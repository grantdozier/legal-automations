var Wy=c=>{throw TypeError(c)};var ld=(c,t,e)=>t.has(c)||Wy("Cannot "+e);var Jt=(c,t,e)=>(ld(c,t,"read from private field"),e?e.call(c):t.get(c)),qn=(c,t,e)=>t.has(c)?Wy("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(c):t.set(c,e),Qe=(c,t,e,s)=>(ld(c,t,"write to private field"),s?s.call(c,e):t.set(c,e),e),$n=(c,t,e)=>(ld(c,t,"access private method"),e);var Qy=(c,t,e,s)=>({set _(a){Qe(c,t,a,e)},get _(){return Jt(c,t,s)}});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=e(a);fetch(a.href,o)}})();var cd={exports:{}},kr={};var Zy;function Zw(){if(Zy)return kr;Zy=1;var c=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(s,a,o){var l=null;if(o!==void 0&&(l=""+o),a.key!==void 0&&(l=""+a.key),"key"in a){o={};for(var h in a)h!=="key"&&(o[h]=a[h])}else o=a;return a=o.ref,{$$typeof:c,type:s,key:l,ref:a!==void 0?a:null,props:o}}return kr.Fragment=t,kr.jsx=e,kr.jsxs=e,kr}var Jy;function Jw(){return Jy||(Jy=1,cd.exports=Zw()),cd.exports}var H=Jw(),ud={exports:{}},bt={};var tb;function tS(){if(tb)return bt;tb=1;var c=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),y=Symbol.for("react.activity"),b=Symbol.iterator;function v(M){return M===null||typeof M!="object"?null:(M=b&&M[b]||M["@@iterator"],typeof M=="function"?M:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,x={};function S(M,q,Q){this.props=M,this.context=q,this.refs=x,this.updater=Q||w}S.prototype.isReactComponent={},S.prototype.setState=function(M,q){if(typeof M!="object"&&typeof M!="function"&&M!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,M,q,"setState")},S.prototype.forceUpdate=function(M){this.updater.enqueueForceUpdate(this,M,"forceUpdate")};function T(){}T.prototype=S.prototype;function C(M,q,Q){this.props=M,this.context=q,this.refs=x,this.updater=Q||w}var N=C.prototype=new T;N.constructor=C,A(N,S.prototype),N.isPureReactComponent=!0;var D=Array.isArray;function L(){}var k={H:null,A:null,T:null,S:null},V=Object.prototype.hasOwnProperty;function K(M,q,Q){var et=Q.ref;return{$$typeof:c,type:M,key:q,ref:et!==void 0?et:null,props:Q}}function J(M,q){return K(M.type,q,M.props)}function W(M){return typeof M=="object"&&M!==null&&M.$$typeof===c}function pt(M){var q={"=":"=0",":":"=2"};return"$"+M.replace(/[=:]/g,function(Q){return q[Q]})}var Tt=/\/+/g;function gt(M,q){return typeof M=="object"&&M!==null&&M.key!=null?pt(""+M.key):q.toString(36)}function Nt(M){switch(M.status){case"fulfilled":return M.value;case"rejected":throw M.reason;default:switch(typeof M.status=="string"?M.then(L,L):(M.status="pending",M.then(function(q){M.status==="pending"&&(M.status="fulfilled",M.value=q)},function(q){M.status==="pending"&&(M.status="rejected",M.reason=q)})),M.status){case"fulfilled":return M.value;case"rejected":throw M.reason}}throw M}function B(M,q,Q,et,ht){var yt=typeof M;(yt==="undefined"||yt==="boolean")&&(M=null);var dt=!1;if(M===null)dt=!0;else switch(yt){case"bigint":case"string":case"number":dt=!0;break;case"object":switch(M.$$typeof){case c:case t:dt=!0;break;case m:return dt=M._init,B(dt(M._payload),q,Q,et,ht)}}if(dt)return ht=ht(M),dt=et===""?"."+gt(M,0):et,D(ht)?(Q="",dt!=null&&(Q=dt.replace(Tt,"$&/")+"/"),B(ht,q,Q,"",function(ei){return ei})):ht!=null&&(W(ht)&&(ht=J(ht,Q+(ht.key==null||M&&M.key===ht.key?"":(""+ht.key).replace(Tt,"$&/")+"/")+dt)),q.push(ht)),1;dt=0;var re=et===""?".":et+":";if(D(M))for(var Vt=0;Vt<M.length;Vt++)et=M[Vt],yt=re+gt(et,Vt),dt+=B(et,q,Q,yt,ht);else if(Vt=v(M),typeof Vt=="function")for(M=Vt.call(M),Vt=0;!(et=M.next()).done;)et=et.value,yt=re+gt(et,Vt++),dt+=B(et,q,Q,yt,ht);else if(yt==="object"){if(typeof M.then=="function")return B(Nt(M),q,Q,et,ht);throw q=String(M),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return dt}function $(M,q,Q){if(M==null)return M;var et=[],ht=0;return B(M,et,"","",function(yt){return q.call(Q,yt,ht++)}),et}function tt(M){if(M._status===-1){var q=M._result;q=q(),q.then(function(Q){(M._status===0||M._status===-1)&&(M._status=1,M._result=Q)},function(Q){(M._status===0||M._status===-1)&&(M._status=2,M._result=Q)}),M._status===-1&&(M._status=0,M._result=q)}if(M._status===1)return M._result.default;throw M._result}var wt=typeof reportError=="function"?reportError:function(M){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof M=="object"&&M!==null&&typeof M.message=="string"?String(M.message):String(M),error:M});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",M);return}console.error(M)},Ct={map:$,forEach:function(M,q,Q){$(M,function(){q.apply(this,arguments)},Q)},count:function(M){var q=0;return $(M,function(){q++}),q},toArray:function(M){return $(M,function(q){return q})||[]},only:function(M){if(!W(M))throw Error("React.Children.only expected to receive a single React element child.");return M}};return bt.Activity=y,bt.Children=Ct,bt.Component=S,bt.Fragment=e,bt.Profiler=a,bt.PureComponent=C,bt.StrictMode=s,bt.Suspense=d,bt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=k,bt.__COMPILER_RUNTIME={__proto__:null,c:function(M){return k.H.useMemoCache(M)}},bt.cache=function(M){return function(){return M.apply(null,arguments)}},bt.cacheSignal=function(){return null},bt.cloneElement=function(M,q,Q){if(M==null)throw Error("The argument must be a React element, but you passed "+M+".");var et=A({},M.props),ht=M.key;if(q!=null)for(yt in q.key!==void 0&&(ht=""+q.key),q)!V.call(q,yt)||yt==="key"||yt==="__self"||yt==="__source"||yt==="ref"&&q.ref===void 0||(et[yt]=q[yt]);var yt=arguments.length-2;if(yt===1)et.children=Q;else if(1<yt){for(var dt=Array(yt),re=0;re<yt;re++)dt[re]=arguments[re+2];et.children=dt}return K(M.type,ht,et)},bt.createContext=function(M){return M={$$typeof:l,_currentValue:M,_currentValue2:M,_threadCount:0,Provider:null,Consumer:null},M.Provider=M,M.Consumer={$$typeof:o,_context:M},M},bt.createElement=function(M,q,Q){var et,ht={},yt=null;if(q!=null)for(et in q.key!==void 0&&(yt=""+q.key),q)V.call(q,et)&&et!=="key"&&et!=="__self"&&et!=="__source"&&(ht[et]=q[et]);var dt=arguments.length-2;if(dt===1)ht.children=Q;else if(1<dt){for(var re=Array(dt),Vt=0;Vt<dt;Vt++)re[Vt]=arguments[Vt+2];ht.children=re}if(M&&M.defaultProps)for(et in dt=M.defaultProps,dt)ht[et]===void 0&&(ht[et]=dt[et]);return K(M,yt,ht)},bt.createRef=function(){return{current:null}},bt.forwardRef=function(M){return{$$typeof:h,render:M}},bt.isValidElement=W,bt.lazy=function(M){return{$$typeof:m,_payload:{_status:-1,_result:M},_init:tt}},bt.memo=function(M,q){return{$$typeof:f,type:M,compare:q===void 0?null:q}},bt.startTransition=function(M){var q=k.T,Q={};k.T=Q;try{var et=M(),ht=k.S;ht!==null&&ht(Q,et),typeof et=="object"&&et!==null&&typeof et.then=="function"&&et.then(L,wt)}catch(yt){wt(yt)}finally{q!==null&&Q.types!==null&&(q.types=Q.types),k.T=q}},bt.unstable_useCacheRefresh=function(){return k.H.useCacheRefresh()},bt.use=function(M){return k.H.use(M)},bt.useActionState=function(M,q,Q){return k.H.useActionState(M,q,Q)},bt.useCallback=function(M,q){return k.H.useCallback(M,q)},bt.useContext=function(M){return k.H.useContext(M)},bt.useDebugValue=function(){},bt.useDeferredValue=function(M,q){return k.H.useDeferredValue(M,q)},bt.useEffect=function(M,q){return k.H.useEffect(M,q)},bt.useEffectEvent=function(M){return k.H.useEffectEvent(M)},bt.useId=function(){return k.H.useId()},bt.useImperativeHandle=function(M,q,Q){return k.H.useImperativeHandle(M,q,Q)},bt.useInsertionEffect=function(M,q){return k.H.useInsertionEffect(M,q)},bt.useLayoutEffect=function(M,q){return k.H.useLayoutEffect(M,q)},bt.useMemo=function(M,q){return k.H.useMemo(M,q)},bt.useOptimistic=function(M,q){return k.H.useOptimistic(M,q)},bt.useReducer=function(M,q,Q){return k.H.useReducer(M,q,Q)},bt.useRef=function(M){return k.H.useRef(M)},bt.useState=function(M){return k.H.useState(M)},bt.useSyncExternalStore=function(M,q,Q){return k.H.useSyncExternalStore(M,q,Q)},bt.useTransition=function(){return k.H.useTransition()},bt.version="19.2.3",bt}var eb;function hf(){return eb||(eb=1,ud.exports=tS()),ud.exports}var en=hf(),hd={exports:{}},Br={},dd={exports:{}},fd={};var nb;function eS(){return nb||(nb=1,(function(c){function t(B,$){var tt=B.length;B.push($);t:for(;0<tt;){var wt=tt-1>>>1,Ct=B[wt];if(0<a(Ct,$))B[wt]=$,B[tt]=Ct,tt=wt;else break t}}function e(B){return B.length===0?null:B[0]}function s(B){if(B.length===0)return null;var $=B[0],tt=B.pop();if(tt!==$){B[0]=tt;t:for(var wt=0,Ct=B.length,M=Ct>>>1;wt<M;){var q=2*(wt+1)-1,Q=B[q],et=q+1,ht=B[et];if(0>a(Q,tt))et<Ct&&0>a(ht,Q)?(B[wt]=ht,B[et]=tt,wt=et):(B[wt]=Q,B[q]=tt,wt=q);else if(et<Ct&&0>a(ht,tt))B[wt]=ht,B[et]=tt,wt=et;else break t}}return $}function a(B,$){var tt=B.sortIndex-$.sortIndex;return tt!==0?tt:B.id-$.id}if(c.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;c.unstable_now=function(){return o.now()}}else{var l=Date,h=l.now();c.unstable_now=function(){return l.now()-h}}var d=[],f=[],m=1,y=null,b=3,v=!1,w=!1,A=!1,x=!1,S=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;function N(B){for(var $=e(f);$!==null;){if($.callback===null)s(f);else if($.startTime<=B)s(f),$.sortIndex=$.expirationTime,t(d,$);else break;$=e(f)}}function D(B){if(A=!1,N(B),!w)if(e(d)!==null)w=!0,L||(L=!0,pt());else{var $=e(f);$!==null&&Nt(D,$.startTime-B)}}var L=!1,k=-1,V=5,K=-1;function J(){return x?!0:!(c.unstable_now()-K<V)}function W(){if(x=!1,L){var B=c.unstable_now();K=B;var $=!0;try{t:{w=!1,A&&(A=!1,T(k),k=-1),v=!0;var tt=b;try{e:{for(N(B),y=e(d);y!==null&&!(y.expirationTime>B&&J());){var wt=y.callback;if(typeof wt=="function"){y.callback=null,b=y.priorityLevel;var Ct=wt(y.expirationTime<=B);if(B=c.unstable_now(),typeof Ct=="function"){y.callback=Ct,N(B),$=!0;break e}y===e(d)&&s(d),N(B)}else s(d);y=e(d)}if(y!==null)$=!0;else{var M=e(f);M!==null&&Nt(D,M.startTime-B),$=!1}}break t}finally{y=null,b=tt,v=!1}$=void 0}}finally{$?pt():L=!1}}}var pt;if(typeof C=="function")pt=function(){C(W)};else if(typeof MessageChannel<"u"){var Tt=new MessageChannel,gt=Tt.port2;Tt.port1.onmessage=W,pt=function(){gt.postMessage(null)}}else pt=function(){S(W,0)};function Nt(B,$){k=S(function(){B(c.unstable_now())},$)}c.unstable_IdlePriority=5,c.unstable_ImmediatePriority=1,c.unstable_LowPriority=4,c.unstable_NormalPriority=3,c.unstable_Profiling=null,c.unstable_UserBlockingPriority=2,c.unstable_cancelCallback=function(B){B.callback=null},c.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):V=0<B?Math.floor(1e3/B):5},c.unstable_getCurrentPriorityLevel=function(){return b},c.unstable_next=function(B){switch(b){case 1:case 2:case 3:var $=3;break;default:$=b}var tt=b;b=$;try{return B()}finally{b=tt}},c.unstable_requestPaint=function(){x=!0},c.unstable_runWithPriority=function(B,$){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var tt=b;b=B;try{return $()}finally{b=tt}},c.unstable_scheduleCallback=function(B,$,tt){var wt=c.unstable_now();switch(typeof tt=="object"&&tt!==null?(tt=tt.delay,tt=typeof tt=="number"&&0<tt?wt+tt:wt):tt=wt,B){case 1:var Ct=-1;break;case 2:Ct=250;break;case 5:Ct=1073741823;break;case 4:Ct=1e4;break;default:Ct=5e3}return Ct=tt+Ct,B={id:m++,callback:$,priorityLevel:B,startTime:tt,expirationTime:Ct,sortIndex:-1},tt>wt?(B.sortIndex=tt,t(f,B),e(d)===null&&B===e(f)&&(A?(T(k),k=-1):A=!0,Nt(D,tt-wt))):(B.sortIndex=Ct,t(d,B),w||v||(w=!0,L||(L=!0,pt()))),B},c.unstable_shouldYield=J,c.unstable_wrapCallback=function(B){var $=b;return function(){var tt=b;b=$;try{return B.apply(this,arguments)}finally{b=tt}}}})(fd)),fd}var sb;function nS(){return sb||(sb=1,dd.exports=eS()),dd.exports}var pd={exports:{}},Fe={};var ib;function sS(){if(ib)return Fe;ib=1;var c=hf();function t(d){var f="https://react.dev/errors/"+d;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)f+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+d+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var s={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},a=Symbol.for("react.portal");function o(d,f,m){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:y==null?null:""+y,children:d,containerInfo:f,implementation:m}}var l=c.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(d,f){if(d==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Fe.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Fe.createPortal=function(d,f){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(t(299));return o(d,f,null,m)},Fe.flushSync=function(d){var f=l.T,m=s.p;try{if(l.T=null,s.p=2,d)return d()}finally{l.T=f,s.p=m,s.d.f()}},Fe.preconnect=function(d,f){typeof d=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,s.d.C(d,f))},Fe.prefetchDNS=function(d){typeof d=="string"&&s.d.D(d)},Fe.preinit=function(d,f){if(typeof d=="string"&&f&&typeof f.as=="string"){var m=f.as,y=h(m,f.crossOrigin),b=typeof f.integrity=="string"?f.integrity:void 0,v=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;m==="style"?s.d.S(d,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:y,integrity:b,fetchPriority:v}):m==="script"&&s.d.X(d,{crossOrigin:y,integrity:b,fetchPriority:v,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Fe.preinitModule=function(d,f){if(typeof d=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var m=h(f.as,f.crossOrigin);s.d.M(d,{crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&s.d.M(d)},Fe.preload=function(d,f){if(typeof d=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var m=f.as,y=h(m,f.crossOrigin);s.d.L(d,m,{crossOrigin:y,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Fe.preloadModule=function(d,f){if(typeof d=="string")if(f){var m=h(f.as,f.crossOrigin);s.d.m(d,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else s.d.m(d)},Fe.requestFormReset=function(d){s.d.r(d)},Fe.unstable_batchedUpdates=function(d,f){return d(f)},Fe.useFormState=function(d,f,m){return l.H.useFormState(d,f,m)},Fe.useFormStatus=function(){return l.H.useHostTransitionStatus()},Fe.version="19.2.3",Fe}var ab;function iS(){if(ab)return pd.exports;ab=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(t){console.error(t)}}return c(),pd.exports=sS(),pd.exports}var rb;function aS(){if(rb)return Br;rb=1;var c=nS(),t=hf(),e=iS();function s(n){var i="https://react.dev/errors/"+n;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)i+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+n+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function o(n){var i=n,r=n;if(n.alternate)for(;i.return;)i=i.return;else{n=i;do i=n,(i.flags&4098)!==0&&(r=i.return),n=i.return;while(n)}return i.tag===3?r:null}function l(n){if(n.tag===13){var i=n.memoizedState;if(i===null&&(n=n.alternate,n!==null&&(i=n.memoizedState)),i!==null)return i.dehydrated}return null}function h(n){if(n.tag===31){var i=n.memoizedState;if(i===null&&(n=n.alternate,n!==null&&(i=n.memoizedState)),i!==null)return i.dehydrated}return null}function d(n){if(o(n)!==n)throw Error(s(188))}function f(n){var i=n.alternate;if(!i){if(i=o(n),i===null)throw Error(s(188));return i!==n?null:n}for(var r=n,u=i;;){var p=r.return;if(p===null)break;var g=p.alternate;if(g===null){if(u=p.return,u!==null){r=u;continue}break}if(p.child===g.child){for(g=p.child;g;){if(g===r)return d(p),n;if(g===u)return d(p),i;g=g.sibling}throw Error(s(188))}if(r.return!==u.return)r=p,u=g;else{for(var _=!1,E=p.child;E;){if(E===r){_=!0,r=p,u=g;break}if(E===u){_=!0,u=p,r=g;break}E=E.sibling}if(!_){for(E=g.child;E;){if(E===r){_=!0,r=g,u=p;break}if(E===u){_=!0,u=g,r=p;break}E=E.sibling}if(!_)throw Error(s(189))}}if(r.alternate!==u)throw Error(s(190))}if(r.tag!==3)throw Error(s(188));return r.stateNode.current===r?n:i}function m(n){var i=n.tag;if(i===5||i===26||i===27||i===6)return n;for(n=n.child;n!==null;){if(i=m(n),i!==null)return i;n=n.sibling}return null}var y=Object.assign,b=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),x=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),T=Symbol.for("react.consumer"),C=Symbol.for("react.context"),N=Symbol.for("react.forward_ref"),D=Symbol.for("react.suspense"),L=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),V=Symbol.for("react.lazy"),K=Symbol.for("react.activity"),J=Symbol.for("react.memo_cache_sentinel"),W=Symbol.iterator;function pt(n){return n===null||typeof n!="object"?null:(n=W&&n[W]||n["@@iterator"],typeof n=="function"?n:null)}var Tt=Symbol.for("react.client.reference");function gt(n){if(n==null)return null;if(typeof n=="function")return n.$$typeof===Tt?null:n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case A:return"Fragment";case S:return"Profiler";case x:return"StrictMode";case D:return"Suspense";case L:return"SuspenseList";case K:return"Activity"}if(typeof n=="object")switch(n.$$typeof){case w:return"Portal";case C:return n.displayName||"Context";case T:return(n._context.displayName||"Context")+".Consumer";case N:var i=n.render;return n=n.displayName,n||(n=i.displayName||i.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case k:return i=n.displayName||null,i!==null?i:gt(n.type)||"Memo";case V:i=n._payload,n=n._init;try{return gt(n(i))}catch{}}return null}var Nt=Array.isArray,B=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,tt={pending:!1,data:null,method:null,action:null},wt=[],Ct=-1;function M(n){return{current:n}}function q(n){0>Ct||(n.current=wt[Ct],wt[Ct]=null,Ct--)}function Q(n,i){Ct++,wt[Ct]=n.current,n.current=i}var et=M(null),ht=M(null),yt=M(null),dt=M(null);function re(n,i){switch(Q(yt,i),Q(ht,n),Q(et,null),i.nodeType){case 9:case 11:n=(n=i.documentElement)&&(n=n.namespaceURI)?vy(n):0;break;default:if(n=i.tagName,i=i.namespaceURI)i=vy(i),n=_y(i,n);else switch(n){case"svg":n=1;break;case"math":n=2;break;default:n=0}}q(et),Q(et,n)}function Vt(){q(et),q(ht),q(yt)}function ei(n){n.memoizedState!==null&&Q(dt,n);var i=et.current,r=_y(i,n.type);i!==r&&(Q(ht,n),Q(et,r))}function Ss(n){ht.current===n&&(q(et),q(ht)),dt.current===n&&(q(dt),Dr._currentValue=tt)}var ni,Ha;function Jn(n){if(ni===void 0)try{throw Error()}catch(r){var i=r.stack.trim().match(/\n( *(at )?)/);ni=i&&i[1]||"",Ha=-1<r.stack.indexOf(`
    at`)?" (<anonymous>)":-1<r.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ni+n+Ha}var Gc=!1;function Xc(n,i){if(!n||Gc)return"";Gc=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(i){var Y=function(){throw Error()};if(Object.defineProperty(Y.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Y,[])}catch(j){var z=j}Reflect.construct(n,[],Y)}else{try{Y.call()}catch(j){z=j}n.call(Y.prototype)}}else{try{throw Error()}catch(j){z=j}(Y=n())&&typeof Y.catch=="function"&&Y.catch(function(){})}}catch(j){if(j&&z&&typeof j.stack=="string")return[j.stack,z.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var g=u.DetermineComponentFrameRoot(),_=g[0],E=g[1];if(_&&E){var R=_.split(`
`),F=E.split(`
`);for(p=u=0;u<R.length&&!R[u].includes("DetermineComponentFrameRoot");)u++;for(;p<F.length&&!F[p].includes("DetermineComponentFrameRoot");)p++;if(u===R.length||p===F.length)for(u=R.length-1,p=F.length-1;1<=u&&0<=p&&R[u]!==F[p];)p--;for(;1<=u&&0<=p;u--,p--)if(R[u]!==F[p]){if(u!==1||p!==1)do if(u--,p--,0>p||R[u]!==F[p]){var G=`
`+R[u].replace(" at new "," at ");return n.displayName&&G.includes("<anonymous>")&&(G=G.replace("<anonymous>",n.displayName)),G}while(1<=u&&0<=p);break}}}finally{Gc=!1,Error.prepareStackTrace=r}return(r=n?n.displayName||n.name:"")?Jn(r):""}function M_(n,i){switch(n.tag){case 26:case 27:case 5:return Jn(n.type);case 16:return Jn("Lazy");case 13:return n.child!==i&&i!==null?Jn("Suspense Fallback"):Jn("Suspense");case 19:return Jn("SuspenseList");case 0:case 15:return Xc(n.type,!1);case 11:return Xc(n.type.render,!1);case 1:return Xc(n.type,!0);case 31:return Jn("Activity");default:return""}}function Wf(n){try{var i="",r=null;do i+=M_(n,r),r=n,n=n.return;while(n);return i}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}var Vc=Object.prototype.hasOwnProperty,Yc=c.unstable_scheduleCallback,Kc=c.unstable_cancelCallback,D_=c.unstable_shouldYield,O_=c.unstable_requestPaint,nn=c.unstable_now,N_=c.unstable_getCurrentPriorityLevel,Qf=c.unstable_ImmediatePriority,Zf=c.unstable_UserBlockingPriority,Ao=c.unstable_NormalPriority,L_=c.unstable_LowPriority,Jf=c.unstable_IdlePriority,k_=c.log,B_=c.unstable_setDisableYieldValue,ja=null,sn=null;function Es(n){if(typeof k_=="function"&&B_(n),sn&&typeof sn.setStrictMode=="function")try{sn.setStrictMode(ja,n)}catch{}}var an=Math.clz32?Math.clz32:F_,I_=Math.log,P_=Math.LN2;function F_(n){return n>>>=0,n===0?32:31-(I_(n)/P_|0)|0}var wo=256,So=262144,Eo=4194304;function si(n){var i=n&42;if(i!==0)return i;switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return n&261888;case 262144:case 524288:case 1048576:case 2097152:return n&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return n&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return n}}function xo(n,i,r){var u=n.pendingLanes;if(u===0)return 0;var p=0,g=n.suspendedLanes,_=n.pingedLanes;n=n.warmLanes;var E=u&134217727;return E!==0?(u=E&~g,u!==0?p=si(u):(_&=E,_!==0?p=si(_):r||(r=E&~n,r!==0&&(p=si(r))))):(E=u&~g,E!==0?p=si(E):_!==0?p=si(_):r||(r=u&~n,r!==0&&(p=si(r)))),p===0?0:i!==0&&i!==p&&(i&g)===0&&(g=p&-p,r=i&-i,g>=r||g===32&&(r&4194048)!==0)?i:p}function qa(n,i){return(n.pendingLanes&~(n.suspendedLanes&~n.pingedLanes)&i)===0}function U_(n,i){switch(n){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tp(){var n=Eo;return Eo<<=1,(Eo&62914560)===0&&(Eo=4194304),n}function Wc(n){for(var i=[],r=0;31>r;r++)i.push(n);return i}function $a(n,i){n.pendingLanes|=i,i!==268435456&&(n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0)}function z_(n,i,r,u,p,g){var _=n.pendingLanes;n.pendingLanes=r,n.suspendedLanes=0,n.pingedLanes=0,n.warmLanes=0,n.expiredLanes&=r,n.entangledLanes&=r,n.errorRecoveryDisabledLanes&=r,n.shellSuspendCounter=0;var E=n.entanglements,R=n.expirationTimes,F=n.hiddenUpdates;for(r=_&~r;0<r;){var G=31-an(r),Y=1<<G;E[G]=0,R[G]=-1;var z=F[G];if(z!==null)for(F[G]=null,G=0;G<z.length;G++){var j=z[G];j!==null&&(j.lane&=-536870913)}r&=~Y}u!==0&&ep(n,u,0),g!==0&&p===0&&n.tag!==0&&(n.suspendedLanes|=g&~(_&~i))}function ep(n,i,r){n.pendingLanes|=i,n.suspendedLanes&=~i;var u=31-an(i);n.entangledLanes|=i,n.entanglements[u]=n.entanglements[u]|1073741824|r&261930}function np(n,i){var r=n.entangledLanes|=i;for(n=n.entanglements;r;){var u=31-an(r),p=1<<u;p&i|n[u]&i&&(n[u]|=i),r&=~p}}function sp(n,i){var r=i&-i;return r=(r&42)!==0?1:Qc(r),(r&(n.suspendedLanes|i))!==0?0:r}function Qc(n){switch(n){case 2:n=1;break;case 8:n=4;break;case 32:n=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:n=128;break;case 268435456:n=134217728;break;default:n=0}return n}function Zc(n){return n&=-n,2<n?8<n?(n&134217727)!==0?32:268435456:8:2}function ip(){var n=$.p;return n!==0?n:(n=window.event,n===void 0?32:qy(n.type))}function ap(n,i){var r=$.p;try{return $.p=n,i()}finally{$.p=r}}var xs=Math.random().toString(36).slice(2),Ce="__reactFiber$"+xs,$e="__reactProps$"+xs,Bi="__reactContainer$"+xs,Jc="__reactEvents$"+xs,H_="__reactListeners$"+xs,j_="__reactHandles$"+xs,rp="__reactResources$"+xs,Ga="__reactMarker$"+xs;function tu(n){delete n[Ce],delete n[$e],delete n[Jc],delete n[H_],delete n[j_]}function Ii(n){var i=n[Ce];if(i)return i;for(var r=n.parentNode;r;){if(i=r[Bi]||r[Ce]){if(r=i.alternate,i.child!==null||r!==null&&r.child!==null)for(n=Cy(n);n!==null;){if(r=n[Ce])return r;n=Cy(n)}return i}n=r,r=n.parentNode}return null}function Pi(n){if(n=n[Ce]||n[Bi]){var i=n.tag;if(i===5||i===6||i===13||i===31||i===26||i===27||i===3)return n}return null}function Xa(n){var i=n.tag;if(i===5||i===26||i===27||i===6)return n.stateNode;throw Error(s(33))}function Fi(n){var i=n[rp];return i||(i=n[rp]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function we(n){n[Ga]=!0}var op=new Set,lp={};function ii(n,i){Ui(n,i),Ui(n+"Capture",i)}function Ui(n,i){for(lp[n]=i,n=0;n<i.length;n++)op.add(i[n])}var q_=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),cp={},up={};function $_(n){return Vc.call(up,n)?!0:Vc.call(cp,n)?!1:q_.test(n)?up[n]=!0:(cp[n]=!0,!1)}function To(n,i,r){if($_(i))if(r===null)n.removeAttribute(i);else{switch(typeof r){case"undefined":case"function":case"symbol":n.removeAttribute(i);return;case"boolean":var u=i.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){n.removeAttribute(i);return}}n.setAttribute(i,""+r)}}function Co(n,i,r){if(r===null)n.removeAttribute(i);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(i);return}n.setAttribute(i,""+r)}}function ts(n,i,r,u){if(u===null)n.removeAttribute(r);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":n.removeAttribute(r);return}n.setAttributeNS(i,r,""+u)}}function vn(n){switch(typeof n){case"bigint":case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function hp(n){var i=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function G_(n,i,r){var u=Object.getOwnPropertyDescriptor(n.constructor.prototype,i);if(!n.hasOwnProperty(i)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var p=u.get,g=u.set;return Object.defineProperty(n,i,{configurable:!0,get:function(){return p.call(this)},set:function(_){r=""+_,g.call(this,_)}}),Object.defineProperty(n,i,{enumerable:u.enumerable}),{getValue:function(){return r},setValue:function(_){r=""+_},stopTracking:function(){n._valueTracker=null,delete n[i]}}}}function eu(n){if(!n._valueTracker){var i=hp(n)?"checked":"value";n._valueTracker=G_(n,i,""+n[i])}}function dp(n){if(!n)return!1;var i=n._valueTracker;if(!i)return!0;var r=i.getValue(),u="";return n&&(u=hp(n)?n.checked?"true":"false":n.value),n=u,n!==r?(i.setValue(n),!0):!1}function Ro(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}var X_=/[\n"\\]/g;function _n(n){return n.replace(X_,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function nu(n,i,r,u,p,g,_,E){n.name="",_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"?n.type=_:n.removeAttribute("type"),i!=null?_==="number"?(i===0&&n.value===""||n.value!=i)&&(n.value=""+vn(i)):n.value!==""+vn(i)&&(n.value=""+vn(i)):_!=="submit"&&_!=="reset"||n.removeAttribute("value"),i!=null?su(n,_,vn(i)):r!=null?su(n,_,vn(r)):u!=null&&n.removeAttribute("value"),p==null&&g!=null&&(n.defaultChecked=!!g),p!=null&&(n.checked=p&&typeof p!="function"&&typeof p!="symbol"),E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?n.name=""+vn(E):n.removeAttribute("name")}function fp(n,i,r,u,p,g,_,E){if(g!=null&&typeof g!="function"&&typeof g!="symbol"&&typeof g!="boolean"&&(n.type=g),i!=null||r!=null){if(!(g!=="submit"&&g!=="reset"||i!=null)){eu(n);return}r=r!=null?""+vn(r):"",i=i!=null?""+vn(i):r,E||i===n.value||(n.value=i),n.defaultValue=i}u=u??p,u=typeof u!="function"&&typeof u!="symbol"&&!!u,n.checked=E?n.checked:!!u,n.defaultChecked=!!u,_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(n.name=_),eu(n)}function su(n,i,r){i==="number"&&Ro(n.ownerDocument)===n||n.defaultValue===""+r||(n.defaultValue=""+r)}function zi(n,i,r,u){if(n=n.options,i){i={};for(var p=0;p<r.length;p++)i["$"+r[p]]=!0;for(r=0;r<n.length;r++)p=i.hasOwnProperty("$"+n[r].value),n[r].selected!==p&&(n[r].selected=p),p&&u&&(n[r].defaultSelected=!0)}else{for(r=""+vn(r),i=null,p=0;p<n.length;p++){if(n[p].value===r){n[p].selected=!0,u&&(n[p].defaultSelected=!0);return}i!==null||n[p].disabled||(i=n[p])}i!==null&&(i.selected=!0)}}function pp(n,i,r){if(i!=null&&(i=""+vn(i),i!==n.value&&(n.value=i),r==null)){n.defaultValue!==i&&(n.defaultValue=i);return}n.defaultValue=r!=null?""+vn(r):""}function mp(n,i,r,u){if(i==null){if(u!=null){if(r!=null)throw Error(s(92));if(Nt(u)){if(1<u.length)throw Error(s(93));u=u[0]}r=u}r==null&&(r=""),i=r}r=vn(i),n.defaultValue=r,u=n.textContent,u===r&&u!==""&&u!==null&&(n.value=u),eu(n)}function Hi(n,i){if(i){var r=n.firstChild;if(r&&r===n.lastChild&&r.nodeType===3){r.nodeValue=i;return}}n.textContent=i}var V_=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function gp(n,i,r){var u=i.indexOf("--")===0;r==null||typeof r=="boolean"||r===""?u?n.setProperty(i,""):i==="float"?n.cssFloat="":n[i]="":u?n.setProperty(i,r):typeof r!="number"||r===0||V_.has(i)?i==="float"?n.cssFloat=r:n[i]=(""+r).trim():n[i]=r+"px"}function yp(n,i,r){if(i!=null&&typeof i!="object")throw Error(s(62));if(n=n.style,r!=null){for(var u in r)!r.hasOwnProperty(u)||i!=null&&i.hasOwnProperty(u)||(u.indexOf("--")===0?n.setProperty(u,""):u==="float"?n.cssFloat="":n[u]="");for(var p in i)u=i[p],i.hasOwnProperty(p)&&r[p]!==u&&gp(n,p,u)}else for(var g in i)i.hasOwnProperty(g)&&gp(n,g,i[g])}function iu(n){if(n.indexOf("-")===-1)return!1;switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Y_=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),K_=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Mo(n){return K_.test(""+n)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":n}function es(){}var au=null;function ru(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var ji=null,qi=null;function bp(n){var i=Pi(n);if(i&&(n=i.stateNode)){var r=n[$e]||null;t:switch(n=i.stateNode,i.type){case"input":if(nu(n,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name),i=r.name,r.type==="radio"&&i!=null){for(r=n;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll('input[name="'+_n(""+i)+'"][type="radio"]'),i=0;i<r.length;i++){var u=r[i];if(u!==n&&u.form===n.form){var p=u[$e]||null;if(!p)throw Error(s(90));nu(u,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(i=0;i<r.length;i++)u=r[i],u.form===n.form&&dp(u)}break t;case"textarea":pp(n,r.value,r.defaultValue);break t;case"select":i=r.value,i!=null&&zi(n,!!r.multiple,i,!1)}}}var ou=!1;function vp(n,i,r){if(ou)return n(i,r);ou=!0;try{var u=n(i);return u}finally{if(ou=!1,(ji!==null||qi!==null)&&(gl(),ji&&(i=ji,n=qi,qi=ji=null,bp(i),n)))for(i=0;i<n.length;i++)bp(n[i])}}function Va(n,i){var r=n.stateNode;if(r===null)return null;var u=r[$e]||null;if(u===null)return null;r=u[i];t:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(n=n.type,u=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!u;break t;default:n=!1}if(n)return null;if(r&&typeof r!="function")throw Error(s(231,i,typeof r));return r}var ns=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),lu=!1;if(ns)try{var Ya={};Object.defineProperty(Ya,"passive",{get:function(){lu=!0}}),window.addEventListener("test",Ya,Ya),window.removeEventListener("test",Ya,Ya)}catch{lu=!1}var Ts=null,cu=null,Do=null;function _p(){if(Do)return Do;var n,i=cu,r=i.length,u,p="value"in Ts?Ts.value:Ts.textContent,g=p.length;for(n=0;n<r&&i[n]===p[n];n++);var _=r-n;for(u=1;u<=_&&i[r-u]===p[g-u];u++);return Do=p.slice(n,1<u?1-u:void 0)}function Oo(n){var i=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&i===13&&(n=13)):n=i,n===10&&(n=13),32<=n||n===13?n:0}function No(){return!0}function Ap(){return!1}function Ge(n){function i(r,u,p,g,_){this._reactName=r,this._targetInst=p,this.type=u,this.nativeEvent=g,this.target=_,this.currentTarget=null;for(var E in n)n.hasOwnProperty(E)&&(r=n[E],this[E]=r?r(g):g[E]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?No:Ap,this.isPropagationStopped=Ap,this}return y(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=No)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=No)},persist:function(){},isPersistent:No}),i}var ai={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Lo=Ge(ai),Ka=y({},ai,{view:0,detail:0}),W_=Ge(Ka),uu,hu,Wa,ko=y({},Ka,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:fu,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Wa&&(Wa&&n.type==="mousemove"?(uu=n.screenX-Wa.screenX,hu=n.screenY-Wa.screenY):hu=uu=0,Wa=n),uu)},movementY:function(n){return"movementY"in n?n.movementY:hu}}),wp=Ge(ko),Q_=y({},ko,{dataTransfer:0}),Z_=Ge(Q_),J_=y({},Ka,{relatedTarget:0}),du=Ge(J_),tA=y({},ai,{animationName:0,elapsedTime:0,pseudoElement:0}),eA=Ge(tA),nA=y({},ai,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),sA=Ge(nA),iA=y({},ai,{data:0}),Sp=Ge(iA),aA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},rA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},oA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function lA(n){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(n):(n=oA[n])?!!i[n]:!1}function fu(){return lA}var cA=y({},Ka,{key:function(n){if(n.key){var i=aA[n.key]||n.key;if(i!=="Unidentified")return i}return n.type==="keypress"?(n=Oo(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?rA[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:fu,charCode:function(n){return n.type==="keypress"?Oo(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Oo(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),uA=Ge(cA),hA=y({},ko,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ep=Ge(hA),dA=y({},Ka,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:fu}),fA=Ge(dA),pA=y({},ai,{propertyName:0,elapsedTime:0,pseudoElement:0}),mA=Ge(pA),gA=y({},ko,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),yA=Ge(gA),bA=y({},ai,{newState:0,oldState:0}),vA=Ge(bA),_A=[9,13,27,32],pu=ns&&"CompositionEvent"in window,Qa=null;ns&&"documentMode"in document&&(Qa=document.documentMode);var AA=ns&&"TextEvent"in window&&!Qa,xp=ns&&(!pu||Qa&&8<Qa&&11>=Qa),Tp=" ",Cp=!1;function Rp(n,i){switch(n){case"keyup":return _A.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mp(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var $i=!1;function wA(n,i){switch(n){case"compositionend":return Mp(i);case"keypress":return i.which!==32?null:(Cp=!0,Tp);case"textInput":return n=i.data,n===Tp&&Cp?null:n;default:return null}}function SA(n,i){if($i)return n==="compositionend"||!pu&&Rp(n,i)?(n=_p(),Do=cu=Ts=null,$i=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return xp&&i.locale!=="ko"?null:i.data;default:return null}}var EA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Dp(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i==="input"?!!EA[n.type]:i==="textarea"}function Op(n,i,r,u){ji?qi?qi.push(u):qi=[u]:ji=u,i=Sl(i,"onChange"),0<i.length&&(r=new Lo("onChange","change",null,r,u),n.push({event:r,listeners:i}))}var Za=null,Ja=null;function xA(n){fy(n,0)}function Bo(n){var i=Xa(n);if(dp(i))return n}function Np(n,i){if(n==="change")return i}var Lp=!1;if(ns){var mu;if(ns){var gu="oninput"in document;if(!gu){var kp=document.createElement("div");kp.setAttribute("oninput","return;"),gu=typeof kp.oninput=="function"}mu=gu}else mu=!1;Lp=mu&&(!document.documentMode||9<document.documentMode)}function Bp(){Za&&(Za.detachEvent("onpropertychange",Ip),Ja=Za=null)}function Ip(n){if(n.propertyName==="value"&&Bo(Ja)){var i=[];Op(i,Ja,n,ru(n)),vp(xA,i)}}function TA(n,i,r){n==="focusin"?(Bp(),Za=i,Ja=r,Za.attachEvent("onpropertychange",Ip)):n==="focusout"&&Bp()}function CA(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Bo(Ja)}function RA(n,i){if(n==="click")return Bo(i)}function MA(n,i){if(n==="input"||n==="change")return Bo(i)}function DA(n,i){return n===i&&(n!==0||1/n===1/i)||n!==n&&i!==i}var rn=typeof Object.is=="function"?Object.is:DA;function tr(n,i){if(rn(n,i))return!0;if(typeof n!="object"||n===null||typeof i!="object"||i===null)return!1;var r=Object.keys(n),u=Object.keys(i);if(r.length!==u.length)return!1;for(u=0;u<r.length;u++){var p=r[u];if(!Vc.call(i,p)||!rn(n[p],i[p]))return!1}return!0}function Pp(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Fp(n,i){var r=Pp(n);n=0;for(var u;r;){if(r.nodeType===3){if(u=n+r.textContent.length,n<=i&&u>=i)return{node:r,offset:i-n};n=u}t:{for(;r;){if(r.nextSibling){r=r.nextSibling;break t}r=r.parentNode}r=void 0}r=Pp(r)}}function Up(n,i){return n&&i?n===i?!0:n&&n.nodeType===3?!1:i&&i.nodeType===3?Up(n,i.parentNode):"contains"in n?n.contains(i):n.compareDocumentPosition?!!(n.compareDocumentPosition(i)&16):!1:!1}function zp(n){n=n!=null&&n.ownerDocument!=null&&n.ownerDocument.defaultView!=null?n.ownerDocument.defaultView:window;for(var i=Ro(n.document);i instanceof n.HTMLIFrameElement;){try{var r=typeof i.contentWindow.location.href=="string"}catch{r=!1}if(r)n=i.contentWindow;else break;i=Ro(n.document)}return i}function yu(n){var i=n&&n.nodeName&&n.nodeName.toLowerCase();return i&&(i==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||i==="textarea"||n.contentEditable==="true")}var OA=ns&&"documentMode"in document&&11>=document.documentMode,Gi=null,bu=null,er=null,vu=!1;function Hp(n,i,r){var u=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;vu||Gi==null||Gi!==Ro(u)||(u=Gi,"selectionStart"in u&&yu(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),er&&tr(er,u)||(er=u,u=Sl(bu,"onSelect"),0<u.length&&(i=new Lo("onSelect","select",null,i,r),n.push({event:i,listeners:u}),i.target=Gi)))}function ri(n,i){var r={};return r[n.toLowerCase()]=i.toLowerCase(),r["Webkit"+n]="webkit"+i,r["Moz"+n]="moz"+i,r}var Xi={animationend:ri("Animation","AnimationEnd"),animationiteration:ri("Animation","AnimationIteration"),animationstart:ri("Animation","AnimationStart"),transitionrun:ri("Transition","TransitionRun"),transitionstart:ri("Transition","TransitionStart"),transitioncancel:ri("Transition","TransitionCancel"),transitionend:ri("Transition","TransitionEnd")},_u={},jp={};ns&&(jp=document.createElement("div").style,"AnimationEvent"in window||(delete Xi.animationend.animation,delete Xi.animationiteration.animation,delete Xi.animationstart.animation),"TransitionEvent"in window||delete Xi.transitionend.transition);function oi(n){if(_u[n])return _u[n];if(!Xi[n])return n;var i=Xi[n],r;for(r in i)if(i.hasOwnProperty(r)&&r in jp)return _u[n]=i[r];return n}var qp=oi("animationend"),$p=oi("animationiteration"),Gp=oi("animationstart"),NA=oi("transitionrun"),LA=oi("transitionstart"),kA=oi("transitioncancel"),Xp=oi("transitionend"),Vp=new Map,Au="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Au.push("scrollEnd");function kn(n,i){Vp.set(n,i),ii(i,[n])}var Io=typeof reportError=="function"?reportError:function(n){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof n=="object"&&n!==null&&typeof n.message=="string"?String(n.message):String(n),error:n});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",n);return}console.error(n)},An=[],Vi=0,wu=0;function Po(){for(var n=Vi,i=wu=Vi=0;i<n;){var r=An[i];An[i++]=null;var u=An[i];An[i++]=null;var p=An[i];An[i++]=null;var g=An[i];if(An[i++]=null,u!==null&&p!==null){var _=u.pending;_===null?p.next=p:(p.next=_.next,_.next=p),u.pending=p}g!==0&&Yp(r,p,g)}}function Fo(n,i,r,u){An[Vi++]=n,An[Vi++]=i,An[Vi++]=r,An[Vi++]=u,wu|=u,n.lanes|=u,n=n.alternate,n!==null&&(n.lanes|=u)}function Su(n,i,r,u){return Fo(n,i,r,u),Uo(n)}function li(n,i){return Fo(n,null,null,i),Uo(n)}function Yp(n,i,r){n.lanes|=r;var u=n.alternate;u!==null&&(u.lanes|=r);for(var p=!1,g=n.return;g!==null;)g.childLanes|=r,u=g.alternate,u!==null&&(u.childLanes|=r),g.tag===22&&(n=g.stateNode,n===null||n._visibility&1||(p=!0)),n=g,g=g.return;return n.tag===3?(g=n.stateNode,p&&i!==null&&(p=31-an(r),n=g.hiddenUpdates,u=n[p],u===null?n[p]=[i]:u.push(i),i.lane=r|536870912),g):null}function Uo(n){if(50<Sr)throw Sr=0,Nh=null,Error(s(185));for(var i=n.return;i!==null;)n=i,i=n.return;return n.tag===3?n.stateNode:null}var Yi={};function BA(n,i,r,u){this.tag=n,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function on(n,i,r,u){return new BA(n,i,r,u)}function Eu(n){return n=n.prototype,!(!n||!n.isReactComponent)}function ss(n,i){var r=n.alternate;return r===null?(r=on(n.tag,i,n.key,n.mode),r.elementType=n.elementType,r.type=n.type,r.stateNode=n.stateNode,r.alternate=n,n.alternate=r):(r.pendingProps=i,r.type=n.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=n.flags&65011712,r.childLanes=n.childLanes,r.lanes=n.lanes,r.child=n.child,r.memoizedProps=n.memoizedProps,r.memoizedState=n.memoizedState,r.updateQueue=n.updateQueue,i=n.dependencies,r.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},r.sibling=n.sibling,r.index=n.index,r.ref=n.ref,r.refCleanup=n.refCleanup,r}function Kp(n,i){n.flags&=65011714;var r=n.alternate;return r===null?(n.childLanes=0,n.lanes=i,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=r.childLanes,n.lanes=r.lanes,n.child=r.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=r.memoizedProps,n.memoizedState=r.memoizedState,n.updateQueue=r.updateQueue,n.type=r.type,i=r.dependencies,n.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),n}function zo(n,i,r,u,p,g){var _=0;if(u=n,typeof n=="function")Eu(n)&&(_=1);else if(typeof n=="string")_=zw(n,r,et.current)?26:n==="html"||n==="head"||n==="body"?27:5;else t:switch(n){case K:return n=on(31,r,i,p),n.elementType=K,n.lanes=g,n;case A:return ci(r.children,p,g,i);case x:_=8,p|=24;break;case S:return n=on(12,r,i,p|2),n.elementType=S,n.lanes=g,n;case D:return n=on(13,r,i,p),n.elementType=D,n.lanes=g,n;case L:return n=on(19,r,i,p),n.elementType=L,n.lanes=g,n;default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case C:_=10;break t;case T:_=9;break t;case N:_=11;break t;case k:_=14;break t;case V:_=16,u=null;break t}_=29,r=Error(s(130,n===null?"null":typeof n,"")),u=null}return i=on(_,r,i,p),i.elementType=n,i.type=u,i.lanes=g,i}function ci(n,i,r,u){return n=on(7,n,u,i),n.lanes=r,n}function xu(n,i,r){return n=on(6,n,null,i),n.lanes=r,n}function Wp(n){var i=on(18,null,null,0);return i.stateNode=n,i}function Tu(n,i,r){return i=on(4,n.children!==null?n.children:[],n.key,i),i.lanes=r,i.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},i}var Qp=new WeakMap;function wn(n,i){if(typeof n=="object"&&n!==null){var r=Qp.get(n);return r!==void 0?r:(i={value:n,source:i,stack:Wf(i)},Qp.set(n,i),i)}return{value:n,source:i,stack:Wf(i)}}var Ki=[],Wi=0,Ho=null,nr=0,Sn=[],En=0,Cs=null,Un=1,zn="";function is(n,i){Ki[Wi++]=nr,Ki[Wi++]=Ho,Ho=n,nr=i}function Zp(n,i,r){Sn[En++]=Un,Sn[En++]=zn,Sn[En++]=Cs,Cs=n;var u=Un;n=zn;var p=32-an(u)-1;u&=~(1<<p),r+=1;var g=32-an(i)+p;if(30<g){var _=p-p%5;g=(u&(1<<_)-1).toString(32),u>>=_,p-=_,Un=1<<32-an(i)+p|r<<p|u,zn=g+n}else Un=1<<g|r<<p|u,zn=n}function Cu(n){n.return!==null&&(is(n,1),Zp(n,1,0))}function Ru(n){for(;n===Ho;)Ho=Ki[--Wi],Ki[Wi]=null,nr=Ki[--Wi],Ki[Wi]=null;for(;n===Cs;)Cs=Sn[--En],Sn[En]=null,zn=Sn[--En],Sn[En]=null,Un=Sn[--En],Sn[En]=null}function Jp(n,i){Sn[En++]=Un,Sn[En++]=zn,Sn[En++]=Cs,Un=i.id,zn=i.overflow,Cs=n}var Re=null,Wt=null,Lt=!1,Rs=null,xn=!1,Mu=Error(s(519));function Ms(n){var i=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw sr(wn(i,n)),Mu}function tm(n){var i=n.stateNode,r=n.type,u=n.memoizedProps;switch(i[Ce]=n,i[$e]=u,r){case"dialog":Mt("cancel",i),Mt("close",i);break;case"iframe":case"object":case"embed":Mt("load",i);break;case"video":case"audio":for(r=0;r<xr.length;r++)Mt(xr[r],i);break;case"source":Mt("error",i);break;case"img":case"image":case"link":Mt("error",i),Mt("load",i);break;case"details":Mt("toggle",i);break;case"input":Mt("invalid",i),fp(i,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0);break;case"select":Mt("invalid",i);break;case"textarea":Mt("invalid",i),mp(i,u.value,u.defaultValue,u.children)}r=u.children,typeof r!="string"&&typeof r!="number"&&typeof r!="bigint"||i.textContent===""+r||u.suppressHydrationWarning===!0||yy(i.textContent,r)?(u.popover!=null&&(Mt("beforetoggle",i),Mt("toggle",i)),u.onScroll!=null&&Mt("scroll",i),u.onScrollEnd!=null&&Mt("scrollend",i),u.onClick!=null&&(i.onclick=es),i=!0):i=!1,i||Ms(n,!0)}function em(n){for(Re=n.return;Re;)switch(Re.tag){case 5:case 31:case 13:xn=!1;return;case 27:case 3:xn=!0;return;default:Re=Re.return}}function Qi(n){if(n!==Re)return!1;if(!Lt)return em(n),Lt=!0,!1;var i=n.tag,r;if((r=i!==3&&i!==27)&&((r=i===5)&&(r=n.type,r=!(r!=="form"&&r!=="button")||Vh(n.type,n.memoizedProps)),r=!r),r&&Wt&&Ms(n),em(n),i===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(s(317));Wt=Ty(n)}else if(i===31){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(s(317));Wt=Ty(n)}else i===27?(i=Wt,qs(n.type)?(n=Zh,Zh=null,Wt=n):Wt=i):Wt=Re?Cn(n.stateNode.nextSibling):null;return!0}function ui(){Wt=Re=null,Lt=!1}function Du(){var n=Rs;return n!==null&&(Ke===null?Ke=n:Ke.push.apply(Ke,n),Rs=null),n}function sr(n){Rs===null?Rs=[n]:Rs.push(n)}var Ou=M(null),hi=null,as=null;function Ds(n,i,r){Q(Ou,i._currentValue),i._currentValue=r}function rs(n){n._currentValue=Ou.current,q(Ou)}function Nu(n,i,r){for(;n!==null;){var u=n.alternate;if((n.childLanes&i)!==i?(n.childLanes|=i,u!==null&&(u.childLanes|=i)):u!==null&&(u.childLanes&i)!==i&&(u.childLanes|=i),n===r)break;n=n.return}}function Lu(n,i,r,u){var p=n.child;for(p!==null&&(p.return=n);p!==null;){var g=p.dependencies;if(g!==null){var _=p.child;g=g.firstContext;t:for(;g!==null;){var E=g;g=p;for(var R=0;R<i.length;R++)if(E.context===i[R]){g.lanes|=r,E=g.alternate,E!==null&&(E.lanes|=r),Nu(g.return,r,n),u||(_=null);break t}g=E.next}}else if(p.tag===18){if(_=p.return,_===null)throw Error(s(341));_.lanes|=r,g=_.alternate,g!==null&&(g.lanes|=r),Nu(_,r,n),_=null}else _=p.child;if(_!==null)_.return=p;else for(_=p;_!==null;){if(_===n){_=null;break}if(p=_.sibling,p!==null){p.return=_.return,_=p;break}_=_.return}p=_}}function Zi(n,i,r,u){n=null;for(var p=i,g=!1;p!==null;){if(!g){if((p.flags&524288)!==0)g=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var _=p.alternate;if(_===null)throw Error(s(387));if(_=_.memoizedProps,_!==null){var E=p.type;rn(p.pendingProps.value,_.value)||(n!==null?n.push(E):n=[E])}}else if(p===dt.current){if(_=p.alternate,_===null)throw Error(s(387));_.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(n!==null?n.push(Dr):n=[Dr])}p=p.return}n!==null&&Lu(i,n,r,u),i.flags|=262144}function jo(n){for(n=n.firstContext;n!==null;){if(!rn(n.context._currentValue,n.memoizedValue))return!0;n=n.next}return!1}function di(n){hi=n,as=null,n=n.dependencies,n!==null&&(n.firstContext=null)}function Me(n){return nm(hi,n)}function qo(n,i){return hi===null&&di(n),nm(n,i)}function nm(n,i){var r=i._currentValue;if(i={context:i,memoizedValue:r,next:null},as===null){if(n===null)throw Error(s(308));as=i,n.dependencies={lanes:0,firstContext:i},n.flags|=524288}else as=as.next=i;return r}var IA=typeof AbortController<"u"?AbortController:function(){var n=[],i=this.signal={aborted:!1,addEventListener:function(r,u){n.push(u)}};this.abort=function(){i.aborted=!0,n.forEach(function(r){return r()})}},PA=c.unstable_scheduleCallback,FA=c.unstable_NormalPriority,ue={$$typeof:C,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ku(){return{controller:new IA,data:new Map,refCount:0}}function ir(n){n.refCount--,n.refCount===0&&PA(FA,function(){n.controller.abort()})}var ar=null,Bu=0,Ji=0,ta=null;function UA(n,i){if(ar===null){var r=ar=[];Bu=0,Ji=Fh(),ta={status:"pending",value:void 0,then:function(u){r.push(u)}}}return Bu++,i.then(sm,sm),i}function sm(){if(--Bu===0&&ar!==null){ta!==null&&(ta.status="fulfilled");var n=ar;ar=null,Ji=0,ta=null;for(var i=0;i<n.length;i++)(0,n[i])()}}function zA(n,i){var r=[],u={status:"pending",value:null,reason:null,then:function(p){r.push(p)}};return n.then(function(){u.status="fulfilled",u.value=i;for(var p=0;p<r.length;p++)(0,r[p])(i)},function(p){for(u.status="rejected",u.reason=p,p=0;p<r.length;p++)(0,r[p])(void 0)}),u}var im=B.S;B.S=function(n,i){Hg=nn(),typeof i=="object"&&i!==null&&typeof i.then=="function"&&UA(n,i),im!==null&&im(n,i)};var fi=M(null);function Iu(){var n=fi.current;return n!==null?n:Yt.pooledCache}function $o(n,i){i===null?Q(fi,fi.current):Q(fi,i.pool)}function am(){var n=Iu();return n===null?null:{parent:ue._currentValue,pool:n}}var ea=Error(s(460)),Pu=Error(s(474)),Go=Error(s(542)),Xo={then:function(){}};function rm(n){return n=n.status,n==="fulfilled"||n==="rejected"}function om(n,i,r){switch(r=n[r],r===void 0?n.push(i):r!==i&&(i.then(es,es),i=r),i.status){case"fulfilled":return i.value;case"rejected":throw n=i.reason,cm(n),n;default:if(typeof i.status=="string")i.then(es,es);else{if(n=Yt,n!==null&&100<n.shellSuspendCounter)throw Error(s(482));n=i,n.status="pending",n.then(function(u){if(i.status==="pending"){var p=i;p.status="fulfilled",p.value=u}},function(u){if(i.status==="pending"){var p=i;p.status="rejected",p.reason=u}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw n=i.reason,cm(n),n}throw mi=i,ea}}function pi(n){try{var i=n._init;return i(n._payload)}catch(r){throw r!==null&&typeof r=="object"&&typeof r.then=="function"?(mi=r,ea):r}}var mi=null;function lm(){if(mi===null)throw Error(s(459));var n=mi;return mi=null,n}function cm(n){if(n===ea||n===Go)throw Error(s(483))}var na=null,rr=0;function Vo(n){var i=rr;return rr+=1,na===null&&(na=[]),om(na,n,i)}function or(n,i){i=i.props.ref,n.ref=i!==void 0?i:null}function Yo(n,i){throw i.$$typeof===b?Error(s(525)):(n=Object.prototype.toString.call(i),Error(s(31,n==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":n)))}function um(n){function i(I,O){if(n){var P=I.deletions;P===null?(I.deletions=[O],I.flags|=16):P.push(O)}}function r(I,O){if(!n)return null;for(;O!==null;)i(I,O),O=O.sibling;return null}function u(I){for(var O=new Map;I!==null;)I.key!==null?O.set(I.key,I):O.set(I.index,I),I=I.sibling;return O}function p(I,O){return I=ss(I,O),I.index=0,I.sibling=null,I}function g(I,O,P){return I.index=P,n?(P=I.alternate,P!==null?(P=P.index,P<O?(I.flags|=67108866,O):P):(I.flags|=67108866,O)):(I.flags|=1048576,O)}function _(I){return n&&I.alternate===null&&(I.flags|=67108866),I}function E(I,O,P,X){return O===null||O.tag!==6?(O=xu(P,I.mode,X),O.return=I,O):(O=p(O,P),O.return=I,O)}function R(I,O,P,X){var lt=P.type;return lt===A?G(I,O,P.props.children,X,P.key):O!==null&&(O.elementType===lt||typeof lt=="object"&&lt!==null&&lt.$$typeof===V&&pi(lt)===O.type)?(O=p(O,P.props),or(O,P),O.return=I,O):(O=zo(P.type,P.key,P.props,null,I.mode,X),or(O,P),O.return=I,O)}function F(I,O,P,X){return O===null||O.tag!==4||O.stateNode.containerInfo!==P.containerInfo||O.stateNode.implementation!==P.implementation?(O=Tu(P,I.mode,X),O.return=I,O):(O=p(O,P.children||[]),O.return=I,O)}function G(I,O,P,X,lt){return O===null||O.tag!==7?(O=ci(P,I.mode,X,lt),O.return=I,O):(O=p(O,P),O.return=I,O)}function Y(I,O,P){if(typeof O=="string"&&O!==""||typeof O=="number"||typeof O=="bigint")return O=xu(""+O,I.mode,P),O.return=I,O;if(typeof O=="object"&&O!==null){switch(O.$$typeof){case v:return P=zo(O.type,O.key,O.props,null,I.mode,P),or(P,O),P.return=I,P;case w:return O=Tu(O,I.mode,P),O.return=I,O;case V:return O=pi(O),Y(I,O,P)}if(Nt(O)||pt(O))return O=ci(O,I.mode,P,null),O.return=I,O;if(typeof O.then=="function")return Y(I,Vo(O),P);if(O.$$typeof===C)return Y(I,qo(I,O),P);Yo(I,O)}return null}function z(I,O,P,X){var lt=O!==null?O.key:null;if(typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint")return lt!==null?null:E(I,O,""+P,X);if(typeof P=="object"&&P!==null){switch(P.$$typeof){case v:return P.key===lt?R(I,O,P,X):null;case w:return P.key===lt?F(I,O,P,X):null;case V:return P=pi(P),z(I,O,P,X)}if(Nt(P)||pt(P))return lt!==null?null:G(I,O,P,X,null);if(typeof P.then=="function")return z(I,O,Vo(P),X);if(P.$$typeof===C)return z(I,O,qo(I,P),X);Yo(I,P)}return null}function j(I,O,P,X,lt){if(typeof X=="string"&&X!==""||typeof X=="number"||typeof X=="bigint")return I=I.get(P)||null,E(O,I,""+X,lt);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case v:return I=I.get(X.key===null?P:X.key)||null,R(O,I,X,lt);case w:return I=I.get(X.key===null?P:X.key)||null,F(O,I,X,lt);case V:return X=pi(X),j(I,O,P,X,lt)}if(Nt(X)||pt(X))return I=I.get(P)||null,G(O,I,X,lt,null);if(typeof X.then=="function")return j(I,O,P,Vo(X),lt);if(X.$$typeof===C)return j(I,O,P,qo(O,X),lt);Yo(O,X)}return null}function it(I,O,P,X){for(var lt=null,It=null,rt=O,Et=O=0,Ot=null;rt!==null&&Et<P.length;Et++){rt.index>Et?(Ot=rt,rt=null):Ot=rt.sibling;var Pt=z(I,rt,P[Et],X);if(Pt===null){rt===null&&(rt=Ot);break}n&&rt&&Pt.alternate===null&&i(I,rt),O=g(Pt,O,Et),It===null?lt=Pt:It.sibling=Pt,It=Pt,rt=Ot}if(Et===P.length)return r(I,rt),Lt&&is(I,Et),lt;if(rt===null){for(;Et<P.length;Et++)rt=Y(I,P[Et],X),rt!==null&&(O=g(rt,O,Et),It===null?lt=rt:It.sibling=rt,It=rt);return Lt&&is(I,Et),lt}for(rt=u(rt);Et<P.length;Et++)Ot=j(rt,I,Et,P[Et],X),Ot!==null&&(n&&Ot.alternate!==null&&rt.delete(Ot.key===null?Et:Ot.key),O=g(Ot,O,Et),It===null?lt=Ot:It.sibling=Ot,It=Ot);return n&&rt.forEach(function(Ys){return i(I,Ys)}),Lt&&is(I,Et),lt}function ft(I,O,P,X){if(P==null)throw Error(s(151));for(var lt=null,It=null,rt=O,Et=O=0,Ot=null,Pt=P.next();rt!==null&&!Pt.done;Et++,Pt=P.next()){rt.index>Et?(Ot=rt,rt=null):Ot=rt.sibling;var Ys=z(I,rt,Pt.value,X);if(Ys===null){rt===null&&(rt=Ot);break}n&&rt&&Ys.alternate===null&&i(I,rt),O=g(Ys,O,Et),It===null?lt=Ys:It.sibling=Ys,It=Ys,rt=Ot}if(Pt.done)return r(I,rt),Lt&&is(I,Et),lt;if(rt===null){for(;!Pt.done;Et++,Pt=P.next())Pt=Y(I,Pt.value,X),Pt!==null&&(O=g(Pt,O,Et),It===null?lt=Pt:It.sibling=Pt,It=Pt);return Lt&&is(I,Et),lt}for(rt=u(rt);!Pt.done;Et++,Pt=P.next())Pt=j(rt,I,Et,Pt.value,X),Pt!==null&&(n&&Pt.alternate!==null&&rt.delete(Pt.key===null?Et:Pt.key),O=g(Pt,O,Et),It===null?lt=Pt:It.sibling=Pt,It=Pt);return n&&rt.forEach(function(Qw){return i(I,Qw)}),Lt&&is(I,Et),lt}function Gt(I,O,P,X){if(typeof P=="object"&&P!==null&&P.type===A&&P.key===null&&(P=P.props.children),typeof P=="object"&&P!==null){switch(P.$$typeof){case v:t:{for(var lt=P.key;O!==null;){if(O.key===lt){if(lt=P.type,lt===A){if(O.tag===7){r(I,O.sibling),X=p(O,P.props.children),X.return=I,I=X;break t}}else if(O.elementType===lt||typeof lt=="object"&&lt!==null&&lt.$$typeof===V&&pi(lt)===O.type){r(I,O.sibling),X=p(O,P.props),or(X,P),X.return=I,I=X;break t}r(I,O);break}else i(I,O);O=O.sibling}P.type===A?(X=ci(P.props.children,I.mode,X,P.key),X.return=I,I=X):(X=zo(P.type,P.key,P.props,null,I.mode,X),or(X,P),X.return=I,I=X)}return _(I);case w:t:{for(lt=P.key;O!==null;){if(O.key===lt)if(O.tag===4&&O.stateNode.containerInfo===P.containerInfo&&O.stateNode.implementation===P.implementation){r(I,O.sibling),X=p(O,P.children||[]),X.return=I,I=X;break t}else{r(I,O);break}else i(I,O);O=O.sibling}X=Tu(P,I.mode,X),X.return=I,I=X}return _(I);case V:return P=pi(P),Gt(I,O,P,X)}if(Nt(P))return it(I,O,P,X);if(pt(P)){if(lt=pt(P),typeof lt!="function")throw Error(s(150));return P=lt.call(P),ft(I,O,P,X)}if(typeof P.then=="function")return Gt(I,O,Vo(P),X);if(P.$$typeof===C)return Gt(I,O,qo(I,P),X);Yo(I,P)}return typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint"?(P=""+P,O!==null&&O.tag===6?(r(I,O.sibling),X=p(O,P),X.return=I,I=X):(r(I,O),X=xu(P,I.mode,X),X.return=I,I=X),_(I)):r(I,O)}return function(I,O,P,X){try{rr=0;var lt=Gt(I,O,P,X);return na=null,lt}catch(rt){if(rt===ea||rt===Go)throw rt;var It=on(29,rt,null,I.mode);return It.lanes=X,It.return=I,It}}}var gi=um(!0),hm=um(!1),Os=!1;function Fu(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Uu(n,i){n=n.updateQueue,i.updateQueue===n&&(i.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,callbacks:null})}function Ns(n){return{lane:n,tag:0,payload:null,callback:null,next:null}}function Ls(n,i,r){var u=n.updateQueue;if(u===null)return null;if(u=u.shared,(Ft&2)!==0){var p=u.pending;return p===null?i.next=i:(i.next=p.next,p.next=i),u.pending=i,i=Uo(n),Yp(n,null,r),i}return Fo(n,u,i,r),Uo(n)}function lr(n,i,r){if(i=i.updateQueue,i!==null&&(i=i.shared,(r&4194048)!==0)){var u=i.lanes;u&=n.pendingLanes,r|=u,i.lanes=r,np(n,r)}}function zu(n,i){var r=n.updateQueue,u=n.alternate;if(u!==null&&(u=u.updateQueue,r===u)){var p=null,g=null;if(r=r.firstBaseUpdate,r!==null){do{var _={lane:r.lane,tag:r.tag,payload:r.payload,callback:null,next:null};g===null?p=g=_:g=g.next=_,r=r.next}while(r!==null);g===null?p=g=i:g=g.next=i}else p=g=i;r={baseState:u.baseState,firstBaseUpdate:p,lastBaseUpdate:g,shared:u.shared,callbacks:u.callbacks},n.updateQueue=r;return}n=r.lastBaseUpdate,n===null?r.firstBaseUpdate=i:n.next=i,r.lastBaseUpdate=i}var Hu=!1;function cr(){if(Hu){var n=ta;if(n!==null)throw n}}function ur(n,i,r,u){Hu=!1;var p=n.updateQueue;Os=!1;var g=p.firstBaseUpdate,_=p.lastBaseUpdate,E=p.shared.pending;if(E!==null){p.shared.pending=null;var R=E,F=R.next;R.next=null,_===null?g=F:_.next=F,_=R;var G=n.alternate;G!==null&&(G=G.updateQueue,E=G.lastBaseUpdate,E!==_&&(E===null?G.firstBaseUpdate=F:E.next=F,G.lastBaseUpdate=R))}if(g!==null){var Y=p.baseState;_=0,G=F=R=null,E=g;do{var z=E.lane&-536870913,j=z!==E.lane;if(j?(Dt&z)===z:(u&z)===z){z!==0&&z===Ji&&(Hu=!0),G!==null&&(G=G.next={lane:0,tag:E.tag,payload:E.payload,callback:null,next:null});t:{var it=n,ft=E;z=i;var Gt=r;switch(ft.tag){case 1:if(it=ft.payload,typeof it=="function"){Y=it.call(Gt,Y,z);break t}Y=it;break t;case 3:it.flags=it.flags&-65537|128;case 0:if(it=ft.payload,z=typeof it=="function"?it.call(Gt,Y,z):it,z==null)break t;Y=y({},Y,z);break t;case 2:Os=!0}}z=E.callback,z!==null&&(n.flags|=64,j&&(n.flags|=8192),j=p.callbacks,j===null?p.callbacks=[z]:j.push(z))}else j={lane:z,tag:E.tag,payload:E.payload,callback:E.callback,next:null},G===null?(F=G=j,R=Y):G=G.next=j,_|=z;if(E=E.next,E===null){if(E=p.shared.pending,E===null)break;j=E,E=j.next,j.next=null,p.lastBaseUpdate=j,p.shared.pending=null}}while(!0);G===null&&(R=Y),p.baseState=R,p.firstBaseUpdate=F,p.lastBaseUpdate=G,g===null&&(p.shared.lanes=0),Fs|=_,n.lanes=_,n.memoizedState=Y}}function dm(n,i){if(typeof n!="function")throw Error(s(191,n));n.call(i)}function fm(n,i){var r=n.callbacks;if(r!==null)for(n.callbacks=null,n=0;n<r.length;n++)dm(r[n],i)}var sa=M(null),Ko=M(0);function pm(n,i){n=ms,Q(Ko,n),Q(sa,i),ms=n|i.baseLanes}function ju(){Q(Ko,ms),Q(sa,sa.current)}function qu(){ms=Ko.current,q(sa),q(Ko)}var ln=M(null),Tn=null;function ks(n){var i=n.alternate;Q(oe,oe.current&1),Q(ln,n),Tn===null&&(i===null||sa.current!==null||i.memoizedState!==null)&&(Tn=n)}function $u(n){Q(oe,oe.current),Q(ln,n),Tn===null&&(Tn=n)}function mm(n){n.tag===22?(Q(oe,oe.current),Q(ln,n),Tn===null&&(Tn=n)):Bs()}function Bs(){Q(oe,oe.current),Q(ln,ln.current)}function cn(n){q(ln),Tn===n&&(Tn=null),q(oe)}var oe=M(0);function Wo(n){for(var i=n;i!==null;){if(i.tag===13){var r=i.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||Wh(r)||Qh(r)))return i}else if(i.tag===19&&(i.memoizedProps.revealOrder==="forwards"||i.memoizedProps.revealOrder==="backwards"||i.memoizedProps.revealOrder==="unstable_legacy-backwards"||i.memoizedProps.revealOrder==="together")){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var os=0,St=null,qt=null,he=null,Qo=!1,ia=!1,yi=!1,Zo=0,hr=0,aa=null,HA=0;function se(){throw Error(s(321))}function Gu(n,i){if(i===null)return!1;for(var r=0;r<i.length&&r<n.length;r++)if(!rn(n[r],i[r]))return!1;return!0}function Xu(n,i,r,u,p,g){return os=g,St=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,B.H=n===null||n.memoizedState===null?Zm:oh,yi=!1,g=r(u,p),yi=!1,ia&&(g=ym(i,r,u,p)),gm(n),g}function gm(n){B.H=pr;var i=qt!==null&&qt.next!==null;if(os=0,he=qt=St=null,Qo=!1,hr=0,aa=null,i)throw Error(s(300));n===null||de||(n=n.dependencies,n!==null&&jo(n)&&(de=!0))}function ym(n,i,r,u){St=n;var p=0;do{if(ia&&(aa=null),hr=0,ia=!1,25<=p)throw Error(s(301));if(p+=1,he=qt=null,n.updateQueue!=null){var g=n.updateQueue;g.lastEffect=null,g.events=null,g.stores=null,g.memoCache!=null&&(g.memoCache.index=0)}B.H=Jm,g=i(r,u)}while(ia);return g}function jA(){var n=B.H,i=n.useState()[0];return i=typeof i.then=="function"?dr(i):i,n=n.useState()[0],(qt!==null?qt.memoizedState:null)!==n&&(St.flags|=1024),i}function Vu(){var n=Zo!==0;return Zo=0,n}function Yu(n,i,r){i.updateQueue=n.updateQueue,i.flags&=-2053,n.lanes&=~r}function Ku(n){if(Qo){for(n=n.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}Qo=!1}os=0,he=qt=St=null,ia=!1,hr=Zo=0,aa=null}function Ue(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return he===null?St.memoizedState=he=n:he=he.next=n,he}function le(){if(qt===null){var n=St.alternate;n=n!==null?n.memoizedState:null}else n=qt.next;var i=he===null?St.memoizedState:he.next;if(i!==null)he=i,qt=n;else{if(n===null)throw St.alternate===null?Error(s(467)):Error(s(310));qt=n,n={memoizedState:qt.memoizedState,baseState:qt.baseState,baseQueue:qt.baseQueue,queue:qt.queue,next:null},he===null?St.memoizedState=he=n:he=he.next=n}return he}function Jo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function dr(n){var i=hr;return hr+=1,aa===null&&(aa=[]),n=om(aa,n,i),i=St,(he===null?i.memoizedState:he.next)===null&&(i=i.alternate,B.H=i===null||i.memoizedState===null?Zm:oh),n}function tl(n){if(n!==null&&typeof n=="object"){if(typeof n.then=="function")return dr(n);if(n.$$typeof===C)return Me(n)}throw Error(s(438,String(n)))}function Wu(n){var i=null,r=St.updateQueue;if(r!==null&&(i=r.memoCache),i==null){var u=St.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(i={data:u.data.map(function(p){return p.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),r===null&&(r=Jo(),St.updateQueue=r),r.memoCache=i,r=i.data[i.index],r===void 0)for(r=i.data[i.index]=Array(n),u=0;u<n;u++)r[u]=J;return i.index++,r}function ls(n,i){return typeof i=="function"?i(n):i}function el(n){var i=le();return Qu(i,qt,n)}function Qu(n,i,r){var u=n.queue;if(u===null)throw Error(s(311));u.lastRenderedReducer=r;var p=n.baseQueue,g=u.pending;if(g!==null){if(p!==null){var _=p.next;p.next=g.next,g.next=_}i.baseQueue=p=g,u.pending=null}if(g=n.baseState,p===null)n.memoizedState=g;else{i=p.next;var E=_=null,R=null,F=i,G=!1;do{var Y=F.lane&-536870913;if(Y!==F.lane?(Dt&Y)===Y:(os&Y)===Y){var z=F.revertLane;if(z===0)R!==null&&(R=R.next={lane:0,revertLane:0,gesture:null,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null}),Y===Ji&&(G=!0);else if((os&z)===z){F=F.next,z===Ji&&(G=!0);continue}else Y={lane:0,revertLane:F.revertLane,gesture:null,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null},R===null?(E=R=Y,_=g):R=R.next=Y,St.lanes|=z,Fs|=z;Y=F.action,yi&&r(g,Y),g=F.hasEagerState?F.eagerState:r(g,Y)}else z={lane:Y,revertLane:F.revertLane,gesture:F.gesture,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null},R===null?(E=R=z,_=g):R=R.next=z,St.lanes|=Y,Fs|=Y;F=F.next}while(F!==null&&F!==i);if(R===null?_=g:R.next=E,!rn(g,n.memoizedState)&&(de=!0,G&&(r=ta,r!==null)))throw r;n.memoizedState=g,n.baseState=_,n.baseQueue=R,u.lastRenderedState=g}return p===null&&(u.lanes=0),[n.memoizedState,u.dispatch]}function Zu(n){var i=le(),r=i.queue;if(r===null)throw Error(s(311));r.lastRenderedReducer=n;var u=r.dispatch,p=r.pending,g=i.memoizedState;if(p!==null){r.pending=null;var _=p=p.next;do g=n(g,_.action),_=_.next;while(_!==p);rn(g,i.memoizedState)||(de=!0),i.memoizedState=g,i.baseQueue===null&&(i.baseState=g),r.lastRenderedState=g}return[g,u]}function bm(n,i,r){var u=St,p=le(),g=Lt;if(g){if(r===void 0)throw Error(s(407));r=r()}else r=i();var _=!rn((qt||p).memoizedState,r);if(_&&(p.memoizedState=r,de=!0),p=p.queue,eh(Am.bind(null,u,p,n),[n]),p.getSnapshot!==i||_||he!==null&&he.memoizedState.tag&1){if(u.flags|=2048,ra(9,{destroy:void 0},_m.bind(null,u,p,r,i),null),Yt===null)throw Error(s(349));g||(os&127)!==0||vm(u,i,r)}return r}function vm(n,i,r){n.flags|=16384,n={getSnapshot:i,value:r},i=St.updateQueue,i===null?(i=Jo(),St.updateQueue=i,i.stores=[n]):(r=i.stores,r===null?i.stores=[n]:r.push(n))}function _m(n,i,r,u){i.value=r,i.getSnapshot=u,wm(i)&&Sm(n)}function Am(n,i,r){return r(function(){wm(i)&&Sm(n)})}function wm(n){var i=n.getSnapshot;n=n.value;try{var r=i();return!rn(n,r)}catch{return!0}}function Sm(n){var i=li(n,2);i!==null&&We(i,n,2)}function Ju(n){var i=Ue();if(typeof n=="function"){var r=n;if(n=r(),yi){Es(!0);try{r()}finally{Es(!1)}}}return i.memoizedState=i.baseState=n,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ls,lastRenderedState:n},i}function Em(n,i,r,u){return n.baseState=r,Qu(n,qt,typeof u=="function"?u:ls)}function qA(n,i,r,u,p){if(il(n))throw Error(s(485));if(n=i.action,n!==null){var g={payload:p,action:n,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(_){g.listeners.push(_)}};B.T!==null?r(!0):g.isTransition=!1,u(g),r=i.pending,r===null?(g.next=i.pending=g,xm(i,g)):(g.next=r.next,i.pending=r.next=g)}}function xm(n,i){var r=i.action,u=i.payload,p=n.state;if(i.isTransition){var g=B.T,_={};B.T=_;try{var E=r(p,u),R=B.S;R!==null&&R(_,E),Tm(n,i,E)}catch(F){th(n,i,F)}finally{g!==null&&_.types!==null&&(g.types=_.types),B.T=g}}else try{g=r(p,u),Tm(n,i,g)}catch(F){th(n,i,F)}}function Tm(n,i,r){r!==null&&typeof r=="object"&&typeof r.then=="function"?r.then(function(u){Cm(n,i,u)},function(u){return th(n,i,u)}):Cm(n,i,r)}function Cm(n,i,r){i.status="fulfilled",i.value=r,Rm(i),n.state=r,i=n.pending,i!==null&&(r=i.next,r===i?n.pending=null:(r=r.next,i.next=r,xm(n,r)))}function th(n,i,r){var u=n.pending;if(n.pending=null,u!==null){u=u.next;do i.status="rejected",i.reason=r,Rm(i),i=i.next;while(i!==u)}n.action=null}function Rm(n){n=n.listeners;for(var i=0;i<n.length;i++)(0,n[i])()}function Mm(n,i){return i}function Dm(n,i){if(Lt){var r=Yt.formState;if(r!==null){t:{var u=St;if(Lt){if(Wt){e:{for(var p=Wt,g=xn;p.nodeType!==8;){if(!g){p=null;break e}if(p=Cn(p.nextSibling),p===null){p=null;break e}}g=p.data,p=g==="F!"||g==="F"?p:null}if(p){Wt=Cn(p.nextSibling),u=p.data==="F!";break t}}Ms(u)}u=!1}u&&(i=r[0])}}return r=Ue(),r.memoizedState=r.baseState=i,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mm,lastRenderedState:i},r.queue=u,r=Km.bind(null,St,u),u.dispatch=r,u=Ju(!1),g=rh.bind(null,St,!1,u.queue),u=Ue(),p={state:i,dispatch:null,action:n,pending:null},u.queue=p,r=qA.bind(null,St,p,g,r),p.dispatch=r,u.memoizedState=n,[i,r,!1]}function Om(n){var i=le();return Nm(i,qt,n)}function Nm(n,i,r){if(i=Qu(n,i,Mm)[0],n=el(ls)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var u=dr(i)}catch(_){throw _===ea?Go:_}else u=i;i=le();var p=i.queue,g=p.dispatch;return r!==i.memoizedState&&(St.flags|=2048,ra(9,{destroy:void 0},$A.bind(null,p,r),null)),[u,g,n]}function $A(n,i){n.action=i}function Lm(n){var i=le(),r=qt;if(r!==null)return Nm(i,r,n);le(),i=i.memoizedState,r=le();var u=r.queue.dispatch;return r.memoizedState=n,[i,u,!1]}function ra(n,i,r,u){return n={tag:n,create:r,deps:u,inst:i,next:null},i=St.updateQueue,i===null&&(i=Jo(),St.updateQueue=i),r=i.lastEffect,r===null?i.lastEffect=n.next=n:(u=r.next,r.next=n,n.next=u,i.lastEffect=n),n}function km(){return le().memoizedState}function nl(n,i,r,u){var p=Ue();St.flags|=n,p.memoizedState=ra(1|i,{destroy:void 0},r,u===void 0?null:u)}function sl(n,i,r,u){var p=le();u=u===void 0?null:u;var g=p.memoizedState.inst;qt!==null&&u!==null&&Gu(u,qt.memoizedState.deps)?p.memoizedState=ra(i,g,r,u):(St.flags|=n,p.memoizedState=ra(1|i,g,r,u))}function Bm(n,i){nl(8390656,8,n,i)}function eh(n,i){sl(2048,8,n,i)}function GA(n){St.flags|=4;var i=St.updateQueue;if(i===null)i=Jo(),St.updateQueue=i,i.events=[n];else{var r=i.events;r===null?i.events=[n]:r.push(n)}}function Im(n){var i=le().memoizedState;return GA({ref:i,nextImpl:n}),function(){if((Ft&2)!==0)throw Error(s(440));return i.impl.apply(void 0,arguments)}}function Pm(n,i){return sl(4,2,n,i)}function Fm(n,i){return sl(4,4,n,i)}function Um(n,i){if(typeof i=="function"){n=n();var r=i(n);return function(){typeof r=="function"?r():i(null)}}if(i!=null)return n=n(),i.current=n,function(){i.current=null}}function zm(n,i,r){r=r!=null?r.concat([n]):null,sl(4,4,Um.bind(null,i,n),r)}function nh(){}function Hm(n,i){var r=le();i=i===void 0?null:i;var u=r.memoizedState;return i!==null&&Gu(i,u[1])?u[0]:(r.memoizedState=[n,i],n)}function jm(n,i){var r=le();i=i===void 0?null:i;var u=r.memoizedState;if(i!==null&&Gu(i,u[1]))return u[0];if(u=n(),yi){Es(!0);try{n()}finally{Es(!1)}}return r.memoizedState=[u,i],u}function sh(n,i,r){return r===void 0||(os&1073741824)!==0&&(Dt&261930)===0?n.memoizedState=i:(n.memoizedState=r,n=qg(),St.lanes|=n,Fs|=n,r)}function qm(n,i,r,u){return rn(r,i)?r:sa.current!==null?(n=sh(n,r,u),rn(n,i)||(de=!0),n):(os&42)===0||(os&1073741824)!==0&&(Dt&261930)===0?(de=!0,n.memoizedState=r):(n=qg(),St.lanes|=n,Fs|=n,i)}function $m(n,i,r,u,p){var g=$.p;$.p=g!==0&&8>g?g:8;var _=B.T,E={};B.T=E,rh(n,!1,i,r);try{var R=p(),F=B.S;if(F!==null&&F(E,R),R!==null&&typeof R=="object"&&typeof R.then=="function"){var G=zA(R,u);fr(n,i,G,dn(n))}else fr(n,i,u,dn(n))}catch(Y){fr(n,i,{then:function(){},status:"rejected",reason:Y},dn())}finally{$.p=g,_!==null&&E.types!==null&&(_.types=E.types),B.T=_}}function XA(){}function ih(n,i,r,u){if(n.tag!==5)throw Error(s(476));var p=Gm(n).queue;$m(n,p,i,tt,r===null?XA:function(){return Xm(n),r(u)})}function Gm(n){var i=n.memoizedState;if(i!==null)return i;i={memoizedState:tt,baseState:tt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ls,lastRenderedState:tt},next:null};var r={};return i.next={memoizedState:r,baseState:r,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ls,lastRenderedState:r},next:null},n.memoizedState=i,n=n.alternate,n!==null&&(n.memoizedState=i),i}function Xm(n){var i=Gm(n);i.next===null&&(i=n.alternate.memoizedState),fr(n,i.next.queue,{},dn())}function ah(){return Me(Dr)}function Vm(){return le().memoizedState}function Ym(){return le().memoizedState}function VA(n){for(var i=n.return;i!==null;){switch(i.tag){case 24:case 3:var r=dn();n=Ns(r);var u=Ls(i,n,r);u!==null&&(We(u,i,r),lr(u,i,r)),i={cache:ku()},n.payload=i;return}i=i.return}}function YA(n,i,r){var u=dn();r={lane:u,revertLane:0,gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},il(n)?Wm(i,r):(r=Su(n,i,r,u),r!==null&&(We(r,n,u),Qm(r,i,u)))}function Km(n,i,r){var u=dn();fr(n,i,r,u)}function fr(n,i,r,u){var p={lane:u,revertLane:0,gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null};if(il(n))Wm(i,p);else{var g=n.alternate;if(n.lanes===0&&(g===null||g.lanes===0)&&(g=i.lastRenderedReducer,g!==null))try{var _=i.lastRenderedState,E=g(_,r);if(p.hasEagerState=!0,p.eagerState=E,rn(E,_))return Fo(n,i,p,0),Yt===null&&Po(),!1}catch{}if(r=Su(n,i,p,u),r!==null)return We(r,n,u),Qm(r,i,u),!0}return!1}function rh(n,i,r,u){if(u={lane:2,revertLane:Fh(),gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},il(n)){if(i)throw Error(s(479))}else i=Su(n,r,u,2),i!==null&&We(i,n,2)}function il(n){var i=n.alternate;return n===St||i!==null&&i===St}function Wm(n,i){ia=Qo=!0;var r=n.pending;r===null?i.next=i:(i.next=r.next,r.next=i),n.pending=i}function Qm(n,i,r){if((r&4194048)!==0){var u=i.lanes;u&=n.pendingLanes,r|=u,i.lanes=r,np(n,r)}}var pr={readContext:Me,use:tl,useCallback:se,useContext:se,useEffect:se,useImperativeHandle:se,useLayoutEffect:se,useInsertionEffect:se,useMemo:se,useReducer:se,useRef:se,useState:se,useDebugValue:se,useDeferredValue:se,useTransition:se,useSyncExternalStore:se,useId:se,useHostTransitionStatus:se,useFormState:se,useActionState:se,useOptimistic:se,useMemoCache:se,useCacheRefresh:se};pr.useEffectEvent=se;var Zm={readContext:Me,use:tl,useCallback:function(n,i){return Ue().memoizedState=[n,i===void 0?null:i],n},useContext:Me,useEffect:Bm,useImperativeHandle:function(n,i,r){r=r!=null?r.concat([n]):null,nl(4194308,4,Um.bind(null,i,n),r)},useLayoutEffect:function(n,i){return nl(4194308,4,n,i)},useInsertionEffect:function(n,i){nl(4,2,n,i)},useMemo:function(n,i){var r=Ue();i=i===void 0?null:i;var u=n();if(yi){Es(!0);try{n()}finally{Es(!1)}}return r.memoizedState=[u,i],u},useReducer:function(n,i,r){var u=Ue();if(r!==void 0){var p=r(i);if(yi){Es(!0);try{r(i)}finally{Es(!1)}}}else p=i;return u.memoizedState=u.baseState=p,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:p},u.queue=n,n=n.dispatch=YA.bind(null,St,n),[u.memoizedState,n]},useRef:function(n){var i=Ue();return n={current:n},i.memoizedState=n},useState:function(n){n=Ju(n);var i=n.queue,r=Km.bind(null,St,i);return i.dispatch=r,[n.memoizedState,r]},useDebugValue:nh,useDeferredValue:function(n,i){var r=Ue();return sh(r,n,i)},useTransition:function(){var n=Ju(!1);return n=$m.bind(null,St,n.queue,!0,!1),Ue().memoizedState=n,[!1,n]},useSyncExternalStore:function(n,i,r){var u=St,p=Ue();if(Lt){if(r===void 0)throw Error(s(407));r=r()}else{if(r=i(),Yt===null)throw Error(s(349));(Dt&127)!==0||vm(u,i,r)}p.memoizedState=r;var g={value:r,getSnapshot:i};return p.queue=g,Bm(Am.bind(null,u,g,n),[n]),u.flags|=2048,ra(9,{destroy:void 0},_m.bind(null,u,g,r,i),null),r},useId:function(){var n=Ue(),i=Yt.identifierPrefix;if(Lt){var r=zn,u=Un;r=(u&~(1<<32-an(u)-1)).toString(32)+r,i="_"+i+"R_"+r,r=Zo++,0<r&&(i+="H"+r.toString(32)),i+="_"}else r=HA++,i="_"+i+"r_"+r.toString(32)+"_";return n.memoizedState=i},useHostTransitionStatus:ah,useFormState:Dm,useActionState:Dm,useOptimistic:function(n){var i=Ue();i.memoizedState=i.baseState=n;var r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=r,i=rh.bind(null,St,!0,r),r.dispatch=i,[n,i]},useMemoCache:Wu,useCacheRefresh:function(){return Ue().memoizedState=VA.bind(null,St)},useEffectEvent:function(n){var i=Ue(),r={impl:n};return i.memoizedState=r,function(){if((Ft&2)!==0)throw Error(s(440));return r.impl.apply(void 0,arguments)}}},oh={readContext:Me,use:tl,useCallback:Hm,useContext:Me,useEffect:eh,useImperativeHandle:zm,useInsertionEffect:Pm,useLayoutEffect:Fm,useMemo:jm,useReducer:el,useRef:km,useState:function(){return el(ls)},useDebugValue:nh,useDeferredValue:function(n,i){var r=le();return qm(r,qt.memoizedState,n,i)},useTransition:function(){var n=el(ls)[0],i=le().memoizedState;return[typeof n=="boolean"?n:dr(n),i]},useSyncExternalStore:bm,useId:Vm,useHostTransitionStatus:ah,useFormState:Om,useActionState:Om,useOptimistic:function(n,i){var r=le();return Em(r,qt,n,i)},useMemoCache:Wu,useCacheRefresh:Ym};oh.useEffectEvent=Im;var Jm={readContext:Me,use:tl,useCallback:Hm,useContext:Me,useEffect:eh,useImperativeHandle:zm,useInsertionEffect:Pm,useLayoutEffect:Fm,useMemo:jm,useReducer:Zu,useRef:km,useState:function(){return Zu(ls)},useDebugValue:nh,useDeferredValue:function(n,i){var r=le();return qt===null?sh(r,n,i):qm(r,qt.memoizedState,n,i)},useTransition:function(){var n=Zu(ls)[0],i=le().memoizedState;return[typeof n=="boolean"?n:dr(n),i]},useSyncExternalStore:bm,useId:Vm,useHostTransitionStatus:ah,useFormState:Lm,useActionState:Lm,useOptimistic:function(n,i){var r=le();return qt!==null?Em(r,qt,n,i):(r.baseState=n,[n,r.queue.dispatch])},useMemoCache:Wu,useCacheRefresh:Ym};Jm.useEffectEvent=Im;function lh(n,i,r,u){i=n.memoizedState,r=r(u,i),r=r==null?i:y({},i,r),n.memoizedState=r,n.lanes===0&&(n.updateQueue.baseState=r)}var ch={enqueueSetState:function(n,i,r){n=n._reactInternals;var u=dn(),p=Ns(u);p.payload=i,r!=null&&(p.callback=r),i=Ls(n,p,u),i!==null&&(We(i,n,u),lr(i,n,u))},enqueueReplaceState:function(n,i,r){n=n._reactInternals;var u=dn(),p=Ns(u);p.tag=1,p.payload=i,r!=null&&(p.callback=r),i=Ls(n,p,u),i!==null&&(We(i,n,u),lr(i,n,u))},enqueueForceUpdate:function(n,i){n=n._reactInternals;var r=dn(),u=Ns(r);u.tag=2,i!=null&&(u.callback=i),i=Ls(n,u,r),i!==null&&(We(i,n,r),lr(i,n,r))}};function tg(n,i,r,u,p,g,_){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(u,g,_):i.prototype&&i.prototype.isPureReactComponent?!tr(r,u)||!tr(p,g):!0}function eg(n,i,r,u){n=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(r,u),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(r,u),i.state!==n&&ch.enqueueReplaceState(i,i.state,null)}function bi(n,i){var r=i;if("ref"in i){r={};for(var u in i)u!=="ref"&&(r[u]=i[u])}if(n=n.defaultProps){r===i&&(r=y({},r));for(var p in n)r[p]===void 0&&(r[p]=n[p])}return r}function ng(n){Io(n)}function sg(n){console.error(n)}function ig(n){Io(n)}function al(n,i){try{var r=n.onUncaughtError;r(i.value,{componentStack:i.stack})}catch(u){setTimeout(function(){throw u})}}function ag(n,i,r){try{var u=n.onCaughtError;u(r.value,{componentStack:r.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function uh(n,i,r){return r=Ns(r),r.tag=3,r.payload={element:null},r.callback=function(){al(n,i)},r}function rg(n){return n=Ns(n),n.tag=3,n}function og(n,i,r,u){var p=r.type.getDerivedStateFromError;if(typeof p=="function"){var g=u.value;n.payload=function(){return p(g)},n.callback=function(){ag(i,r,u)}}var _=r.stateNode;_!==null&&typeof _.componentDidCatch=="function"&&(n.callback=function(){ag(i,r,u),typeof p!="function"&&(Us===null?Us=new Set([this]):Us.add(this));var E=u.stack;this.componentDidCatch(u.value,{componentStack:E!==null?E:""})})}function KA(n,i,r,u,p){if(r.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(i=r.alternate,i!==null&&Zi(i,r,p,!0),r=ln.current,r!==null){switch(r.tag){case 31:case 13:return Tn===null?yl():r.alternate===null&&ie===0&&(ie=3),r.flags&=-257,r.flags|=65536,r.lanes=p,u===Xo?r.flags|=16384:(i=r.updateQueue,i===null?r.updateQueue=new Set([u]):i.add(u),Bh(n,u,p)),!1;case 22:return r.flags|=65536,u===Xo?r.flags|=16384:(i=r.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([u])},r.updateQueue=i):(r=i.retryQueue,r===null?i.retryQueue=new Set([u]):r.add(u)),Bh(n,u,p)),!1}throw Error(s(435,r.tag))}return Bh(n,u,p),yl(),!1}if(Lt)return i=ln.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=p,u!==Mu&&(n=Error(s(422),{cause:u}),sr(wn(n,r)))):(u!==Mu&&(i=Error(s(423),{cause:u}),sr(wn(i,r))),n=n.current.alternate,n.flags|=65536,p&=-p,n.lanes|=p,u=wn(u,r),p=uh(n.stateNode,u,p),zu(n,p),ie!==4&&(ie=2)),!1;var g=Error(s(520),{cause:u});if(g=wn(g,r),wr===null?wr=[g]:wr.push(g),ie!==4&&(ie=2),i===null)return!0;u=wn(u,r),r=i;do{switch(r.tag){case 3:return r.flags|=65536,n=p&-p,r.lanes|=n,n=uh(r.stateNode,u,n),zu(r,n),!1;case 1:if(i=r.type,g=r.stateNode,(r.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(Us===null||!Us.has(g))))return r.flags|=65536,p&=-p,r.lanes|=p,p=rg(p),og(p,n,r,u),zu(r,p),!1}r=r.return}while(r!==null);return!1}var hh=Error(s(461)),de=!1;function De(n,i,r,u){i.child=n===null?hm(i,null,r,u):gi(i,n.child,r,u)}function lg(n,i,r,u,p){r=r.render;var g=i.ref;if("ref"in u){var _={};for(var E in u)E!=="ref"&&(_[E]=u[E])}else _=u;return di(i),u=Xu(n,i,r,_,g,p),E=Vu(),n!==null&&!de?(Yu(n,i,p),cs(n,i,p)):(Lt&&E&&Cu(i),i.flags|=1,De(n,i,u,p),i.child)}function cg(n,i,r,u,p){if(n===null){var g=r.type;return typeof g=="function"&&!Eu(g)&&g.defaultProps===void 0&&r.compare===null?(i.tag=15,i.type=g,ug(n,i,g,u,p)):(n=zo(r.type,null,u,i,i.mode,p),n.ref=i.ref,n.return=i,i.child=n)}if(g=n.child,!vh(n,p)){var _=g.memoizedProps;if(r=r.compare,r=r!==null?r:tr,r(_,u)&&n.ref===i.ref)return cs(n,i,p)}return i.flags|=1,n=ss(g,u),n.ref=i.ref,n.return=i,i.child=n}function ug(n,i,r,u,p){if(n!==null){var g=n.memoizedProps;if(tr(g,u)&&n.ref===i.ref)if(de=!1,i.pendingProps=u=g,vh(n,p))(n.flags&131072)!==0&&(de=!0);else return i.lanes=n.lanes,cs(n,i,p)}return dh(n,i,r,u,p)}function hg(n,i,r,u){var p=u.children,g=n!==null?n.memoizedState:null;if(n===null&&i.stateNode===null&&(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),u.mode==="hidden"){if((i.flags&128)!==0){if(g=g!==null?g.baseLanes|r:r,n!==null){for(u=i.child=n.child,p=0;u!==null;)p=p|u.lanes|u.childLanes,u=u.sibling;u=p&~g}else u=0,i.child=null;return dg(n,i,g,r,u)}if((r&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},n!==null&&$o(i,g!==null?g.cachePool:null),g!==null?pm(i,g):ju(),mm(i);else return u=i.lanes=536870912,dg(n,i,g!==null?g.baseLanes|r:r,r,u)}else g!==null?($o(i,g.cachePool),pm(i,g),Bs(),i.memoizedState=null):(n!==null&&$o(i,null),ju(),Bs());return De(n,i,p,r),i.child}function mr(n,i){return n!==null&&n.tag===22||i.stateNode!==null||(i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.sibling}function dg(n,i,r,u,p){var g=Iu();return g=g===null?null:{parent:ue._currentValue,pool:g},i.memoizedState={baseLanes:r,cachePool:g},n!==null&&$o(i,null),ju(),mm(i),n!==null&&Zi(n,i,u,!0),i.childLanes=p,null}function rl(n,i){return i=ll({mode:i.mode,children:i.children},n.mode),i.ref=n.ref,n.child=i,i.return=n,i}function fg(n,i,r){return gi(i,n.child,null,r),n=rl(i,i.pendingProps),n.flags|=2,cn(i),i.memoizedState=null,n}function WA(n,i,r){var u=i.pendingProps,p=(i.flags&128)!==0;if(i.flags&=-129,n===null){if(Lt){if(u.mode==="hidden")return n=rl(i,u),i.lanes=536870912,mr(null,n);if($u(i),(n=Wt)?(n=xy(n,xn),n=n!==null&&n.data==="&"?n:null,n!==null&&(i.memoizedState={dehydrated:n,treeContext:Cs!==null?{id:Un,overflow:zn}:null,retryLane:536870912,hydrationErrors:null},r=Wp(n),r.return=i,i.child=r,Re=i,Wt=null)):n=null,n===null)throw Ms(i);return i.lanes=536870912,null}return rl(i,u)}var g=n.memoizedState;if(g!==null){var _=g.dehydrated;if($u(i),p)if(i.flags&256)i.flags&=-257,i=fg(n,i,r);else if(i.memoizedState!==null)i.child=n.child,i.flags|=128,i=null;else throw Error(s(558));else if(de||Zi(n,i,r,!1),p=(r&n.childLanes)!==0,de||p){if(u=Yt,u!==null&&(_=sp(u,r),_!==0&&_!==g.retryLane))throw g.retryLane=_,li(n,_),We(u,n,_),hh;yl(),i=fg(n,i,r)}else n=g.treeContext,Wt=Cn(_.nextSibling),Re=i,Lt=!0,Rs=null,xn=!1,n!==null&&Jp(i,n),i=rl(i,u),i.flags|=4096;return i}return n=ss(n.child,{mode:u.mode,children:u.children}),n.ref=i.ref,i.child=n,n.return=i,n}function ol(n,i){var r=i.ref;if(r===null)n!==null&&n.ref!==null&&(i.flags|=4194816);else{if(typeof r!="function"&&typeof r!="object")throw Error(s(284));(n===null||n.ref!==r)&&(i.flags|=4194816)}}function dh(n,i,r,u,p){return di(i),r=Xu(n,i,r,u,void 0,p),u=Vu(),n!==null&&!de?(Yu(n,i,p),cs(n,i,p)):(Lt&&u&&Cu(i),i.flags|=1,De(n,i,r,p),i.child)}function pg(n,i,r,u,p,g){return di(i),i.updateQueue=null,r=ym(i,u,r,p),gm(n),u=Vu(),n!==null&&!de?(Yu(n,i,g),cs(n,i,g)):(Lt&&u&&Cu(i),i.flags|=1,De(n,i,r,g),i.child)}function mg(n,i,r,u,p){if(di(i),i.stateNode===null){var g=Yi,_=r.contextType;typeof _=="object"&&_!==null&&(g=Me(_)),g=new r(u,g),i.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,g.updater=ch,i.stateNode=g,g._reactInternals=i,g=i.stateNode,g.props=u,g.state=i.memoizedState,g.refs={},Fu(i),_=r.contextType,g.context=typeof _=="object"&&_!==null?Me(_):Yi,g.state=i.memoizedState,_=r.getDerivedStateFromProps,typeof _=="function"&&(lh(i,r,_,u),g.state=i.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(_=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),_!==g.state&&ch.enqueueReplaceState(g,g.state,null),ur(i,u,g,p),cr(),g.state=i.memoizedState),typeof g.componentDidMount=="function"&&(i.flags|=4194308),u=!0}else if(n===null){g=i.stateNode;var E=i.memoizedProps,R=bi(r,E);g.props=R;var F=g.context,G=r.contextType;_=Yi,typeof G=="object"&&G!==null&&(_=Me(G));var Y=r.getDerivedStateFromProps;G=typeof Y=="function"||typeof g.getSnapshotBeforeUpdate=="function",E=i.pendingProps!==E,G||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(E||F!==_)&&eg(i,g,u,_),Os=!1;var z=i.memoizedState;g.state=z,ur(i,u,g,p),cr(),F=i.memoizedState,E||z!==F||Os?(typeof Y=="function"&&(lh(i,r,Y,u),F=i.memoizedState),(R=Os||tg(i,r,R,u,z,F,_))?(G||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(i.flags|=4194308)):(typeof g.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=u,i.memoizedState=F),g.props=u,g.state=F,g.context=_,u=R):(typeof g.componentDidMount=="function"&&(i.flags|=4194308),u=!1)}else{g=i.stateNode,Uu(n,i),_=i.memoizedProps,G=bi(r,_),g.props=G,Y=i.pendingProps,z=g.context,F=r.contextType,R=Yi,typeof F=="object"&&F!==null&&(R=Me(F)),E=r.getDerivedStateFromProps,(F=typeof E=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(_!==Y||z!==R)&&eg(i,g,u,R),Os=!1,z=i.memoizedState,g.state=z,ur(i,u,g,p),cr();var j=i.memoizedState;_!==Y||z!==j||Os||n!==null&&n.dependencies!==null&&jo(n.dependencies)?(typeof E=="function"&&(lh(i,r,E,u),j=i.memoizedState),(G=Os||tg(i,r,G,u,z,j,R)||n!==null&&n.dependencies!==null&&jo(n.dependencies))?(F||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(u,j,R),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(u,j,R)),typeof g.componentDidUpdate=="function"&&(i.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof g.componentDidUpdate!="function"||_===n.memoizedProps&&z===n.memoizedState||(i.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||_===n.memoizedProps&&z===n.memoizedState||(i.flags|=1024),i.memoizedProps=u,i.memoizedState=j),g.props=u,g.state=j,g.context=R,u=G):(typeof g.componentDidUpdate!="function"||_===n.memoizedProps&&z===n.memoizedState||(i.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||_===n.memoizedProps&&z===n.memoizedState||(i.flags|=1024),u=!1)}return g=u,ol(n,i),u=(i.flags&128)!==0,g||u?(g=i.stateNode,r=u&&typeof r.getDerivedStateFromError!="function"?null:g.render(),i.flags|=1,n!==null&&u?(i.child=gi(i,n.child,null,p),i.child=gi(i,null,r,p)):De(n,i,r,p),i.memoizedState=g.state,n=i.child):n=cs(n,i,p),n}function gg(n,i,r,u){return ui(),i.flags|=256,De(n,i,r,u),i.child}var fh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ph(n){return{baseLanes:n,cachePool:am()}}function mh(n,i,r){return n=n!==null?n.childLanes&~r:0,i&&(n|=hn),n}function yg(n,i,r){var u=i.pendingProps,p=!1,g=(i.flags&128)!==0,_;if((_=g)||(_=n!==null&&n.memoizedState===null?!1:(oe.current&2)!==0),_&&(p=!0,i.flags&=-129),_=(i.flags&32)!==0,i.flags&=-33,n===null){if(Lt){if(p?ks(i):Bs(),(n=Wt)?(n=xy(n,xn),n=n!==null&&n.data!=="&"?n:null,n!==null&&(i.memoizedState={dehydrated:n,treeContext:Cs!==null?{id:Un,overflow:zn}:null,retryLane:536870912,hydrationErrors:null},r=Wp(n),r.return=i,i.child=r,Re=i,Wt=null)):n=null,n===null)throw Ms(i);return Qh(n)?i.lanes=32:i.lanes=536870912,null}var E=u.children;return u=u.fallback,p?(Bs(),p=i.mode,E=ll({mode:"hidden",children:E},p),u=ci(u,p,r,null),E.return=i,u.return=i,E.sibling=u,i.child=E,u=i.child,u.memoizedState=ph(r),u.childLanes=mh(n,_,r),i.memoizedState=fh,mr(null,u)):(ks(i),gh(i,E))}var R=n.memoizedState;if(R!==null&&(E=R.dehydrated,E!==null)){if(g)i.flags&256?(ks(i),i.flags&=-257,i=yh(n,i,r)):i.memoizedState!==null?(Bs(),i.child=n.child,i.flags|=128,i=null):(Bs(),E=u.fallback,p=i.mode,u=ll({mode:"visible",children:u.children},p),E=ci(E,p,r,null),E.flags|=2,u.return=i,E.return=i,u.sibling=E,i.child=u,gi(i,n.child,null,r),u=i.child,u.memoizedState=ph(r),u.childLanes=mh(n,_,r),i.memoizedState=fh,i=mr(null,u));else if(ks(i),Qh(E)){if(_=E.nextSibling&&E.nextSibling.dataset,_)var F=_.dgst;_=F,u=Error(s(419)),u.stack="",u.digest=_,sr({value:u,source:null,stack:null}),i=yh(n,i,r)}else if(de||Zi(n,i,r,!1),_=(r&n.childLanes)!==0,de||_){if(_=Yt,_!==null&&(u=sp(_,r),u!==0&&u!==R.retryLane))throw R.retryLane=u,li(n,u),We(_,n,u),hh;Wh(E)||yl(),i=yh(n,i,r)}else Wh(E)?(i.flags|=192,i.child=n.child,i=null):(n=R.treeContext,Wt=Cn(E.nextSibling),Re=i,Lt=!0,Rs=null,xn=!1,n!==null&&Jp(i,n),i=gh(i,u.children),i.flags|=4096);return i}return p?(Bs(),E=u.fallback,p=i.mode,R=n.child,F=R.sibling,u=ss(R,{mode:"hidden",children:u.children}),u.subtreeFlags=R.subtreeFlags&65011712,F!==null?E=ss(F,E):(E=ci(E,p,r,null),E.flags|=2),E.return=i,u.return=i,u.sibling=E,i.child=u,mr(null,u),u=i.child,E=n.child.memoizedState,E===null?E=ph(r):(p=E.cachePool,p!==null?(R=ue._currentValue,p=p.parent!==R?{parent:R,pool:R}:p):p=am(),E={baseLanes:E.baseLanes|r,cachePool:p}),u.memoizedState=E,u.childLanes=mh(n,_,r),i.memoizedState=fh,mr(n.child,u)):(ks(i),r=n.child,n=r.sibling,r=ss(r,{mode:"visible",children:u.children}),r.return=i,r.sibling=null,n!==null&&(_=i.deletions,_===null?(i.deletions=[n],i.flags|=16):_.push(n)),i.child=r,i.memoizedState=null,r)}function gh(n,i){return i=ll({mode:"visible",children:i},n.mode),i.return=n,n.child=i}function ll(n,i){return n=on(22,n,null,i),n.lanes=0,n}function yh(n,i,r){return gi(i,n.child,null,r),n=gh(i,i.pendingProps.children),n.flags|=2,i.memoizedState=null,n}function bg(n,i,r){n.lanes|=i;var u=n.alternate;u!==null&&(u.lanes|=i),Nu(n.return,i,r)}function bh(n,i,r,u,p,g){var _=n.memoizedState;_===null?n.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:u,tail:r,tailMode:p,treeForkCount:g}:(_.isBackwards=i,_.rendering=null,_.renderingStartTime=0,_.last=u,_.tail=r,_.tailMode=p,_.treeForkCount=g)}function vg(n,i,r){var u=i.pendingProps,p=u.revealOrder,g=u.tail;u=u.children;var _=oe.current,E=(_&2)!==0;if(E?(_=_&1|2,i.flags|=128):_&=1,Q(oe,_),De(n,i,u,r),u=Lt?nr:0,!E&&n!==null&&(n.flags&128)!==0)t:for(n=i.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&bg(n,r,i);else if(n.tag===19)bg(n,r,i);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===i)break t;for(;n.sibling===null;){if(n.return===null||n.return===i)break t;n=n.return}n.sibling.return=n.return,n=n.sibling}switch(p){case"forwards":for(r=i.child,p=null;r!==null;)n=r.alternate,n!==null&&Wo(n)===null&&(p=r),r=r.sibling;r=p,r===null?(p=i.child,i.child=null):(p=r.sibling,r.sibling=null),bh(i,!1,p,r,g,u);break;case"backwards":case"unstable_legacy-backwards":for(r=null,p=i.child,i.child=null;p!==null;){if(n=p.alternate,n!==null&&Wo(n)===null){i.child=p;break}n=p.sibling,p.sibling=r,r=p,p=n}bh(i,!0,r,null,g,u);break;case"together":bh(i,!1,null,null,void 0,u);break;default:i.memoizedState=null}return i.child}function cs(n,i,r){if(n!==null&&(i.dependencies=n.dependencies),Fs|=i.lanes,(r&i.childLanes)===0)if(n!==null){if(Zi(n,i,r,!1),(r&i.childLanes)===0)return null}else return null;if(n!==null&&i.child!==n.child)throw Error(s(153));if(i.child!==null){for(n=i.child,r=ss(n,n.pendingProps),i.child=r,r.return=i;n.sibling!==null;)n=n.sibling,r=r.sibling=ss(n,n.pendingProps),r.return=i;r.sibling=null}return i.child}function vh(n,i){return(n.lanes&i)!==0?!0:(n=n.dependencies,!!(n!==null&&jo(n)))}function QA(n,i,r){switch(i.tag){case 3:re(i,i.stateNode.containerInfo),Ds(i,ue,n.memoizedState.cache),ui();break;case 27:case 5:ei(i);break;case 4:re(i,i.stateNode.containerInfo);break;case 10:Ds(i,i.type,i.memoizedProps.value);break;case 31:if(i.memoizedState!==null)return i.flags|=128,$u(i),null;break;case 13:var u=i.memoizedState;if(u!==null)return u.dehydrated!==null?(ks(i),i.flags|=128,null):(r&i.child.childLanes)!==0?yg(n,i,r):(ks(i),n=cs(n,i,r),n!==null?n.sibling:null);ks(i);break;case 19:var p=(n.flags&128)!==0;if(u=(r&i.childLanes)!==0,u||(Zi(n,i,r,!1),u=(r&i.childLanes)!==0),p){if(u)return vg(n,i,r);i.flags|=128}if(p=i.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),Q(oe,oe.current),u)break;return null;case 22:return i.lanes=0,hg(n,i,r,i.pendingProps);case 24:Ds(i,ue,n.memoizedState.cache)}return cs(n,i,r)}function _g(n,i,r){if(n!==null)if(n.memoizedProps!==i.pendingProps)de=!0;else{if(!vh(n,r)&&(i.flags&128)===0)return de=!1,QA(n,i,r);de=(n.flags&131072)!==0}else de=!1,Lt&&(i.flags&1048576)!==0&&Zp(i,nr,i.index);switch(i.lanes=0,i.tag){case 16:t:{var u=i.pendingProps;if(n=pi(i.elementType),i.type=n,typeof n=="function")Eu(n)?(u=bi(n,u),i.tag=1,i=mg(null,i,n,u,r)):(i.tag=0,i=dh(null,i,n,u,r));else{if(n!=null){var p=n.$$typeof;if(p===N){i.tag=11,i=lg(null,i,n,u,r);break t}else if(p===k){i.tag=14,i=cg(null,i,n,u,r);break t}}throw i=gt(n)||n,Error(s(306,i,""))}}return i;case 0:return dh(n,i,i.type,i.pendingProps,r);case 1:return u=i.type,p=bi(u,i.pendingProps),mg(n,i,u,p,r);case 3:t:{if(re(i,i.stateNode.containerInfo),n===null)throw Error(s(387));u=i.pendingProps;var g=i.memoizedState;p=g.element,Uu(n,i),ur(i,u,null,r);var _=i.memoizedState;if(u=_.cache,Ds(i,ue,u),u!==g.cache&&Lu(i,[ue],r,!0),cr(),u=_.element,g.isDehydrated)if(g={element:u,isDehydrated:!1,cache:_.cache},i.updateQueue.baseState=g,i.memoizedState=g,i.flags&256){i=gg(n,i,u,r);break t}else if(u!==p){p=wn(Error(s(424)),i),sr(p),i=gg(n,i,u,r);break t}else for(n=i.stateNode.containerInfo,n.nodeType===9?n=n.body:n=n.nodeName==="HTML"?n.ownerDocument.body:n,Wt=Cn(n.firstChild),Re=i,Lt=!0,Rs=null,xn=!0,r=hm(i,null,u,r),i.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(ui(),u===p){i=cs(n,i,r);break t}De(n,i,u,r)}i=i.child}return i;case 26:return ol(n,i),n===null?(r=Oy(i.type,null,i.pendingProps,null))?i.memoizedState=r:Lt||(r=i.type,n=i.pendingProps,u=El(yt.current).createElement(r),u[Ce]=i,u[$e]=n,Oe(u,r,n),we(u),i.stateNode=u):i.memoizedState=Oy(i.type,n.memoizedProps,i.pendingProps,n.memoizedState),null;case 27:return ei(i),n===null&&Lt&&(u=i.stateNode=Ry(i.type,i.pendingProps,yt.current),Re=i,xn=!0,p=Wt,qs(i.type)?(Zh=p,Wt=Cn(u.firstChild)):Wt=p),De(n,i,i.pendingProps.children,r),ol(n,i),n===null&&(i.flags|=4194304),i.child;case 5:return n===null&&Lt&&((p=u=Wt)&&(u=Cw(u,i.type,i.pendingProps,xn),u!==null?(i.stateNode=u,Re=i,Wt=Cn(u.firstChild),xn=!1,p=!0):p=!1),p||Ms(i)),ei(i),p=i.type,g=i.pendingProps,_=n!==null?n.memoizedProps:null,u=g.children,Vh(p,g)?u=null:_!==null&&Vh(p,_)&&(i.flags|=32),i.memoizedState!==null&&(p=Xu(n,i,jA,null,null,r),Dr._currentValue=p),ol(n,i),De(n,i,u,r),i.child;case 6:return n===null&&Lt&&((n=r=Wt)&&(r=Rw(r,i.pendingProps,xn),r!==null?(i.stateNode=r,Re=i,Wt=null,n=!0):n=!1),n||Ms(i)),null;case 13:return yg(n,i,r);case 4:return re(i,i.stateNode.containerInfo),u=i.pendingProps,n===null?i.child=gi(i,null,u,r):De(n,i,u,r),i.child;case 11:return lg(n,i,i.type,i.pendingProps,r);case 7:return De(n,i,i.pendingProps,r),i.child;case 8:return De(n,i,i.pendingProps.children,r),i.child;case 12:return De(n,i,i.pendingProps.children,r),i.child;case 10:return u=i.pendingProps,Ds(i,i.type,u.value),De(n,i,u.children,r),i.child;case 9:return p=i.type._context,u=i.pendingProps.children,di(i),p=Me(p),u=u(p),i.flags|=1,De(n,i,u,r),i.child;case 14:return cg(n,i,i.type,i.pendingProps,r);case 15:return ug(n,i,i.type,i.pendingProps,r);case 19:return vg(n,i,r);case 31:return WA(n,i,r);case 22:return hg(n,i,r,i.pendingProps);case 24:return di(i),u=Me(ue),n===null?(p=Iu(),p===null&&(p=Yt,g=ku(),p.pooledCache=g,g.refCount++,g!==null&&(p.pooledCacheLanes|=r),p=g),i.memoizedState={parent:u,cache:p},Fu(i),Ds(i,ue,p)):((n.lanes&r)!==0&&(Uu(n,i),ur(i,null,null,r),cr()),p=n.memoizedState,g=i.memoizedState,p.parent!==u?(p={parent:u,cache:u},i.memoizedState=p,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=p),Ds(i,ue,u)):(u=g.cache,Ds(i,ue,u),u!==p.cache&&Lu(i,[ue],r,!0))),De(n,i,i.pendingProps.children,r),i.child;case 29:throw i.pendingProps}throw Error(s(156,i.tag))}function us(n){n.flags|=4}function _h(n,i,r,u,p){if((i=(n.mode&32)!==0)&&(i=!1),i){if(n.flags|=16777216,(p&335544128)===p)if(n.stateNode.complete)n.flags|=8192;else if(Vg())n.flags|=8192;else throw mi=Xo,Pu}else n.flags&=-16777217}function Ag(n,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)n.flags&=-16777217;else if(n.flags|=16777216,!Iy(i))if(Vg())n.flags|=8192;else throw mi=Xo,Pu}function cl(n,i){i!==null&&(n.flags|=4),n.flags&16384&&(i=n.tag!==22?tp():536870912,n.lanes|=i,ua|=i)}function gr(n,i){if(!Lt)switch(n.tailMode){case"hidden":i=n.tail;for(var r=null;i!==null;)i.alternate!==null&&(r=i),i=i.sibling;r===null?n.tail=null:r.sibling=null;break;case"collapsed":r=n.tail;for(var u=null;r!==null;)r.alternate!==null&&(u=r),r=r.sibling;u===null?i||n.tail===null?n.tail=null:n.tail.sibling=null:u.sibling=null}}function Qt(n){var i=n.alternate!==null&&n.alternate.child===n.child,r=0,u=0;if(i)for(var p=n.child;p!==null;)r|=p.lanes|p.childLanes,u|=p.subtreeFlags&65011712,u|=p.flags&65011712,p.return=n,p=p.sibling;else for(p=n.child;p!==null;)r|=p.lanes|p.childLanes,u|=p.subtreeFlags,u|=p.flags,p.return=n,p=p.sibling;return n.subtreeFlags|=u,n.childLanes=r,i}function ZA(n,i,r){var u=i.pendingProps;switch(Ru(i),i.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qt(i),null;case 1:return Qt(i),null;case 3:return r=i.stateNode,u=null,n!==null&&(u=n.memoizedState.cache),i.memoizedState.cache!==u&&(i.flags|=2048),rs(ue),Vt(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(Qi(i)?us(i):n===null||n.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,Du())),Qt(i),null;case 26:var p=i.type,g=i.memoizedState;return n===null?(us(i),g!==null?(Qt(i),Ag(i,g)):(Qt(i),_h(i,p,null,u,r))):g?g!==n.memoizedState?(us(i),Qt(i),Ag(i,g)):(Qt(i),i.flags&=-16777217):(n=n.memoizedProps,n!==u&&us(i),Qt(i),_h(i,p,n,u,r)),null;case 27:if(Ss(i),r=yt.current,p=i.type,n!==null&&i.stateNode!=null)n.memoizedProps!==u&&us(i);else{if(!u){if(i.stateNode===null)throw Error(s(166));return Qt(i),null}n=et.current,Qi(i)?tm(i):(n=Ry(p,u,r),i.stateNode=n,us(i))}return Qt(i),null;case 5:if(Ss(i),p=i.type,n!==null&&i.stateNode!=null)n.memoizedProps!==u&&us(i);else{if(!u){if(i.stateNode===null)throw Error(s(166));return Qt(i),null}if(g=et.current,Qi(i))tm(i);else{var _=El(yt.current);switch(g){case 1:g=_.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:g=_.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":g=_.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":g=_.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":g=_.createElement("div"),g.innerHTML="<script><\/script>",g=g.removeChild(g.firstChild);break;case"select":g=typeof u.is=="string"?_.createElement("select",{is:u.is}):_.createElement("select"),u.multiple?g.multiple=!0:u.size&&(g.size=u.size);break;default:g=typeof u.is=="string"?_.createElement(p,{is:u.is}):_.createElement(p)}}g[Ce]=i,g[$e]=u;t:for(_=i.child;_!==null;){if(_.tag===5||_.tag===6)g.appendChild(_.stateNode);else if(_.tag!==4&&_.tag!==27&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===i)break t;for(;_.sibling===null;){if(_.return===null||_.return===i)break t;_=_.return}_.sibling.return=_.return,_=_.sibling}i.stateNode=g;t:switch(Oe(g,p,u),p){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break t;case"img":u=!0;break t;default:u=!1}u&&us(i)}}return Qt(i),_h(i,i.type,n===null?null:n.memoizedProps,i.pendingProps,r),null;case 6:if(n&&i.stateNode!=null)n.memoizedProps!==u&&us(i);else{if(typeof u!="string"&&i.stateNode===null)throw Error(s(166));if(n=yt.current,Qi(i)){if(n=i.stateNode,r=i.memoizedProps,u=null,p=Re,p!==null)switch(p.tag){case 27:case 5:u=p.memoizedProps}n[Ce]=i,n=!!(n.nodeValue===r||u!==null&&u.suppressHydrationWarning===!0||yy(n.nodeValue,r)),n||Ms(i,!0)}else n=El(n).createTextNode(u),n[Ce]=i,i.stateNode=n}return Qt(i),null;case 31:if(r=i.memoizedState,n===null||n.memoizedState!==null){if(u=Qi(i),r!==null){if(n===null){if(!u)throw Error(s(318));if(n=i.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(s(557));n[Ce]=i}else ui(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;Qt(i),n=!1}else r=Du(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=r),n=!0;if(!n)return i.flags&256?(cn(i),i):(cn(i),null);if((i.flags&128)!==0)throw Error(s(558))}return Qt(i),null;case 13:if(u=i.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(p=Qi(i),u!==null&&u.dehydrated!==null){if(n===null){if(!p)throw Error(s(318));if(p=i.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(s(317));p[Ce]=i}else ui(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;Qt(i),p=!1}else p=Du(),n!==null&&n.memoizedState!==null&&(n.memoizedState.hydrationErrors=p),p=!0;if(!p)return i.flags&256?(cn(i),i):(cn(i),null)}return cn(i),(i.flags&128)!==0?(i.lanes=r,i):(r=u!==null,n=n!==null&&n.memoizedState!==null,r&&(u=i.child,p=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(p=u.alternate.memoizedState.cachePool.pool),g=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(g=u.memoizedState.cachePool.pool),g!==p&&(u.flags|=2048)),r!==n&&r&&(i.child.flags|=8192),cl(i,i.updateQueue),Qt(i),null);case 4:return Vt(),n===null&&jh(i.stateNode.containerInfo),Qt(i),null;case 10:return rs(i.type),Qt(i),null;case 19:if(q(oe),u=i.memoizedState,u===null)return Qt(i),null;if(p=(i.flags&128)!==0,g=u.rendering,g===null)if(p)gr(u,!1);else{if(ie!==0||n!==null&&(n.flags&128)!==0)for(n=i.child;n!==null;){if(g=Wo(n),g!==null){for(i.flags|=128,gr(u,!1),n=g.updateQueue,i.updateQueue=n,cl(i,n),i.subtreeFlags=0,n=r,r=i.child;r!==null;)Kp(r,n),r=r.sibling;return Q(oe,oe.current&1|2),Lt&&is(i,u.treeForkCount),i.child}n=n.sibling}u.tail!==null&&nn()>pl&&(i.flags|=128,p=!0,gr(u,!1),i.lanes=4194304)}else{if(!p)if(n=Wo(g),n!==null){if(i.flags|=128,p=!0,n=n.updateQueue,i.updateQueue=n,cl(i,n),gr(u,!0),u.tail===null&&u.tailMode==="hidden"&&!g.alternate&&!Lt)return Qt(i),null}else 2*nn()-u.renderingStartTime>pl&&r!==536870912&&(i.flags|=128,p=!0,gr(u,!1),i.lanes=4194304);u.isBackwards?(g.sibling=i.child,i.child=g):(n=u.last,n!==null?n.sibling=g:i.child=g,u.last=g)}return u.tail!==null?(n=u.tail,u.rendering=n,u.tail=n.sibling,u.renderingStartTime=nn(),n.sibling=null,r=oe.current,Q(oe,p?r&1|2:r&1),Lt&&is(i,u.treeForkCount),n):(Qt(i),null);case 22:case 23:return cn(i),qu(),u=i.memoizedState!==null,n!==null?n.memoizedState!==null!==u&&(i.flags|=8192):u&&(i.flags|=8192),u?(r&536870912)!==0&&(i.flags&128)===0&&(Qt(i),i.subtreeFlags&6&&(i.flags|=8192)):Qt(i),r=i.updateQueue,r!==null&&cl(i,r.retryQueue),r=null,n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(r=n.memoizedState.cachePool.pool),u=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),u!==r&&(i.flags|=2048),n!==null&&q(fi),null;case 24:return r=null,n!==null&&(r=n.memoizedState.cache),i.memoizedState.cache!==r&&(i.flags|=2048),rs(ue),Qt(i),null;case 25:return null;case 30:return null}throw Error(s(156,i.tag))}function JA(n,i){switch(Ru(i),i.tag){case 1:return n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 3:return rs(ue),Vt(),n=i.flags,(n&65536)!==0&&(n&128)===0?(i.flags=n&-65537|128,i):null;case 26:case 27:case 5:return Ss(i),null;case 31:if(i.memoizedState!==null){if(cn(i),i.alternate===null)throw Error(s(340));ui()}return n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 13:if(cn(i),n=i.memoizedState,n!==null&&n.dehydrated!==null){if(i.alternate===null)throw Error(s(340));ui()}return n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 19:return q(oe),null;case 4:return Vt(),null;case 10:return rs(i.type),null;case 22:case 23:return cn(i),qu(),n!==null&&q(fi),n=i.flags,n&65536?(i.flags=n&-65537|128,i):null;case 24:return rs(ue),null;case 25:return null;default:return null}}function wg(n,i){switch(Ru(i),i.tag){case 3:rs(ue),Vt();break;case 26:case 27:case 5:Ss(i);break;case 4:Vt();break;case 31:i.memoizedState!==null&&cn(i);break;case 13:cn(i);break;case 19:q(oe);break;case 10:rs(i.type);break;case 22:case 23:cn(i),qu(),n!==null&&q(fi);break;case 24:rs(ue)}}function yr(n,i){try{var r=i.updateQueue,u=r!==null?r.lastEffect:null;if(u!==null){var p=u.next;r=p;do{if((r.tag&n)===n){u=void 0;var g=r.create,_=r.inst;u=g(),_.destroy=u}r=r.next}while(r!==p)}}catch(E){jt(i,i.return,E)}}function Is(n,i,r){try{var u=i.updateQueue,p=u!==null?u.lastEffect:null;if(p!==null){var g=p.next;u=g;do{if((u.tag&n)===n){var _=u.inst,E=_.destroy;if(E!==void 0){_.destroy=void 0,p=i;var R=r,F=E;try{F()}catch(G){jt(p,R,G)}}}u=u.next}while(u!==g)}}catch(G){jt(i,i.return,G)}}function Sg(n){var i=n.updateQueue;if(i!==null){var r=n.stateNode;try{fm(i,r)}catch(u){jt(n,n.return,u)}}}function Eg(n,i,r){r.props=bi(n.type,n.memoizedProps),r.state=n.memoizedState;try{r.componentWillUnmount()}catch(u){jt(n,i,u)}}function br(n,i){try{var r=n.ref;if(r!==null){switch(n.tag){case 26:case 27:case 5:var u=n.stateNode;break;case 30:u=n.stateNode;break;default:u=n.stateNode}typeof r=="function"?n.refCleanup=r(u):r.current=u}}catch(p){jt(n,i,p)}}function Hn(n,i){var r=n.ref,u=n.refCleanup;if(r!==null)if(typeof u=="function")try{u()}catch(p){jt(n,i,p)}finally{n.refCleanup=null,n=n.alternate,n!=null&&(n.refCleanup=null)}else if(typeof r=="function")try{r(null)}catch(p){jt(n,i,p)}else r.current=null}function xg(n){var i=n.type,r=n.memoizedProps,u=n.stateNode;try{t:switch(i){case"button":case"input":case"select":case"textarea":r.autoFocus&&u.focus();break t;case"img":r.src?u.src=r.src:r.srcSet&&(u.srcset=r.srcSet)}}catch(p){jt(n,n.return,p)}}function Ah(n,i,r){try{var u=n.stateNode;Aw(u,n.type,r,i),u[$e]=i}catch(p){jt(n,n.return,p)}}function Tg(n){return n.tag===5||n.tag===3||n.tag===26||n.tag===27&&qs(n.type)||n.tag===4}function wh(n){t:for(;;){for(;n.sibling===null;){if(n.return===null||Tg(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.tag===27&&qs(n.type)||n.flags&2||n.child===null||n.tag===4)continue t;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Sh(n,i,r){var u=n.tag;if(u===5||u===6)n=n.stateNode,i?(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r).insertBefore(n,i):(i=r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,i.appendChild(n),r=r._reactRootContainer,r!=null||i.onclick!==null||(i.onclick=es));else if(u!==4&&(u===27&&qs(n.type)&&(r=n.stateNode,i=null),n=n.child,n!==null))for(Sh(n,i,r),n=n.sibling;n!==null;)Sh(n,i,r),n=n.sibling}function ul(n,i,r){var u=n.tag;if(u===5||u===6)n=n.stateNode,i?r.insertBefore(n,i):r.appendChild(n);else if(u!==4&&(u===27&&qs(n.type)&&(r=n.stateNode),n=n.child,n!==null))for(ul(n,i,r),n=n.sibling;n!==null;)ul(n,i,r),n=n.sibling}function Cg(n){var i=n.stateNode,r=n.memoizedProps;try{for(var u=n.type,p=i.attributes;p.length;)i.removeAttributeNode(p[0]);Oe(i,u,r),i[Ce]=n,i[$e]=r}catch(g){jt(n,n.return,g)}}var hs=!1,fe=!1,Eh=!1,Rg=typeof WeakSet=="function"?WeakSet:Set,Se=null;function tw(n,i){if(n=n.containerInfo,Gh=Ol,n=zp(n),yu(n)){if("selectionStart"in n)var r={start:n.selectionStart,end:n.selectionEnd};else t:{r=(r=n.ownerDocument)&&r.defaultView||window;var u=r.getSelection&&r.getSelection();if(u&&u.rangeCount!==0){r=u.anchorNode;var p=u.anchorOffset,g=u.focusNode;u=u.focusOffset;try{r.nodeType,g.nodeType}catch{r=null;break t}var _=0,E=-1,R=-1,F=0,G=0,Y=n,z=null;e:for(;;){for(var j;Y!==r||p!==0&&Y.nodeType!==3||(E=_+p),Y!==g||u!==0&&Y.nodeType!==3||(R=_+u),Y.nodeType===3&&(_+=Y.nodeValue.length),(j=Y.firstChild)!==null;)z=Y,Y=j;for(;;){if(Y===n)break e;if(z===r&&++F===p&&(E=_),z===g&&++G===u&&(R=_),(j=Y.nextSibling)!==null)break;Y=z,z=Y.parentNode}Y=j}r=E===-1||R===-1?null:{start:E,end:R}}else r=null}r=r||{start:0,end:0}}else r=null;for(Xh={focusedElem:n,selectionRange:r},Ol=!1,Se=i;Se!==null;)if(i=Se,n=i.child,(i.subtreeFlags&1028)!==0&&n!==null)n.return=i,Se=n;else for(;Se!==null;){switch(i=Se,g=i.alternate,n=i.flags,i.tag){case 0:if((n&4)!==0&&(n=i.updateQueue,n=n!==null?n.events:null,n!==null))for(r=0;r<n.length;r++)p=n[r],p.ref.impl=p.nextImpl;break;case 11:case 15:break;case 1:if((n&1024)!==0&&g!==null){n=void 0,r=i,p=g.memoizedProps,g=g.memoizedState,u=r.stateNode;try{var it=bi(r.type,p);n=u.getSnapshotBeforeUpdate(it,g),u.__reactInternalSnapshotBeforeUpdate=n}catch(ft){jt(r,r.return,ft)}}break;case 3:if((n&1024)!==0){if(n=i.stateNode.containerInfo,r=n.nodeType,r===9)Kh(n);else if(r===1)switch(n.nodeName){case"HEAD":case"HTML":case"BODY":Kh(n);break;default:n.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((n&1024)!==0)throw Error(s(163))}if(n=i.sibling,n!==null){n.return=i.return,Se=n;break}Se=i.return}}function Mg(n,i,r){var u=r.flags;switch(r.tag){case 0:case 11:case 15:fs(n,r),u&4&&yr(5,r);break;case 1:if(fs(n,r),u&4)if(n=r.stateNode,i===null)try{n.componentDidMount()}catch(_){jt(r,r.return,_)}else{var p=bi(r.type,i.memoizedProps);i=i.memoizedState;try{n.componentDidUpdate(p,i,n.__reactInternalSnapshotBeforeUpdate)}catch(_){jt(r,r.return,_)}}u&64&&Sg(r),u&512&&br(r,r.return);break;case 3:if(fs(n,r),u&64&&(n=r.updateQueue,n!==null)){if(i=null,r.child!==null)switch(r.child.tag){case 27:case 5:i=r.child.stateNode;break;case 1:i=r.child.stateNode}try{fm(n,i)}catch(_){jt(r,r.return,_)}}break;case 27:i===null&&u&4&&Cg(r);case 26:case 5:fs(n,r),i===null&&u&4&&xg(r),u&512&&br(r,r.return);break;case 12:fs(n,r);break;case 31:fs(n,r),u&4&&Ng(n,r);break;case 13:fs(n,r),u&4&&Lg(n,r),u&64&&(n=r.memoizedState,n!==null&&(n=n.dehydrated,n!==null&&(r=cw.bind(null,r),Mw(n,r))));break;case 22:if(u=r.memoizedState!==null||hs,!u){i=i!==null&&i.memoizedState!==null||fe,p=hs;var g=fe;hs=u,(fe=i)&&!g?ps(n,r,(r.subtreeFlags&8772)!==0):fs(n,r),hs=p,fe=g}break;case 30:break;default:fs(n,r)}}function Dg(n){var i=n.alternate;i!==null&&(n.alternate=null,Dg(i)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(i=n.stateNode,i!==null&&tu(i)),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}var Zt=null,Xe=!1;function ds(n,i,r){for(r=r.child;r!==null;)Og(n,i,r),r=r.sibling}function Og(n,i,r){if(sn&&typeof sn.onCommitFiberUnmount=="function")try{sn.onCommitFiberUnmount(ja,r)}catch{}switch(r.tag){case 26:fe||Hn(r,i),ds(n,i,r),r.memoizedState?r.memoizedState.count--:r.stateNode&&(r=r.stateNode,r.parentNode.removeChild(r));break;case 27:fe||Hn(r,i);var u=Zt,p=Xe;qs(r.type)&&(Zt=r.stateNode,Xe=!1),ds(n,i,r),Cr(r.stateNode),Zt=u,Xe=p;break;case 5:fe||Hn(r,i);case 6:if(u=Zt,p=Xe,Zt=null,ds(n,i,r),Zt=u,Xe=p,Zt!==null)if(Xe)try{(Zt.nodeType===9?Zt.body:Zt.nodeName==="HTML"?Zt.ownerDocument.body:Zt).removeChild(r.stateNode)}catch(g){jt(r,i,g)}else try{Zt.removeChild(r.stateNode)}catch(g){jt(r,i,g)}break;case 18:Zt!==null&&(Xe?(n=Zt,Sy(n.nodeType===9?n.body:n.nodeName==="HTML"?n.ownerDocument.body:n,r.stateNode),ba(n)):Sy(Zt,r.stateNode));break;case 4:u=Zt,p=Xe,Zt=r.stateNode.containerInfo,Xe=!0,ds(n,i,r),Zt=u,Xe=p;break;case 0:case 11:case 14:case 15:Is(2,r,i),fe||Is(4,r,i),ds(n,i,r);break;case 1:fe||(Hn(r,i),u=r.stateNode,typeof u.componentWillUnmount=="function"&&Eg(r,i,u)),ds(n,i,r);break;case 21:ds(n,i,r);break;case 22:fe=(u=fe)||r.memoizedState!==null,ds(n,i,r),fe=u;break;default:ds(n,i,r)}}function Ng(n,i){if(i.memoizedState===null&&(n=i.alternate,n!==null&&(n=n.memoizedState,n!==null))){n=n.dehydrated;try{ba(n)}catch(r){jt(i,i.return,r)}}}function Lg(n,i){if(i.memoizedState===null&&(n=i.alternate,n!==null&&(n=n.memoizedState,n!==null&&(n=n.dehydrated,n!==null))))try{ba(n)}catch(r){jt(i,i.return,r)}}function ew(n){switch(n.tag){case 31:case 13:case 19:var i=n.stateNode;return i===null&&(i=n.stateNode=new Rg),i;case 22:return n=n.stateNode,i=n._retryCache,i===null&&(i=n._retryCache=new Rg),i;default:throw Error(s(435,n.tag))}}function hl(n,i){var r=ew(n);i.forEach(function(u){if(!r.has(u)){r.add(u);var p=uw.bind(null,n,u);u.then(p,p)}})}function Ve(n,i){var r=i.deletions;if(r!==null)for(var u=0;u<r.length;u++){var p=r[u],g=n,_=i,E=_;t:for(;E!==null;){switch(E.tag){case 27:if(qs(E.type)){Zt=E.stateNode,Xe=!1;break t}break;case 5:Zt=E.stateNode,Xe=!1;break t;case 3:case 4:Zt=E.stateNode.containerInfo,Xe=!0;break t}E=E.return}if(Zt===null)throw Error(s(160));Og(g,_,p),Zt=null,Xe=!1,g=p.alternate,g!==null&&(g.return=null),p.return=null}if(i.subtreeFlags&13886)for(i=i.child;i!==null;)kg(i,n),i=i.sibling}var Bn=null;function kg(n,i){var r=n.alternate,u=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:Ve(i,n),Ye(n),u&4&&(Is(3,n,n.return),yr(3,n),Is(5,n,n.return));break;case 1:Ve(i,n),Ye(n),u&512&&(fe||r===null||Hn(r,r.return)),u&64&&hs&&(n=n.updateQueue,n!==null&&(u=n.callbacks,u!==null&&(r=n.shared.hiddenCallbacks,n.shared.hiddenCallbacks=r===null?u:r.concat(u))));break;case 26:var p=Bn;if(Ve(i,n),Ye(n),u&512&&(fe||r===null||Hn(r,r.return)),u&4){var g=r!==null?r.memoizedState:null;if(u=n.memoizedState,r===null)if(u===null)if(n.stateNode===null){t:{u=n.type,r=n.memoizedProps,p=p.ownerDocument||p;e:switch(u){case"title":g=p.getElementsByTagName("title")[0],(!g||g[Ga]||g[Ce]||g.namespaceURI==="http://www.w3.org/2000/svg"||g.hasAttribute("itemprop"))&&(g=p.createElement(u),p.head.insertBefore(g,p.querySelector("head > title"))),Oe(g,u,r),g[Ce]=n,we(g),u=g;break t;case"link":var _=ky("link","href",p).get(u+(r.href||""));if(_){for(var E=0;E<_.length;E++)if(g=_[E],g.getAttribute("href")===(r.href==null||r.href===""?null:r.href)&&g.getAttribute("rel")===(r.rel==null?null:r.rel)&&g.getAttribute("title")===(r.title==null?null:r.title)&&g.getAttribute("crossorigin")===(r.crossOrigin==null?null:r.crossOrigin)){_.splice(E,1);break e}}g=p.createElement(u),Oe(g,u,r),p.head.appendChild(g);break;case"meta":if(_=ky("meta","content",p).get(u+(r.content||""))){for(E=0;E<_.length;E++)if(g=_[E],g.getAttribute("content")===(r.content==null?null:""+r.content)&&g.getAttribute("name")===(r.name==null?null:r.name)&&g.getAttribute("property")===(r.property==null?null:r.property)&&g.getAttribute("http-equiv")===(r.httpEquiv==null?null:r.httpEquiv)&&g.getAttribute("charset")===(r.charSet==null?null:r.charSet)){_.splice(E,1);break e}}g=p.createElement(u),Oe(g,u,r),p.head.appendChild(g);break;default:throw Error(s(468,u))}g[Ce]=n,we(g),u=g}n.stateNode=u}else By(p,n.type,n.stateNode);else n.stateNode=Ly(p,u,n.memoizedProps);else g!==u?(g===null?r.stateNode!==null&&(r=r.stateNode,r.parentNode.removeChild(r)):g.count--,u===null?By(p,n.type,n.stateNode):Ly(p,u,n.memoizedProps)):u===null&&n.stateNode!==null&&Ah(n,n.memoizedProps,r.memoizedProps)}break;case 27:Ve(i,n),Ye(n),u&512&&(fe||r===null||Hn(r,r.return)),r!==null&&u&4&&Ah(n,n.memoizedProps,r.memoizedProps);break;case 5:if(Ve(i,n),Ye(n),u&512&&(fe||r===null||Hn(r,r.return)),n.flags&32){p=n.stateNode;try{Hi(p,"")}catch(it){jt(n,n.return,it)}}u&4&&n.stateNode!=null&&(p=n.memoizedProps,Ah(n,p,r!==null?r.memoizedProps:p)),u&1024&&(Eh=!0);break;case 6:if(Ve(i,n),Ye(n),u&4){if(n.stateNode===null)throw Error(s(162));u=n.memoizedProps,r=n.stateNode;try{r.nodeValue=u}catch(it){jt(n,n.return,it)}}break;case 3:if(Cl=null,p=Bn,Bn=xl(i.containerInfo),Ve(i,n),Bn=p,Ye(n),u&4&&r!==null&&r.memoizedState.isDehydrated)try{ba(i.containerInfo)}catch(it){jt(n,n.return,it)}Eh&&(Eh=!1,Bg(n));break;case 4:u=Bn,Bn=xl(n.stateNode.containerInfo),Ve(i,n),Ye(n),Bn=u;break;case 12:Ve(i,n),Ye(n);break;case 31:Ve(i,n),Ye(n),u&4&&(u=n.updateQueue,u!==null&&(n.updateQueue=null,hl(n,u)));break;case 13:Ve(i,n),Ye(n),n.child.flags&8192&&n.memoizedState!==null!=(r!==null&&r.memoizedState!==null)&&(fl=nn()),u&4&&(u=n.updateQueue,u!==null&&(n.updateQueue=null,hl(n,u)));break;case 22:p=n.memoizedState!==null;var R=r!==null&&r.memoizedState!==null,F=hs,G=fe;if(hs=F||p,fe=G||R,Ve(i,n),fe=G,hs=F,Ye(n),u&8192)t:for(i=n.stateNode,i._visibility=p?i._visibility&-2:i._visibility|1,p&&(r===null||R||hs||fe||vi(n)),r=null,i=n;;){if(i.tag===5||i.tag===26){if(r===null){R=r=i;try{if(g=R.stateNode,p)_=g.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none";else{E=R.stateNode;var Y=R.memoizedProps.style,z=Y!=null&&Y.hasOwnProperty("display")?Y.display:null;E.style.display=z==null||typeof z=="boolean"?"":(""+z).trim()}}catch(it){jt(R,R.return,it)}}}else if(i.tag===6){if(r===null){R=i;try{R.stateNode.nodeValue=p?"":R.memoizedProps}catch(it){jt(R,R.return,it)}}}else if(i.tag===18){if(r===null){R=i;try{var j=R.stateNode;p?Ey(j,!0):Ey(R.stateNode,!1)}catch(it){jt(R,R.return,it)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===n)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===n)break t;for(;i.sibling===null;){if(i.return===null||i.return===n)break t;r===i&&(r=null),i=i.return}r===i&&(r=null),i.sibling.return=i.return,i=i.sibling}u&4&&(u=n.updateQueue,u!==null&&(r=u.retryQueue,r!==null&&(u.retryQueue=null,hl(n,r))));break;case 19:Ve(i,n),Ye(n),u&4&&(u=n.updateQueue,u!==null&&(n.updateQueue=null,hl(n,u)));break;case 30:break;case 21:break;default:Ve(i,n),Ye(n)}}function Ye(n){var i=n.flags;if(i&2){try{for(var r,u=n.return;u!==null;){if(Tg(u)){r=u;break}u=u.return}if(r==null)throw Error(s(160));switch(r.tag){case 27:var p=r.stateNode,g=wh(n);ul(n,g,p);break;case 5:var _=r.stateNode;r.flags&32&&(Hi(_,""),r.flags&=-33);var E=wh(n);ul(n,E,_);break;case 3:case 4:var R=r.stateNode.containerInfo,F=wh(n);Sh(n,F,R);break;default:throw Error(s(161))}}catch(G){jt(n,n.return,G)}n.flags&=-3}i&4096&&(n.flags&=-4097)}function Bg(n){if(n.subtreeFlags&1024)for(n=n.child;n!==null;){var i=n;Bg(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),n=n.sibling}}function fs(n,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)Mg(n,i.alternate,i),i=i.sibling}function vi(n){for(n=n.child;n!==null;){var i=n;switch(i.tag){case 0:case 11:case 14:case 15:Is(4,i,i.return),vi(i);break;case 1:Hn(i,i.return);var r=i.stateNode;typeof r.componentWillUnmount=="function"&&Eg(i,i.return,r),vi(i);break;case 27:Cr(i.stateNode);case 26:case 5:Hn(i,i.return),vi(i);break;case 22:i.memoizedState===null&&vi(i);break;case 30:vi(i);break;default:vi(i)}n=n.sibling}}function ps(n,i,r){for(r=r&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var u=i.alternate,p=n,g=i,_=g.flags;switch(g.tag){case 0:case 11:case 15:ps(p,g,r),yr(4,g);break;case 1:if(ps(p,g,r),u=g,p=u.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(F){jt(u,u.return,F)}if(u=g,p=u.updateQueue,p!==null){var E=u.stateNode;try{var R=p.shared.hiddenCallbacks;if(R!==null)for(p.shared.hiddenCallbacks=null,p=0;p<R.length;p++)dm(R[p],E)}catch(F){jt(u,u.return,F)}}r&&_&64&&Sg(g),br(g,g.return);break;case 27:Cg(g);case 26:case 5:ps(p,g,r),r&&u===null&&_&4&&xg(g),br(g,g.return);break;case 12:ps(p,g,r);break;case 31:ps(p,g,r),r&&_&4&&Ng(p,g);break;case 13:ps(p,g,r),r&&_&4&&Lg(p,g);break;case 22:g.memoizedState===null&&ps(p,g,r),br(g,g.return);break;case 30:break;default:ps(p,g,r)}i=i.sibling}}function xh(n,i){var r=null;n!==null&&n.memoizedState!==null&&n.memoizedState.cachePool!==null&&(r=n.memoizedState.cachePool.pool),n=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(n=i.memoizedState.cachePool.pool),n!==r&&(n!=null&&n.refCount++,r!=null&&ir(r))}function Th(n,i){n=null,i.alternate!==null&&(n=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==n&&(i.refCount++,n!=null&&ir(n))}function In(n,i,r,u){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Ig(n,i,r,u),i=i.sibling}function Ig(n,i,r,u){var p=i.flags;switch(i.tag){case 0:case 11:case 15:In(n,i,r,u),p&2048&&yr(9,i);break;case 1:In(n,i,r,u);break;case 3:In(n,i,r,u),p&2048&&(n=null,i.alternate!==null&&(n=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==n&&(i.refCount++,n!=null&&ir(n)));break;case 12:if(p&2048){In(n,i,r,u),n=i.stateNode;try{var g=i.memoizedProps,_=g.id,E=g.onPostCommit;typeof E=="function"&&E(_,i.alternate===null?"mount":"update",n.passiveEffectDuration,-0)}catch(R){jt(i,i.return,R)}}else In(n,i,r,u);break;case 31:In(n,i,r,u);break;case 13:In(n,i,r,u);break;case 23:break;case 22:g=i.stateNode,_=i.alternate,i.memoizedState!==null?g._visibility&2?In(n,i,r,u):vr(n,i):g._visibility&2?In(n,i,r,u):(g._visibility|=2,oa(n,i,r,u,(i.subtreeFlags&10256)!==0||!1)),p&2048&&xh(_,i);break;case 24:In(n,i,r,u),p&2048&&Th(i.alternate,i);break;default:In(n,i,r,u)}}function oa(n,i,r,u,p){for(p=p&&((i.subtreeFlags&10256)!==0||!1),i=i.child;i!==null;){var g=n,_=i,E=r,R=u,F=_.flags;switch(_.tag){case 0:case 11:case 15:oa(g,_,E,R,p),yr(8,_);break;case 23:break;case 22:var G=_.stateNode;_.memoizedState!==null?G._visibility&2?oa(g,_,E,R,p):vr(g,_):(G._visibility|=2,oa(g,_,E,R,p)),p&&F&2048&&xh(_.alternate,_);break;case 24:oa(g,_,E,R,p),p&&F&2048&&Th(_.alternate,_);break;default:oa(g,_,E,R,p)}i=i.sibling}}function vr(n,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var r=n,u=i,p=u.flags;switch(u.tag){case 22:vr(r,u),p&2048&&xh(u.alternate,u);break;case 24:vr(r,u),p&2048&&Th(u.alternate,u);break;default:vr(r,u)}i=i.sibling}}var _r=8192;function la(n,i,r){if(n.subtreeFlags&_r)for(n=n.child;n!==null;)Pg(n,i,r),n=n.sibling}function Pg(n,i,r){switch(n.tag){case 26:la(n,i,r),n.flags&_r&&n.memoizedState!==null&&Hw(r,Bn,n.memoizedState,n.memoizedProps);break;case 5:la(n,i,r);break;case 3:case 4:var u=Bn;Bn=xl(n.stateNode.containerInfo),la(n,i,r),Bn=u;break;case 22:n.memoizedState===null&&(u=n.alternate,u!==null&&u.memoizedState!==null?(u=_r,_r=16777216,la(n,i,r),_r=u):la(n,i,r));break;default:la(n,i,r)}}function Fg(n){var i=n.alternate;if(i!==null&&(n=i.child,n!==null)){i.child=null;do i=n.sibling,n.sibling=null,n=i;while(n!==null)}}function Ar(n){var i=n.deletions;if((n.flags&16)!==0){if(i!==null)for(var r=0;r<i.length;r++){var u=i[r];Se=u,zg(u,n)}Fg(n)}if(n.subtreeFlags&10256)for(n=n.child;n!==null;)Ug(n),n=n.sibling}function Ug(n){switch(n.tag){case 0:case 11:case 15:Ar(n),n.flags&2048&&Is(9,n,n.return);break;case 3:Ar(n);break;case 12:Ar(n);break;case 22:var i=n.stateNode;n.memoizedState!==null&&i._visibility&2&&(n.return===null||n.return.tag!==13)?(i._visibility&=-3,dl(n)):Ar(n);break;default:Ar(n)}}function dl(n){var i=n.deletions;if((n.flags&16)!==0){if(i!==null)for(var r=0;r<i.length;r++){var u=i[r];Se=u,zg(u,n)}Fg(n)}for(n=n.child;n!==null;){switch(i=n,i.tag){case 0:case 11:case 15:Is(8,i,i.return),dl(i);break;case 22:r=i.stateNode,r._visibility&2&&(r._visibility&=-3,dl(i));break;default:dl(i)}n=n.sibling}}function zg(n,i){for(;Se!==null;){var r=Se;switch(r.tag){case 0:case 11:case 15:Is(8,r,i);break;case 23:case 22:if(r.memoizedState!==null&&r.memoizedState.cachePool!==null){var u=r.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:ir(r.memoizedState.cache)}if(u=r.child,u!==null)u.return=r,Se=u;else t:for(r=n;Se!==null;){u=Se;var p=u.sibling,g=u.return;if(Dg(u),u===r){Se=null;break t}if(p!==null){p.return=g,Se=p;break t}Se=g}}}var nw={getCacheForType:function(n){var i=Me(ue),r=i.data.get(n);return r===void 0&&(r=n(),i.data.set(n,r)),r},cacheSignal:function(){return Me(ue).controller.signal}},sw=typeof WeakMap=="function"?WeakMap:Map,Ft=0,Yt=null,Rt=null,Dt=0,Ht=0,un=null,Ps=!1,ca=!1,Ch=!1,ms=0,ie=0,Fs=0,_i=0,Rh=0,hn=0,ua=0,wr=null,Ke=null,Mh=!1,fl=0,Hg=0,pl=1/0,ml=null,Us=null,ye=0,zs=null,ha=null,gs=0,Dh=0,Oh=null,jg=null,Sr=0,Nh=null;function dn(){return(Ft&2)!==0&&Dt!==0?Dt&-Dt:B.T!==null?Fh():ip()}function qg(){if(hn===0)if((Dt&536870912)===0||Lt){var n=So;So<<=1,(So&3932160)===0&&(So=262144),hn=n}else hn=536870912;return n=ln.current,n!==null&&(n.flags|=32),hn}function We(n,i,r){(n===Yt&&(Ht===2||Ht===9)||n.cancelPendingCommit!==null)&&(da(n,0),Hs(n,Dt,hn,!1)),$a(n,r),((Ft&2)===0||n!==Yt)&&(n===Yt&&((Ft&2)===0&&(_i|=r),ie===4&&Hs(n,Dt,hn,!1)),jn(n))}function $g(n,i,r){if((Ft&6)!==0)throw Error(s(327));var u=!r&&(i&127)===0&&(i&n.expiredLanes)===0||qa(n,i),p=u?rw(n,i):kh(n,i,!0),g=u;do{if(p===0){ca&&!u&&Hs(n,i,0,!1);break}else{if(r=n.current.alternate,g&&!iw(r)){p=kh(n,i,!1),g=!1;continue}if(p===2){if(g=i,n.errorRecoveryDisabledLanes&g)var _=0;else _=n.pendingLanes&-536870913,_=_!==0?_:_&536870912?536870912:0;if(_!==0){i=_;t:{var E=n;p=wr;var R=E.current.memoizedState.isDehydrated;if(R&&(da(E,_).flags|=256),_=kh(E,_,!1),_!==2){if(Ch&&!R){E.errorRecoveryDisabledLanes|=g,_i|=g,p=4;break t}g=Ke,Ke=p,g!==null&&(Ke===null?Ke=g:Ke.push.apply(Ke,g))}p=_}if(g=!1,p!==2)continue}}if(p===1){da(n,0),Hs(n,i,0,!0);break}t:{switch(u=n,g=p,g){case 0:case 1:throw Error(s(345));case 4:if((i&4194048)!==i)break;case 6:Hs(u,i,hn,!Ps);break t;case 2:Ke=null;break;case 3:case 5:break;default:throw Error(s(329))}if((i&62914560)===i&&(p=fl+300-nn(),10<p)){if(Hs(u,i,hn,!Ps),xo(u,0,!0)!==0)break t;gs=i,u.timeoutHandle=Ay(Gg.bind(null,u,r,Ke,ml,Mh,i,hn,_i,ua,Ps,g,"Throttled",-0,0),p);break t}Gg(u,r,Ke,ml,Mh,i,hn,_i,ua,Ps,g,null,-0,0)}}break}while(!0);jn(n)}function Gg(n,i,r,u,p,g,_,E,R,F,G,Y,z,j){if(n.timeoutHandle=-1,Y=i.subtreeFlags,Y&8192||(Y&16785408)===16785408){Y={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:es},Pg(i,g,Y);var it=(g&62914560)===g?fl-nn():(g&4194048)===g?Hg-nn():0;if(it=jw(Y,it),it!==null){gs=g,n.cancelPendingCommit=it(Jg.bind(null,n,i,g,r,u,p,_,E,R,G,Y,null,z,j)),Hs(n,g,_,!F);return}}Jg(n,i,g,r,u,p,_,E,R)}function iw(n){for(var i=n;;){var r=i.tag;if((r===0||r===11||r===15)&&i.flags&16384&&(r=i.updateQueue,r!==null&&(r=r.stores,r!==null)))for(var u=0;u<r.length;u++){var p=r[u],g=p.getSnapshot;p=p.value;try{if(!rn(g(),p))return!1}catch{return!1}}if(r=i.child,i.subtreeFlags&16384&&r!==null)r.return=i,i=r;else{if(i===n)break;for(;i.sibling===null;){if(i.return===null||i.return===n)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Hs(n,i,r,u){i&=~Rh,i&=~_i,n.suspendedLanes|=i,n.pingedLanes&=~i,u&&(n.warmLanes|=i),u=n.expirationTimes;for(var p=i;0<p;){var g=31-an(p),_=1<<g;u[g]=-1,p&=~_}r!==0&&ep(n,r,i)}function gl(){return(Ft&6)===0?(Er(0),!1):!0}function Lh(){if(Rt!==null){if(Ht===0)var n=Rt.return;else n=Rt,as=hi=null,Ku(n),na=null,rr=0,n=Rt;for(;n!==null;)wg(n.alternate,n),n=n.return;Rt=null}}function da(n,i){var r=n.timeoutHandle;r!==-1&&(n.timeoutHandle=-1,Ew(r)),r=n.cancelPendingCommit,r!==null&&(n.cancelPendingCommit=null,r()),gs=0,Lh(),Yt=n,Rt=r=ss(n.current,null),Dt=i,Ht=0,un=null,Ps=!1,ca=qa(n,i),Ch=!1,ua=hn=Rh=_i=Fs=ie=0,Ke=wr=null,Mh=!1,(i&8)!==0&&(i|=i&32);var u=n.entangledLanes;if(u!==0)for(n=n.entanglements,u&=i;0<u;){var p=31-an(u),g=1<<p;i|=n[p],u&=~g}return ms=i,Po(),r}function Xg(n,i){St=null,B.H=pr,i===ea||i===Go?(i=lm(),Ht=3):i===Pu?(i=lm(),Ht=4):Ht=i===hh?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,un=i,Rt===null&&(ie=1,al(n,wn(i,n.current)))}function Vg(){var n=ln.current;return n===null?!0:(Dt&4194048)===Dt?Tn===null:(Dt&62914560)===Dt||(Dt&536870912)!==0?n===Tn:!1}function Yg(){var n=B.H;return B.H=pr,n===null?pr:n}function Kg(){var n=B.A;return B.A=nw,n}function yl(){ie=4,Ps||(Dt&4194048)!==Dt&&ln.current!==null||(ca=!0),(Fs&134217727)===0&&(_i&134217727)===0||Yt===null||Hs(Yt,Dt,hn,!1)}function kh(n,i,r){var u=Ft;Ft|=2;var p=Yg(),g=Kg();(Yt!==n||Dt!==i)&&(ml=null,da(n,i)),i=!1;var _=ie;t:do try{if(Ht!==0&&Rt!==null){var E=Rt,R=un;switch(Ht){case 8:Lh(),_=6;break t;case 3:case 2:case 9:case 6:ln.current===null&&(i=!0);var F=Ht;if(Ht=0,un=null,fa(n,E,R,F),r&&ca){_=0;break t}break;default:F=Ht,Ht=0,un=null,fa(n,E,R,F)}}aw(),_=ie;break}catch(G){Xg(n,G)}while(!0);return i&&n.shellSuspendCounter++,as=hi=null,Ft=u,B.H=p,B.A=g,Rt===null&&(Yt=null,Dt=0,Po()),_}function aw(){for(;Rt!==null;)Wg(Rt)}function rw(n,i){var r=Ft;Ft|=2;var u=Yg(),p=Kg();Yt!==n||Dt!==i?(ml=null,pl=nn()+500,da(n,i)):ca=qa(n,i);t:do try{if(Ht!==0&&Rt!==null){i=Rt;var g=un;e:switch(Ht){case 1:Ht=0,un=null,fa(n,i,g,1);break;case 2:case 9:if(rm(g)){Ht=0,un=null,Qg(i);break}i=function(){Ht!==2&&Ht!==9||Yt!==n||(Ht=7),jn(n)},g.then(i,i);break t;case 3:Ht=7;break t;case 4:Ht=5;break t;case 7:rm(g)?(Ht=0,un=null,Qg(i)):(Ht=0,un=null,fa(n,i,g,7));break;case 5:var _=null;switch(Rt.tag){case 26:_=Rt.memoizedState;case 5:case 27:var E=Rt;if(_?Iy(_):E.stateNode.complete){Ht=0,un=null;var R=E.sibling;if(R!==null)Rt=R;else{var F=E.return;F!==null?(Rt=F,bl(F)):Rt=null}break e}}Ht=0,un=null,fa(n,i,g,5);break;case 6:Ht=0,un=null,fa(n,i,g,6);break;case 8:Lh(),ie=6;break t;default:throw Error(s(462))}}ow();break}catch(G){Xg(n,G)}while(!0);return as=hi=null,B.H=u,B.A=p,Ft=r,Rt!==null?0:(Yt=null,Dt=0,Po(),ie)}function ow(){for(;Rt!==null&&!D_();)Wg(Rt)}function Wg(n){var i=_g(n.alternate,n,ms);n.memoizedProps=n.pendingProps,i===null?bl(n):Rt=i}function Qg(n){var i=n,r=i.alternate;switch(i.tag){case 15:case 0:i=pg(r,i,i.pendingProps,i.type,void 0,Dt);break;case 11:i=pg(r,i,i.pendingProps,i.type.render,i.ref,Dt);break;case 5:Ku(i);default:wg(r,i),i=Rt=Kp(i,ms),i=_g(r,i,ms)}n.memoizedProps=n.pendingProps,i===null?bl(n):Rt=i}function fa(n,i,r,u){as=hi=null,Ku(i),na=null,rr=0;var p=i.return;try{if(KA(n,p,i,r,Dt)){ie=1,al(n,wn(r,n.current)),Rt=null;return}}catch(g){if(p!==null)throw Rt=p,g;ie=1,al(n,wn(r,n.current)),Rt=null;return}i.flags&32768?(Lt||u===1?n=!0:ca||(Dt&536870912)!==0?n=!1:(Ps=n=!0,(u===2||u===9||u===3||u===6)&&(u=ln.current,u!==null&&u.tag===13&&(u.flags|=16384))),Zg(i,n)):bl(i)}function bl(n){var i=n;do{if((i.flags&32768)!==0){Zg(i,Ps);return}n=i.return;var r=ZA(i.alternate,i,ms);if(r!==null){Rt=r;return}if(i=i.sibling,i!==null){Rt=i;return}Rt=i=n}while(i!==null);ie===0&&(ie=5)}function Zg(n,i){do{var r=JA(n.alternate,n);if(r!==null){r.flags&=32767,Rt=r;return}if(r=n.return,r!==null&&(r.flags|=32768,r.subtreeFlags=0,r.deletions=null),!i&&(n=n.sibling,n!==null)){Rt=n;return}Rt=n=r}while(n!==null);ie=6,Rt=null}function Jg(n,i,r,u,p,g,_,E,R){n.cancelPendingCommit=null;do vl();while(ye!==0);if((Ft&6)!==0)throw Error(s(327));if(i!==null){if(i===n.current)throw Error(s(177));if(g=i.lanes|i.childLanes,g|=wu,z_(n,r,g,_,E,R),n===Yt&&(Rt=Yt=null,Dt=0),ha=i,zs=n,gs=r,Dh=g,Oh=p,jg=u,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(n.callbackNode=null,n.callbackPriority=0,hw(Ao,function(){return iy(),null})):(n.callbackNode=null,n.callbackPriority=0),u=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||u){u=B.T,B.T=null,p=$.p,$.p=2,_=Ft,Ft|=4;try{tw(n,i,r)}finally{Ft=_,$.p=p,B.T=u}}ye=1,ty(),ey(),ny()}}function ty(){if(ye===1){ye=0;var n=zs,i=ha,r=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||r){r=B.T,B.T=null;var u=$.p;$.p=2;var p=Ft;Ft|=4;try{kg(i,n);var g=Xh,_=zp(n.containerInfo),E=g.focusedElem,R=g.selectionRange;if(_!==E&&E&&E.ownerDocument&&Up(E.ownerDocument.documentElement,E)){if(R!==null&&yu(E)){var F=R.start,G=R.end;if(G===void 0&&(G=F),"selectionStart"in E)E.selectionStart=F,E.selectionEnd=Math.min(G,E.value.length);else{var Y=E.ownerDocument||document,z=Y&&Y.defaultView||window;if(z.getSelection){var j=z.getSelection(),it=E.textContent.length,ft=Math.min(R.start,it),Gt=R.end===void 0?ft:Math.min(R.end,it);!j.extend&&ft>Gt&&(_=Gt,Gt=ft,ft=_);var I=Fp(E,ft),O=Fp(E,Gt);if(I&&O&&(j.rangeCount!==1||j.anchorNode!==I.node||j.anchorOffset!==I.offset||j.focusNode!==O.node||j.focusOffset!==O.offset)){var P=Y.createRange();P.setStart(I.node,I.offset),j.removeAllRanges(),ft>Gt?(j.addRange(P),j.extend(O.node,O.offset)):(P.setEnd(O.node,O.offset),j.addRange(P))}}}}for(Y=[],j=E;j=j.parentNode;)j.nodeType===1&&Y.push({element:j,left:j.scrollLeft,top:j.scrollTop});for(typeof E.focus=="function"&&E.focus(),E=0;E<Y.length;E++){var X=Y[E];X.element.scrollLeft=X.left,X.element.scrollTop=X.top}}Ol=!!Gh,Xh=Gh=null}finally{Ft=p,$.p=u,B.T=r}}n.current=i,ye=2}}function ey(){if(ye===2){ye=0;var n=zs,i=ha,r=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||r){r=B.T,B.T=null;var u=$.p;$.p=2;var p=Ft;Ft|=4;try{Mg(n,i.alternate,i)}finally{Ft=p,$.p=u,B.T=r}}ye=3}}function ny(){if(ye===4||ye===3){ye=0,O_();var n=zs,i=ha,r=gs,u=jg;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?ye=5:(ye=0,ha=zs=null,sy(n,n.pendingLanes));var p=n.pendingLanes;if(p===0&&(Us=null),Zc(r),i=i.stateNode,sn&&typeof sn.onCommitFiberRoot=="function")try{sn.onCommitFiberRoot(ja,i,void 0,(i.current.flags&128)===128)}catch{}if(u!==null){i=B.T,p=$.p,$.p=2,B.T=null;try{for(var g=n.onRecoverableError,_=0;_<u.length;_++){var E=u[_];g(E.value,{componentStack:E.stack})}}finally{B.T=i,$.p=p}}(gs&3)!==0&&vl(),jn(n),p=n.pendingLanes,(r&261930)!==0&&(p&42)!==0?n===Nh?Sr++:(Sr=0,Nh=n):Sr=0,Er(0)}}function sy(n,i){(n.pooledCacheLanes&=i)===0&&(i=n.pooledCache,i!=null&&(n.pooledCache=null,ir(i)))}function vl(){return ty(),ey(),ny(),iy()}function iy(){if(ye!==5)return!1;var n=zs,i=Dh;Dh=0;var r=Zc(gs),u=B.T,p=$.p;try{$.p=32>r?32:r,B.T=null,r=Oh,Oh=null;var g=zs,_=gs;if(ye=0,ha=zs=null,gs=0,(Ft&6)!==0)throw Error(s(331));var E=Ft;if(Ft|=4,Ug(g.current),Ig(g,g.current,_,r),Ft=E,Er(0,!1),sn&&typeof sn.onPostCommitFiberRoot=="function")try{sn.onPostCommitFiberRoot(ja,g)}catch{}return!0}finally{$.p=p,B.T=u,sy(n,i)}}function ay(n,i,r){i=wn(r,i),i=uh(n.stateNode,i,2),n=Ls(n,i,2),n!==null&&($a(n,2),jn(n))}function jt(n,i,r){if(n.tag===3)ay(n,n,r);else for(;i!==null;){if(i.tag===3){ay(i,n,r);break}else if(i.tag===1){var u=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(Us===null||!Us.has(u))){n=wn(r,n),r=rg(2),u=Ls(i,r,2),u!==null&&(og(r,u,i,n),$a(u,2),jn(u));break}}i=i.return}}function Bh(n,i,r){var u=n.pingCache;if(u===null){u=n.pingCache=new sw;var p=new Set;u.set(i,p)}else p=u.get(i),p===void 0&&(p=new Set,u.set(i,p));p.has(r)||(Ch=!0,p.add(r),n=lw.bind(null,n,i,r),i.then(n,n))}function lw(n,i,r){var u=n.pingCache;u!==null&&u.delete(i),n.pingedLanes|=n.suspendedLanes&r,n.warmLanes&=~r,Yt===n&&(Dt&r)===r&&(ie===4||ie===3&&(Dt&62914560)===Dt&&300>nn()-fl?(Ft&2)===0&&da(n,0):Rh|=r,ua===Dt&&(ua=0)),jn(n)}function ry(n,i){i===0&&(i=tp()),n=li(n,i),n!==null&&($a(n,i),jn(n))}function cw(n){var i=n.memoizedState,r=0;i!==null&&(r=i.retryLane),ry(n,r)}function uw(n,i){var r=0;switch(n.tag){case 31:case 13:var u=n.stateNode,p=n.memoizedState;p!==null&&(r=p.retryLane);break;case 19:u=n.stateNode;break;case 22:u=n.stateNode._retryCache;break;default:throw Error(s(314))}u!==null&&u.delete(i),ry(n,r)}function hw(n,i){return Yc(n,i)}var _l=null,pa=null,Ih=!1,Al=!1,Ph=!1,js=0;function jn(n){n!==pa&&n.next===null&&(pa===null?_l=pa=n:pa=pa.next=n),Al=!0,Ih||(Ih=!0,fw())}function Er(n,i){if(!Ph&&Al){Ph=!0;do for(var r=!1,u=_l;u!==null;){if(n!==0){var p=u.pendingLanes;if(p===0)var g=0;else{var _=u.suspendedLanes,E=u.pingedLanes;g=(1<<31-an(42|n)+1)-1,g&=p&~(_&~E),g=g&201326741?g&201326741|1:g?g|2:0}g!==0&&(r=!0,uy(u,g))}else g=Dt,g=xo(u,u===Yt?g:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),(g&3)===0||qa(u,g)||(r=!0,uy(u,g));u=u.next}while(r);Ph=!1}}function dw(){oy()}function oy(){Al=Ih=!1;var n=0;js!==0&&Sw()&&(n=js);for(var i=nn(),r=null,u=_l;u!==null;){var p=u.next,g=ly(u,i);g===0?(u.next=null,r===null?_l=p:r.next=p,p===null&&(pa=r)):(r=u,(n!==0||(g&3)!==0)&&(Al=!0)),u=p}ye!==0&&ye!==5||Er(n),js!==0&&(js=0)}function ly(n,i){for(var r=n.suspendedLanes,u=n.pingedLanes,p=n.expirationTimes,g=n.pendingLanes&-62914561;0<g;){var _=31-an(g),E=1<<_,R=p[_];R===-1?((E&r)===0||(E&u)!==0)&&(p[_]=U_(E,i)):R<=i&&(n.expiredLanes|=E),g&=~E}if(i=Yt,r=Dt,r=xo(n,n===i?r:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),u=n.callbackNode,r===0||n===i&&(Ht===2||Ht===9)||n.cancelPendingCommit!==null)return u!==null&&u!==null&&Kc(u),n.callbackNode=null,n.callbackPriority=0;if((r&3)===0||qa(n,r)){if(i=r&-r,i===n.callbackPriority)return i;switch(u!==null&&Kc(u),Zc(r)){case 2:case 8:r=Zf;break;case 32:r=Ao;break;case 268435456:r=Jf;break;default:r=Ao}return u=cy.bind(null,n),r=Yc(r,u),n.callbackPriority=i,n.callbackNode=r,i}return u!==null&&u!==null&&Kc(u),n.callbackPriority=2,n.callbackNode=null,2}function cy(n,i){if(ye!==0&&ye!==5)return n.callbackNode=null,n.callbackPriority=0,null;var r=n.callbackNode;if(vl()&&n.callbackNode!==r)return null;var u=Dt;return u=xo(n,n===Yt?u:0,n.cancelPendingCommit!==null||n.timeoutHandle!==-1),u===0?null:($g(n,u,i),ly(n,nn()),n.callbackNode!=null&&n.callbackNode===r?cy.bind(null,n):null)}function uy(n,i){if(vl())return null;$g(n,i,!0)}function fw(){xw(function(){(Ft&6)!==0?Yc(Qf,dw):oy()})}function Fh(){if(js===0){var n=Ji;n===0&&(n=wo,wo<<=1,(wo&261888)===0&&(wo=256)),js=n}return js}function hy(n){return n==null||typeof n=="symbol"||typeof n=="boolean"?null:typeof n=="function"?n:Mo(""+n)}function dy(n,i){var r=i.ownerDocument.createElement("input");return r.name=i.name,r.value=i.value,n.id&&r.setAttribute("form",n.id),i.parentNode.insertBefore(r,i),n=new FormData(n),r.parentNode.removeChild(r),n}function pw(n,i,r,u,p){if(i==="submit"&&r&&r.stateNode===p){var g=hy((p[$e]||null).action),_=u.submitter;_&&(i=(i=_[$e]||null)?hy(i.formAction):_.getAttribute("formAction"),i!==null&&(g=i,_=null));var E=new Lo("action","action",null,u,p);n.push({event:E,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(js!==0){var R=_?dy(p,_):new FormData(p);ih(r,{pending:!0,data:R,method:p.method,action:g},null,R)}}else typeof g=="function"&&(E.preventDefault(),R=_?dy(p,_):new FormData(p),ih(r,{pending:!0,data:R,method:p.method,action:g},g,R))},currentTarget:p}]})}}for(var Uh=0;Uh<Au.length;Uh++){var zh=Au[Uh],mw=zh.toLowerCase(),gw=zh[0].toUpperCase()+zh.slice(1);kn(mw,"on"+gw)}kn(qp,"onAnimationEnd"),kn($p,"onAnimationIteration"),kn(Gp,"onAnimationStart"),kn("dblclick","onDoubleClick"),kn("focusin","onFocus"),kn("focusout","onBlur"),kn(NA,"onTransitionRun"),kn(LA,"onTransitionStart"),kn(kA,"onTransitionCancel"),kn(Xp,"onTransitionEnd"),Ui("onMouseEnter",["mouseout","mouseover"]),Ui("onMouseLeave",["mouseout","mouseover"]),Ui("onPointerEnter",["pointerout","pointerover"]),Ui("onPointerLeave",["pointerout","pointerover"]),ii("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ii("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ii("onBeforeInput",["compositionend","keypress","textInput","paste"]),ii("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ii("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ii("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),yw=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(xr));function fy(n,i){i=(i&4)!==0;for(var r=0;r<n.length;r++){var u=n[r],p=u.event;u=u.listeners;t:{var g=void 0;if(i)for(var _=u.length-1;0<=_;_--){var E=u[_],R=E.instance,F=E.currentTarget;if(E=E.listener,R!==g&&p.isPropagationStopped())break t;g=E,p.currentTarget=F;try{g(p)}catch(G){Io(G)}p.currentTarget=null,g=R}else for(_=0;_<u.length;_++){if(E=u[_],R=E.instance,F=E.currentTarget,E=E.listener,R!==g&&p.isPropagationStopped())break t;g=E,p.currentTarget=F;try{g(p)}catch(G){Io(G)}p.currentTarget=null,g=R}}}}function Mt(n,i){var r=i[Jc];r===void 0&&(r=i[Jc]=new Set);var u=n+"__bubble";r.has(u)||(py(i,n,2,!1),r.add(u))}function Hh(n,i,r){var u=0;i&&(u|=4),py(r,n,u,i)}var wl="_reactListening"+Math.random().toString(36).slice(2);function jh(n){if(!n[wl]){n[wl]=!0,op.forEach(function(r){r!=="selectionchange"&&(yw.has(r)||Hh(r,!1,n),Hh(r,!0,n))});var i=n.nodeType===9?n:n.ownerDocument;i===null||i[wl]||(i[wl]=!0,Hh("selectionchange",!1,i))}}function py(n,i,r,u){switch(qy(i)){case 2:var p=Gw;break;case 8:p=Xw;break;default:p=sd}r=p.bind(null,i,r,n),p=void 0,!lu||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(p=!0),u?p!==void 0?n.addEventListener(i,r,{capture:!0,passive:p}):n.addEventListener(i,r,!0):p!==void 0?n.addEventListener(i,r,{passive:p}):n.addEventListener(i,r,!1)}function qh(n,i,r,u,p){var g=u;if((i&1)===0&&(i&2)===0&&u!==null)t:for(;;){if(u===null)return;var _=u.tag;if(_===3||_===4){var E=u.stateNode.containerInfo;if(E===p)break;if(_===4)for(_=u.return;_!==null;){var R=_.tag;if((R===3||R===4)&&_.stateNode.containerInfo===p)return;_=_.return}for(;E!==null;){if(_=Ii(E),_===null)return;if(R=_.tag,R===5||R===6||R===26||R===27){u=g=_;continue t}E=E.parentNode}}u=u.return}vp(function(){var F=g,G=ru(r),Y=[];t:{var z=Vp.get(n);if(z!==void 0){var j=Lo,it=n;switch(n){case"keypress":if(Oo(r)===0)break t;case"keydown":case"keyup":j=uA;break;case"focusin":it="focus",j=du;break;case"focusout":it="blur",j=du;break;case"beforeblur":case"afterblur":j=du;break;case"click":if(r.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":j=wp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":j=Z_;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":j=fA;break;case qp:case $p:case Gp:j=eA;break;case Xp:j=mA;break;case"scroll":case"scrollend":j=W_;break;case"wheel":j=yA;break;case"copy":case"cut":case"paste":j=sA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":j=Ep;break;case"toggle":case"beforetoggle":j=vA}var ft=(i&4)!==0,Gt=!ft&&(n==="scroll"||n==="scrollend"),I=ft?z!==null?z+"Capture":null:z;ft=[];for(var O=F,P;O!==null;){var X=O;if(P=X.stateNode,X=X.tag,X!==5&&X!==26&&X!==27||P===null||I===null||(X=Va(O,I),X!=null&&ft.push(Tr(O,X,P))),Gt)break;O=O.return}0<ft.length&&(z=new j(z,it,null,r,G),Y.push({event:z,listeners:ft}))}}if((i&7)===0){t:{if(z=n==="mouseover"||n==="pointerover",j=n==="mouseout"||n==="pointerout",z&&r!==au&&(it=r.relatedTarget||r.fromElement)&&(Ii(it)||it[Bi]))break t;if((j||z)&&(z=G.window===G?G:(z=G.ownerDocument)?z.defaultView||z.parentWindow:window,j?(it=r.relatedTarget||r.toElement,j=F,it=it?Ii(it):null,it!==null&&(Gt=o(it),ft=it.tag,it!==Gt||ft!==5&&ft!==27&&ft!==6)&&(it=null)):(j=null,it=F),j!==it)){if(ft=wp,X="onMouseLeave",I="onMouseEnter",O="mouse",(n==="pointerout"||n==="pointerover")&&(ft=Ep,X="onPointerLeave",I="onPointerEnter",O="pointer"),Gt=j==null?z:Xa(j),P=it==null?z:Xa(it),z=new ft(X,O+"leave",j,r,G),z.target=Gt,z.relatedTarget=P,X=null,Ii(G)===F&&(ft=new ft(I,O+"enter",it,r,G),ft.target=P,ft.relatedTarget=Gt,X=ft),Gt=X,j&&it)e:{for(ft=bw,I=j,O=it,P=0,X=I;X;X=ft(X))P++;X=0;for(var lt=O;lt;lt=ft(lt))X++;for(;0<P-X;)I=ft(I),P--;for(;0<X-P;)O=ft(O),X--;for(;P--;){if(I===O||O!==null&&I===O.alternate){ft=I;break e}I=ft(I),O=ft(O)}ft=null}else ft=null;j!==null&&my(Y,z,j,ft,!1),it!==null&&Gt!==null&&my(Y,Gt,it,ft,!0)}}t:{if(z=F?Xa(F):window,j=z.nodeName&&z.nodeName.toLowerCase(),j==="select"||j==="input"&&z.type==="file")var It=Np;else if(Dp(z))if(Lp)It=MA;else{It=CA;var rt=TA}else j=z.nodeName,!j||j.toLowerCase()!=="input"||z.type!=="checkbox"&&z.type!=="radio"?F&&iu(F.elementType)&&(It=Np):It=RA;if(It&&(It=It(n,F))){Op(Y,It,r,G);break t}rt&&rt(n,z,F),n==="focusout"&&F&&z.type==="number"&&F.memoizedProps.value!=null&&su(z,"number",z.value)}switch(rt=F?Xa(F):window,n){case"focusin":(Dp(rt)||rt.contentEditable==="true")&&(Gi=rt,bu=F,er=null);break;case"focusout":er=bu=Gi=null;break;case"mousedown":vu=!0;break;case"contextmenu":case"mouseup":case"dragend":vu=!1,Hp(Y,r,G);break;case"selectionchange":if(OA)break;case"keydown":case"keyup":Hp(Y,r,G)}var Et;if(pu)t:{switch(n){case"compositionstart":var Ot="onCompositionStart";break t;case"compositionend":Ot="onCompositionEnd";break t;case"compositionupdate":Ot="onCompositionUpdate";break t}Ot=void 0}else $i?Rp(n,r)&&(Ot="onCompositionEnd"):n==="keydown"&&r.keyCode===229&&(Ot="onCompositionStart");Ot&&(xp&&r.locale!=="ko"&&($i||Ot!=="onCompositionStart"?Ot==="onCompositionEnd"&&$i&&(Et=_p()):(Ts=G,cu="value"in Ts?Ts.value:Ts.textContent,$i=!0)),rt=Sl(F,Ot),0<rt.length&&(Ot=new Sp(Ot,n,null,r,G),Y.push({event:Ot,listeners:rt}),Et?Ot.data=Et:(Et=Mp(r),Et!==null&&(Ot.data=Et)))),(Et=AA?wA(n,r):SA(n,r))&&(Ot=Sl(F,"onBeforeInput"),0<Ot.length&&(rt=new Sp("onBeforeInput","beforeinput",null,r,G),Y.push({event:rt,listeners:Ot}),rt.data=Et)),pw(Y,n,F,r,G)}fy(Y,i)})}function Tr(n,i,r){return{instance:n,listener:i,currentTarget:r}}function Sl(n,i){for(var r=i+"Capture",u=[];n!==null;){var p=n,g=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||g===null||(p=Va(n,r),p!=null&&u.unshift(Tr(n,p,g)),p=Va(n,i),p!=null&&u.push(Tr(n,p,g))),n.tag===3)return u;n=n.return}return[]}function bw(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5&&n.tag!==27);return n||null}function my(n,i,r,u,p){for(var g=i._reactName,_=[];r!==null&&r!==u;){var E=r,R=E.alternate,F=E.stateNode;if(E=E.tag,R!==null&&R===u)break;E!==5&&E!==26&&E!==27||F===null||(R=F,p?(F=Va(r,g),F!=null&&_.unshift(Tr(r,F,R))):p||(F=Va(r,g),F!=null&&_.push(Tr(r,F,R)))),r=r.return}_.length!==0&&n.push({event:i,listeners:_})}var vw=/\r\n?/g,_w=/\u0000|\uFFFD/g;function gy(n){return(typeof n=="string"?n:""+n).replace(vw,`
`).replace(_w,"")}function yy(n,i){return i=gy(i),gy(n)===i}function $t(n,i,r,u,p,g){switch(r){case"children":typeof u=="string"?i==="body"||i==="textarea"&&u===""||Hi(n,u):(typeof u=="number"||typeof u=="bigint")&&i!=="body"&&Hi(n,""+u);break;case"className":Co(n,"class",u);break;case"tabIndex":Co(n,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":Co(n,r,u);break;case"style":yp(n,u,g);break;case"data":if(i!=="object"){Co(n,"data",u);break}case"src":case"href":if(u===""&&(i!=="a"||r!=="href")){n.removeAttribute(r);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){n.removeAttribute(r);break}u=Mo(""+u),n.setAttribute(r,u);break;case"action":case"formAction":if(typeof u=="function"){n.setAttribute(r,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof g=="function"&&(r==="formAction"?(i!=="input"&&$t(n,i,"name",p.name,p,null),$t(n,i,"formEncType",p.formEncType,p,null),$t(n,i,"formMethod",p.formMethod,p,null),$t(n,i,"formTarget",p.formTarget,p,null)):($t(n,i,"encType",p.encType,p,null),$t(n,i,"method",p.method,p,null),$t(n,i,"target",p.target,p,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){n.removeAttribute(r);break}u=Mo(""+u),n.setAttribute(r,u);break;case"onClick":u!=null&&(n.onclick=es);break;case"onScroll":u!=null&&Mt("scroll",n);break;case"onScrollEnd":u!=null&&Mt("scrollend",n);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(s(61));if(r=u.__html,r!=null){if(p.children!=null)throw Error(s(60));n.innerHTML=r}}break;case"multiple":n.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":n.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){n.removeAttribute("xlink:href");break}r=Mo(""+u),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?n.setAttribute(r,""+u):n.removeAttribute(r);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?n.setAttribute(r,""):n.removeAttribute(r);break;case"capture":case"download":u===!0?n.setAttribute(r,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?n.setAttribute(r,u):n.removeAttribute(r);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?n.setAttribute(r,u):n.removeAttribute(r);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?n.removeAttribute(r):n.setAttribute(r,u);break;case"popover":Mt("beforetoggle",n),Mt("toggle",n),To(n,"popover",u);break;case"xlinkActuate":ts(n,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":ts(n,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":ts(n,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":ts(n,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":ts(n,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":ts(n,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":ts(n,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":ts(n,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":ts(n,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":To(n,"is",u);break;case"innerText":case"textContent":break;default:(!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(r=Y_.get(r)||r,To(n,r,u))}}function $h(n,i,r,u,p,g){switch(r){case"style":yp(n,u,g);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(s(61));if(r=u.__html,r!=null){if(p.children!=null)throw Error(s(60));n.innerHTML=r}}break;case"children":typeof u=="string"?Hi(n,u):(typeof u=="number"||typeof u=="bigint")&&Hi(n,""+u);break;case"onScroll":u!=null&&Mt("scroll",n);break;case"onScrollEnd":u!=null&&Mt("scrollend",n);break;case"onClick":u!=null&&(n.onclick=es);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!lp.hasOwnProperty(r))t:{if(r[0]==="o"&&r[1]==="n"&&(p=r.endsWith("Capture"),i=r.slice(2,p?r.length-7:void 0),g=n[$e]||null,g=g!=null?g[r]:null,typeof g=="function"&&n.removeEventListener(i,g,p),typeof u=="function")){typeof g!="function"&&g!==null&&(r in n?n[r]=null:n.hasAttribute(r)&&n.removeAttribute(r)),n.addEventListener(i,u,p);break t}r in n?n[r]=u:u===!0?n.setAttribute(r,""):To(n,r,u)}}}function Oe(n,i,r){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Mt("error",n),Mt("load",n);var u=!1,p=!1,g;for(g in r)if(r.hasOwnProperty(g)){var _=r[g];if(_!=null)switch(g){case"src":u=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,i));default:$t(n,i,g,_,r,null)}}p&&$t(n,i,"srcSet",r.srcSet,r,null),u&&$t(n,i,"src",r.src,r,null);return;case"input":Mt("invalid",n);var E=g=_=p=null,R=null,F=null;for(u in r)if(r.hasOwnProperty(u)){var G=r[u];if(G!=null)switch(u){case"name":p=G;break;case"type":_=G;break;case"checked":R=G;break;case"defaultChecked":F=G;break;case"value":g=G;break;case"defaultValue":E=G;break;case"children":case"dangerouslySetInnerHTML":if(G!=null)throw Error(s(137,i));break;default:$t(n,i,u,G,r,null)}}fp(n,g,E,R,F,_,p,!1);return;case"select":Mt("invalid",n),u=_=g=null;for(p in r)if(r.hasOwnProperty(p)&&(E=r[p],E!=null))switch(p){case"value":g=E;break;case"defaultValue":_=E;break;case"multiple":u=E;default:$t(n,i,p,E,r,null)}i=g,r=_,n.multiple=!!u,i!=null?zi(n,!!u,i,!1):r!=null&&zi(n,!!u,r,!0);return;case"textarea":Mt("invalid",n),g=p=u=null;for(_ in r)if(r.hasOwnProperty(_)&&(E=r[_],E!=null))switch(_){case"value":u=E;break;case"defaultValue":p=E;break;case"children":g=E;break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(s(91));break;default:$t(n,i,_,E,r,null)}mp(n,u,p,g);return;case"option":for(R in r)r.hasOwnProperty(R)&&(u=r[R],u!=null)&&(R==="selected"?n.selected=u&&typeof u!="function"&&typeof u!="symbol":$t(n,i,R,u,r,null));return;case"dialog":Mt("beforetoggle",n),Mt("toggle",n),Mt("cancel",n),Mt("close",n);break;case"iframe":case"object":Mt("load",n);break;case"video":case"audio":for(u=0;u<xr.length;u++)Mt(xr[u],n);break;case"image":Mt("error",n),Mt("load",n);break;case"details":Mt("toggle",n);break;case"embed":case"source":case"link":Mt("error",n),Mt("load",n);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(F in r)if(r.hasOwnProperty(F)&&(u=r[F],u!=null))switch(F){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,i));default:$t(n,i,F,u,r,null)}return;default:if(iu(i)){for(G in r)r.hasOwnProperty(G)&&(u=r[G],u!==void 0&&$h(n,i,G,u,r,void 0));return}}for(E in r)r.hasOwnProperty(E)&&(u=r[E],u!=null&&$t(n,i,E,u,r,null))}function Aw(n,i,r,u){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,g=null,_=null,E=null,R=null,F=null,G=null;for(j in r){var Y=r[j];if(r.hasOwnProperty(j)&&Y!=null)switch(j){case"checked":break;case"value":break;case"defaultValue":R=Y;default:u.hasOwnProperty(j)||$t(n,i,j,null,u,Y)}}for(var z in u){var j=u[z];if(Y=r[z],u.hasOwnProperty(z)&&(j!=null||Y!=null))switch(z){case"type":g=j;break;case"name":p=j;break;case"checked":F=j;break;case"defaultChecked":G=j;break;case"value":_=j;break;case"defaultValue":E=j;break;case"children":case"dangerouslySetInnerHTML":if(j!=null)throw Error(s(137,i));break;default:j!==Y&&$t(n,i,z,j,u,Y)}}nu(n,_,E,R,F,G,g,p);return;case"select":j=_=E=z=null;for(g in r)if(R=r[g],r.hasOwnProperty(g)&&R!=null)switch(g){case"value":break;case"multiple":j=R;default:u.hasOwnProperty(g)||$t(n,i,g,null,u,R)}for(p in u)if(g=u[p],R=r[p],u.hasOwnProperty(p)&&(g!=null||R!=null))switch(p){case"value":z=g;break;case"defaultValue":E=g;break;case"multiple":_=g;default:g!==R&&$t(n,i,p,g,u,R)}i=E,r=_,u=j,z!=null?zi(n,!!r,z,!1):!!u!=!!r&&(i!=null?zi(n,!!r,i,!0):zi(n,!!r,r?[]:"",!1));return;case"textarea":j=z=null;for(E in r)if(p=r[E],r.hasOwnProperty(E)&&p!=null&&!u.hasOwnProperty(E))switch(E){case"value":break;case"children":break;default:$t(n,i,E,null,u,p)}for(_ in u)if(p=u[_],g=r[_],u.hasOwnProperty(_)&&(p!=null||g!=null))switch(_){case"value":z=p;break;case"defaultValue":j=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(s(91));break;default:p!==g&&$t(n,i,_,p,u,g)}pp(n,z,j);return;case"option":for(var it in r)z=r[it],r.hasOwnProperty(it)&&z!=null&&!u.hasOwnProperty(it)&&(it==="selected"?n.selected=!1:$t(n,i,it,null,u,z));for(R in u)z=u[R],j=r[R],u.hasOwnProperty(R)&&z!==j&&(z!=null||j!=null)&&(R==="selected"?n.selected=z&&typeof z!="function"&&typeof z!="symbol":$t(n,i,R,z,u,j));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ft in r)z=r[ft],r.hasOwnProperty(ft)&&z!=null&&!u.hasOwnProperty(ft)&&$t(n,i,ft,null,u,z);for(F in u)if(z=u[F],j=r[F],u.hasOwnProperty(F)&&z!==j&&(z!=null||j!=null))switch(F){case"children":case"dangerouslySetInnerHTML":if(z!=null)throw Error(s(137,i));break;default:$t(n,i,F,z,u,j)}return;default:if(iu(i)){for(var Gt in r)z=r[Gt],r.hasOwnProperty(Gt)&&z!==void 0&&!u.hasOwnProperty(Gt)&&$h(n,i,Gt,void 0,u,z);for(G in u)z=u[G],j=r[G],!u.hasOwnProperty(G)||z===j||z===void 0&&j===void 0||$h(n,i,G,z,u,j);return}}for(var I in r)z=r[I],r.hasOwnProperty(I)&&z!=null&&!u.hasOwnProperty(I)&&$t(n,i,I,null,u,z);for(Y in u)z=u[Y],j=r[Y],!u.hasOwnProperty(Y)||z===j||z==null&&j==null||$t(n,i,Y,z,u,j)}function by(n){switch(n){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ww(){if(typeof performance.getEntriesByType=="function"){for(var n=0,i=0,r=performance.getEntriesByType("resource"),u=0;u<r.length;u++){var p=r[u],g=p.transferSize,_=p.initiatorType,E=p.duration;if(g&&E&&by(_)){for(_=0,E=p.responseEnd,u+=1;u<r.length;u++){var R=r[u],F=R.startTime;if(F>E)break;var G=R.transferSize,Y=R.initiatorType;G&&by(Y)&&(R=R.responseEnd,_+=G*(R<E?1:(E-F)/(R-F)))}if(--u,i+=8*(g+_)/(p.duration/1e3),n++,10<n)break}}if(0<n)return i/n/1e6}return navigator.connection&&(n=navigator.connection.downlink,typeof n=="number")?n:5}var Gh=null,Xh=null;function El(n){return n.nodeType===9?n:n.ownerDocument}function vy(n){switch(n){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function _y(n,i){if(n===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return n===1&&i==="foreignObject"?0:n}function Vh(n,i){return n==="textarea"||n==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Yh=null;function Sw(){var n=window.event;return n&&n.type==="popstate"?n===Yh?!1:(Yh=n,!0):(Yh=null,!1)}var Ay=typeof setTimeout=="function"?setTimeout:void 0,Ew=typeof clearTimeout=="function"?clearTimeout:void 0,wy=typeof Promise=="function"?Promise:void 0,xw=typeof queueMicrotask=="function"?queueMicrotask:typeof wy<"u"?function(n){return wy.resolve(null).then(n).catch(Tw)}:Ay;function Tw(n){setTimeout(function(){throw n})}function qs(n){return n==="head"}function Sy(n,i){var r=i,u=0;do{var p=r.nextSibling;if(n.removeChild(r),p&&p.nodeType===8)if(r=p.data,r==="/$"||r==="/&"){if(u===0){n.removeChild(p),ba(i);return}u--}else if(r==="$"||r==="$?"||r==="$~"||r==="$!"||r==="&")u++;else if(r==="html")Cr(n.ownerDocument.documentElement);else if(r==="head"){r=n.ownerDocument.head,Cr(r);for(var g=r.firstChild;g;){var _=g.nextSibling,E=g.nodeName;g[Ga]||E==="SCRIPT"||E==="STYLE"||E==="LINK"&&g.rel.toLowerCase()==="stylesheet"||r.removeChild(g),g=_}}else r==="body"&&Cr(n.ownerDocument.body);r=p}while(r);ba(i)}function Ey(n,i){var r=n;n=0;do{var u=r.nextSibling;if(r.nodeType===1?i?(r._stashedDisplay=r.style.display,r.style.display="none"):(r.style.display=r._stashedDisplay||"",r.getAttribute("style")===""&&r.removeAttribute("style")):r.nodeType===3&&(i?(r._stashedText=r.nodeValue,r.nodeValue=""):r.nodeValue=r._stashedText||""),u&&u.nodeType===8)if(r=u.data,r==="/$"){if(n===0)break;n--}else r!=="$"&&r!=="$?"&&r!=="$~"&&r!=="$!"||n++;r=u}while(r)}function Kh(n){var i=n.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var r=i;switch(i=i.nextSibling,r.nodeName){case"HTML":case"HEAD":case"BODY":Kh(r),tu(r);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(r.rel.toLowerCase()==="stylesheet")continue}n.removeChild(r)}}function Cw(n,i,r,u){for(;n.nodeType===1;){var p=r;if(n.nodeName.toLowerCase()!==i.toLowerCase()){if(!u&&(n.nodeName!=="INPUT"||n.type!=="hidden"))break}else if(u){if(!n[Ga])switch(i){case"meta":if(!n.hasAttribute("itemprop"))break;return n;case"link":if(g=n.getAttribute("rel"),g==="stylesheet"&&n.hasAttribute("data-precedence"))break;if(g!==p.rel||n.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||n.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||n.getAttribute("title")!==(p.title==null?null:p.title))break;return n;case"style":if(n.hasAttribute("data-precedence"))break;return n;case"script":if(g=n.getAttribute("src"),(g!==(p.src==null?null:p.src)||n.getAttribute("type")!==(p.type==null?null:p.type)||n.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&g&&n.hasAttribute("async")&&!n.hasAttribute("itemprop"))break;return n;default:return n}}else if(i==="input"&&n.type==="hidden"){var g=p.name==null?null:""+p.name;if(p.type==="hidden"&&n.getAttribute("name")===g)return n}else return n;if(n=Cn(n.nextSibling),n===null)break}return null}function Rw(n,i,r){if(i==="")return null;for(;n.nodeType!==3;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!r||(n=Cn(n.nextSibling),n===null))return null;return n}function xy(n,i){for(;n.nodeType!==8;)if((n.nodeType!==1||n.nodeName!=="INPUT"||n.type!=="hidden")&&!i||(n=Cn(n.nextSibling),n===null))return null;return n}function Wh(n){return n.data==="$?"||n.data==="$~"}function Qh(n){return n.data==="$!"||n.data==="$?"&&n.ownerDocument.readyState!=="loading"}function Mw(n,i){var r=n.ownerDocument;if(n.data==="$~")n._reactRetry=i;else if(n.data!=="$?"||r.readyState!=="loading")i();else{var u=function(){i(),r.removeEventListener("DOMContentLoaded",u)};r.addEventListener("DOMContentLoaded",u),n._reactRetry=u}}function Cn(n){for(;n!=null;n=n.nextSibling){var i=n.nodeType;if(i===1||i===3)break;if(i===8){if(i=n.data,i==="$"||i==="$!"||i==="$?"||i==="$~"||i==="&"||i==="F!"||i==="F")break;if(i==="/$"||i==="/&")return null}}return n}var Zh=null;function Ty(n){n=n.nextSibling;for(var i=0;n;){if(n.nodeType===8){var r=n.data;if(r==="/$"||r==="/&"){if(i===0)return Cn(n.nextSibling);i--}else r!=="$"&&r!=="$!"&&r!=="$?"&&r!=="$~"&&r!=="&"||i++}n=n.nextSibling}return null}function Cy(n){n=n.previousSibling;for(var i=0;n;){if(n.nodeType===8){var r=n.data;if(r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"){if(i===0)return n;i--}else r!=="/$"&&r!=="/&"||i++}n=n.previousSibling}return null}function Ry(n,i,r){switch(i=El(r),n){case"html":if(n=i.documentElement,!n)throw Error(s(452));return n;case"head":if(n=i.head,!n)throw Error(s(453));return n;case"body":if(n=i.body,!n)throw Error(s(454));return n;default:throw Error(s(451))}}function Cr(n){for(var i=n.attributes;i.length;)n.removeAttributeNode(i[0]);tu(n)}var Rn=new Map,My=new Set;function xl(n){return typeof n.getRootNode=="function"?n.getRootNode():n.nodeType===9?n:n.ownerDocument}var ys=$.d;$.d={f:Dw,r:Ow,D:Nw,C:Lw,L:kw,m:Bw,X:Pw,S:Iw,M:Fw};function Dw(){var n=ys.f(),i=gl();return n||i}function Ow(n){var i=Pi(n);i!==null&&i.tag===5&&i.type==="form"?Xm(i):ys.r(n)}var ma=typeof document>"u"?null:document;function Dy(n,i,r){var u=ma;if(u&&typeof i=="string"&&i){var p=_n(i);p='link[rel="'+n+'"][href="'+p+'"]',typeof r=="string"&&(p+='[crossorigin="'+r+'"]'),My.has(p)||(My.add(p),n={rel:n,crossOrigin:r,href:i},u.querySelector(p)===null&&(i=u.createElement("link"),Oe(i,"link",n),we(i),u.head.appendChild(i)))}}function Nw(n){ys.D(n),Dy("dns-prefetch",n,null)}function Lw(n,i){ys.C(n,i),Dy("preconnect",n,i)}function kw(n,i,r){ys.L(n,i,r);var u=ma;if(u&&n&&i){var p='link[rel="preload"][as="'+_n(i)+'"]';i==="image"&&r&&r.imageSrcSet?(p+='[imagesrcset="'+_n(r.imageSrcSet)+'"]',typeof r.imageSizes=="string"&&(p+='[imagesizes="'+_n(r.imageSizes)+'"]')):p+='[href="'+_n(n)+'"]';var g=p;switch(i){case"style":g=ga(n);break;case"script":g=ya(n)}Rn.has(g)||(n=y({rel:"preload",href:i==="image"&&r&&r.imageSrcSet?void 0:n,as:i},r),Rn.set(g,n),u.querySelector(p)!==null||i==="style"&&u.querySelector(Rr(g))||i==="script"&&u.querySelector(Mr(g))||(i=u.createElement("link"),Oe(i,"link",n),we(i),u.head.appendChild(i)))}}function Bw(n,i){ys.m(n,i);var r=ma;if(r&&n){var u=i&&typeof i.as=="string"?i.as:"script",p='link[rel="modulepreload"][as="'+_n(u)+'"][href="'+_n(n)+'"]',g=p;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":g=ya(n)}if(!Rn.has(g)&&(n=y({rel:"modulepreload",href:n},i),Rn.set(g,n),r.querySelector(p)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(r.querySelector(Mr(g)))return}u=r.createElement("link"),Oe(u,"link",n),we(u),r.head.appendChild(u)}}}function Iw(n,i,r){ys.S(n,i,r);var u=ma;if(u&&n){var p=Fi(u).hoistableStyles,g=ga(n);i=i||"default";var _=p.get(g);if(!_){var E={loading:0,preload:null};if(_=u.querySelector(Rr(g)))E.loading=5;else{n=y({rel:"stylesheet",href:n,"data-precedence":i},r),(r=Rn.get(g))&&Jh(n,r);var R=_=u.createElement("link");we(R),Oe(R,"link",n),R._p=new Promise(function(F,G){R.onload=F,R.onerror=G}),R.addEventListener("load",function(){E.loading|=1}),R.addEventListener("error",function(){E.loading|=2}),E.loading|=4,Tl(_,i,u)}_={type:"stylesheet",instance:_,count:1,state:E},p.set(g,_)}}}function Pw(n,i){ys.X(n,i);var r=ma;if(r&&n){var u=Fi(r).hoistableScripts,p=ya(n),g=u.get(p);g||(g=r.querySelector(Mr(p)),g||(n=y({src:n,async:!0},i),(i=Rn.get(p))&&td(n,i),g=r.createElement("script"),we(g),Oe(g,"link",n),r.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},u.set(p,g))}}function Fw(n,i){ys.M(n,i);var r=ma;if(r&&n){var u=Fi(r).hoistableScripts,p=ya(n),g=u.get(p);g||(g=r.querySelector(Mr(p)),g||(n=y({src:n,async:!0,type:"module"},i),(i=Rn.get(p))&&td(n,i),g=r.createElement("script"),we(g),Oe(g,"link",n),r.head.appendChild(g)),g={type:"script",instance:g,count:1,state:null},u.set(p,g))}}function Oy(n,i,r,u){var p=(p=yt.current)?xl(p):null;if(!p)throw Error(s(446));switch(n){case"meta":case"title":return null;case"style":return typeof r.precedence=="string"&&typeof r.href=="string"?(i=ga(r.href),r=Fi(p).hoistableStyles,u=r.get(i),u||(u={type:"style",instance:null,count:0,state:null},r.set(i,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(r.rel==="stylesheet"&&typeof r.href=="string"&&typeof r.precedence=="string"){n=ga(r.href);var g=Fi(p).hoistableStyles,_=g.get(n);if(_||(p=p.ownerDocument||p,_={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},g.set(n,_),(g=p.querySelector(Rr(n)))&&!g._p&&(_.instance=g,_.state.loading=5),Rn.has(n)||(r={rel:"preload",as:"style",href:r.href,crossOrigin:r.crossOrigin,integrity:r.integrity,media:r.media,hrefLang:r.hrefLang,referrerPolicy:r.referrerPolicy},Rn.set(n,r),g||Uw(p,n,r,_.state))),i&&u===null)throw Error(s(528,""));return _}if(i&&u!==null)throw Error(s(529,""));return null;case"script":return i=r.async,r=r.src,typeof r=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=ya(r),r=Fi(p).hoistableScripts,u=r.get(i),u||(u={type:"script",instance:null,count:0,state:null},r.set(i,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,n))}}function ga(n){return'href="'+_n(n)+'"'}function Rr(n){return'link[rel="stylesheet"]['+n+"]"}function Ny(n){return y({},n,{"data-precedence":n.precedence,precedence:null})}function Uw(n,i,r,u){n.querySelector('link[rel="preload"][as="style"]['+i+"]")?u.loading=1:(i=n.createElement("link"),u.preload=i,i.addEventListener("load",function(){return u.loading|=1}),i.addEventListener("error",function(){return u.loading|=2}),Oe(i,"link",r),we(i),n.head.appendChild(i))}function ya(n){return'[src="'+_n(n)+'"]'}function Mr(n){return"script[async]"+n}function Ly(n,i,r){if(i.count++,i.instance===null)switch(i.type){case"style":var u=n.querySelector('style[data-href~="'+_n(r.href)+'"]');if(u)return i.instance=u,we(u),u;var p=y({},r,{"data-href":r.href,"data-precedence":r.precedence,href:null,precedence:null});return u=(n.ownerDocument||n).createElement("style"),we(u),Oe(u,"style",p),Tl(u,r.precedence,n),i.instance=u;case"stylesheet":p=ga(r.href);var g=n.querySelector(Rr(p));if(g)return i.state.loading|=4,i.instance=g,we(g),g;u=Ny(r),(p=Rn.get(p))&&Jh(u,p),g=(n.ownerDocument||n).createElement("link"),we(g);var _=g;return _._p=new Promise(function(E,R){_.onload=E,_.onerror=R}),Oe(g,"link",u),i.state.loading|=4,Tl(g,r.precedence,n),i.instance=g;case"script":return g=ya(r.src),(p=n.querySelector(Mr(g)))?(i.instance=p,we(p),p):(u=r,(p=Rn.get(g))&&(u=y({},r),td(u,p)),n=n.ownerDocument||n,p=n.createElement("script"),we(p),Oe(p,"link",u),n.head.appendChild(p),i.instance=p);case"void":return null;default:throw Error(s(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(u=i.instance,i.state.loading|=4,Tl(u,r.precedence,n));return i.instance}function Tl(n,i,r){for(var u=r.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=u.length?u[u.length-1]:null,g=p,_=0;_<u.length;_++){var E=u[_];if(E.dataset.precedence===i)g=E;else if(g!==p)break}g?g.parentNode.insertBefore(n,g.nextSibling):(i=r.nodeType===9?r.head:r,i.insertBefore(n,i.firstChild))}function Jh(n,i){n.crossOrigin==null&&(n.crossOrigin=i.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=i.referrerPolicy),n.title==null&&(n.title=i.title)}function td(n,i){n.crossOrigin==null&&(n.crossOrigin=i.crossOrigin),n.referrerPolicy==null&&(n.referrerPolicy=i.referrerPolicy),n.integrity==null&&(n.integrity=i.integrity)}var Cl=null;function ky(n,i,r){if(Cl===null){var u=new Map,p=Cl=new Map;p.set(r,u)}else p=Cl,u=p.get(r),u||(u=new Map,p.set(r,u));if(u.has(n))return u;for(u.set(n,null),r=r.getElementsByTagName(n),p=0;p<r.length;p++){var g=r[p];if(!(g[Ga]||g[Ce]||n==="link"&&g.getAttribute("rel")==="stylesheet")&&g.namespaceURI!=="http://www.w3.org/2000/svg"){var _=g.getAttribute(i)||"";_=n+_;var E=u.get(_);E?E.push(g):u.set(_,[g])}}return u}function By(n,i,r){n=n.ownerDocument||n,n.head.insertBefore(r,i==="title"?n.querySelector("head > title"):null)}function zw(n,i,r){if(r===1||i.itemProp!=null)return!1;switch(n){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;return i.rel==="stylesheet"?(n=i.disabled,typeof i.precedence=="string"&&n==null):!0;case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function Iy(n){return!(n.type==="stylesheet"&&(n.state.loading&3)===0)}function Hw(n,i,r,u){if(r.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(r.state.loading&4)===0){if(r.instance===null){var p=ga(u.href),g=i.querySelector(Rr(p));if(g){i=g._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(n.count++,n=Rl.bind(n),i.then(n,n)),r.state.loading|=4,r.instance=g,we(g);return}g=i.ownerDocument||i,u=Ny(u),(p=Rn.get(p))&&Jh(u,p),g=g.createElement("link"),we(g);var _=g;_._p=new Promise(function(E,R){_.onload=E,_.onerror=R}),Oe(g,"link",u),r.instance=g}n.stylesheets===null&&(n.stylesheets=new Map),n.stylesheets.set(r,i),(i=r.state.preload)&&(r.state.loading&3)===0&&(n.count++,r=Rl.bind(n),i.addEventListener("load",r),i.addEventListener("error",r))}}var ed=0;function jw(n,i){return n.stylesheets&&n.count===0&&Dl(n,n.stylesheets),0<n.count||0<n.imgCount?function(r){var u=setTimeout(function(){if(n.stylesheets&&Dl(n,n.stylesheets),n.unsuspend){var g=n.unsuspend;n.unsuspend=null,g()}},6e4+i);0<n.imgBytes&&ed===0&&(ed=62500*ww());var p=setTimeout(function(){if(n.waitingForImages=!1,n.count===0&&(n.stylesheets&&Dl(n,n.stylesheets),n.unsuspend)){var g=n.unsuspend;n.unsuspend=null,g()}},(n.imgBytes>ed?50:800)+i);return n.unsuspend=r,function(){n.unsuspend=null,clearTimeout(u),clearTimeout(p)}}:null}function Rl(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Dl(this,this.stylesheets);else if(this.unsuspend){var n=this.unsuspend;this.unsuspend=null,n()}}}var Ml=null;function Dl(n,i){n.stylesheets=null,n.unsuspend!==null&&(n.count++,Ml=new Map,i.forEach(qw,n),Ml=null,Rl.call(n))}function qw(n,i){if(!(i.state.loading&4)){var r=Ml.get(n);if(r)var u=r.get(null);else{r=new Map,Ml.set(n,r);for(var p=n.querySelectorAll("link[data-precedence],style[data-precedence]"),g=0;g<p.length;g++){var _=p[g];(_.nodeName==="LINK"||_.getAttribute("media")!=="not all")&&(r.set(_.dataset.precedence,_),u=_)}u&&r.set(null,u)}p=i.instance,_=p.getAttribute("data-precedence"),g=r.get(_)||u,g===u&&r.set(null,p),r.set(_,p),this.count++,u=Rl.bind(this),p.addEventListener("load",u),p.addEventListener("error",u),g?g.parentNode.insertBefore(p,g.nextSibling):(n=n.nodeType===9?n.head:n,n.insertBefore(p,n.firstChild)),i.state.loading|=4}}var Dr={$$typeof:C,Provider:null,Consumer:null,_currentValue:tt,_currentValue2:tt,_threadCount:0};function $w(n,i,r,u,p,g,_,E,R){this.tag=1,this.containerInfo=n,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Wc(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Wc(0),this.hiddenUpdates=Wc(null),this.identifierPrefix=u,this.onUncaughtError=p,this.onCaughtError=g,this.onRecoverableError=_,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=R,this.incompleteTransitions=new Map}function Py(n,i,r,u,p,g,_,E,R,F,G,Y){return n=new $w(n,i,r,_,R,F,G,Y,E),i=1,g===!0&&(i|=24),g=on(3,null,null,i),n.current=g,g.stateNode=n,i=ku(),i.refCount++,n.pooledCache=i,i.refCount++,g.memoizedState={element:u,isDehydrated:r,cache:i},Fu(g),n}function Fy(n){return n?(n=Yi,n):Yi}function Uy(n,i,r,u,p,g){p=Fy(p),u.context===null?u.context=p:u.pendingContext=p,u=Ns(i),u.payload={element:r},g=g===void 0?null:g,g!==null&&(u.callback=g),r=Ls(n,u,i),r!==null&&(We(r,n,i),lr(r,n,i))}function zy(n,i){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var r=n.retryLane;n.retryLane=r!==0&&r<i?r:i}}function nd(n,i){zy(n,i),(n=n.alternate)&&zy(n,i)}function Hy(n){if(n.tag===13||n.tag===31){var i=li(n,67108864);i!==null&&We(i,n,67108864),nd(n,67108864)}}function jy(n){if(n.tag===13||n.tag===31){var i=dn();i=Qc(i);var r=li(n,i);r!==null&&We(r,n,i),nd(n,i)}}var Ol=!0;function Gw(n,i,r,u){var p=B.T;B.T=null;var g=$.p;try{$.p=2,sd(n,i,r,u)}finally{$.p=g,B.T=p}}function Xw(n,i,r,u){var p=B.T;B.T=null;var g=$.p;try{$.p=8,sd(n,i,r,u)}finally{$.p=g,B.T=p}}function sd(n,i,r,u){if(Ol){var p=id(u);if(p===null)qh(n,i,u,Nl,r),$y(n,u);else if(Yw(p,n,i,r,u))u.stopPropagation();else if($y(n,u),i&4&&-1<Vw.indexOf(n)){for(;p!==null;){var g=Pi(p);if(g!==null)switch(g.tag){case 3:if(g=g.stateNode,g.current.memoizedState.isDehydrated){var _=si(g.pendingLanes);if(_!==0){var E=g;for(E.pendingLanes|=2,E.entangledLanes|=2;_;){var R=1<<31-an(_);E.entanglements[1]|=R,_&=~R}jn(g),(Ft&6)===0&&(pl=nn()+500,Er(0))}}break;case 31:case 13:E=li(g,2),E!==null&&We(E,g,2),gl(),nd(g,2)}if(g=id(u),g===null&&qh(n,i,u,Nl,r),g===p)break;p=g}p!==null&&u.stopPropagation()}else qh(n,i,u,null,r)}}function id(n){return n=ru(n),ad(n)}var Nl=null;function ad(n){if(Nl=null,n=Ii(n),n!==null){var i=o(n);if(i===null)n=null;else{var r=i.tag;if(r===13){if(n=l(i),n!==null)return n;n=null}else if(r===31){if(n=h(i),n!==null)return n;n=null}else if(r===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;n=null}else i!==n&&(n=null)}}return Nl=n,null}function qy(n){switch(n){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(N_()){case Qf:return 2;case Zf:return 8;case Ao:case L_:return 32;case Jf:return 268435456;default:return 32}default:return 32}}var rd=!1,$s=null,Gs=null,Xs=null,Or=new Map,Nr=new Map,Vs=[],Vw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function $y(n,i){switch(n){case"focusin":case"focusout":$s=null;break;case"dragenter":case"dragleave":Gs=null;break;case"mouseover":case"mouseout":Xs=null;break;case"pointerover":case"pointerout":Or.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nr.delete(i.pointerId)}}function Lr(n,i,r,u,p,g){return n===null||n.nativeEvent!==g?(n={blockedOn:i,domEventName:r,eventSystemFlags:u,nativeEvent:g,targetContainers:[p]},i!==null&&(i=Pi(i),i!==null&&Hy(i)),n):(n.eventSystemFlags|=u,i=n.targetContainers,p!==null&&i.indexOf(p)===-1&&i.push(p),n)}function Yw(n,i,r,u,p){switch(i){case"focusin":return $s=Lr($s,n,i,r,u,p),!0;case"dragenter":return Gs=Lr(Gs,n,i,r,u,p),!0;case"mouseover":return Xs=Lr(Xs,n,i,r,u,p),!0;case"pointerover":var g=p.pointerId;return Or.set(g,Lr(Or.get(g)||null,n,i,r,u,p)),!0;case"gotpointercapture":return g=p.pointerId,Nr.set(g,Lr(Nr.get(g)||null,n,i,r,u,p)),!0}return!1}function Gy(n){var i=Ii(n.target);if(i!==null){var r=o(i);if(r!==null){if(i=r.tag,i===13){if(i=l(r),i!==null){n.blockedOn=i,ap(n.priority,function(){jy(r)});return}}else if(i===31){if(i=h(r),i!==null){n.blockedOn=i,ap(n.priority,function(){jy(r)});return}}else if(i===3&&r.stateNode.current.memoizedState.isDehydrated){n.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Ll(n){if(n.blockedOn!==null)return!1;for(var i=n.targetContainers;0<i.length;){var r=id(n.nativeEvent);if(r===null){r=n.nativeEvent;var u=new r.constructor(r.type,r);au=u,r.target.dispatchEvent(u),au=null}else return i=Pi(r),i!==null&&Hy(i),n.blockedOn=r,!1;i.shift()}return!0}function Xy(n,i,r){Ll(n)&&r.delete(i)}function Kw(){rd=!1,$s!==null&&Ll($s)&&($s=null),Gs!==null&&Ll(Gs)&&(Gs=null),Xs!==null&&Ll(Xs)&&(Xs=null),Or.forEach(Xy),Nr.forEach(Xy)}function kl(n,i){n.blockedOn===i&&(n.blockedOn=null,rd||(rd=!0,c.unstable_scheduleCallback(c.unstable_NormalPriority,Kw)))}var Bl=null;function Vy(n){Bl!==n&&(Bl=n,c.unstable_scheduleCallback(c.unstable_NormalPriority,function(){Bl===n&&(Bl=null);for(var i=0;i<n.length;i+=3){var r=n[i],u=n[i+1],p=n[i+2];if(typeof u!="function"){if(ad(u||r)===null)continue;break}var g=Pi(r);g!==null&&(n.splice(i,3),i-=3,ih(g,{pending:!0,data:p,method:r.method,action:u},u,p))}}))}function ba(n){function i(R){return kl(R,n)}$s!==null&&kl($s,n),Gs!==null&&kl(Gs,n),Xs!==null&&kl(Xs,n),Or.forEach(i),Nr.forEach(i);for(var r=0;r<Vs.length;r++){var u=Vs[r];u.blockedOn===n&&(u.blockedOn=null)}for(;0<Vs.length&&(r=Vs[0],r.blockedOn===null);)Gy(r),r.blockedOn===null&&Vs.shift();if(r=(n.ownerDocument||n).$$reactFormReplay,r!=null)for(u=0;u<r.length;u+=3){var p=r[u],g=r[u+1],_=p[$e]||null;if(typeof g=="function")_||Vy(r);else if(_){var E=null;if(g&&g.hasAttribute("formAction")){if(p=g,_=g[$e]||null)E=_.formAction;else if(ad(p)!==null)continue}else E=_.action;typeof E=="function"?r[u+1]=E:(r.splice(u,3),u-=3),Vy(r)}}}function Yy(){function n(g){g.canIntercept&&g.info==="react-transition"&&g.intercept({handler:function(){return new Promise(function(_){return p=_})},focusReset:"manual",scroll:"manual"})}function i(){p!==null&&(p(),p=null),u||setTimeout(r,20)}function r(){if(!u&&!navigation.transition){var g=navigation.currentEntry;g&&g.url!=null&&navigation.navigate(g.url,{state:g.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var u=!1,p=null;return navigation.addEventListener("navigate",n),navigation.addEventListener("navigatesuccess",i),navigation.addEventListener("navigateerror",i),setTimeout(r,100),function(){u=!0,navigation.removeEventListener("navigate",n),navigation.removeEventListener("navigatesuccess",i),navigation.removeEventListener("navigateerror",i),p!==null&&(p(),p=null)}}}function od(n){this._internalRoot=n}Il.prototype.render=od.prototype.render=function(n){var i=this._internalRoot;if(i===null)throw Error(s(409));var r=i.current,u=dn();Uy(r,u,n,i,null,null)},Il.prototype.unmount=od.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var i=n.containerInfo;Uy(n.current,2,null,n,null,null),gl(),i[Bi]=null}};function Il(n){this._internalRoot=n}Il.prototype.unstable_scheduleHydration=function(n){if(n){var i=ip();n={blockedOn:null,target:n,priority:i};for(var r=0;r<Vs.length&&i!==0&&i<Vs[r].priority;r++);Vs.splice(r,0,n),r===0&&Gy(n)}};var Ky=t.version;if(Ky!=="19.2.3")throw Error(s(527,Ky,"19.2.3"));$.findDOMNode=function(n){var i=n._reactInternals;if(i===void 0)throw typeof n.render=="function"?Error(s(188)):(n=Object.keys(n).join(","),Error(s(268,n)));return n=f(i),n=n!==null?m(n):null,n=n===null?null:n.stateNode,n};var Ww={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:B,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Pl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Pl.isDisabled&&Pl.supportsFiber)try{ja=Pl.inject(Ww),sn=Pl}catch{}}return Br.createRoot=function(n,i){if(!a(n))throw Error(s(299));var r=!1,u="",p=ng,g=sg,_=ig;return i!=null&&(i.unstable_strictMode===!0&&(r=!0),i.identifierPrefix!==void 0&&(u=i.identifierPrefix),i.onUncaughtError!==void 0&&(p=i.onUncaughtError),i.onCaughtError!==void 0&&(g=i.onCaughtError),i.onRecoverableError!==void 0&&(_=i.onRecoverableError)),i=Py(n,1,!1,null,null,r,u,null,p,g,_,Yy),n[Bi]=i.current,jh(n),new od(i)},Br.hydrateRoot=function(n,i,r){if(!a(n))throw Error(s(299));var u=!1,p="",g=ng,_=sg,E=ig,R=null;return r!=null&&(r.unstable_strictMode===!0&&(u=!0),r.identifierPrefix!==void 0&&(p=r.identifierPrefix),r.onUncaughtError!==void 0&&(g=r.onUncaughtError),r.onCaughtError!==void 0&&(_=r.onCaughtError),r.onRecoverableError!==void 0&&(E=r.onRecoverableError),r.formState!==void 0&&(R=r.formState)),i=Py(n,1,!0,i,r??null,u,p,R,g,_,E,Yy),i.context=Fy(null),r=i.current,u=dn(),u=Qc(u),p=Ns(u),p.callback=null,Ls(r,p,u),r=u,i.current.lanes=r,$a(i,r),jn(i),n[Bi]=i.current,jh(n),new Il(i)},Br.version="19.2.3",Br}var ob;function rS(){if(ob)return hd.exports;ob=1;function c(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c)}catch(t){console.error(t)}}return c(),hd.exports=aS(),hd.exports}var oS=rS();const h0="depo-forensics-data",d0="depo-forensics-config",lb={documents:[],utterances:[],claims:[],contradictions:[],config:{}};function xc(){try{const c=localStorage.getItem(h0);if(!c)return lb;const t=JSON.parse(c);return t.documents&&(t.documents=t.documents.map(e=>({...e,uploadedAt:new Date(e.uploadedAt)}))),t.claims&&(t.claims=t.claims.map(e=>({...e,createdAt:new Date(e.createdAt)}))),t.contradictions&&(t.contradictions=t.contradictions.map(e=>({...e,createdAt:new Date(e.createdAt),claimA:{...e.claimA,createdAt:new Date(e.claimA.createdAt)},claimB:{...e.claimB,createdAt:new Date(e.claimB.createdAt)}}))),t}catch(c){return console.error("Failed to load from storage:",c),lb}}function Tc(c){try{localStorage.setItem(h0,JSON.stringify(c))}catch(t){throw console.error("Failed to save to storage:",t),new Error("Storage quota exceeded or storage unavailable")}}function lS(){try{const c=localStorage.getItem(d0);return c?JSON.parse(c):{}}catch(c){return console.error("Failed to load config:",c),{}}}function cb(c){try{localStorage.setItem(d0,JSON.stringify(c))}catch(t){console.error("Failed to save config:",t)}}function cS(c){const t=xc(),e=t.documents.findIndex(s=>s.id===c.id);e>=0?t.documents[e]=c:t.documents.push(c),Tc(t)}function uS(c){const t=xc();t.utterances.push(...c),Tc(t)}function hS(c){const t=xc();t.claims.push(...c),Tc(t)}function dS(c){const t=xc();t.contradictions.push(...c),Tc(t)}const fS=({onConfigured:c})=>{const[t,e]=en.useState({}),[s,a]=en.useState(!1),[o,l]=en.useState(!1);en.useEffect(()=>{const f=lS();e(f),f.openaiApiKey&&l(!0)},[]);const h=()=>{if(!t.openaiApiKey){alert("OpenAI API key is required");return}cb(t),l(!0),c(t)},d=()=>{e({}),cb({}),l(!1)};return H.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[H.jsx("h2",{className:"text-2xl font-bold mb-4",children:"API Configuration"}),o&&H.jsx("div",{className:"bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded mb-4",children:"Configuration saved successfully!"}),H.jsxs("div",{className:"space-y-4",children:[H.jsxs("div",{children:[H.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["OpenAI API Key ",H.jsx("span",{className:"text-red-500",children:"*"})]}),H.jsx("input",{type:s?"text":"password",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"sk-...",value:t.openaiApiKey||"",onChange:f=>e({...t,openaiApiKey:f.target.value})}),H.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Required for claim extraction and contradiction detection. Get your key at"," ",H.jsx("a",{href:"https://platform.openai.com/api-keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:"platform.openai.com"})]})]}),H.jsxs("div",{className:"pt-4 border-t",children:[H.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Chroma Cloud (Optional)"}),H.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"For better semantic search. If not configured, local similarity matching will be used."}),H.jsxs("div",{className:"space-y-3",children:[H.jsxs("div",{children:[H.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tenant ID"}),H.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"default-tenant",value:t.chromaTenant||"",onChange:f=>e({...t,chromaTenant:f.target.value})})]}),H.jsxs("div",{children:[H.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Database Name"}),H.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"default-database",value:t.chromaDatabase||"",onChange:f=>e({...t,chromaDatabase:f.target.value})})]}),H.jsxs("div",{children:[H.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API Key"}),H.jsx("input",{type:s?"text":"password",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"chroma-api-key",value:t.chromaApiKey||"",onChange:f=>e({...t,chromaApiKey:f.target.value})})]})]})]}),H.jsxs("div",{className:"flex items-center",children:[H.jsx("input",{type:"checkbox",id:"showKeys",checked:s,onChange:f=>a(f.target.checked),className:"mr-2"}),H.jsx("label",{htmlFor:"showKeys",className:"text-sm text-gray-700",children:"Show API keys"})]}),H.jsxs("div",{className:"flex gap-3 pt-4",children:[H.jsx("button",{onClick:h,className:"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Save Configuration"}),o&&H.jsx("button",{onClick:d,className:"bg-gray-200 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400",children:"Clear Configuration"})]}),H.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 text-yellow-800 px-4 py-3 rounded mt-4",children:[H.jsx("strong",{children:"Security Note:"})," API keys are stored in your browser's local storage. Never share your API keys or use this tool on shared computers."]})]})]})},pS=({onFileSelected:c,disabled:t=!1})=>{const[e,s]=en.useState(!1),a=en.useCallback(d=>{d.preventDefault(),d.stopPropagation(),d.type==="dragenter"||d.type==="dragover"?s(!0):d.type==="dragleave"&&s(!1)},[]),o=en.useCallback(d=>{d.preventDefault(),d.stopPropagation(),s(!1),!t&&d.dataTransfer.files&&d.dataTransfer.files[0]&&h(d.dataTransfer.files[0])},[t]),l=en.useCallback(d=>{d.preventDefault(),!t&&d.target.files&&d.target.files[0]&&h(d.target.files[0])},[t]),h=d=>{const f=["application/pdf","text/plain"],m=[".pdf",".txt"],y=f.includes(d.type),b=m.some(v=>d.name.toLowerCase().endsWith(v));if(!y&&!b){alert("Please upload a PDF or TXT file");return}c(d)};return H.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[H.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Upload Deposition Transcript"}),H.jsxs("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${e?"border-blue-500 bg-blue-50":"border-gray-300 bg-gray-50"} ${t?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onDragEnter:a,onDragLeave:a,onDragOver:a,onDrop:o,children:[H.jsx("input",{type:"file",id:"fileInput",className:"hidden",accept:".pdf,.txt",onChange:l,disabled:t}),H.jsxs("label",{htmlFor:"fileInput",className:t?"cursor-not-allowed":"cursor-pointer",children:[H.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true",children:H.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),H.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:[H.jsx("span",{className:"font-semibold text-blue-600",children:"Click to upload"})," or drag and drop"]}),H.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"PDF or TXT files only"})]})]}),H.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:[H.jsx("p",{className:"font-semibold mb-2",children:"Supported formats:"}),H.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[H.jsx("li",{children:"PDF deposition transcripts (with or without line numbers)"}),H.jsx("li",{children:"Plain text transcripts (TXT format)"})]}),H.jsx("p",{className:"mt-3 text-xs text-gray-500",children:'For best results, ensure your transcript includes clear Q/A markers (e.g., "Q." and "A.") and page numbers.'})]})]})},mS=({status:c})=>{const t=s=>{switch(s){case"idle":return"Ready";case"parsing":return"Parsing transcript...";case"extracting":return"Extracting claims...";case"embedding":return"Generating embeddings...";case"analyzing":return"Detecting contradictions...";case"complete":return"Analysis complete!";case"error":return"Error occurred";default:return"Processing..."}},e=s=>s==="complete"?H.jsx("svg",{className:"w-6 h-6 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:H.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):s==="error"?H.jsx("svg",{className:"w-6 h-6 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:H.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}):H.jsxs("svg",{className:"animate-spin h-6 w-6 text-blue-500",fill:"none",viewBox:"0 0 24 24",children:[H.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),H.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]});return c.stage==="idle"?null:H.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[H.jsxs("div",{className:"flex items-center mb-4",children:[e(c.stage),H.jsx("h3",{className:"text-lg font-semibold ml-3",children:t(c.stage)})]}),c.stage!=="complete"&&c.stage!=="error"&&H.jsxs(H.Fragment,{children:[H.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mb-2",children:H.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-300",style:{width:`${c.progress}%`}})}),H.jsx("p",{className:"text-sm text-gray-600",children:c.message}),H.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.progress,"% complete"]})]}),c.stage==="complete"&&H.jsx("p",{className:"text-sm text-green-700",children:c.message}),c.stage==="error"&&H.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded",children:[H.jsx("p",{className:"font-semibold",children:"Error:"}),H.jsx("p",{className:"text-sm",children:c.error||"An unknown error occurred"})]})]})},Ne=[];for(let c=0;c<256;++c)Ne.push((c+256).toString(16).slice(1));function gS(c,t=0){return(Ne[c[t+0]]+Ne[c[t+1]]+Ne[c[t+2]]+Ne[c[t+3]]+"-"+Ne[c[t+4]]+Ne[c[t+5]]+"-"+Ne[c[t+6]]+Ne[c[t+7]]+"-"+Ne[c[t+8]]+Ne[c[t+9]]+"-"+Ne[c[t+10]]+Ne[c[t+11]]+Ne[c[t+12]]+Ne[c[t+13]]+Ne[c[t+14]]+Ne[c[t+15]]).toLowerCase()}let md;const yS=new Uint8Array(16);function bS(){if(!md){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");md=crypto.getRandomValues.bind(crypto)}return md(yS)}const vS=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ub={randomUUID:vS};function _S(c,t,e){c=c||{};const s=c.random??c.rng?.()??bS();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,gS(s)}function Cc(c,t,e){return ub.randomUUID&&!c?ub.randomUUID():_S(c)}function mt(c,t,e,s,a){if(typeof t=="function"?c!==t||!0:!t.has(c))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(c,e),e}function U(c,t,e,s){if(e==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?c!==t||!s:!t.has(c))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?s:e==="a"?s.call(c):s?s.value:t.get(c)}let f0=function(){const{crypto:c}=globalThis;if(c?.randomUUID)return f0=c.randomUUID.bind(c),c.randomUUID();const t=new Uint8Array(1),e=c?()=>c.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,s=>(+s^e()&15>>+s/4).toString(16))};function Bd(c){return typeof c=="object"&&c!==null&&("name"in c&&c.name==="AbortError"||"message"in c&&String(c.message).includes("FetchRequestCanceledException"))}const Id=c=>{if(c instanceof Error)return c;if(typeof c=="object"&&c!==null){try{if(Object.prototype.toString.call(c)==="[object Error]"){const t=new Error(c.message,c.cause?{cause:c.cause}:{});return c.stack&&(t.stack=c.stack),c.cause&&!t.cause&&(t.cause=c.cause),c.name&&(t.name=c.name),t}}catch{}try{return new Error(JSON.stringify(c))}catch{}}return new Error(c)};class ut extends Error{}class Pe extends ut{constructor(t,e,s,a){super(`${Pe.makeMessage(t,e,s)}`),this.status=t,this.headers=a,this.requestID=a?.get("x-request-id"),this.error=e;const o=e;this.code=o?.code,this.param=o?.param,this.type=o?.type}static makeMessage(t,e,s){const a=e?.message?typeof e.message=="string"?e.message:JSON.stringify(e.message):e?JSON.stringify(e):s;return t&&a?`${t} ${a}`:t?`${t} status code (no body)`:a||"(no status code or body)"}static generate(t,e,s,a){if(!t||!a)return new Rc({message:s,cause:Id(e)});const o=e?.error;return t===400?new p0(t,o,s,a):t===401?new m0(t,o,s,a):t===403?new g0(t,o,s,a):t===404?new y0(t,o,s,a):t===409?new b0(t,o,s,a):t===422?new v0(t,o,s,a):t===429?new _0(t,o,s,a):t>=500?new A0(t,o,s,a):new Pe(t,o,s,a)}}class Nn extends Pe{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class Rc extends Pe{constructor({message:t,cause:e}){super(void 0,void 0,t||"Connection error.",void 0),e&&(this.cause=e)}}class df extends Rc{constructor({message:t}={}){super({message:t??"Request timed out."})}}class p0 extends Pe{}class m0 extends Pe{}class g0 extends Pe{}class y0 extends Pe{}class b0 extends Pe{}class v0 extends Pe{}class _0 extends Pe{}class A0 extends Pe{}class w0 extends ut{constructor(){super("Could not parse response content as the length limit was reached")}}class S0 extends ut{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class jr extends Error{constructor(t){super(t)}}const AS=/^[a-z][a-z0-9+.-]*:/i,wS=c=>AS.test(c);let tn=c=>(tn=Array.isArray,tn(c)),hb=tn;function E0(c){return typeof c!="object"?{}:c??{}}function SS(c){if(!c)return!0;for(const t in c)return!1;return!0}function ES(c,t){return Object.prototype.hasOwnProperty.call(c,t)}function gd(c){return c!=null&&typeof c=="object"&&!Array.isArray(c)}const xS=(c,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new ut(`${c} must be an integer`);if(t<0)throw new ut(`${c} must be a positive integer`);return t},TS=c=>{try{return JSON.parse(c)}catch{return}},uo=c=>new Promise(t=>setTimeout(t,c)),Sa="6.16.0",CS=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function RS(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const MS=()=>{const c=RS();if(c==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Sa,"X-Stainless-OS":fb(Deno.build.os),"X-Stainless-Arch":db(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Sa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(c==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Sa,"X-Stainless-OS":fb(globalThis.process.platform??"unknown"),"X-Stainless-Arch":db(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const t=DS();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Sa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Sa,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function DS(){if(typeof navigator>"u"||!navigator)return null;const c=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:e}of c){const s=e.exec(navigator.userAgent);if(s){const a=s[1]||0,o=s[2]||0,l=s[3]||0;return{browser:t,version:`${a}.${o}.${l}`}}}return null}const db=c=>c==="x32"?"x32":c==="x86_64"||c==="x64"?"x64":c==="arm"?"arm":c==="aarch64"||c==="arm64"?"arm64":c?`other:${c}`:"unknown",fb=c=>(c=c.toLowerCase(),c.includes("ios")?"iOS":c==="android"?"Android":c==="darwin"?"MacOS":c==="win32"?"Windows":c==="freebsd"?"FreeBSD":c==="openbsd"?"OpenBSD":c==="linux"?"Linux":c?`Other:${c}`:"Unknown");let pb;const OS=()=>pb??(pb=MS());function NS(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function x0(...c){const t=globalThis.ReadableStream;if(typeof t>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...c)}function T0(c){let t=Symbol.asyncIterator in c?c[Symbol.asyncIterator]():c[Symbol.iterator]();return x0({start(){},async pull(e){const{done:s,value:a}=await t.next();s?e.close():e.enqueue(a)},async cancel(){await t.return?.()}})}function C0(c){if(c[Symbol.asyncIterator])return c;const t=c.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function LS(c){if(c===null||typeof c!="object")return;if(c[Symbol.asyncIterator]){await c[Symbol.asyncIterator]().return?.();return}const t=c.getReader(),e=t.cancel();t.releaseLock(),await e}const kS=({headers:c,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),R0="RFC3986",M0=c=>String(c),mb={RFC1738:c=>String(c).replace(/%20/g,"+"),RFC3986:M0},BS="RFC1738";let Pd=(c,t)=>(Pd=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),Pd(c,t));const Gn=(()=>{const c=[];for(let t=0;t<256;++t)c.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return c})(),yd=1024,IS=(c,t,e,s,a)=>{if(c.length===0)return c;let o=c;if(typeof c=="symbol"?o=Symbol.prototype.toString.call(c):typeof c!="string"&&(o=String(c)),e==="iso-8859-1")return escape(o).replace(/%u[0-9a-f]{4}/gi,function(h){return"%26%23"+parseInt(h.slice(2),16)+"%3B"});let l="";for(let h=0;h<o.length;h+=yd){const d=o.length>=yd?o.slice(h,h+yd):o,f=[];for(let m=0;m<d.length;++m){let y=d.charCodeAt(m);if(y===45||y===46||y===95||y===126||y>=48&&y<=57||y>=65&&y<=90||y>=97&&y<=122||a===BS&&(y===40||y===41)){f[f.length]=d.charAt(m);continue}if(y<128){f[f.length]=Gn[y];continue}if(y<2048){f[f.length]=Gn[192|y>>6]+Gn[128|y&63];continue}if(y<55296||y>=57344){f[f.length]=Gn[224|y>>12]+Gn[128|y>>6&63]+Gn[128|y&63];continue}m+=1,y=65536+((y&1023)<<10|d.charCodeAt(m)&1023),f[f.length]=Gn[240|y>>18]+Gn[128|y>>12&63]+Gn[128|y>>6&63]+Gn[128|y&63]}l+=f.join("")}return l};function PS(c){return!c||typeof c!="object"?!1:!!(c.constructor&&c.constructor.isBuffer&&c.constructor.isBuffer(c))}function gb(c,t){if(tn(c)){const e=[];for(let s=0;s<c.length;s+=1)e.push(t(c[s]));return e}return t(c)}const D0={brackets(c){return String(c)+"[]"},comma:"comma",indices(c,t){return String(c)+"["+t+"]"},repeat(c){return String(c)}},O0=function(c,t){Array.prototype.push.apply(c,tn(t)?t:[t])};let yb;const _e={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:IS,encodeValuesOnly:!1,format:R0,formatter:M0,indices:!1,serializeDate(c){return(yb??(yb=Function.prototype.call.bind(Date.prototype.toISOString)))(c)},skipNulls:!1,strictNullHandling:!1};function FS(c){return typeof c=="string"||typeof c=="number"||typeof c=="boolean"||typeof c=="symbol"||typeof c=="bigint"}const bd={};function N0(c,t,e,s,a,o,l,h,d,f,m,y,b,v,w,A,x,S){let T=c,C=S,N=0,D=!1;for(;(C=C.get(bd))!==void 0&&!D;){const J=C.get(c);if(N+=1,typeof J<"u"){if(J===N)throw new RangeError("Cyclic object value");D=!0}typeof C.get(bd)>"u"&&(N=0)}if(typeof f=="function"?T=f(t,T):T instanceof Date?T=b?.(T):e==="comma"&&tn(T)&&(T=gb(T,function(J){return J instanceof Date?b?.(J):J})),T===null){if(o)return d&&!A?d(t,_e.encoder,x,"key",v):t;T=""}if(FS(T)||PS(T)){if(d){const J=A?t:d(t,_e.encoder,x,"key",v);return[w?.(J)+"="+w?.(d(T,_e.encoder,x,"value",v))]}return[w?.(t)+"="+w?.(String(T))]}const L=[];if(typeof T>"u")return L;let k;if(e==="comma"&&tn(T))A&&d&&(T=gb(T,d)),k=[{value:T.length>0?T.join(",")||null:void 0}];else if(tn(f))k=f;else{const J=Object.keys(T);k=m?J.sort(m):J}const V=h?String(t).replace(/\./g,"%2E"):String(t),K=s&&tn(T)&&T.length===1?V+"[]":V;if(a&&tn(T)&&T.length===0)return K+"[]";for(let J=0;J<k.length;++J){const W=k[J],pt=typeof W=="object"&&typeof W.value<"u"?W.value:T[W];if(l&&pt===null)continue;const Tt=y&&h?W.replace(/\./g,"%2E"):W,gt=tn(T)?typeof e=="function"?e(K,Tt):K:K+(y?"."+Tt:"["+Tt+"]");S.set(c,N);const Nt=new WeakMap;Nt.set(bd,S),O0(L,N0(pt,gt,e,s,a,o,l,h,e==="comma"&&A&&tn(T)?null:d,f,m,y,b,v,w,A,x,Nt))}return L}function US(c=_e){if(typeof c.allowEmptyArrays<"u"&&typeof c.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof c.encodeDotInKeys<"u"&&typeof c.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(c.encoder!==null&&typeof c.encoder<"u"&&typeof c.encoder!="function")throw new TypeError("Encoder has to be a function.");const t=c.charset||_e.charset;if(typeof c.charset<"u"&&c.charset!=="utf-8"&&c.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let e=R0;if(typeof c.format<"u"){if(!Pd(mb,c.format))throw new TypeError("Unknown format option provided.");e=c.format}const s=mb[e];let a=_e.filter;(typeof c.filter=="function"||tn(c.filter))&&(a=c.filter);let o;if(c.arrayFormat&&c.arrayFormat in D0?o=c.arrayFormat:"indices"in c?o=c.indices?"indices":"repeat":o=_e.arrayFormat,"commaRoundTrip"in c&&typeof c.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const l=typeof c.allowDots>"u"?c.encodeDotInKeys?!0:_e.allowDots:!!c.allowDots;return{addQueryPrefix:typeof c.addQueryPrefix=="boolean"?c.addQueryPrefix:_e.addQueryPrefix,allowDots:l,allowEmptyArrays:typeof c.allowEmptyArrays=="boolean"?!!c.allowEmptyArrays:_e.allowEmptyArrays,arrayFormat:o,charset:t,charsetSentinel:typeof c.charsetSentinel=="boolean"?c.charsetSentinel:_e.charsetSentinel,commaRoundTrip:!!c.commaRoundTrip,delimiter:typeof c.delimiter>"u"?_e.delimiter:c.delimiter,encode:typeof c.encode=="boolean"?c.encode:_e.encode,encodeDotInKeys:typeof c.encodeDotInKeys=="boolean"?c.encodeDotInKeys:_e.encodeDotInKeys,encoder:typeof c.encoder=="function"?c.encoder:_e.encoder,encodeValuesOnly:typeof c.encodeValuesOnly=="boolean"?c.encodeValuesOnly:_e.encodeValuesOnly,filter:a,format:e,formatter:s,serializeDate:typeof c.serializeDate=="function"?c.serializeDate:_e.serializeDate,skipNulls:typeof c.skipNulls=="boolean"?c.skipNulls:_e.skipNulls,sort:typeof c.sort=="function"?c.sort:null,strictNullHandling:typeof c.strictNullHandling=="boolean"?c.strictNullHandling:_e.strictNullHandling}}function zS(c,t={}){let e=c;const s=US(t);let a,o;typeof s.filter=="function"?(o=s.filter,e=o("",e)):tn(s.filter)&&(o=s.filter,a=o);const l=[];if(typeof e!="object"||e===null)return"";const h=D0[s.arrayFormat],d=h==="comma"&&s.commaRoundTrip;a||(a=Object.keys(e)),s.sort&&a.sort(s.sort);const f=new WeakMap;for(let b=0;b<a.length;++b){const v=a[b];s.skipNulls&&e[v]===null||O0(l,N0(e[v],v,h,d,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,f))}const m=l.join(s.delimiter);let y=s.addQueryPrefix===!0?"?":"";return s.charsetSentinel&&(s.charset==="iso-8859-1"?y+="utf8=%26%2310003%3B&":y+="utf8=%E2%9C%93&"),m.length>0?y+m:""}function HS(c){let t=0;for(const a of c)t+=a.length;const e=new Uint8Array(t);let s=0;for(const a of c)e.set(a,s),s+=a.length;return e}let bb;function ff(c){let t;return(bb??(t=new globalThis.TextEncoder,bb=t.encode.bind(t)))(c)}let vb;function _b(c){let t;return(vb??(t=new globalThis.TextDecoder,vb=t.decode.bind(t)))(c)}var fn,pn;class Mc{constructor(){fn.set(this,void 0),pn.set(this,void 0),mt(this,fn,new Uint8Array),mt(this,pn,null)}decode(t){if(t==null)return[];const e=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?ff(t):t;mt(this,fn,HS([U(this,fn,"f"),e]));const s=[];let a;for(;(a=jS(U(this,fn,"f"),U(this,pn,"f")))!=null;){if(a.carriage&&U(this,pn,"f")==null){mt(this,pn,a.index);continue}if(U(this,pn,"f")!=null&&(a.index!==U(this,pn,"f")+1||a.carriage)){s.push(_b(U(this,fn,"f").subarray(0,U(this,pn,"f")-1))),mt(this,fn,U(this,fn,"f").subarray(U(this,pn,"f"))),mt(this,pn,null);continue}const o=U(this,pn,"f")!==null?a.preceding-1:a.preceding,l=_b(U(this,fn,"f").subarray(0,o));s.push(l),mt(this,fn,U(this,fn,"f").subarray(a.index)),mt(this,pn,null)}return s}flush(){return U(this,fn,"f").length?this.decode(`
`):[]}}fn=new WeakMap,pn=new WeakMap;Mc.NEWLINE_CHARS=new Set([`
`,"\r"]);Mc.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function jS(c,t){for(let a=t??0;a<c.length;a++){if(c[a]===10)return{preceding:a,index:a+1,carriage:!1};if(c[a]===13)return{preceding:a,index:a+1,carriage:!0}}return null}function qS(c){for(let s=0;s<c.length-1;s++){if(c[s]===10&&c[s+1]===10||c[s]===13&&c[s+1]===13)return s+2;if(c[s]===13&&c[s+1]===10&&s+3<c.length&&c[s+2]===13&&c[s+3]===10)return s+4}return-1}const dc={off:0,error:200,warn:300,info:400,debug:500},Ab=(c,t,e)=>{if(c){if(ES(dc,c))return c;ke(e).warn(`${t} was set to ${JSON.stringify(c)}, expected one of ${JSON.stringify(Object.keys(dc))}`)}};function qr(){}function Fl(c,t,e){return!t||dc[c]>dc[e]?qr:t[c].bind(t)}const $S={error:qr,warn:qr,info:qr,debug:qr};let wb=new WeakMap;function ke(c){const t=c.logger,e=c.logLevel??"off";if(!t)return $S;const s=wb.get(t);if(s&&s[0]===e)return s[1];const a={error:Fl("error",t,e),warn:Fl("warn",t,e),info:Fl("info",t,e),debug:Fl("debug",t,e)};return wb.set(t,[e,a]),a}const Ai=c=>(c.options&&(c.options={...c.options},delete c.options.headers),c.headers&&(c.headers=Object.fromEntries((c.headers instanceof Headers?[...c.headers]:Object.entries(c.headers)).map(([t,e])=>[t,t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":e]))),"retryOfRequestLogID"in c&&(c.retryOfRequestLogID&&(c.retryOf=c.retryOfRequestLogID),delete c.retryOfRequestLogID),c);var Ir;class Qn{constructor(t,e,s){this.iterator=t,Ir.set(this,void 0),this.controller=e,mt(this,Ir,s)}static fromSSEResponse(t,e,s){let a=!1;const o=s?ke(s):console;async function*l(){if(a)throw new ut("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let h=!1;try{for await(const d of GS(t,e))if(!h){if(d.data.startsWith("[DONE]")){h=!0;continue}if(d.event===null||!d.event.startsWith("thread.")){let f;try{f=JSON.parse(d.data)}catch(m){throw o.error("Could not parse message into JSON:",d.data),o.error("From chunk:",d.raw),m}if(f&&f.error)throw new Pe(void 0,f.error,void 0,t.headers);yield f}else{let f;try{f=JSON.parse(d.data)}catch(m){throw console.error("Could not parse message into JSON:",d.data),console.error("From chunk:",d.raw),m}if(d.event=="error")throw new Pe(void 0,f.error,f.message,void 0);yield{event:d.event,data:f}}}h=!0}catch(d){if(Bd(d))return;throw d}finally{h||e.abort()}}return new Qn(l,e,s)}static fromReadableStream(t,e,s){let a=!1;async function*o(){const h=new Mc,d=C0(t);for await(const f of d)for(const m of h.decode(f))yield m;for(const f of h.flush())yield f}async function*l(){if(a)throw new ut("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");a=!0;let h=!1;try{for await(const d of o())h||d&&(yield JSON.parse(d));h=!0}catch(d){if(Bd(d))return;throw d}finally{h||e.abort()}}return new Qn(l,e,s)}[(Ir=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const t=[],e=[],s=this.iterator(),a=o=>({next:()=>{if(o.length===0){const l=s.next();t.push(l),e.push(l)}return o.shift()}});return[new Qn(()=>a(t),this.controller,U(this,Ir,"f")),new Qn(()=>a(e),this.controller,U(this,Ir,"f"))]}toReadableStream(){const t=this;let e;return x0({async start(){e=t[Symbol.asyncIterator]()},async pull(s){try{const{value:a,done:o}=await e.next();if(o)return s.close();const l=ff(JSON.stringify(a)+`
`);s.enqueue(l)}catch(a){s.error(a)}},async cancel(){await e.return?.()}})}}async function*GS(c,t){if(!c.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new ut("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new ut("Attempted to iterate over a response with no body");const e=new VS,s=new Mc,a=C0(c.body);for await(const o of XS(a))for(const l of s.decode(o)){const h=e.decode(l);h&&(yield h)}for(const o of s.flush()){const l=e.decode(o);l&&(yield l)}}async function*XS(c){let t=new Uint8Array;for await(const e of c){if(e==null)continue;const s=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?ff(e):e;let a=new Uint8Array(t.length+s.length);a.set(t),a.set(s,t.length),t=a;let o;for(;(o=qS(t))!==-1;)yield t.slice(0,o),t=t.slice(o)}t.length>0&&(yield t)}class VS{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(t),t.startsWith(":"))return null;let[e,s,a]=YS(t,":");return a.startsWith(" ")&&(a=a.substring(1)),e==="event"?this.event=a:e==="data"&&this.data.push(a),null}}function YS(c,t){const e=c.indexOf(t);return e!==-1?[c.substring(0,e),t,c.substring(e+t.length)]:[c,"",""]}async function L0(c,t){const{response:e,requestLogID:s,retryOfRequestLogID:a,startTime:o}=t,l=await(async()=>{if(t.options.stream)return ke(c).debug("response",e.status,e.url,e.headers,e.body),t.options.__streamClass?t.options.__streamClass.fromSSEResponse(e,t.controller,c):Qn.fromSSEResponse(e,t.controller,c);if(e.status===204)return null;if(t.options.__binaryResponse)return e;const d=e.headers.get("content-type")?.split(";")[0]?.trim();if(d?.includes("application/json")||d?.endsWith("+json")){const y=await e.json();return k0(y,e)}return await e.text()})();return ke(c).debug(`[${s}] response parsed`,Ai({retryOfRequestLogID:a,url:e.url,status:e.status,body:l,durationMs:Date.now()-o})),l}function k0(c,t){return!c||typeof c!="object"||Array.isArray(c)?c:Object.defineProperty(c,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}var $r;class Dc extends Promise{constructor(t,e,s=L0){super(a=>{a(null)}),this.responsePromise=e,this.parseResponse=s,$r.set(this,void 0),mt(this,$r,t)}_thenUnwrap(t){return new Dc(U(this,$r,"f"),this.responsePromise,async(e,s)=>k0(t(await this.parseResponse(e,s),s),s.response))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,e]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:e,request_id:e.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(U(this,$r,"f"),t))),this.parsedPromise}then(t,e){return this.parse().then(t,e)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}$r=new WeakMap;var Ul;class pf{constructor(t,e,s,a){Ul.set(this,void 0),mt(this,Ul,t),this.options=a,this.response=e,this.body=s}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const t=this.nextPageRequestOptions();if(!t)throw new ut("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await U(this,Ul,"f").requestAPIList(this.constructor,t)}async*iterPages(){let t=this;for(yield t;t.hasNextPage();)t=await t.getNextPage(),yield t}async*[(Ul=new WeakMap,Symbol.asyncIterator)](){for await(const t of this.iterPages())for(const e of t.getPaginatedItems())yield e}}class KS extends Dc{constructor(t,e,s){super(t,e,async(a,o)=>new s(a,o.response,await L0(a,o),o.options))}async*[Symbol.asyncIterator](){const t=await this;for await(const e of t)yield e}}class Oc extends pf{constructor(t,e,s,a){super(t,e,s,a),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class ge extends pf{constructor(t,e,s,a){super(t,e,s,a),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const t=this.getPaginatedItems(),e=t[t.length-1]?.id;return e?{...this.options,query:{...E0(this.options.query),after:e}}:null}}class fc extends pf{constructor(t,e,s,a){super(t,e,s,a),this.data=s.data||[],this.has_more=s.has_more||!1,this.last_id=s.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const t=this.last_id;return t?{...this.options,query:{...E0(this.options.query),after:t}}:null}}const B0=()=>{if(typeof File>"u"){const{process:c}=globalThis,t=typeof c?.versions?.node=="string"&&parseInt(c.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function to(c,t,e){return B0(),new File(c,t??"unknown_file",e)}function tc(c){return(typeof c=="object"&&c!==null&&("name"in c&&c.name&&String(c.name)||"url"in c&&c.url&&String(c.url)||"filename"in c&&c.filename&&String(c.filename)||"path"in c&&c.path&&String(c.path))||"").split(/[\\/]/).pop()||void 0}const mf=c=>c!=null&&typeof c=="object"&&typeof c[Symbol.asyncIterator]=="function",Sb=async(c,t)=>Fd(c.body)?{...c,body:await I0(c.body,t)}:c,Mi=async(c,t)=>({...c,body:await I0(c.body,t)}),Eb=new WeakMap;function WS(c){const t=typeof c=="function"?c:c.fetch,e=Eb.get(t);if(e)return e;const s=(async()=>{try{const a="Response"in t?t.Response:(await t("data:,")).constructor,o=new FormData;return o.toString()!==await new a(o).text()}catch{return!0}})();return Eb.set(t,s),s}const I0=async(c,t)=>{if(!await WS(t))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const e=new FormData;return await Promise.all(Object.entries(c||{}).map(([s,a])=>Ud(e,s,a))),e},P0=c=>c instanceof Blob&&"name"in c,QS=c=>typeof c=="object"&&c!==null&&(c instanceof Response||mf(c)||P0(c)),Fd=c=>{if(QS(c))return!0;if(Array.isArray(c))return c.some(Fd);if(c&&typeof c=="object"){for(const t in c)if(Fd(c[t]))return!0}return!1},Ud=async(c,t,e)=>{if(e!==void 0){if(e==null)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof e=="string"||typeof e=="number"||typeof e=="boolean")c.append(t,String(e));else if(e instanceof Response)c.append(t,to([await e.blob()],tc(e)));else if(mf(e))c.append(t,to([await new Response(T0(e)).blob()],tc(e)));else if(P0(e))c.append(t,e,tc(e));else if(Array.isArray(e))await Promise.all(e.map(s=>Ud(c,t+"[]",s)));else if(typeof e=="object")await Promise.all(Object.entries(e).map(([s,a])=>Ud(c,`${t}[${s}]`,a)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${e} instead`)}},F0=c=>c!=null&&typeof c=="object"&&typeof c.size=="number"&&typeof c.type=="string"&&typeof c.text=="function"&&typeof c.slice=="function"&&typeof c.arrayBuffer=="function",ZS=c=>c!=null&&typeof c=="object"&&typeof c.name=="string"&&typeof c.lastModified=="number"&&F0(c),JS=c=>c!=null&&typeof c=="object"&&typeof c.url=="string"&&typeof c.blob=="function";async function t1(c,t,e){if(B0(),c=await c,ZS(c))return c instanceof File?c:to([await c.arrayBuffer()],c.name);if(JS(c)){const a=await c.blob();return t||(t=new URL(c.url).pathname.split(/[\\/]/).pop()),to(await zd(a),t,e)}const s=await zd(c);if(t||(t=tc(c)),!e?.type){const a=s.find(o=>typeof o=="object"&&"type"in o&&o.type);typeof a=="string"&&(e={...e,type:a})}return to(s,t,e)}async function zd(c){let t=[];if(typeof c=="string"||ArrayBuffer.isView(c)||c instanceof ArrayBuffer)t.push(c);else if(F0(c))t.push(c instanceof Blob?c:await c.arrayBuffer());else if(mf(c))for await(const e of c)t.push(...await zd(e));else{const e=c?.constructor?.name;throw new Error(`Unexpected data type: ${typeof c}${e?`; constructor: ${e}`:""}${e1(c)}`)}return t}function e1(c){return typeof c!="object"||c===null?"":`; props: [${Object.getOwnPropertyNames(c).map(e=>`"${e}"`).join(", ")}]`}class ot{constructor(t){this._client=t}}function U0(c){return c.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const xb=Object.freeze(Object.create(null)),n1=(c=U0)=>function(e,...s){if(e.length===1)return e[0];let a=!1;const o=[],l=e.reduce((m,y,b)=>{/[?#]/.test(y)&&(a=!0);const v=s[b];let w=(a?encodeURIComponent:c)(""+v);return b!==s.length&&(v==null||typeof v=="object"&&v.toString===Object.getPrototypeOf(Object.getPrototypeOf(v.hasOwnProperty??xb)??xb)?.toString)&&(w=v+"",o.push({start:m.length+y.length,length:w.length,error:`Value of type ${Object.prototype.toString.call(v).slice(8,-1)} is not a valid path parameter`})),m+y+(b===s.length?"":w)},""),h=l.split(/[?#]/,1)[0],d=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let f;for(;(f=d.exec(h))!==null;)o.push({start:f.index,length:f[0].length,error:`Value "${f[0]}" can't be safely passed as a path parameter`});if(o.sort((m,y)=>m.start-y.start),o.length>0){let m=0;const y=o.reduce((b,v)=>{const w=" ".repeat(v.start-m),A="^".repeat(v.length);return m=v.start+v.length,b+w+A},"");throw new ut(`Path parameters result in path with invalid segments:
${o.map(b=>b.error).join(`
`)}
${l}
${y}`)}return l},Z=n1(U0);let z0=class extends ot{list(t,e={},s){return this._client.getAPIList(Z`/chat/completions/${t}/messages`,ge,{query:e,...s})}};function pc(c){return c!==void 0&&"function"in c&&c.function!==void 0}function gf(c){return c?.$brand==="auto-parseable-response-format"}function ho(c){return c?.$brand==="auto-parseable-tool"}function s1(c,t){return!t||!H0(t)?{...c,choices:c.choices.map(e=>(j0(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}:yf(c,t)}function yf(c,t){const e=c.choices.map(s=>{if(s.finish_reason==="length")throw new w0;if(s.finish_reason==="content_filter")throw new S0;return j0(s.message.tool_calls),{...s,message:{...s.message,...s.message.tool_calls?{tool_calls:s.message.tool_calls?.map(a=>a1(t,a))??void 0}:void 0,parsed:s.message.content&&!s.message.refusal?i1(t,s.message.content):null}}});return{...c,choices:e}}function i1(c,t){return c.response_format?.type!=="json_schema"?null:c.response_format?.type==="json_schema"?"$parseRaw"in c.response_format?c.response_format.$parseRaw(t):JSON.parse(t):null}function a1(c,t){const e=c.tools?.find(s=>pc(s)&&s.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:ho(e)?e.$parseRaw(t.function.arguments):e?.function.strict?JSON.parse(t.function.arguments):null}}}function r1(c,t){if(!c||!("tools"in c)||!c.tools)return!1;const e=c.tools?.find(s=>pc(s)&&s.function?.name===t.function.name);return pc(e)&&(ho(e)||e?.function.strict||!1)}function H0(c){return gf(c.response_format)?!0:c.tools?.some(t=>ho(t)||t.type==="function"&&t.function.strict===!0)??!1}function j0(c){for(const t of c||[])if(t.type!=="function")throw new ut(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}function o1(c){for(const t of c??[]){if(t.type!=="function")throw new ut(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(t.function.strict!==!0)throw new ut(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}const mc=c=>c?.role==="assistant",q0=c=>c?.role==="tool";var Hd,ec,nc,Gr,Xr,sc,Vr,vs,Yr,gc,yc,Ea,$0;class bf{constructor(){Hd.add(this),this.controller=new AbortController,ec.set(this,void 0),nc.set(this,()=>{}),Gr.set(this,()=>{}),Xr.set(this,void 0),sc.set(this,()=>{}),Vr.set(this,()=>{}),vs.set(this,{}),Yr.set(this,!1),gc.set(this,!1),yc.set(this,!1),Ea.set(this,!1),mt(this,ec,new Promise((t,e)=>{mt(this,nc,t,"f"),mt(this,Gr,e,"f")})),mt(this,Xr,new Promise((t,e)=>{mt(this,sc,t,"f"),mt(this,Vr,e,"f")})),U(this,ec,"f").catch(()=>{}),U(this,Xr,"f").catch(()=>{})}_run(t){setTimeout(()=>{t().then(()=>{this._emitFinal(),this._emit("end")},U(this,Hd,"m",$0).bind(this))},0)}_connected(){this.ended||(U(this,nc,"f").call(this),this._emit("connect"))}get ended(){return U(this,Yr,"f")}get errored(){return U(this,gc,"f")}get aborted(){return U(this,yc,"f")}abort(){this.controller.abort()}on(t,e){return(U(this,vs,"f")[t]||(U(this,vs,"f")[t]=[])).push({listener:e}),this}off(t,e){const s=U(this,vs,"f")[t];if(!s)return this;const a=s.findIndex(o=>o.listener===e);return a>=0&&s.splice(a,1),this}once(t,e){return(U(this,vs,"f")[t]||(U(this,vs,"f")[t]=[])).push({listener:e,once:!0}),this}emitted(t){return new Promise((e,s)=>{mt(this,Ea,!0),t!=="error"&&this.once("error",s),this.once(t,e)})}async done(){mt(this,Ea,!0),await U(this,Xr,"f")}_emit(t,...e){if(U(this,Yr,"f"))return;t==="end"&&(mt(this,Yr,!0),U(this,sc,"f").call(this));const s=U(this,vs,"f")[t];if(s&&(U(this,vs,"f")[t]=s.filter(a=>!a.once),s.forEach(({listener:a})=>a(...e))),t==="abort"){const a=e[0];!U(this,Ea,"f")&&!s?.length&&Promise.reject(a),U(this,Gr,"f").call(this,a),U(this,Vr,"f").call(this,a),this._emit("end");return}if(t==="error"){const a=e[0];!U(this,Ea,"f")&&!s?.length&&Promise.reject(a),U(this,Gr,"f").call(this,a),U(this,Vr,"f").call(this,a),this._emit("end")}}_emitFinal(){}}ec=new WeakMap,nc=new WeakMap,Gr=new WeakMap,Xr=new WeakMap,sc=new WeakMap,Vr=new WeakMap,vs=new WeakMap,Yr=new WeakMap,gc=new WeakMap,yc=new WeakMap,Ea=new WeakMap,Hd=new WeakSet,$0=function(t){if(mt(this,gc,!0),t instanceof Error&&t.name==="AbortError"&&(t=new Nn),t instanceof Nn)return mt(this,yc,!0),this._emit("abort",t);if(t instanceof ut)return this._emit("error",t);if(t instanceof Error){const e=new ut(t.message);return e.cause=t,this._emit("error",e)}return this._emit("error",new ut(String(t)))};function l1(c){return typeof c.parse=="function"}var ze,jd,bc,qd,$d,Gd,G0,X0;const c1=10;class V0 extends bf{constructor(){super(...arguments),ze.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(t){this._chatCompletions.push(t),this._emit("chatCompletion",t);const e=t.choices[0]?.message;return e&&this._addMessage(e),t}_addMessage(t,e=!0){if("content"in t||(t.content=null),this.messages.push(t),e){if(this._emit("message",t),q0(t)&&t.content)this._emit("functionToolCallResult",t.content);else if(mc(t)&&t.tool_calls)for(const s of t.tool_calls)s.type==="function"&&this._emit("functionToolCall",s.function)}}async finalChatCompletion(){await this.done();const t=this._chatCompletions[this._chatCompletions.length-1];if(!t)throw new ut("stream ended without producing a ChatCompletion");return t}async finalContent(){return await this.done(),U(this,ze,"m",jd).call(this)}async finalMessage(){return await this.done(),U(this,ze,"m",bc).call(this)}async finalFunctionToolCall(){return await this.done(),U(this,ze,"m",qd).call(this)}async finalFunctionToolCallResult(){return await this.done(),U(this,ze,"m",$d).call(this)}async totalUsage(){return await this.done(),U(this,ze,"m",Gd).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const t=this._chatCompletions[this._chatCompletions.length-1];t&&this._emit("finalChatCompletion",t);const e=U(this,ze,"m",bc).call(this);e&&this._emit("finalMessage",e);const s=U(this,ze,"m",jd).call(this);s&&this._emit("finalContent",s);const a=U(this,ze,"m",qd).call(this);a&&this._emit("finalFunctionToolCall",a);const o=U(this,ze,"m",$d).call(this);o!=null&&this._emit("finalFunctionToolCallResult",o),this._chatCompletions.some(l=>l.usage)&&this._emit("totalUsage",U(this,ze,"m",Gd).call(this))}async _createChatCompletion(t,e,s){const a=s?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),U(this,ze,"m",G0).call(this,e);const o=await t.chat.completions.create({...e,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(yf(o,e))}async _runChatCompletion(t,e,s){for(const a of e.messages)this._addMessage(a,!1);return await this._createChatCompletion(t,e,s)}async _runTools(t,e,s){const a="tool",{tool_choice:o="auto",stream:l,...h}=e,d=typeof o!="string"&&o.type==="function"&&o?.function?.name,{maxChatCompletions:f=c1}=s||{},m=e.tools.map(v=>{if(ho(v)){if(!v.$callback)throw new ut("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:v.$callback,name:v.function.name,description:v.function.description||"",parameters:v.function.parameters,parse:v.$parseRaw,strict:!0}}}return v}),y={};for(const v of m)v.type==="function"&&(y[v.function.name||v.function.function.name]=v.function);const b="tools"in e?m.map(v=>v.type==="function"?{type:"function",function:{name:v.function.name||v.function.function.name,parameters:v.function.parameters,description:v.function.description,strict:v.function.strict}}:v):void 0;for(const v of e.messages)this._addMessage(v,!1);for(let v=0;v<f;++v){const A=(await this._createChatCompletion(t,{...h,tool_choice:o,tools:b,messages:[...this.messages]},s)).choices[0]?.message;if(!A)throw new ut("missing message in ChatCompletion response");if(!A.tool_calls?.length)return;for(const x of A.tool_calls){if(x.type!=="function")continue;const S=x.id,{name:T,arguments:C}=x.function,N=y[T];if(N){if(d&&d!==T){const V=`Invalid tool_call: ${JSON.stringify(T)}. ${JSON.stringify(d)} requested. Please try again`;this._addMessage({role:a,tool_call_id:S,content:V});continue}}else{const V=`Invalid tool_call: ${JSON.stringify(T)}. Available options are: ${Object.keys(y).map(K=>JSON.stringify(K)).join(", ")}. Please try again`;this._addMessage({role:a,tool_call_id:S,content:V});continue}let D;try{D=l1(N)?await N.parse(C):C}catch(V){const K=V instanceof Error?V.message:String(V);this._addMessage({role:a,tool_call_id:S,content:K});continue}const L=await N.function(D,this),k=U(this,ze,"m",X0).call(this,L);if(this._addMessage({role:a,tool_call_id:S,content:k}),d)return}}}}ze=new WeakSet,jd=function(){return U(this,ze,"m",bc).call(this).content??null},bc=function(){let t=this.messages.length;for(;t-- >0;){const e=this.messages[t];if(mc(e))return{...e,content:e.content??null,refusal:e.refusal??null}}throw new ut("stream ended without producing a ChatCompletionMessage with role=assistant")},qd=function(){for(let t=this.messages.length-1;t>=0;t--){const e=this.messages[t];if(mc(e)&&e?.tool_calls?.length)return e.tool_calls.filter(s=>s.type==="function").at(-1)?.function}},$d=function(){for(let t=this.messages.length-1;t>=0;t--){const e=this.messages[t];if(q0(e)&&e.content!=null&&typeof e.content=="string"&&this.messages.some(s=>s.role==="assistant"&&s.tool_calls?.some(a=>a.type==="function"&&a.id===e.tool_call_id)))return e.content}},Gd=function(){const t={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:e}of this._chatCompletions)e&&(t.completion_tokens+=e.completion_tokens,t.prompt_tokens+=e.prompt_tokens,t.total_tokens+=e.total_tokens);return t},G0=function(t){if(t.n!=null&&t.n>1)throw new ut("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},X0=function(t){return typeof t=="string"?t:t===void 0?"undefined":JSON.stringify(t)};class vf extends V0{static runTools(t,e,s){const a=new vf,o={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(t,e,o)),a}_addMessage(t,e=!0){super._addMessage(t,e),mc(t)&&t.content&&this._emit("content",t.content)}}const Y0=1,K0=2,W0=4,Q0=8,Z0=16,J0=32,tv=64,ev=128,nv=256,sv=ev|nv,iv=Z0|J0|sv|tv,av=Y0|K0|iv,rv=W0|Q0,u1=av|rv,Te={STR:Y0,NUM:K0,ARR:W0,OBJ:Q0,NULL:Z0,BOOL:J0,NAN:tv,INFINITY:ev,MINUS_INFINITY:nv,INF:sv,SPECIAL:iv,ATOM:av,COLLECTION:rv,ALL:u1};class h1 extends Error{}class d1 extends Error{}function f1(c,t=Te.ALL){if(typeof c!="string")throw new TypeError(`expecting str, got ${typeof c}`);if(!c.trim())throw new Error(`${c} is empty`);return p1(c.trim(),t)}const p1=(c,t)=>{const e=c.length;let s=0;const a=b=>{throw new h1(`${b} at position ${s}`)},o=b=>{throw new d1(`${b} at position ${s}`)},l=()=>(y(),s>=e&&a("Unexpected end of input"),c[s]==='"'?h():c[s]==="{"?d():c[s]==="["?f():c.substring(s,s+4)==="null"||Te.NULL&t&&e-s<4&&"null".startsWith(c.substring(s))?(s+=4,null):c.substring(s,s+4)==="true"||Te.BOOL&t&&e-s<4&&"true".startsWith(c.substring(s))?(s+=4,!0):c.substring(s,s+5)==="false"||Te.BOOL&t&&e-s<5&&"false".startsWith(c.substring(s))?(s+=5,!1):c.substring(s,s+8)==="Infinity"||Te.INFINITY&t&&e-s<8&&"Infinity".startsWith(c.substring(s))?(s+=8,1/0):c.substring(s,s+9)==="-Infinity"||Te.MINUS_INFINITY&t&&1<e-s&&e-s<9&&"-Infinity".startsWith(c.substring(s))?(s+=9,-1/0):c.substring(s,s+3)==="NaN"||Te.NAN&t&&e-s<3&&"NaN".startsWith(c.substring(s))?(s+=3,NaN):m()),h=()=>{const b=s;let v=!1;for(s++;s<e&&(c[s]!=='"'||v&&c[s-1]==="\\");)v=c[s]==="\\"?!v:!1,s++;if(c.charAt(s)=='"')try{return JSON.parse(c.substring(b,++s-Number(v)))}catch(w){o(String(w))}else if(Te.STR&t)try{return JSON.parse(c.substring(b,s-Number(v))+'"')}catch{return JSON.parse(c.substring(b,c.lastIndexOf("\\"))+'"')}a("Unterminated string literal")},d=()=>{s++,y();const b={};try{for(;c[s]!=="}";){if(y(),s>=e&&Te.OBJ&t)return b;const v=h();y(),s++;try{const w=l();Object.defineProperty(b,v,{value:w,writable:!0,enumerable:!0,configurable:!0})}catch(w){if(Te.OBJ&t)return b;throw w}y(),c[s]===","&&s++}}catch{if(Te.OBJ&t)return b;a("Expected '}' at end of object")}return s++,b},f=()=>{s++;const b=[];try{for(;c[s]!=="]";)b.push(l()),y(),c[s]===","&&s++}catch{if(Te.ARR&t)return b;a("Expected ']' at end of array")}return s++,b},m=()=>{if(s===0){c==="-"&&Te.NUM&t&&a("Not sure what '-' is");try{return JSON.parse(c)}catch(v){if(Te.NUM&t)try{return c[c.length-1]==="."?JSON.parse(c.substring(0,c.lastIndexOf("."))):JSON.parse(c.substring(0,c.lastIndexOf("e")))}catch{}o(String(v))}}const b=s;for(c[s]==="-"&&s++;c[s]&&!",]}".includes(c[s]);)s++;s==e&&!(Te.NUM&t)&&a("Unterminated number literal");try{return JSON.parse(c.substring(b,s))}catch{c.substring(b,s)==="-"&&Te.NUM&t&&a("Not sure what '-' is");try{return JSON.parse(c.substring(b,c.lastIndexOf("e")))}catch(w){o(String(w))}}},y=()=>{for(;s<e&&` 
\r	`.includes(c[s]);)s++};return l()},Tb=c=>f1(c,Te.ALL^Te.NUM);var be,bs,va,Ks,vd,zl,_d,Ad,wd,Hl,Sd,Cb;class io extends V0{constructor(t){super(),be.add(this),bs.set(this,void 0),va.set(this,void 0),Ks.set(this,void 0),mt(this,bs,t),mt(this,va,[])}get currentChatCompletionSnapshot(){return U(this,Ks,"f")}static fromReadableStream(t){const e=new io(null);return e._run(()=>e._fromReadableStream(t)),e}static createChatCompletion(t,e,s){const a=new io(e);return a._run(()=>a._runChatCompletion(t,{...e,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createChatCompletion(t,e,s){super._createChatCompletion;const a=s?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),U(this,be,"m",vd).call(this);const o=await t.chat.completions.create({...e,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const l of o)U(this,be,"m",_d).call(this,l);if(o.controller.signal?.aborted)throw new Nn;return this._addChatCompletion(U(this,be,"m",Hl).call(this))}async _fromReadableStream(t,e){const s=e?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),U(this,be,"m",vd).call(this),this._connected();const a=Qn.fromReadableStream(t,this.controller);let o;for await(const l of a)o&&o!==l.id&&this._addChatCompletion(U(this,be,"m",Hl).call(this)),U(this,be,"m",_d).call(this,l),o=l.id;if(a.controller.signal?.aborted)throw new Nn;return this._addChatCompletion(U(this,be,"m",Hl).call(this))}[(bs=new WeakMap,va=new WeakMap,Ks=new WeakMap,be=new WeakSet,vd=function(){this.ended||mt(this,Ks,void 0)},zl=function(e){let s=U(this,va,"f")[e.index];return s||(s={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},U(this,va,"f")[e.index]=s,s)},_d=function(e){if(this.ended)return;const s=U(this,be,"m",Cb).call(this,e);this._emit("chunk",e,s);for(const a of e.choices){const o=s.choices[a.index];a.delta.content!=null&&o.message?.role==="assistant"&&o.message?.content&&(this._emit("content",a.delta.content,o.message.content),this._emit("content.delta",{delta:a.delta.content,snapshot:o.message.content,parsed:o.message.parsed})),a.delta.refusal!=null&&o.message?.role==="assistant"&&o.message?.refusal&&this._emit("refusal.delta",{delta:a.delta.refusal,snapshot:o.message.refusal}),a.logprobs?.content!=null&&o.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:a.logprobs?.content,snapshot:o.logprobs?.content??[]}),a.logprobs?.refusal!=null&&o.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:a.logprobs?.refusal,snapshot:o.logprobs?.refusal??[]});const l=U(this,be,"m",zl).call(this,o);o.finish_reason&&(U(this,be,"m",wd).call(this,o),l.current_tool_call_index!=null&&U(this,be,"m",Ad).call(this,o,l.current_tool_call_index));for(const h of a.delta.tool_calls??[])l.current_tool_call_index!==h.index&&(U(this,be,"m",wd).call(this,o),l.current_tool_call_index!=null&&U(this,be,"m",Ad).call(this,o,l.current_tool_call_index)),l.current_tool_call_index=h.index;for(const h of a.delta.tool_calls??[]){const d=o.message.tool_calls?.[h.index];d?.type&&(d?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:d.function?.name,index:h.index,arguments:d.function.arguments,parsed_arguments:d.function.parsed_arguments,arguments_delta:h.function?.arguments??""}):(d?.type,void 0))}}},Ad=function(e,s){if(U(this,be,"m",zl).call(this,e).done_tool_calls.has(s))return;const o=e.message.tool_calls?.[s];if(!o)throw new Error("no tool call snapshot");if(!o.type)throw new Error("tool call snapshot missing `type`");if(o.type==="function"){const l=U(this,bs,"f")?.tools?.find(h=>pc(h)&&h.function.name===o.function.name);this._emit("tool_calls.function.arguments.done",{name:o.function.name,index:s,arguments:o.function.arguments,parsed_arguments:ho(l)?l.$parseRaw(o.function.arguments):l?.function.strict?JSON.parse(o.function.arguments):null})}else o.type},wd=function(e){const s=U(this,be,"m",zl).call(this,e);if(e.message.content&&!s.content_done){s.content_done=!0;const a=U(this,be,"m",Sd).call(this);this._emit("content.done",{content:e.message.content,parsed:a?a.$parseRaw(e.message.content):null})}e.message.refusal&&!s.refusal_done&&(s.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!s.logprobs_content_done&&(s.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!s.logprobs_refusal_done&&(s.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},Hl=function(){if(this.ended)throw new ut("stream has ended, this shouldn't happen");const e=U(this,Ks,"f");if(!e)throw new ut("request ended without sending any chunks");return mt(this,Ks,void 0),mt(this,va,[]),m1(e,U(this,bs,"f"))},Sd=function(){const e=U(this,bs,"f")?.response_format;return gf(e)?e:null},Cb=function(e){var s,a,o,l;let h=U(this,Ks,"f");const{choices:d,...f}=e;h?Object.assign(h,f):h=mt(this,Ks,{...f,choices:[]});for(const{delta:m,finish_reason:y,index:b,logprobs:v=null,...w}of e.choices){let A=h.choices[b];if(A||(A=h.choices[b]={finish_reason:y,index:b,message:{},logprobs:v,...w}),v)if(!A.logprobs)A.logprobs=Object.assign({},v);else{const{content:L,refusal:k,...V}=v;Object.assign(A.logprobs,V),L&&((s=A.logprobs).content??(s.content=[]),A.logprobs.content.push(...L)),k&&((a=A.logprobs).refusal??(a.refusal=[]),A.logprobs.refusal.push(...k))}if(y&&(A.finish_reason=y,U(this,bs,"f")&&H0(U(this,bs,"f")))){if(y==="length")throw new w0;if(y==="content_filter")throw new S0}if(Object.assign(A,w),!m)continue;const{content:x,refusal:S,function_call:T,role:C,tool_calls:N,...D}=m;if(Object.assign(A.message,D),S&&(A.message.refusal=(A.message.refusal||"")+S),C&&(A.message.role=C),T&&(A.message.function_call?(T.name&&(A.message.function_call.name=T.name),T.arguments&&((o=A.message.function_call).arguments??(o.arguments=""),A.message.function_call.arguments+=T.arguments)):A.message.function_call=T),x&&(A.message.content=(A.message.content||"")+x,!A.message.refusal&&U(this,be,"m",Sd).call(this)&&(A.message.parsed=Tb(A.message.content))),N){A.message.tool_calls||(A.message.tool_calls=[]);for(const{index:L,id:k,type:V,function:K,...J}of N){const W=(l=A.message.tool_calls)[L]??(l[L]={});Object.assign(W,J),k&&(W.id=k),V&&(W.type=V),K&&(W.function??(W.function={name:K.name??"",arguments:""})),K?.name&&(W.function.name=K.name),K?.arguments&&(W.function.arguments+=K.arguments,r1(U(this,bs,"f"),W)&&(W.function.parsed_arguments=Tb(W.function.arguments)))}}}return h},Symbol.asyncIterator)](){const t=[],e=[];let s=!1;return this.on("chunk",a=>{const o=e.shift();o?o.resolve(a):t.push(a)}),this.on("end",()=>{s=!0;for(const a of e)a.resolve(void 0);e.length=0}),this.on("abort",a=>{s=!0;for(const o of e)o.reject(a);e.length=0}),this.on("error",a=>{s=!0;for(const o of e)o.reject(a);e.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((o,l)=>e.push({resolve:o,reject:l})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Qn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function m1(c,t){const{id:e,choices:s,created:a,model:o,system_fingerprint:l,...h}=c,d={...h,id:e,choices:s.map(({message:f,finish_reason:m,index:y,logprobs:b,...v})=>{if(!m)throw new ut(`missing finish_reason for choice ${y}`);const{content:w=null,function_call:A,tool_calls:x,...S}=f,T=f.role;if(!T)throw new ut(`missing role for choice ${y}`);if(A){const{arguments:C,name:N}=A;if(C==null)throw new ut(`missing function_call.arguments for choice ${y}`);if(!N)throw new ut(`missing function_call.name for choice ${y}`);return{...v,message:{content:w,function_call:{arguments:C,name:N},role:T,refusal:f.refusal??null},finish_reason:m,index:y,logprobs:b}}return x?{...v,index:y,finish_reason:m,logprobs:b,message:{...S,role:T,content:w,refusal:f.refusal??null,tool_calls:x.map((C,N)=>{const{function:D,type:L,id:k,...V}=C,{arguments:K,name:J,...W}=D||{};if(k==null)throw new ut(`missing choices[${y}].tool_calls[${N}].id
${jl(c)}`);if(L==null)throw new ut(`missing choices[${y}].tool_calls[${N}].type
${jl(c)}`);if(J==null)throw new ut(`missing choices[${y}].tool_calls[${N}].function.name
${jl(c)}`);if(K==null)throw new ut(`missing choices[${y}].tool_calls[${N}].function.arguments
${jl(c)}`);return{...V,id:k,type:L,function:{...W,name:J,arguments:K}}})}}:{...v,message:{...S,content:w,role:T,refusal:f.refusal??null},finish_reason:m,index:y,logprobs:b}}),created:a,model:o,object:"chat.completion",...l?{system_fingerprint:l}:{}};return s1(d,t)}function jl(c){return JSON.stringify(c)}class vc extends io{static fromReadableStream(t){const e=new vc(null);return e._run(()=>e._fromReadableStream(t)),e}static runTools(t,e,s){const a=new vc(e),o={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return a._run(()=>a._runTools(t,e,o)),a}}let _f=class extends ot{constructor(){super(...arguments),this.messages=new z0(this._client)}create(t,e){return this._client.post("/chat/completions",{body:t,...e,stream:t.stream??!1})}retrieve(t,e){return this._client.get(Z`/chat/completions/${t}`,e)}update(t,e,s){return this._client.post(Z`/chat/completions/${t}`,{body:e,...s})}list(t={},e){return this._client.getAPIList("/chat/completions",ge,{query:t,...e})}delete(t,e){return this._client.delete(Z`/chat/completions/${t}`,e)}parse(t,e){return o1(t.tools),this._client.chat.completions.create(t,{...e,headers:{...e?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(s=>yf(s,t))}runTools(t,e){return t.stream?vc.runTools(this._client,t,e):vf.runTools(this._client,t,e)}stream(t,e){return io.createChatCompletion(this._client,t,e)}};_f.Messages=z0;class Af extends ot{constructor(){super(...arguments),this.completions=new _f(this._client)}}Af.Completions=_f;const ov=Symbol("brand.privateNullableHeaders");function*g1(c){if(!c)return;if(ov in c){const{values:s,nulls:a}=c;yield*s.entries();for(const o of a)yield[o,null];return}let t=!1,e;c instanceof Headers?e=c.entries():hb(c)?e=c:(t=!0,e=Object.entries(c??{}));for(let s of e){const a=s[0];if(typeof a!="string")throw new TypeError("expected header name to be a string");const o=hb(s[1])?s[1]:[s[1]];let l=!1;for(const h of o)h!==void 0&&(t&&!l&&(l=!0,yield[a,null]),yield[a,h])}}const at=c=>{const t=new Headers,e=new Set;for(const s of c){const a=new Set;for(const[o,l]of g1(s)){const h=o.toLowerCase();a.has(h)||(t.delete(o),a.add(h)),l===null?(t.delete(o),e.add(h)):(t.append(o,l),e.delete(h))}}return{[ov]:!0,values:t,nulls:e}};class lv extends ot{create(t,e){return this._client.post("/audio/speech",{body:t,...e,headers:at([{Accept:"application/octet-stream"},e?.headers]),__binaryResponse:!0})}}class cv extends ot{create(t,e){return this._client.post("/audio/transcriptions",Mi({body:t,...e,stream:t.stream??!1,__metadata:{model:t.model}},this._client))}}class uv extends ot{create(t,e){return this._client.post("/audio/translations",Mi({body:t,...e,__metadata:{model:t.model}},this._client))}}class fo extends ot{constructor(){super(...arguments),this.transcriptions=new cv(this._client),this.translations=new uv(this._client),this.speech=new lv(this._client)}}fo.Transcriptions=cv;fo.Translations=uv;fo.Speech=lv;class hv extends ot{create(t,e){return this._client.post("/batches",{body:t,...e})}retrieve(t,e){return this._client.get(Z`/batches/${t}`,e)}list(t={},e){return this._client.getAPIList("/batches",ge,{query:t,...e})}cancel(t,e){return this._client.post(Z`/batches/${t}/cancel`,e)}}class dv extends ot{create(t,e){return this._client.post("/assistants",{body:t,...e,headers:at([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}retrieve(t,e){return this._client.get(Z`/assistants/${t}`,{...e,headers:at([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}update(t,e,s){return this._client.post(Z`/assistants/${t}`,{body:e,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(t={},e){return this._client.getAPIList("/assistants",ge,{query:t,...e,headers:at([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}delete(t,e){return this._client.delete(Z`/assistants/${t}`,{...e,headers:at([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}}let fv=class extends ot{create(t,e){return this._client.post("/realtime/sessions",{body:t,...e,headers:at([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}};class pv extends ot{create(t,e){return this._client.post("/realtime/transcription_sessions",{body:t,...e,headers:at([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}}let Nc=class extends ot{constructor(){super(...arguments),this.sessions=new fv(this._client),this.transcriptionSessions=new pv(this._client)}};Nc.Sessions=fv;Nc.TranscriptionSessions=pv;class mv extends ot{create(t,e){return this._client.post("/chatkit/sessions",{body:t,...e,headers:at([{"OpenAI-Beta":"chatkit_beta=v1"},e?.headers])})}cancel(t,e){return this._client.post(Z`/chatkit/sessions/${t}/cancel`,{...e,headers:at([{"OpenAI-Beta":"chatkit_beta=v1"},e?.headers])})}}let gv=class extends ot{retrieve(t,e){return this._client.get(Z`/chatkit/threads/${t}`,{...e,headers:at([{"OpenAI-Beta":"chatkit_beta=v1"},e?.headers])})}list(t={},e){return this._client.getAPIList("/chatkit/threads",fc,{query:t,...e,headers:at([{"OpenAI-Beta":"chatkit_beta=v1"},e?.headers])})}delete(t,e){return this._client.delete(Z`/chatkit/threads/${t}`,{...e,headers:at([{"OpenAI-Beta":"chatkit_beta=v1"},e?.headers])})}listItems(t,e={},s){return this._client.getAPIList(Z`/chatkit/threads/${t}/items`,fc,{query:e,...s,headers:at([{"OpenAI-Beta":"chatkit_beta=v1"},s?.headers])})}};class Lc extends ot{constructor(){super(...arguments),this.sessions=new mv(this._client),this.threads=new gv(this._client)}}Lc.Sessions=mv;Lc.Threads=gv;class yv extends ot{create(t,e,s){return this._client.post(Z`/threads/${t}/messages`,{body:e,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(t,e,s){const{thread_id:a}=e;return this._client.get(Z`/threads/${a}/messages/${t}`,{...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(t,e,s){const{thread_id:a,...o}=e;return this._client.post(Z`/threads/${a}/messages/${t}`,{body:o,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(t,e={},s){return this._client.getAPIList(Z`/threads/${t}/messages`,ge,{query:e,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(t,e,s){const{thread_id:a}=e;return this._client.delete(Z`/threads/${a}/messages/${t}`,{...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class bv extends ot{retrieve(t,e,s){const{thread_id:a,run_id:o,...l}=e;return this._client.get(Z`/threads/${a}/runs/${o}/steps/${t}`,{query:l,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(t,e,s){const{thread_id:a,...o}=e;return this._client.getAPIList(Z`/threads/${a}/runs/${t}/steps`,ge,{query:o,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}const y1=c=>{if(typeof Buffer<"u"){const t=Buffer.from(c,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}else{const t=atob(c),e=t.length,s=new Uint8Array(e);for(let a=0;a<e;a++)s[a]=t.charCodeAt(a);return Array.from(new Float32Array(s.buffer))}};var b1={};const _a=c=>{if(typeof globalThis.process<"u")return b1?.[c]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(c)?.trim()};var Be,Si,Xd,Kn,ic,Pn,Ei,Ma,wi,_c,mn,ac,rc,eo,Kr,Wr,Rb,Mb,Db,Ob,Nb,Lb,kb;class no extends bf{constructor(){super(...arguments),Be.add(this),Xd.set(this,[]),Kn.set(this,{}),ic.set(this,{}),Pn.set(this,void 0),Ei.set(this,void 0),Ma.set(this,void 0),wi.set(this,void 0),_c.set(this,void 0),mn.set(this,void 0),ac.set(this,void 0),rc.set(this,void 0),eo.set(this,void 0)}[(Xd=new WeakMap,Kn=new WeakMap,ic=new WeakMap,Pn=new WeakMap,Ei=new WeakMap,Ma=new WeakMap,wi=new WeakMap,_c=new WeakMap,mn=new WeakMap,ac=new WeakMap,rc=new WeakMap,eo=new WeakMap,Be=new WeakSet,Symbol.asyncIterator)](){const t=[],e=[];let s=!1;return this.on("event",a=>{const o=e.shift();o?o.resolve(a):t.push(a)}),this.on("end",()=>{s=!0;for(const a of e)a.resolve(void 0);e.length=0}),this.on("abort",a=>{s=!0;for(const o of e)o.reject(a);e.length=0}),this.on("error",a=>{s=!0;for(const o of e)o.reject(a);e.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((o,l)=>e.push({resolve:o,reject:l})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(t){const e=new Si;return e._run(()=>e._fromReadableStream(t)),e}async _fromReadableStream(t,e){const s=e?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();const a=Qn.fromReadableStream(t,this.controller);for await(const o of a)U(this,Be,"m",Kr).call(this,o);if(a.controller.signal?.aborted)throw new Nn;return this._addRun(U(this,Be,"m",Wr).call(this))}toReadableStream(){return new Qn(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(t,e,s,a){const o=new Si;return o._run(()=>o._runToolAssistantStream(t,e,s,{...a,headers:{...a?.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createToolAssistantStream(t,e,s,a){const o=a?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const l={...s,stream:!0},h=await t.submitToolOutputs(e,l,{...a,signal:this.controller.signal});this._connected();for await(const d of h)U(this,Be,"m",Kr).call(this,d);if(h.controller.signal?.aborted)throw new Nn;return this._addRun(U(this,Be,"m",Wr).call(this))}static createThreadAssistantStream(t,e,s){const a=new Si;return a._run(()=>a._threadAssistantStream(t,e,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),a}static createAssistantStream(t,e,s,a){const o=new Si;return o._run(()=>o._runAssistantStream(t,e,s,{...a,headers:{...a?.headers,"X-Stainless-Helper-Method":"stream"}})),o}currentEvent(){return U(this,ac,"f")}currentRun(){return U(this,rc,"f")}currentMessageSnapshot(){return U(this,Pn,"f")}currentRunStepSnapshot(){return U(this,eo,"f")}async finalRunSteps(){return await this.done(),Object.values(U(this,Kn,"f"))}async finalMessages(){return await this.done(),Object.values(U(this,ic,"f"))}async finalRun(){if(await this.done(),!U(this,Ei,"f"))throw Error("Final run was not received.");return U(this,Ei,"f")}async _createThreadAssistantStream(t,e,s){const a=s?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...e,stream:!0},l=await t.createAndRun(o,{...s,signal:this.controller.signal});this._connected();for await(const h of l)U(this,Be,"m",Kr).call(this,h);if(l.controller.signal?.aborted)throw new Nn;return this._addRun(U(this,Be,"m",Wr).call(this))}async _createAssistantStream(t,e,s,a){const o=a?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const l={...s,stream:!0},h=await t.create(e,l,{...a,signal:this.controller.signal});this._connected();for await(const d of h)U(this,Be,"m",Kr).call(this,d);if(h.controller.signal?.aborted)throw new Nn;return this._addRun(U(this,Be,"m",Wr).call(this))}static accumulateDelta(t,e){for(const[s,a]of Object.entries(e)){if(!t.hasOwnProperty(s)){t[s]=a;continue}let o=t[s];if(o==null){t[s]=a;continue}if(s==="index"||s==="type"){t[s]=a;continue}if(typeof o=="string"&&typeof a=="string")o+=a;else if(typeof o=="number"&&typeof a=="number")o+=a;else if(gd(o)&&gd(a))o=this.accumulateDelta(o,a);else if(Array.isArray(o)&&Array.isArray(a)){if(o.every(l=>typeof l=="string"||typeof l=="number")){o.push(...a);continue}for(const l of a){if(!gd(l))throw new Error(`Expected array delta entry to be an object but got: ${l}`);const h=l.index;if(h==null)throw console.error(l),new Error("Expected array delta entry to have an `index` property");if(typeof h!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${h}`);const d=o[h];d==null?o.push(l):o[h]=this.accumulateDelta(d,l)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${a}, accValue: ${o}`);t[s]=o}return t}_addRun(t){return t}async _threadAssistantStream(t,e,s){return await this._createThreadAssistantStream(e,t,s)}async _runAssistantStream(t,e,s,a){return await this._createAssistantStream(e,t,s,a)}async _runToolAssistantStream(t,e,s,a){return await this._createToolAssistantStream(e,t,s,a)}}Si=no,Kr=function(t){if(!this.ended)switch(mt(this,ac,t),U(this,Be,"m",Db).call(this,t),t.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":U(this,Be,"m",kb).call(this,t);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":U(this,Be,"m",Mb).call(this,t);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":U(this,Be,"m",Rb).call(this,t);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Wr=function(){if(this.ended)throw new ut("stream has ended, this shouldn't happen");if(!U(this,Ei,"f"))throw Error("Final run has not been received");return U(this,Ei,"f")},Rb=function(t){const[e,s]=U(this,Be,"m",Nb).call(this,t,U(this,Pn,"f"));mt(this,Pn,e),U(this,ic,"f")[e.id]=e;for(const a of s){const o=e.content[a.index];o?.type=="text"&&this._emit("textCreated",o.text)}switch(t.event){case"thread.message.created":this._emit("messageCreated",t.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",t.data.delta,e),t.data.delta.content)for(const a of t.data.delta.content){if(a.type=="text"&&a.text){let o=a.text,l=e.content[a.index];if(l&&l.type=="text")this._emit("textDelta",o,l.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(a.index!=U(this,Ma,"f")){if(U(this,wi,"f"))switch(U(this,wi,"f").type){case"text":this._emit("textDone",U(this,wi,"f").text,U(this,Pn,"f"));break;case"image_file":this._emit("imageFileDone",U(this,wi,"f").image_file,U(this,Pn,"f"));break}mt(this,Ma,a.index)}mt(this,wi,e.content[a.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(U(this,Ma,"f")!==void 0){const a=t.data.content[U(this,Ma,"f")];if(a)switch(a.type){case"image_file":this._emit("imageFileDone",a.image_file,U(this,Pn,"f"));break;case"text":this._emit("textDone",a.text,U(this,Pn,"f"));break}}U(this,Pn,"f")&&this._emit("messageDone",t.data),mt(this,Pn,void 0)}},Mb=function(t){const e=U(this,Be,"m",Ob).call(this,t);switch(mt(this,eo,e),t.event){case"thread.run.step.created":this._emit("runStepCreated",t.data);break;case"thread.run.step.delta":const s=t.data.delta;if(s.step_details&&s.step_details.type=="tool_calls"&&s.step_details.tool_calls&&e.step_details.type=="tool_calls")for(const o of s.step_details.tool_calls)o.index==U(this,_c,"f")?this._emit("toolCallDelta",o,e.step_details.tool_calls[o.index]):(U(this,mn,"f")&&this._emit("toolCallDone",U(this,mn,"f")),mt(this,_c,o.index),mt(this,mn,e.step_details.tool_calls[o.index]),U(this,mn,"f")&&this._emit("toolCallCreated",U(this,mn,"f")));this._emit("runStepDelta",t.data.delta,e);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":mt(this,eo,void 0),t.data.step_details.type=="tool_calls"&&U(this,mn,"f")&&(this._emit("toolCallDone",U(this,mn,"f")),mt(this,mn,void 0)),this._emit("runStepDone",t.data,e);break}},Db=function(t){U(this,Xd,"f").push(t),this._emit("event",t)},Ob=function(t){switch(t.event){case"thread.run.step.created":return U(this,Kn,"f")[t.data.id]=t.data,t.data;case"thread.run.step.delta":let e=U(this,Kn,"f")[t.data.id];if(!e)throw Error("Received a RunStepDelta before creation of a snapshot");let s=t.data;if(s.delta){const a=Si.accumulateDelta(e,s.delta);U(this,Kn,"f")[t.data.id]=a}return U(this,Kn,"f")[t.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":U(this,Kn,"f")[t.data.id]=t.data;break}if(U(this,Kn,"f")[t.data.id])return U(this,Kn,"f")[t.data.id];throw new Error("No snapshot available")},Nb=function(t,e){let s=[];switch(t.event){case"thread.message.created":return[t.data,s];case"thread.message.delta":if(!e)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let a=t.data;if(a.delta.content)for(const o of a.delta.content)if(o.index in e.content){let l=e.content[o.index];e.content[o.index]=U(this,Be,"m",Lb).call(this,o,l)}else e.content[o.index]=o,s.push(o);return[e,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(e)return[e,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Lb=function(t,e){return Si.accumulateDelta(e,t)},kb=function(t){switch(mt(this,rc,t.data),t.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":mt(this,Ei,t.data),U(this,mn,"f")&&(this._emit("toolCallDone",U(this,mn,"f")),mt(this,mn,void 0));break}};let wf=class extends ot{constructor(){super(...arguments),this.steps=new bv(this._client)}create(t,e,s){const{include:a,...o}=e;return this._client.post(Z`/threads/${t}/runs`,{query:{include:a},body:o,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:e.stream??!1})}retrieve(t,e,s){const{thread_id:a}=e;return this._client.get(Z`/threads/${a}/runs/${t}`,{...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(t,e,s){const{thread_id:a,...o}=e;return this._client.post(Z`/threads/${a}/runs/${t}`,{body:o,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(t,e={},s){return this._client.getAPIList(Z`/threads/${t}/runs`,ge,{query:e,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(t,e,s){const{thread_id:a}=e;return this._client.post(Z`/threads/${a}/runs/${t}/cancel`,{...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(t,e,s){const a=await this.create(t,e,s);return await this.poll(a.id,{thread_id:t},s)}createAndStream(t,e,s){return no.createAssistantStream(t,this._client.beta.threads.runs,e,s)}async poll(t,e,s){const a=at([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:o,response:l}=await this.retrieve(t,e,{...s,headers:{...s?.headers,...a}}).withResponse();switch(o.status){case"queued":case"in_progress":case"cancelling":let h=5e3;if(s?.pollIntervalMs)h=s.pollIntervalMs;else{const d=l.headers.get("openai-poll-after-ms");if(d){const f=parseInt(d);isNaN(f)||(h=f)}}await uo(h);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return o}}}stream(t,e,s){return no.createAssistantStream(t,this._client.beta.threads.runs,e,s)}submitToolOutputs(t,e,s){const{thread_id:a,...o}=e;return this._client.post(Z`/threads/${a}/runs/${t}/submit_tool_outputs`,{body:o,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:e.stream??!1})}async submitToolOutputsAndPoll(t,e,s){const a=await this.submitToolOutputs(t,e,s);return await this.poll(a.id,e,s)}submitToolOutputsStream(t,e,s){return no.createToolAssistantStream(t,this._client.beta.threads.runs,e,s)}};wf.Steps=bv;class kc extends ot{constructor(){super(...arguments),this.runs=new wf(this._client),this.messages=new yv(this._client)}create(t={},e){return this._client.post("/threads",{body:t,...e,headers:at([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}retrieve(t,e){return this._client.get(Z`/threads/${t}`,{...e,headers:at([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}update(t,e,s){return this._client.post(Z`/threads/${t}`,{body:e,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(t,e){return this._client.delete(Z`/threads/${t}`,{...e,headers:at([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}createAndRun(t,e){return this._client.post("/threads/runs",{body:t,...e,headers:at([{"OpenAI-Beta":"assistants=v2"},e?.headers]),stream:t.stream??!1})}async createAndRunPoll(t,e){const s=await this.createAndRun(t,e);return await this.runs.poll(s.id,{thread_id:s.thread_id},e)}createAndRunStream(t,e){return no.createThreadAssistantStream(t,this._client.beta.threads,e)}}kc.Runs=wf;kc.Messages=yv;class Ua extends ot{constructor(){super(...arguments),this.realtime=new Nc(this._client),this.chatkit=new Lc(this._client),this.assistants=new dv(this._client),this.threads=new kc(this._client)}}Ua.Realtime=Nc;Ua.ChatKit=Lc;Ua.Assistants=dv;Ua.Threads=kc;class vv extends ot{create(t,e){return this._client.post("/completions",{body:t,...e,stream:t.stream??!1})}}class _v extends ot{retrieve(t,e,s){const{container_id:a}=e;return this._client.get(Z`/containers/${a}/files/${t}/content`,{...s,headers:at([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}}let Sf=class extends ot{constructor(){super(...arguments),this.content=new _v(this._client)}create(t,e,s){return this._client.post(Z`/containers/${t}/files`,Mi({body:e,...s},this._client))}retrieve(t,e,s){const{container_id:a}=e;return this._client.get(Z`/containers/${a}/files/${t}`,s)}list(t,e={},s){return this._client.getAPIList(Z`/containers/${t}/files`,ge,{query:e,...s})}delete(t,e,s){const{container_id:a}=e;return this._client.delete(Z`/containers/${a}/files/${t}`,{...s,headers:at([{Accept:"*/*"},s?.headers])})}};Sf.Content=_v;class Ef extends ot{constructor(){super(...arguments),this.files=new Sf(this._client)}create(t,e){return this._client.post("/containers",{body:t,...e})}retrieve(t,e){return this._client.get(Z`/containers/${t}`,e)}list(t={},e){return this._client.getAPIList("/containers",ge,{query:t,...e})}delete(t,e){return this._client.delete(Z`/containers/${t}`,{...e,headers:at([{Accept:"*/*"},e?.headers])})}}Ef.Files=Sf;class Av extends ot{create(t,e,s){const{include:a,...o}=e;return this._client.post(Z`/conversations/${t}/items`,{query:{include:a},body:o,...s})}retrieve(t,e,s){const{conversation_id:a,...o}=e;return this._client.get(Z`/conversations/${a}/items/${t}`,{query:o,...s})}list(t,e={},s){return this._client.getAPIList(Z`/conversations/${t}/items`,fc,{query:e,...s})}delete(t,e,s){const{conversation_id:a}=e;return this._client.delete(Z`/conversations/${a}/items/${t}`,s)}}class xf extends ot{constructor(){super(...arguments),this.items=new Av(this._client)}create(t={},e){return this._client.post("/conversations",{body:t,...e})}retrieve(t,e){return this._client.get(Z`/conversations/${t}`,e)}update(t,e,s){return this._client.post(Z`/conversations/${t}`,{body:e,...s})}delete(t,e){return this._client.delete(Z`/conversations/${t}`,e)}}xf.Items=Av;class wv extends ot{create(t,e){const s=!!t.encoding_format;let a=s?t.encoding_format:"base64";s&&ke(this._client).debug("embeddings/user defined encoding_format:",t.encoding_format);const o=this._client.post("/embeddings",{body:{...t,encoding_format:a},...e});return s?o:(ke(this._client).debug("embeddings/decoding base64 embeddings from base64"),o._thenUnwrap(l=>(l&&l.data&&l.data.forEach(h=>{const d=h.embedding;h.embedding=y1(d)}),l)))}}class Sv extends ot{retrieve(t,e,s){const{eval_id:a,run_id:o}=e;return this._client.get(Z`/evals/${a}/runs/${o}/output_items/${t}`,s)}list(t,e,s){const{eval_id:a,...o}=e;return this._client.getAPIList(Z`/evals/${a}/runs/${t}/output_items`,ge,{query:o,...s})}}class Tf extends ot{constructor(){super(...arguments),this.outputItems=new Sv(this._client)}create(t,e,s){return this._client.post(Z`/evals/${t}/runs`,{body:e,...s})}retrieve(t,e,s){const{eval_id:a}=e;return this._client.get(Z`/evals/${a}/runs/${t}`,s)}list(t,e={},s){return this._client.getAPIList(Z`/evals/${t}/runs`,ge,{query:e,...s})}delete(t,e,s){const{eval_id:a}=e;return this._client.delete(Z`/evals/${a}/runs/${t}`,s)}cancel(t,e,s){const{eval_id:a}=e;return this._client.post(Z`/evals/${a}/runs/${t}`,s)}}Tf.OutputItems=Sv;class Cf extends ot{constructor(){super(...arguments),this.runs=new Tf(this._client)}create(t,e){return this._client.post("/evals",{body:t,...e})}retrieve(t,e){return this._client.get(Z`/evals/${t}`,e)}update(t,e,s){return this._client.post(Z`/evals/${t}`,{body:e,...s})}list(t={},e){return this._client.getAPIList("/evals",ge,{query:t,...e})}delete(t,e){return this._client.delete(Z`/evals/${t}`,e)}}Cf.Runs=Tf;let Ev=class extends ot{create(t,e){return this._client.post("/files",Mi({body:t,...e},this._client))}retrieve(t,e){return this._client.get(Z`/files/${t}`,e)}list(t={},e){return this._client.getAPIList("/files",ge,{query:t,...e})}delete(t,e){return this._client.delete(Z`/files/${t}`,e)}content(t,e){return this._client.get(Z`/files/${t}/content`,{...e,headers:at([{Accept:"application/binary"},e?.headers]),__binaryResponse:!0})}async waitForProcessing(t,{pollInterval:e=5e3,maxWait:s=1800*1e3}={}){const a=new Set(["processed","error","deleted"]),o=Date.now();let l=await this.retrieve(t);for(;!l.status||!a.has(l.status);)if(await uo(e),l=await this.retrieve(t),Date.now()-o>s)throw new df({message:`Giving up on waiting for file ${t} to finish processing after ${s} milliseconds.`});return l}};class xv extends ot{}let Tv=class extends ot{run(t,e){return this._client.post("/fine_tuning/alpha/graders/run",{body:t,...e})}validate(t,e){return this._client.post("/fine_tuning/alpha/graders/validate",{body:t,...e})}};class Rf extends ot{constructor(){super(...arguments),this.graders=new Tv(this._client)}}Rf.Graders=Tv;class Cv extends ot{create(t,e,s){return this._client.getAPIList(Z`/fine_tuning/checkpoints/${t}/permissions`,Oc,{body:e,method:"post",...s})}retrieve(t,e={},s){return this._client.get(Z`/fine_tuning/checkpoints/${t}/permissions`,{query:e,...s})}delete(t,e,s){const{fine_tuned_model_checkpoint:a}=e;return this._client.delete(Z`/fine_tuning/checkpoints/${a}/permissions/${t}`,s)}}let Mf=class extends ot{constructor(){super(...arguments),this.permissions=new Cv(this._client)}};Mf.Permissions=Cv;class Rv extends ot{list(t,e={},s){return this._client.getAPIList(Z`/fine_tuning/jobs/${t}/checkpoints`,ge,{query:e,...s})}}class Df extends ot{constructor(){super(...arguments),this.checkpoints=new Rv(this._client)}create(t,e){return this._client.post("/fine_tuning/jobs",{body:t,...e})}retrieve(t,e){return this._client.get(Z`/fine_tuning/jobs/${t}`,e)}list(t={},e){return this._client.getAPIList("/fine_tuning/jobs",ge,{query:t,...e})}cancel(t,e){return this._client.post(Z`/fine_tuning/jobs/${t}/cancel`,e)}listEvents(t,e={},s){return this._client.getAPIList(Z`/fine_tuning/jobs/${t}/events`,ge,{query:e,...s})}pause(t,e){return this._client.post(Z`/fine_tuning/jobs/${t}/pause`,e)}resume(t,e){return this._client.post(Z`/fine_tuning/jobs/${t}/resume`,e)}}Df.Checkpoints=Rv;class za extends ot{constructor(){super(...arguments),this.methods=new xv(this._client),this.jobs=new Df(this._client),this.checkpoints=new Mf(this._client),this.alpha=new Rf(this._client)}}za.Methods=xv;za.Jobs=Df;za.Checkpoints=Mf;za.Alpha=Rf;class Mv extends ot{}class Of extends ot{constructor(){super(...arguments),this.graderModels=new Mv(this._client)}}Of.GraderModels=Mv;class Dv extends ot{createVariation(t,e){return this._client.post("/images/variations",Mi({body:t,...e},this._client))}edit(t,e){return this._client.post("/images/edits",Mi({body:t,...e,stream:t.stream??!1},this._client))}generate(t,e){return this._client.post("/images/generations",{body:t,...e,stream:t.stream??!1})}}class Ov extends ot{retrieve(t,e){return this._client.get(Z`/models/${t}`,e)}list(t){return this._client.getAPIList("/models",Oc,t)}delete(t,e){return this._client.delete(Z`/models/${t}`,e)}}class Nv extends ot{create(t,e){return this._client.post("/moderations",{body:t,...e})}}class Lv extends ot{accept(t,e,s){return this._client.post(Z`/realtime/calls/${t}/accept`,{body:e,...s,headers:at([{Accept:"*/*"},s?.headers])})}hangup(t,e){return this._client.post(Z`/realtime/calls/${t}/hangup`,{...e,headers:at([{Accept:"*/*"},e?.headers])})}refer(t,e,s){return this._client.post(Z`/realtime/calls/${t}/refer`,{body:e,...s,headers:at([{Accept:"*/*"},s?.headers])})}reject(t,e={},s){return this._client.post(Z`/realtime/calls/${t}/reject`,{body:e,...s,headers:at([{Accept:"*/*"},s?.headers])})}}class kv extends ot{create(t,e){return this._client.post("/realtime/client_secrets",{body:t,...e})}}class Bc extends ot{constructor(){super(...arguments),this.clientSecrets=new kv(this._client),this.calls=new Lv(this._client)}}Bc.ClientSecrets=kv;Bc.Calls=Lv;function v1(c,t){return!t||!A1(t)?{...c,output_parsed:null,output:c.output.map(e=>e.type==="function_call"?{...e,parsed_arguments:null}:e.type==="message"?{...e,content:e.content.map(s=>({...s,parsed:null}))}:e)}:Bv(c,t)}function Bv(c,t){const e=c.output.map(a=>{if(a.type==="function_call")return{...a,parsed_arguments:E1(t,a)};if(a.type==="message"){const o=a.content.map(l=>l.type==="output_text"?{...l,parsed:_1(t,l.text)}:l);return{...a,content:o}}return a}),s=Object.assign({},c,{output:e});return Object.getOwnPropertyDescriptor(c,"output_text")||Vd(s),Object.defineProperty(s,"output_parsed",{enumerable:!0,get(){for(const a of s.output)if(a.type==="message"){for(const o of a.content)if(o.type==="output_text"&&o.parsed!==null)return o.parsed}return null}}),s}function _1(c,t){return c.text?.format?.type!=="json_schema"?null:"$parseRaw"in c.text?.format?(c.text?.format).$parseRaw(t):JSON.parse(t)}function A1(c){return!!gf(c.text?.format)}function w1(c){return c?.$brand==="auto-parseable-tool"}function S1(c,t){return c.find(e=>e.type==="function"&&e.name===t)}function E1(c,t){const e=S1(c.tools??[],t.name);return{...t,...t,parsed_arguments:w1(e)?e.$parseRaw(t.arguments):e?.strict?JSON.parse(t.arguments):null}}function Vd(c){const t=[];for(const e of c.output)if(e.type==="message")for(const s of e.content)s.type==="output_text"&&t.push(s.text);c.output_text=t.join("")}var Aa,ql,Ws,$l,Bb,Ib,Pb,Fb;class Nf extends bf{constructor(t){super(),Aa.add(this),ql.set(this,void 0),Ws.set(this,void 0),$l.set(this,void 0),mt(this,ql,t)}static createResponse(t,e,s){const a=new Nf(e);return a._run(()=>a._createOrRetrieveResponse(t,e,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createOrRetrieveResponse(t,e,s){const a=s?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort())),U(this,Aa,"m",Bb).call(this);let o,l=null;"response_id"in e?(o=await t.responses.retrieve(e.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),l=e.starting_after??null):o=await t.responses.create({...e,stream:!0},{...s,signal:this.controller.signal}),this._connected();for await(const h of o)U(this,Aa,"m",Ib).call(this,h,l);if(o.controller.signal?.aborted)throw new Nn;return U(this,Aa,"m",Pb).call(this)}[(ql=new WeakMap,Ws=new WeakMap,$l=new WeakMap,Aa=new WeakSet,Bb=function(){this.ended||mt(this,Ws,void 0)},Ib=function(e,s){if(this.ended)return;const a=(l,h)=>{(s==null||h.sequence_number>s)&&this._emit(l,h)},o=U(this,Aa,"m",Fb).call(this,e);switch(a("event",e),e.type){case"response.output_text.delta":{const l=o.output[e.output_index];if(!l)throw new ut(`missing output at index ${e.output_index}`);if(l.type==="message"){const h=l.content[e.content_index];if(!h)throw new ut(`missing content at index ${e.content_index}`);if(h.type!=="output_text")throw new ut(`expected content to be 'output_text', got ${h.type}`);a("response.output_text.delta",{...e,snapshot:h.text})}break}case"response.function_call_arguments.delta":{const l=o.output[e.output_index];if(!l)throw new ut(`missing output at index ${e.output_index}`);l.type==="function_call"&&a("response.function_call_arguments.delta",{...e,snapshot:l.arguments});break}default:a(e.type,e);break}},Pb=function(){if(this.ended)throw new ut("stream has ended, this shouldn't happen");const e=U(this,Ws,"f");if(!e)throw new ut("request ended without sending any events");mt(this,Ws,void 0);const s=x1(e,U(this,ql,"f"));return mt(this,$l,s),s},Fb=function(e){let s=U(this,Ws,"f");if(!s){if(e.type!=="response.created")throw new ut(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return s=mt(this,Ws,e.response),s}switch(e.type){case"response.output_item.added":{s.output.push(e.item);break}case"response.content_part.added":{const a=s.output[e.output_index];if(!a)throw new ut(`missing output at index ${e.output_index}`);const o=a.type,l=e.part;o==="message"&&l.type!=="reasoning_text"?a.content.push(l):o==="reasoning"&&l.type==="reasoning_text"&&(a.content||(a.content=[]),a.content.push(l));break}case"response.output_text.delta":{const a=s.output[e.output_index];if(!a)throw new ut(`missing output at index ${e.output_index}`);if(a.type==="message"){const o=a.content[e.content_index];if(!o)throw new ut(`missing content at index ${e.content_index}`);if(o.type!=="output_text")throw new ut(`expected content to be 'output_text', got ${o.type}`);o.text+=e.delta}break}case"response.function_call_arguments.delta":{const a=s.output[e.output_index];if(!a)throw new ut(`missing output at index ${e.output_index}`);a.type==="function_call"&&(a.arguments+=e.delta);break}case"response.reasoning_text.delta":{const a=s.output[e.output_index];if(!a)throw new ut(`missing output at index ${e.output_index}`);if(a.type==="reasoning"){const o=a.content?.[e.content_index];if(!o)throw new ut(`missing content at index ${e.content_index}`);if(o.type!=="reasoning_text")throw new ut(`expected content to be 'reasoning_text', got ${o.type}`);o.text+=e.delta}break}case"response.completed":{mt(this,Ws,e.response);break}}return s},Symbol.asyncIterator)](){const t=[],e=[];let s=!1;return this.on("event",a=>{const o=e.shift();o?o.resolve(a):t.push(a)}),this.on("end",()=>{s=!0;for(const a of e)a.resolve(void 0);e.length=0}),this.on("abort",a=>{s=!0;for(const o of e)o.reject(a);e.length=0}),this.on("error",a=>{s=!0;for(const o of e)o.reject(a);e.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((o,l)=>e.push({resolve:o,reject:l})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const t=U(this,$l,"f");if(!t)throw new ut("stream ended without producing a ChatCompletion");return t}}function x1(c,t){return v1(c,t)}class Iv extends ot{list(t,e={},s){return this._client.getAPIList(Z`/responses/${t}/input_items`,ge,{query:e,...s})}}class Pv extends ot{count(t={},e){return this._client.post("/responses/input_tokens",{body:t,...e})}}class Ic extends ot{constructor(){super(...arguments),this.inputItems=new Iv(this._client),this.inputTokens=new Pv(this._client)}create(t,e){return this._client.post("/responses",{body:t,...e,stream:t.stream??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&Vd(s),s))}retrieve(t,e={},s){return this._client.get(Z`/responses/${t}`,{query:e,...s,stream:e?.stream??!1})._thenUnwrap(a=>("object"in a&&a.object==="response"&&Vd(a),a))}delete(t,e){return this._client.delete(Z`/responses/${t}`,{...e,headers:at([{Accept:"*/*"},e?.headers])})}parse(t,e){return this._client.responses.create(t,e)._thenUnwrap(s=>Bv(s,t))}stream(t,e){return Nf.createResponse(this._client,t,e)}cancel(t,e){return this._client.post(Z`/responses/${t}/cancel`,e)}compact(t,e){return this._client.post("/responses/compact",{body:t,...e})}}Ic.InputItems=Iv;Ic.InputTokens=Pv;class Fv extends ot{create(t,e,s){return this._client.post(Z`/uploads/${t}/parts`,Mi({body:e,...s},this._client))}}class Lf extends ot{constructor(){super(...arguments),this.parts=new Fv(this._client)}create(t,e){return this._client.post("/uploads",{body:t,...e})}cancel(t,e){return this._client.post(Z`/uploads/${t}/cancel`,e)}complete(t,e,s){return this._client.post(Z`/uploads/${t}/complete`,{body:e,...s})}}Lf.Parts=Fv;const T1=async c=>{const t=await Promise.allSettled(c),e=t.filter(a=>a.status==="rejected");if(e.length){for(const a of e)console.error(a.reason);throw new Error(`${e.length} promise(s) failed - see the above errors`)}const s=[];for(const a of t)a.status==="fulfilled"&&s.push(a.value);return s};class Uv extends ot{create(t,e,s){return this._client.post(Z`/vector_stores/${t}/file_batches`,{body:e,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(t,e,s){const{vector_store_id:a}=e;return this._client.get(Z`/vector_stores/${a}/file_batches/${t}`,{...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(t,e,s){const{vector_store_id:a}=e;return this._client.post(Z`/vector_stores/${a}/file_batches/${t}/cancel`,{...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(t,e,s){const a=await this.create(t,e);return await this.poll(t,a.id,s)}listFiles(t,e,s){const{vector_store_id:a,...o}=e;return this._client.getAPIList(Z`/vector_stores/${a}/file_batches/${t}/files`,ge,{query:o,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(t,e,s){const a=at([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){const{data:o,response:l}=await this.retrieve(e,{vector_store_id:t},{...s,headers:a}).withResponse();switch(o.status){case"in_progress":let h=5e3;if(s?.pollIntervalMs)h=s.pollIntervalMs;else{const d=l.headers.get("openai-poll-after-ms");if(d){const f=parseInt(d);isNaN(f)||(h=f)}}await uo(h);break;case"failed":case"cancelled":case"completed":return o}}}async uploadAndPoll(t,{files:e,fileIds:s=[]},a){if(e==null||e.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const o=a?.maxConcurrency??5,l=Math.min(o,e.length),h=this._client,d=e.values(),f=[...s];async function m(b){for(let v of b){const w=await h.files.create({file:v,purpose:"assistants"},a);f.push(w.id)}}const y=Array(l).fill(d).map(m);return await T1(y),await this.createAndPoll(t,{file_ids:f})}}class zv extends ot{create(t,e,s){return this._client.post(Z`/vector_stores/${t}/files`,{body:e,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(t,e,s){const{vector_store_id:a}=e;return this._client.get(Z`/vector_stores/${a}/files/${t}`,{...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(t,e,s){const{vector_store_id:a,...o}=e;return this._client.post(Z`/vector_stores/${a}/files/${t}`,{body:o,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(t,e={},s){return this._client.getAPIList(Z`/vector_stores/${t}/files`,ge,{query:e,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(t,e,s){const{vector_store_id:a}=e;return this._client.delete(Z`/vector_stores/${a}/files/${t}`,{...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(t,e,s){const a=await this.create(t,e,s);return await this.poll(t,a.id,s)}async poll(t,e,s){const a=at([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){const o=await this.retrieve(e,{vector_store_id:t},{...s,headers:a}).withResponse(),l=o.data;switch(l.status){case"in_progress":let h=5e3;if(s?.pollIntervalMs)h=s.pollIntervalMs;else{const d=o.response.headers.get("openai-poll-after-ms");if(d){const f=parseInt(d);isNaN(f)||(h=f)}}await uo(h);break;case"failed":case"completed":return l}}}async upload(t,e,s){const a=await this._client.files.create({file:e,purpose:"assistants"},s);return this.create(t,{file_id:a.id},s)}async uploadAndPoll(t,e,s){const a=await this.upload(t,e,s);return await this.poll(t,a.id,s)}content(t,e,s){const{vector_store_id:a}=e;return this._client.getAPIList(Z`/vector_stores/${a}/files/${t}/content`,Oc,{...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class Pc extends ot{constructor(){super(...arguments),this.files=new zv(this._client),this.fileBatches=new Uv(this._client)}create(t,e){return this._client.post("/vector_stores",{body:t,...e,headers:at([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}retrieve(t,e){return this._client.get(Z`/vector_stores/${t}`,{...e,headers:at([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}update(t,e,s){return this._client.post(Z`/vector_stores/${t}`,{body:e,...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(t={},e){return this._client.getAPIList("/vector_stores",ge,{query:t,...e,headers:at([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}delete(t,e){return this._client.delete(Z`/vector_stores/${t}`,{...e,headers:at([{"OpenAI-Beta":"assistants=v2"},e?.headers])})}search(t,e,s){return this._client.getAPIList(Z`/vector_stores/${t}/search`,Oc,{body:e,method:"post",...s,headers:at([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}Pc.Files=zv;Pc.FileBatches=Uv;class Hv extends ot{create(t,e){return this._client.post("/videos",Sb({body:t,...e},this._client))}retrieve(t,e){return this._client.get(Z`/videos/${t}`,e)}list(t={},e){return this._client.getAPIList("/videos",fc,{query:t,...e})}delete(t,e){return this._client.delete(Z`/videos/${t}`,e)}downloadContent(t,e={},s){return this._client.get(Z`/videos/${t}/content`,{query:e,...s,headers:at([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}remix(t,e,s){return this._client.post(Z`/videos/${t}/remix`,Sb({body:e,...s},this._client))}}var xa,jv,oc;class qv extends ot{constructor(){super(...arguments),xa.add(this)}async unwrap(t,e,s=this._client.webhookSecret,a=300){return await this.verifySignature(t,e,s,a),JSON.parse(t)}async verifySignature(t,e,s=this._client.webhookSecret,a=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");U(this,xa,"m",jv).call(this,s);const o=at([e]).values,l=U(this,xa,"m",oc).call(this,o,"webhook-signature"),h=U(this,xa,"m",oc).call(this,o,"webhook-timestamp"),d=U(this,xa,"m",oc).call(this,o,"webhook-id"),f=parseInt(h,10);if(isNaN(f))throw new jr("Invalid webhook timestamp format");const m=Math.floor(Date.now()/1e3);if(m-f>a)throw new jr("Webhook timestamp is too old");if(f>m+a)throw new jr("Webhook timestamp is too new");const y=l.split(" ").map(A=>A.startsWith("v1,")?A.substring(3):A),b=s.startsWith("whsec_")?Buffer.from(s.replace("whsec_",""),"base64"):Buffer.from(s,"utf-8"),v=d?`${d}.${h}.${t}`:`${h}.${t}`,w=await crypto.subtle.importKey("raw",b,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const A of y)try{const x=Buffer.from(A,"base64");if(await crypto.subtle.verify("HMAC",w,x,new TextEncoder().encode(v)))return}catch{continue}throw new jr("The given webhook signature does not match the expected signature")}}xa=new WeakSet,jv=function(t){if(typeof t!="string"||t.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},oc=function(t,e){if(!t)throw new Error("Headers are required");const s=t.get(e);if(s==null)throw new Error(`Missing required header: ${e}`);return s};var Yd,kf,lc,$v;class xt{constructor({baseURL:t=_a("OPENAI_BASE_URL"),apiKey:e=_a("OPENAI_API_KEY"),organization:s=_a("OPENAI_ORG_ID")??null,project:a=_a("OPENAI_PROJECT_ID")??null,webhookSecret:o=_a("OPENAI_WEBHOOK_SECRET")??null,...l}={}){if(Yd.add(this),lc.set(this,void 0),this.completions=new vv(this),this.chat=new Af(this),this.embeddings=new wv(this),this.files=new Ev(this),this.images=new Dv(this),this.audio=new fo(this),this.moderations=new Nv(this),this.models=new Ov(this),this.fineTuning=new za(this),this.graders=new Of(this),this.vectorStores=new Pc(this),this.webhooks=new qv(this),this.beta=new Ua(this),this.batches=new hv(this),this.uploads=new Lf(this),this.responses=new Ic(this),this.realtime=new Bc(this),this.conversations=new xf(this),this.evals=new Cf(this),this.containers=new Ef(this),this.videos=new Hv(this),e===void 0)throw new ut("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const h={apiKey:e,organization:s,project:a,webhookSecret:o,...l,baseURL:t||"https://api.openai.com/v1"};if(!h.dangerouslyAllowBrowser&&CS())throw new ut(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=h.baseURL,this.timeout=h.timeout??kf.DEFAULT_TIMEOUT,this.logger=h.logger??console;const d="warn";this.logLevel=d,this.logLevel=Ab(h.logLevel,"ClientOptions.logLevel",this)??Ab(_a("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??d,this.fetchOptions=h.fetchOptions,this.maxRetries=h.maxRetries??2,this.fetch=h.fetch??NS(),mt(this,lc,kS),this._options=h,this.apiKey=typeof e=="string"?e:"Missing Key",this.organization=s,this.project=a,this.webhookSecret=o}withOptions(t){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...t})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:e}){}async authHeaders(t){return at([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(t){return zS(t,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Sa}`}defaultIdempotencyKey(){return`stainless-node-retry-${f0()}`}makeStatusError(t,e,s,a){return Pe.generate(t,e,s,a)}async _callApiKey(){const t=this._options.apiKey;if(typeof t!="function")return!1;let e;try{e=await t()}catch(s){throw s instanceof ut?s:new ut(`Failed to get token from 'apiKey' function: ${s.message}`,{cause:s})}if(typeof e!="string"||!e)throw new ut(`Expected 'apiKey' function argument to return a string but it returned ${e}`);return this.apiKey=e,!0}buildURL(t,e,s){const a=!U(this,Yd,"m",$v).call(this)&&s||this.baseURL,o=wS(t)?new URL(t):new URL(a+(a.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),l=this.defaultQuery();return SS(l)||(e={...l,...e}),typeof e=="object"&&e&&!Array.isArray(e)&&(o.search=this.stringifyQuery(e)),o.toString()}async prepareOptions(t){await this._callApiKey()}async prepareRequest(t,{url:e,options:s}){}get(t,e){return this.methodRequest("get",t,e)}post(t,e){return this.methodRequest("post",t,e)}patch(t,e){return this.methodRequest("patch",t,e)}put(t,e){return this.methodRequest("put",t,e)}delete(t,e){return this.methodRequest("delete",t,e)}methodRequest(t,e,s){return this.request(Promise.resolve(s).then(a=>({method:t,path:e,...a})))}request(t,e=null){return new Dc(this,this.makeRequest(t,e,void 0))}async makeRequest(t,e,s){const a=await t,o=a.maxRetries??this.maxRetries;e==null&&(e=o),await this.prepareOptions(a);const{req:l,url:h,timeout:d}=await this.buildRequest(a,{retryCount:o-e});await this.prepareRequest(l,{url:h,options:a});const f="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),m=s===void 0?"":`, retryOf: ${s}`,y=Date.now();if(ke(this).debug(`[${f}] sending request`,Ai({retryOfRequestLogID:s,method:a.method,url:h,options:a,headers:l.headers})),a.signal?.aborted)throw new Nn;const b=new AbortController,v=await this.fetchWithTimeout(h,l,d,b).catch(Id),w=Date.now();if(v instanceof globalThis.Error){const S=`retrying, ${e} attempts remaining`;if(a.signal?.aborted)throw new Nn;const T=Bd(v)||/timed? ?out/i.test(String(v)+("cause"in v?String(v.cause):""));if(e)return ke(this).info(`[${f}] connection ${T?"timed out":"failed"} - ${S}`),ke(this).debug(`[${f}] connection ${T?"timed out":"failed"} (${S})`,Ai({retryOfRequestLogID:s,url:h,durationMs:w-y,message:v.message})),this.retryRequest(a,e,s??f);throw ke(this).info(`[${f}] connection ${T?"timed out":"failed"} - error; no more retries left`),ke(this).debug(`[${f}] connection ${T?"timed out":"failed"} (error; no more retries left)`,Ai({retryOfRequestLogID:s,url:h,durationMs:w-y,message:v.message})),T?new df:new Rc({cause:v})}const A=[...v.headers.entries()].filter(([S])=>S==="x-request-id").map(([S,T])=>", "+S+": "+JSON.stringify(T)).join(""),x=`[${f}${m}${A}] ${l.method} ${h} ${v.ok?"succeeded":"failed"} with status ${v.status} in ${w-y}ms`;if(!v.ok){const S=await this.shouldRetry(v);if(e&&S){const k=`retrying, ${e} attempts remaining`;return await LS(v.body),ke(this).info(`${x} - ${k}`),ke(this).debug(`[${f}] response error (${k})`,Ai({retryOfRequestLogID:s,url:v.url,status:v.status,headers:v.headers,durationMs:w-y})),this.retryRequest(a,e,s??f,v.headers)}const T=S?"error; no more retries left":"error; not retryable";ke(this).info(`${x} - ${T}`);const C=await v.text().catch(k=>Id(k).message),N=TS(C),D=N?void 0:C;throw ke(this).debug(`[${f}] response error (${T})`,Ai({retryOfRequestLogID:s,url:v.url,status:v.status,headers:v.headers,message:D,durationMs:Date.now()-y})),this.makeStatusError(v.status,N,D,v.headers)}return ke(this).info(x),ke(this).debug(`[${f}] response start`,Ai({retryOfRequestLogID:s,url:v.url,status:v.status,headers:v.headers,durationMs:w-y})),{response:v,options:a,controller:b,requestLogID:f,retryOfRequestLogID:s,startTime:y}}getAPIList(t,e,s){return this.requestAPIList(e,{method:"get",path:t,...s})}requestAPIList(t,e){const s=this.makeRequest(e,null,void 0);return new KS(this,s,t)}async fetchWithTimeout(t,e,s,a){const{signal:o,method:l,...h}=e||{};o&&o.addEventListener("abort",()=>a.abort());const d=setTimeout(()=>a.abort(),s),f=globalThis.ReadableStream&&h.body instanceof globalThis.ReadableStream||typeof h.body=="object"&&h.body!==null&&Symbol.asyncIterator in h.body,m={signal:a.signal,...f?{duplex:"half"}:{},method:"GET",...h};l&&(m.method=l.toUpperCase());try{return await this.fetch.call(void 0,t,m)}finally{clearTimeout(d)}}async shouldRetry(t){const e=t.headers.get("x-should-retry");return e==="true"?!0:e==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,e,s,a){let o;const l=a?.get("retry-after-ms");if(l){const d=parseFloat(l);Number.isNaN(d)||(o=d)}const h=a?.get("retry-after");if(h&&!o){const d=parseFloat(h);Number.isNaN(d)?o=Date.parse(h)-Date.now():o=d*1e3}if(!(o&&0<=o&&o<60*1e3)){const d=t.maxRetries??this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(e,d)}return await uo(o),this.makeRequest(t,e-1,s)}calculateDefaultRetryTimeoutMillis(t,e){const o=e-t,l=Math.min(.5*Math.pow(2,o),8),h=1-Math.random()*.25;return l*h*1e3}async buildRequest(t,{retryCount:e=0}={}){const s={...t},{method:a,path:o,query:l,defaultBaseURL:h}=s,d=this.buildURL(o,l,h);"timeout"in s&&xS("timeout",s.timeout),s.timeout=s.timeout??this.timeout;const{bodyHeaders:f,body:m}=this.buildBody({options:s}),y=await this.buildHeaders({options:t,method:a,bodyHeaders:f,retryCount:e});return{req:{method:a,headers:y,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&m instanceof globalThis.ReadableStream&&{duplex:"half"},...m&&{body:m},...this.fetchOptions??{},...s.fetchOptions??{}},url:d,timeout:s.timeout}}async buildHeaders({options:t,method:e,bodyHeaders:s,retryCount:a}){let o={};this.idempotencyHeader&&e!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=t.idempotencyKey);const l=at([o,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(a),...t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{},...OS(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(t),this._options.defaultHeaders,s,t.headers]);return this.validateHeaders(l),l.values}buildBody({options:{body:t,headers:e}}){if(!t)return{bodyHeaders:void 0,body:void 0};const s=at([e]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&s.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:T0(t)}:U(this,lc,"f").call(this,{body:t,headers:s})}}kf=xt,lc=new WeakMap,Yd=new WeakSet,$v=function(){return this.baseURL!=="https://api.openai.com/v1"};xt.OpenAI=kf;xt.DEFAULT_TIMEOUT=6e5;xt.OpenAIError=ut;xt.APIError=Pe;xt.APIConnectionError=Rc;xt.APIConnectionTimeoutError=df;xt.APIUserAbortError=Nn;xt.NotFoundError=y0;xt.ConflictError=b0;xt.RateLimitError=_0;xt.BadRequestError=p0;xt.AuthenticationError=m0;xt.InternalServerError=A0;xt.PermissionDeniedError=g0;xt.UnprocessableEntityError=v0;xt.InvalidWebhookSignatureError=jr;xt.toFile=t1;xt.Completions=vv;xt.Chat=Af;xt.Embeddings=wv;xt.Files=Ev;xt.Images=Dv;xt.Audio=fo;xt.Moderations=Nv;xt.Models=Ov;xt.FineTuning=za;xt.Graders=Of;xt.VectorStores=Pc;xt.Webhooks=qv;xt.Beta=Ua;xt.Batches=hv;xt.Uploads=Lf;xt.Responses=Ic;xt.Realtime=Bc;xt.Conversations=xf;xt.Evals=Cf;xt.Containers=Ef;xt.Videos=Hv;let Di=null;function C1(c){if(!c)throw new Error("OpenAI API key is required");Di=new xt({apiKey:c,dangerouslyAllowBrowser:!0})}async function Gv(c,t={}){if(!Di)throw new Error("OpenAI client not initialized. Please configure your API key.");const{temperature:e=.3,maxTokens:s=2e3,responseFormat:a="text"}=t;try{const l=(await Di.chat.completions.create({model:"gpt-4o",messages:c,temperature:e,max_tokens:s,...a==="json"&&{response_format:{type:"json_object"}}})).choices[0]?.message?.content;if(!l)throw new Error("No response from OpenAI");return l}catch(o){throw o?.status===401?new Error("Invalid OpenAI API key. Please check your configuration."):o?.status===429?new Error("OpenAI rate limit exceeded. Please try again later."):o?.status===500||o?.status===503?new Error("OpenAI service is currently unavailable. Please try again later."):(console.error("OpenAI API error:",o),new Error(`OpenAI API error: ${o?.message||"Unknown error"}`))}}async function R1(c){const t=await Gv([{role:"system",content:"You are a legal assistant that extracts structured claims from testimony. Always respond with valid JSON."},{role:"user",content:c}],{temperature:.3,maxTokens:3e3,responseFormat:"json"});try{const e=JSON.parse(t);if(Array.isArray(e))return e;if(e.claims&&Array.isArray(e.claims))return e.claims;throw new Error("Response is not in expected format")}catch(e){throw console.error("Failed to parse claims extraction response:",e),console.error("Response was:",t),new Error("Failed to parse claims from LLM response")}}async function M1(c){const t=await Gv([{role:"system",content:"You are a legal assistant that compares claims to identify contradictions. Always respond with valid JSON."},{role:"user",content:c}],{temperature:.2,maxTokens:1e3,responseFormat:"json"});try{const e=JSON.parse(t);if(!e.label||!e.explanation||e.confidence===void 0)throw new Error("Response missing required fields");return{label:e.label,explanation:e.explanation,confidence:e.confidence}}catch(e){throw console.error("Failed to parse contradiction judgment response:",e),console.error("Response was:",t),new Error("Failed to parse contradiction judgment from LLM response")}}async function D1(c){if(!Di)throw new Error("OpenAI client not initialized. Please configure your API key.");try{return(await Di.embeddings.create({model:"text-embedding-3-large",input:c})).data[0].embedding}catch(t){throw console.error("OpenAI embedding error:",t),new Error(`Failed to generate embedding: ${t?.message||"Unknown error"}`)}}async function O1(c){if(!Di)throw new Error("OpenAI client not initialized. Please configure your API key.");try{return(await Di.embeddings.create({model:"text-embedding-3-large",input:c})).data.map(e=>e.embedding)}catch(t){throw console.error("OpenAI batch embedding error:",t),new Error(`Failed to generate embeddings: ${t?.message||"Unknown error"}`)}}const N1=`You are a legal assistant analyzing deposition testimony. Your task is to extract atomic claims from witness testimony.

INSTRUCTIONS:
1. Read the witness's answer carefully
2. Extract each distinct claim or assertion made
3. Normalize the language while preserving meaning
4. Identify polarity (affirm/deny/unknown), modality (certain/uncertain/don't recall)
5. Extract temporal scope, entities, and topics
6. Return strict JSON only - no additional commentary

POLARITY:
- "affirm": Witness affirms or confirms something
- "deny": Witness denies or rejects something
- "unknown": Unclear or ambiguous

MODALITY:
- "certain": Definite statements ("I did", "It was", "I always")
- "uncertain": Qualified statements ("I think", "maybe", "probably")
- "dont_recall": Memory-related ("I don't recall", "I can't remember")

ENTITIES: Names, systems, documents, events, locations, organizations

TOPICS: Examples: duty, confidentiality, disclosure, reliance, responsibility, oversight, knowledge, authorization, communication

OUTPUT FORMAT (JSON array):
[
  {
    "normalized_text": "The witness was responsible for overseeing the project",
    "polarity": "affirm",
    "modality": "certain",
    "time_scope": "2020-2021",
    "entities": ["project"],
    "topics": ["responsibility", "oversight"]
  }
]

IMPORTANT:
- Use neutral language
- Preserve the meaning from the original testimony
- Each claim should be atomic (one assertion per claim)
- If multiple claims exist in one answer, separate them
- If witness doesn't recall, still extract the claim structure

WITNESS TESTIMONY TO ANALYZE:
{testimony}

Return only the JSON array, nothing else.`,L1=`You are a legal assistant comparing two claims from deposition testimony to identify inconsistencies.

INSTRUCTIONS:
1. Compare the two claims carefully
2. Identify the type of relationship between them
3. Provide a neutral, factual explanation
4. NEVER use words like "lying", "dishonest", or "false"
5. Instead use: "inconsistent with", "appears to conflict", "differs from", "contradicts"
6. Return strict JSON only

CLASSIFICATION TYPES:
- "CONSISTENT": Claims are compatible or complementary
- "HARD_CONTRADICTION": Claims are mutually exclusive (both cannot be true)
- "SOFT_INCONSISTENCY": Claims show tension but aren't mutually exclusive (hedging, vagueness)
- "SCOPE_SHIFT": Scope changes ("never"  "sometimes", "not responsible"  "oversaw")
- "TEMPORAL_CONFLICT": Timeline inconsistency
- "DEFINITION_DRIFT": Key term is defined or used differently

OUTPUT FORMAT (JSON object):
{
  "label": "HARD_CONTRADICTION",
  "explanation": "In the first statement, witness affirms never being involved in X, but in the second statement affirms direct involvement in X during the same time period",
  "confidence": 0.95
}

CONFIDENCE SCALE:
- 0.9-1.0: Clear contradiction, no ambiguity
- 0.7-0.89: Strong inconsistency with minor ambiguity
- 0.5-0.69: Moderate inconsistency, some ambiguity
- 0.3-0.49: Weak inconsistency, significant ambiguity
- 0.0-0.29: Likely consistent or unclear

CLAIM A:
Citation: {citation_a}
Text: {claim_a}
Polarity: {polarity_a}
Modality: {modality_a}
Time Scope: {time_scope_a}
Topics: {topics_a}

CLAIM B:
Citation: {citation_b}
Text: {claim_b}
Polarity: {polarity_b}
Modality: {modality_b}
Time Scope: {time_scope_b}
Topics: {topics_b}

Compare these claims and return only the JSON object, nothing else.`;function k1(c){return N1.replace("{testimony}",c)}function B1(c,t){return L1.replace("{citation_a}",c.citation).replace("{claim_a}",c.text).replace("{polarity_a}",c.polarity).replace("{modality_a}",c.modality).replace("{time_scope_a}",c.timeScope||"not specified").replace("{topics_a}",c.topics.join(", ")||"not specified").replace("{citation_b}",t.citation).replace("{claim_b}",t.text).replace("{polarity_b}",t.polarity).replace("{modality_b}",t.modality).replace("{time_scope_b}",t.timeScope||"not specified").replace("{topics_b}",t.topics.join(", ")||"not specified")}async function I1(c,t){const e=[],s=c.filter(a=>a.role==="ANSWER");for(let a=0;a<s.length;a++){const o=s[a];t&&t({current:a+1,total:s.length,currentUtterance:o.text.substring(0,100)+"..."});try{const l=await P1(o);e.push(...l)}catch(l){console.error(`Failed to extract claims from utterance ${o.id}:`,l)}await U1(500)}return e}async function P1(c){const t=k1(c.text);return(await R1(t)).map(a=>({id:Cc(),utteranceId:c.id,documentId:c.documentId,normalizedText:a.normalized_text,polarity:a.polarity,modality:a.modality,timeScope:a.time_scope,entities:a.entities||[],topics:a.topics||[],citation:c.citation,createdAt:new Date}))}function F1(c){const t={certain:0,uncertain:0,dont_recall:0},e={affirm:0,deny:0,unknown:0},s=new Map,a=new Map;for(const h of c){t[h.modality]++,e[h.polarity]++;for(const d of h.topics)s.set(d,(s.get(d)||0)+1);for(const d of h.entities){const f=d.toLowerCase().trim();a.set(f,(a.get(f)||0)+1)}}const o=Array.from(s.entries()).map(([h,d])=>({topic:h,count:d})).sort((h,d)=>d.count-h.count).slice(0,10),l=Array.from(a.entries()).map(([h,d])=>({entity:h,count:d})).sort((h,d)=>d.count-h.count).slice(0,10);return{total:c.length,byModality:t,byPolarity:e,topTopics:o,topEntities:l}}function U1(c){return new Promise(t=>setTimeout(t,c))}const Xv="depo-forensics-embeddings";function z1(c){console.log("Chroma Cloud integration disabled in browser mode. Using local similarity matching.")}async function H1(c){try{const t=Vv();for(const{claim:e,embedding:s}of c)t.push({claimId:e.id,embedding:s,metadata:{claimId:e.id,documentId:e.documentId,utteranceId:e.utteranceId,citation:e.citation,polarity:e.polarity,modality:e.modality,timeScope:e.timeScope||"",entities:JSON.stringify(e.entities),topics:JSON.stringify(e.topics)},document:e.normalizedText});localStorage.setItem(Xv,JSON.stringify(t))}catch(t){console.error("Failed to store embeddings:",t)}}async function j1(c,t=10,e){let a=Vv();const o=[];for(const d of a){const f=1-q1(c,d.embedding);o.push({stored:d,distance:f})}return o.sort((d,f)=>d.distance-f.distance),o.slice(0,t).map(d=>({claimId:d.stored.claimId,distance:d.distance,metadata:d.stored.metadata,document:d.stored.document}))}function Vv(){try{const c=localStorage.getItem(Xv);return c?JSON.parse(c):[]}catch(c){return console.error("Failed to load embeddings:",c),[]}}function q1(c,t){if(c.length!==t.length)return 0;let e=0,s=0,a=0;for(let o=0;o<c.length;o++)e+=c[o]*t[o],s+=c[o]*c[o],a+=t[o]*t[o];return s=Math.sqrt(s),a=Math.sqrt(a),s===0||a===0?0:e/(s*a)}async function $1(c,t=8,e=.7,s){const a=[];let o=0;const l=new Set;for(let h=0;h<c.length;h++){const d=c[h];s&&s({current:h+1,total:c.length,pairsAnalyzed:o,contradictionsFound:a.length});try{const f=await G1(d,c,t,e);for(const m of f){const y=Y1(m.claimA.id,m.claimB.id);if(l.has(y))continue;l.add(y),o++;const b=await X1(m.claimA,m.claimB);b&&a.push(b),await W1(300)}}catch(f){console.error(`Failed to process claim ${d.id}:`,f)}}return s&&s({current:c.length,total:c.length,pairsAnalyzed:o,contradictionsFound:a.length}),a}async function G1(c,t,e,s){const a=[],o=new Set([c.id]);try{const l=await D1(c.normalizedText),h=await j1(l,e*2);for(const d of h){if(o.has(d.claimId))continue;const f=1-d.distance;if(f>=s){const m=t.find(y=>y.id===d.claimId);m&&(a.push({claimA:c,claimB:m,similarity:f,reason:"semantic"}),o.add(d.claimId))}}}catch(l){console.warn("Semantic search failed, falling back to lexical matching:",l)}for(const l of t){if(o.has(l.id))continue;c.entities.filter(d=>l.entities.some(f=>f.toLowerCase()===d.toLowerCase())).length>0&&(a.push({claimA:c,claimB:l,similarity:.8,reason:"entity"}),o.add(l.id))}for(const l of t){if(o.has(l.id))continue;c.topics.filter(d=>l.topics.includes(d)).length>0&&(a.push({claimA:c,claimB:l,similarity:.7,reason:"topic"}),o.add(l.id))}if(c.timeScope)for(const l of t)o.has(l.id)||l.timeScope&&K1(c.timeScope,l.timeScope)&&(a.push({claimA:c,claimB:l,similarity:.75,reason:"temporal"}),o.add(l.id));return a.sort((l,h)=>h.similarity-l.similarity).slice(0,e)}async function X1(c,t){const e=B1({text:c.normalizedText,citation:c.citation,polarity:c.polarity,modality:c.modality,timeScope:c.timeScope,topics:c.topics},{text:t.normalizedText,citation:t.citation,polarity:t.polarity,modality:t.modality,timeScope:t.timeScope,topics:t.topics}),s=await M1(e);return s.label==="CONSISTENT"?null:{id:Cc(),claimA:c,claimB:t,type:s.label,explanation:s.explanation,confidence:s.confidence,createdAt:new Date}}function V1(c){const t={HARD_CONTRADICTION:0,SOFT_INCONSISTENCY:0,SCOPE_SHIFT:0,TEMPORAL_CONFLICT:0,DEFINITION_DRIFT:0};let e=0,s=0,a=0,o=0;for(const l of c)t[l.type]++,e+=l.confidence,l.confidence>=.8?s++:l.confidence>=.5?a++:o++;return{total:c.length,byType:t,avgConfidence:c.length>0?e/c.length:0,highConfidence:s,mediumConfidence:a,lowConfidence:o}}function Y1(c,t){return c<t?`${c}:${t}`:`${t}:${c}`}function K1(c,t){const e=c.match(/\d{4}/g)||[],s=t.match(/\d{4}/g)||[];for(const a of e)if(s.includes(a))return!0;return!1}function W1(c){return new Promise(t=>setTimeout(t,c))}function Q1(c,t,e){const s=F1(t),a=V1(e),o=e.map(h=>({issue:eE(h),claimA:{text:h.claimA.normalizedText,citation:h.claimA.citation},claimB:{text:h.claimB.normalizedText,citation:h.claimB.citation},type:h.type,explanation:h.explanation,confidence:h.confidence})),l=tE(c,t,e,s,a);return{documentId:c.id,documentTitle:c.title,generatedAt:new Date,summary:l,contradictions:o,statistics:{totalClaims:t.length,totalContradictions:e.length,hardContradictions:a.byType.HARD_CONTRADICTION||0,softInconsistencies:a.byType.SOFT_INCONSISTENCY||0}}}function Kd(c){const t=[];if(t.push("# Deposition Analysis Report"),t.push(`## ${c.documentTitle}`),t.push(`Generated: ${c.generatedAt.toLocaleString()}`),t.push(""),t.push("---"),t.push(""),t.push("## Executive Summary"),t.push(""),t.push(c.summary),t.push(""),t.push("## Statistics"),t.push(""),t.push(`- **Total Claims Extracted**: ${c.statistics.totalClaims}`),t.push(`- **Total Contradictions Found**: ${c.statistics.totalContradictions}`),t.push(`- **Hard Contradictions**: ${c.statistics.hardContradictions}`),t.push(`- **Soft Inconsistencies**: ${c.statistics.softInconsistencies}`),t.push(""),c.contradictions.length>0){t.push("## Contradictions & Inconsistencies"),t.push("");const e=new Map;for(const s of c.contradictions)e.has(s.issue)||e.set(s.issue,[]),e.get(s.issue).push(s);for(const[s,a]of e.entries()){t.push(`### ${s}`),t.push("");for(const o of a)t.push(`#### ${nE(o.type)} (Confidence: ${(o.confidence*100).toFixed(0)}%)`),t.push(""),t.push(`**Statement A** (${o.claimA.citation}):`),t.push(`> ${o.claimA.text}`),t.push(""),t.push(`**Statement B** (${o.claimB.citation}):`),t.push(`> ${o.claimB.text}`),t.push(""),t.push(`**Analysis**: ${o.explanation}`),t.push(""),t.push("---"),t.push("")}}else t.push("## Contradictions & Inconsistencies"),t.push(""),t.push("No contradictions or inconsistencies detected in this deposition."),t.push("");if(c.timeline&&c.timeline.length>0){t.push("## Timeline"),t.push("");for(const e of c.timeline){t.push(`### ${e.date}`),t.push(`**Event**: ${e.event}`),t.push(""),t.push("**Related Claims**:");for(let s=0;s<e.claims.length;s++)t.push(`- ${e.claims[s]} (${e.citations[s]})`);t.push("")}}return t.push("---"),t.push(""),t.push("*Generated by Legal Deposition Analysis Tool*"),t.push(""),t.push("**Disclaimer**: This report is generated by automated analysis and should be reviewed by legal professionals. The tool identifies patterns and potential inconsistencies but does not make legal conclusions."),t.join(`
`)}function Z1(c){let e=Kd(c);return e=e.replace(/^### (.*$)/gm,"<h3>$1</h3>"),e=e.replace(/^## (.*$)/gm,"<h2>$1</h2>"),e=e.replace(/^# (.*$)/gm,"<h1>$1</h1>"),e=e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),e=e.replace(/\*(.*?)\*/g,"<em>$1</em>"),e=e.replace(/^> (.*$)/gm,"<blockquote>$1</blockquote>"),e=e.replace(/^- (.*$)/gm,"<li>$1</li>"),e=e.replace(/^---$/gm,"<hr>"),e=e.replace(/\n\n/g,"</p><p>"),e=e.replace(/\n/g,"<br>"),`
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deposition Analysis Report - ${c.documentTitle}</title>
  <style>
    body {
      font-family: 'Georgia', serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
      line-height: 1.6;
      color: #333;
    }
    h1 { border-bottom: 3px solid #333; padding-bottom: 10px; }
    h2 { border-bottom: 1px solid #666; padding-bottom: 5px; margin-top: 40px; }
    h3 { color: #555; margin-top: 30px; }
    blockquote {
      border-left: 4px solid #ccc;
      margin-left: 0;
      padding-left: 20px;
      color: #666;
      font-style: italic;
    }
    hr { border: 0; border-top: 1px solid #ccc; margin: 30px 0; }
    li { margin-bottom: 5px; }
    strong { color: #000; }
  </style>
</head>
<body>
  <p>${e}</p>
</body>
</html>
  `.trim()}function J1(c){return JSON.stringify(c,null,2)}function tE(c,t,e,s,a){const o=[];return o.push(`This report analyzes the deposition testimony from "${c.title}".`),o.push(`A total of ${t.length} distinct claims were extracted from ${t.filter((l,h,d)=>d.findIndex(f=>f.utteranceId===l.utteranceId)===h).length} witness responses.`),e.length===0?o.push("No significant contradictions or inconsistencies were identified in the testimony."):(o.push(`The analysis identified ${e.length} potential contradictions or inconsistencies:`),o.push(`- ${a.byType.HARD_CONTRADICTION||0} hard contradictions (mutually exclusive statements)`),o.push(`- ${a.byType.SOFT_INCONSISTENCY||0} soft inconsistencies (hedging or vagueness)`),o.push(`- ${a.byType.SCOPE_SHIFT||0} scope shifts (changing scope of statements)`),o.push(`- ${a.byType.TEMPORAL_CONFLICT||0} temporal conflicts (timeline inconsistencies)`),o.push(`- ${a.byType.DEFINITION_DRIFT||0} definition drifts (term usage changes)`)),s.topTopics.length>0&&o.push(`
Key topics covered: ${s.topTopics.slice(0,5).map(l=>l.topic).join(", ")}.`),a.highConfidence>0&&o.push(`
**High Priority**: ${a.highConfidence} contradiction(s) have high confidence (80%) and should be reviewed carefully.`),o.join(" ")}function eE(c){const t=new Set([...c.claimA.topics,...c.claimB.topics]);if(t.size===0)return"General Testimony";const e=Array.from(t)[0];return e.charAt(0).toUpperCase()+e.slice(1)}function nE(c){const t=c.replace(/_/g," ");return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}function Ed(c,t,e="text/plain"){const s=new Blob([c],{type:e}),a=URL.createObjectURL(s),o=document.createElement("a");o.href=a,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)}function sE(c){return navigator.clipboard.writeText(c)}const iE=({report:c})=>{const[t,e]=en.useState(!1),s=async()=>{const f=Kd(c);await sE(f),e(!0),setTimeout(()=>e(!1),2e3)},a=()=>{const f=Kd(c),m=`${c.documentTitle.replace(/\s+/g,"_")}_report.md`;Ed(f,m,"text/markdown")},o=()=>{const f=Z1(c),m=`${c.documentTitle.replace(/\s+/g,"_")}_report.html`;Ed(f,m,"text/html")},l=()=>{const f=J1(c),m=`${c.documentTitle.replace(/\s+/g,"_")}_report.json`;Ed(f,m,"application/json")},h=f=>{switch(f){case"HARD_CONTRADICTION":return"bg-red-100 text-red-800 border-red-300";case"SOFT_INCONSISTENCY":return"bg-yellow-100 text-yellow-800 border-yellow-300";case"SCOPE_SHIFT":return"bg-orange-100 text-orange-800 border-orange-300";case"TEMPORAL_CONFLICT":return"bg-purple-100 text-purple-800 border-purple-300";case"DEFINITION_DRIFT":return"bg-blue-100 text-blue-800 border-blue-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},d=f=>f.replace(/_/g," ").toLowerCase().replace(/\b\w/g,m=>m.toUpperCase());return H.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[H.jsxs("div",{className:"border-b pb-4 mb-6",children:[H.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Analysis Report"}),H.jsx("h3",{className:"text-xl text-gray-600 mb-2",children:c.documentTitle}),H.jsxs("p",{className:"text-sm text-gray-500",children:["Generated: ",c.generatedAt.toLocaleString()]})]}),H.jsxs("div",{className:"flex flex-wrap gap-2 mb-6",children:[H.jsx("button",{onClick:s,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 text-sm",children:t?"Copied!":"Copy Markdown"}),H.jsx("button",{onClick:a,className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 text-sm",children:"Download Markdown"}),H.jsx("button",{onClick:o,className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 text-sm",children:"Download HTML"}),H.jsx("button",{onClick:l,className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 text-sm",children:"Download JSON"})]}),H.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:[H.jsx("h3",{className:"font-semibold text-lg mb-2",children:"Executive Summary"}),H.jsx("p",{className:"text-gray-700",children:c.summary})]}),H.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[H.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border",children:[H.jsx("p",{className:"text-sm text-gray-600",children:"Total Claims"}),H.jsx("p",{className:"text-2xl font-bold",children:c.statistics.totalClaims})]}),H.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 border",children:[H.jsx("p",{className:"text-sm text-gray-600",children:"Total Contradictions"}),H.jsx("p",{className:"text-2xl font-bold",children:c.statistics.totalContradictions})]}),H.jsxs("div",{className:"bg-red-50 rounded-lg p-4 border border-red-200",children:[H.jsx("p",{className:"text-sm text-red-600",children:"Hard Contradictions"}),H.jsx("p",{className:"text-2xl font-bold text-red-700",children:c.statistics.hardContradictions})]}),H.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4 border border-yellow-200",children:[H.jsx("p",{className:"text-sm text-yellow-600",children:"Soft Inconsistencies"}),H.jsx("p",{className:"text-2xl font-bold text-yellow-700",children:c.statistics.softInconsistencies})]})]}),H.jsxs("div",{children:[H.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Contradictions & Inconsistencies"}),c.contradictions.length===0?H.jsx("div",{className:"bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded",children:"No contradictions or inconsistencies detected in this deposition."}):H.jsx("div",{className:"space-y-6",children:c.contradictions.map((f,m)=>H.jsxs("div",{className:"border rounded-lg p-5 hover:shadow-lg transition-shadow",children:[H.jsxs("div",{className:"flex items-start justify-between mb-3",children:[H.jsxs("div",{children:[H.jsx("h4",{className:"font-semibold text-lg",children:f.issue}),H.jsx("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-semibold mt-2 border ${h(f.type)}`,children:d(f.type)})]}),H.jsxs("div",{className:"text-right",children:[H.jsx("p",{className:"text-sm text-gray-600",children:"Confidence"}),H.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:[(f.confidence*100).toFixed(0),"%"]})]})]}),H.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-4",children:[H.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-3",children:[H.jsxs("p",{className:"text-xs font-semibold text-red-600 mb-2",children:["STATEMENT A (",f.claimA.citation,")"]}),H.jsx("p",{className:"text-sm text-gray-800",children:f.claimA.text})]}),H.jsxs("div",{className:"bg-red-50 border border-red-200 rounded p-3",children:[H.jsxs("p",{className:"text-xs font-semibold text-red-600 mb-2",children:["STATEMENT B (",f.claimB.citation,")"]}),H.jsx("p",{className:"text-sm text-gray-800",children:f.claimB.text})]})]}),H.jsxs("div",{className:"bg-gray-50 rounded p-3",children:[H.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-1",children:"ANALYSIS"}),H.jsx("p",{className:"text-sm text-gray-800",children:f.explanation})]})]},m))})]}),H.jsxs("div",{className:"mt-8 pt-6 border-t text-xs text-gray-500",children:[H.jsx("p",{className:"font-semibold mb-1",children:"Disclaimer:"}),H.jsx("p",{children:"This report is generated by automated analysis and should be reviewed by legal professionals. The tool identifies patterns and potential inconsistencies but does not make legal conclusions."})]})]})},He=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Wd=[.001,0,0,.001,0,0],xd=1.35,gn={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Qs={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},ao="pdfjs_internal_editor_",At={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},kt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},aE={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Qd={TRIANGLES:1,LATTICE:2},ve={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},cc={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},me={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Ta={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Fc={ERRORS:0,WARNINGS:1,INFOS:5},ro={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Pr={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},rE={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Uc=Fc.WARNINGS;function oE(c){Number.isInteger(c)&&(Uc=c)}function lE(){return Uc}function zc(c){Uc>=Fc.INFOS&&console.info(`Info: ${c}`)}function vt(c){Uc>=Fc.WARNINGS&&console.warn(`Warning: ${c}`)}function Kt(c){throw new Error(c)}function Bt(c,t){c||Kt(t)}function cE(c){switch(c?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Yv(c,t=null,e=null){if(!c)return null;if(e&&typeof c=="string"&&(e.addDefaultProtocol&&c.startsWith("www.")&&c.match(/\./g)?.length>=2&&(c=`http://${c}`),e.tryConvertEncoding))try{c=pE(c)}catch{}const s=t?URL.parse(c,t):URL.parse(c);return cE(s)?s:null}function Kv(c,t,e=!1){const s=URL.parse(c);return s?(s.hash=t,s.href):e&&Yv(c,"http://example.com")?c.split("#",1)[0]+`${t?`#${t}`:""}`:""}function _t(c,t,e,s=!1){return Object.defineProperty(c,t,{value:e,enumerable:!s,configurable:!0,writable:!1}),e}const Li=(function(){function t(e,s){this.message=e,this.name=s}return t.prototype=new Error,t.constructor=t,t})();class Ub extends Li{constructor(t,e){super(t,"PasswordException"),this.code=e}}class Td extends Li{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class Zd extends Li{constructor(t){super(t,"InvalidPDFException")}}class Ac extends Li{constructor(t,e,s){super(t,"ResponseException"),this.status=e,this.missing=s}}class uE extends Li{constructor(t){super(t,"FormatError")}}class Js extends Li{constructor(t){super(t,"AbortException")}}function Wv(c){(typeof c!="object"||c?.length===void 0)&&Kt("Invalid argument for bytesToString");const t=c.length,e=8192;if(t<e)return String.fromCharCode.apply(null,c);const s=[];for(let a=0;a<t;a+=e){const o=Math.min(a+e,t),l=c.subarray(a,o);s.push(String.fromCharCode.apply(null,l))}return s.join("")}function po(c){typeof c!="string"&&Kt("Invalid argument for stringToBytes");const t=c.length,e=new Uint8Array(t);for(let s=0;s<t;++s)e[s]=c.charCodeAt(s)&255;return e}function hE(c){return String.fromCharCode(c>>24&255,c>>16&255,c>>8&255,c&255)}function dE(){const c=new Uint8Array(4);return c[0]=1,new Uint32Array(c.buffer,0,1)[0]===1}function fE(){try{return new Function(""),!0}catch{return!1}}class Ae{static get isLittleEndian(){return _t(this,"isLittleEndian",dE())}static get isEvalSupported(){return _t(this,"isEvalSupported",fE())}static get isOffscreenCanvasSupported(){return _t(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return _t(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return _t(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return _t(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return _t(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return _t(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const Cd=Array.from(Array(256).keys(),c=>c.toString(16).padStart(2,"0"));class nt{static makeHexColor(t,e,s){return`#${Cd[t]}${Cd[e]}${Cd[s]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let s;t[0]?(t[0]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[3],e[3]*=t[3]):(s=e[0],e[0]=e[1],e[1]=s,s=e[2],e[2]=e[3],e[3]=s,t[1]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,s=0){const a=t[s],o=t[s+1];t[s]=a*e[0]+o*e[2]+e[4],t[s+1]=a*e[1]+o*e[3]+e[5]}static applyTransformToBezier(t,e,s=0){const a=e[0],o=e[1],l=e[2],h=e[3],d=e[4],f=e[5];for(let m=0;m<6;m+=2){const y=t[s+m],b=t[s+m+1];t[s+m]=y*a+b*l+d,t[s+m+1]=y*o+b*h+f}}static applyInverseTransform(t,e){const s=t[0],a=t[1],o=e[0]*e[3]-e[1]*e[2];t[0]=(s*e[3]-a*e[2]+e[2]*e[5]-e[4]*e[3])/o,t[1]=(-s*e[1]+a*e[0]+e[4]*e[1]-e[5]*e[0])/o}static axialAlignedBoundingBox(t,e,s){const a=e[0],o=e[1],l=e[2],h=e[3],d=e[4],f=e[5],m=t[0],y=t[1],b=t[2],v=t[3];let w=a*m+d,A=w,x=a*b+d,S=x,T=h*y+f,C=T,N=h*v+f,D=N;if(o!==0||l!==0){const L=o*m,k=o*b,V=l*y,K=l*v;w+=V,S+=V,x+=K,A+=K,T+=L,D+=L,N+=k,C+=k}s[0]=Math.min(s[0],w,x,A,S),s[1]=Math.min(s[1],T,N,C,D),s[2]=Math.max(s[2],w,x,A,S),s[3]=Math.max(s[3],T,N,C,D)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const s=t[0],a=t[1],o=t[2],l=t[3],h=s**2+a**2,d=s*o+a*l,f=o**2+l**2,m=(h+f)/2,y=Math.sqrt(m**2-(h*f-d**2));e[0]=Math.sqrt(m+y||1),e[1]=Math.sqrt(m-y||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const s=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),a=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(s>a)return null;const o=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),l=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return o>l?null:[s,o,a,l]}static pointBoundingBox(t,e,s){s[0]=Math.min(s[0],t),s[1]=Math.min(s[1],e),s[2]=Math.max(s[2],t),s[3]=Math.max(s[3],e)}static rectBoundingBox(t,e,s,a,o){o[0]=Math.min(o[0],t,s),o[1]=Math.min(o[1],e,a),o[2]=Math.max(o[2],t,s),o[3]=Math.max(o[3],e,a)}static#t(t,e,s,a,o,l,h,d,f,m){if(f<=0||f>=1)return;const y=1-f,b=f*f,v=b*f,w=y*(y*(y*t+3*f*e)+3*b*s)+v*a,A=y*(y*(y*o+3*f*l)+3*b*h)+v*d;m[0]=Math.min(m[0],w),m[1]=Math.min(m[1],A),m[2]=Math.max(m[2],w),m[3]=Math.max(m[3],A)}static#e(t,e,s,a,o,l,h,d,f,m,y,b){if(Math.abs(f)<1e-12){Math.abs(m)>=1e-12&&this.#t(t,e,s,a,o,l,h,d,-y/m,b);return}const v=m**2-4*y*f;if(v<0)return;const w=Math.sqrt(v),A=2*f;this.#t(t,e,s,a,o,l,h,d,(-m+w)/A,b),this.#t(t,e,s,a,o,l,h,d,(-m-w)/A,b)}static bezierBoundingBox(t,e,s,a,o,l,h,d,f){f[0]=Math.min(f[0],t,h),f[1]=Math.min(f[1],e,d),f[2]=Math.max(f[2],t,h),f[3]=Math.max(f[3],e,d),this.#e(t,s,o,h,e,a,l,d,3*(-t+3*(s-o)+h),6*(t-2*s+o),3*(s-t),f),this.#e(t,s,o,h,e,a,l,d,3*(-e+3*(a-l)+d),6*(e-2*a+l),3*(a-e),f)}}function pE(c){return decodeURIComponent(escape(c))}let Rd=null,zb=null;function mE(c){return Rd||(Rd=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,zb=new Map([["","t"]])),c.replaceAll(Rd,(t,e,s)=>e?e.normalize("NFKC"):zb.get(s))}function Qv(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const c=new Uint8Array(32);return crypto.getRandomValues(c),Wv(c)}const Da="pdfjs_internal_id_";function gE(c,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[s,a,...o]=e;if(!c(s)&&!Number.isInteger(s)||!t(a))return!1;const l=o.length;let h=!0;switch(a.name){case"XYZ":if(l<2||l>3)return!1;break;case"Fit":case"FitB":return l===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(l>1)return!1;break;case"FitR":if(l!==4)return!1;h=!1;break;default:return!1}for(const d of o)if(!(typeof d=="number"||h&&d===null))return!1;return!0}function je(c,t,e){return Math.min(Math.max(c,t),e)}function Zv(c){return Uint8Array.prototype.toBase64?c.toBase64():btoa(Wv(c))}function yE(c){return Uint8Array.fromBase64?Uint8Array.fromBase64(c):po(atob(c))}typeof Promise.try!="function"&&(Promise.try=function(c,...t){return new Promise(e=>{e(c(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(c){return c.reduce((t,e)=>t+e,0)});class oo{static textContent(t){const e=[],s={items:e,styles:Object.create(null)};function a(o){if(!o)return;let l=null;const h=o.name;if(h==="#text")l=o.value;else if(oo.shouldBuildText(h))o?.attributes?.textContent?l=o.attributes.textContent:o.value&&(l=o.value);else return;if(l!==null&&e.push({str:l}),!!o.children)for(const d of o.children)a(d)}return a(t),s}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}class Jv{static setupStorage(t,e,s,a,o){const l=a.getValue(e,{value:null});switch(s.name){case"textarea":if(l.value!==null&&(t.textContent=l.value),o==="print")break;t.addEventListener("input",h=>{a.setValue(e,{value:h.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(l.value===s.attributes.xfaOn?t.setAttribute("checked",!0):l.value===s.attributes.xfaOff&&t.removeAttribute("checked"),o==="print")break;t.addEventListener("change",h=>{a.setValue(e,{value:h.target.checked?h.target.getAttribute("xfaOn"):h.target.getAttribute("xfaOff")})})}else{if(l.value!==null&&t.setAttribute("value",l.value),o==="print")break;t.addEventListener("input",h=>{a.setValue(e,{value:h.target.value})})}break;case"select":if(l.value!==null){t.setAttribute("value",l.value);for(const h of s.children)h.attributes.value===l.value?h.attributes.selected=!0:h.attributes.hasOwnProperty("selected")&&delete h.attributes.selected}t.addEventListener("input",h=>{const d=h.target.options,f=d.selectedIndex===-1?"":d[d.selectedIndex].value;a.setValue(e,{value:f})});break}}static setAttributes({html:t,element:e,storage:s=null,intent:a,linkService:o}){const{attributes:l}=e,h=t instanceof HTMLAnchorElement;l.type==="radio"&&(l.name=`${l.name}-${a}`);for(const[d,f]of Object.entries(l))if(f!=null)switch(d){case"class":f.length&&t.setAttribute(d,f.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",f);break;case"style":Object.assign(t.style,f);break;case"textContent":t.textContent=f;break;default:(!h||d!=="href"&&d!=="newWindow")&&t.setAttribute(d,f)}h&&o.addLinkAttributes(t,l.href,l.newWindow),s&&l.dataId&&this.setupStorage(t,l.dataId,e,s)}static render(t){const e=t.annotationStorage,s=t.linkService,a=t.xfaHtml,o=t.intent||"display",l=document.createElement(a.name);a.attributes&&this.setAttributes({html:l,element:a,intent:o,linkService:s});const h=o!=="richText",d=t.div;if(d.append(l),t.viewport){const y=`matrix(${t.viewport.transform.join(",")})`;d.style.transform=y}h&&d.setAttribute("class","xfaLayer xfaFont");const f=[];if(a.children.length===0){if(a.value){const y=document.createTextNode(a.value);l.append(y),h&&oo.shouldBuildText(a.name)&&f.push(y)}return{textDivs:f}}const m=[[a,-1,l]];for(;m.length>0;){const[y,b,v]=m.at(-1);if(b+1===y.children.length){m.pop();continue}const w=y.children[++m.at(-1)[1]];if(w===null)continue;const{name:A}=w;if(A==="#text"){const S=document.createTextNode(w.value);f.push(S),v.append(S);continue}const x=w?.attributes?.xmlns?document.createElementNS(w.attributes.xmlns,A):document.createElement(A);if(v.append(x),w.attributes&&this.setAttributes({html:x,element:w,storage:e,intent:o,linkService:s}),w.children?.length>0)m.push([w,-1,x]);else if(w.value){const S=document.createTextNode(w.value);h&&oo.shouldBuildText(A)&&f.push(S),x.append(S)}}for(const y of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))y.setAttribute("readOnly",!0);return{textDivs:f}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const _s="http://www.w3.org/2000/svg";class Fa{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function mo(c,t="text"){if(Qr(c,document.baseURI)){const e=await fetch(c);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,s)=>{const a=new XMLHttpRequest;a.open("GET",c,!0),a.responseType=t,a.onreadystatechange=()=>{if(a.readyState===XMLHttpRequest.DONE){if(a.status===200||a.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(a.response);return}e(a.responseText);return}s(new Error(a.statusText))}},a.send(null)})}class go{constructor({viewBox:t,userUnit:e,scale:s,rotation:a,offsetX:o=0,offsetY:l=0,dontFlip:h=!1}){this.viewBox=t,this.userUnit=e,this.scale=s,this.rotation=a,this.offsetX=o,this.offsetY=l,s*=e;const d=(t[2]+t[0])/2,f=(t[3]+t[1])/2;let m,y,b,v;switch(a%=360,a<0&&(a+=360),a){case 180:m=-1,y=0,b=0,v=1;break;case 90:m=0,y=1,b=1,v=0;break;case 270:m=0,y=-1,b=-1,v=0;break;case 0:m=1,y=0,b=0,v=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}h&&(b=-b,v=-v);let w,A,x,S;m===0?(w=Math.abs(f-t[1])*s+o,A=Math.abs(d-t[0])*s+l,x=(t[3]-t[1])*s,S=(t[2]-t[0])*s):(w=Math.abs(d-t[0])*s+o,A=Math.abs(f-t[1])*s+l,x=(t[2]-t[0])*s,S=(t[3]-t[1])*s),this.transform=[m*s,y*s,b*s,v*s,w-m*s*d-b*s*f,A-y*s*d-v*s*f],this.width=x,this.height=S}get rawDims(){const t=this.viewBox;return _t(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:s=this.offsetX,offsetY:a=this.offsetY,dontFlip:o=!1}={}){return new go({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:a,dontFlip:o})}convertToViewportPoint(t,e){const s=[t,e];return nt.applyTransform(s,this.transform),s}convertToViewportRectangle(t){const e=[t[0],t[1]];nt.applyTransform(e,this.transform);const s=[t[2],t[3]];return nt.applyTransform(s,this.transform),[e[0],e[1],s[0],s[1]]}convertToPdfPoint(t,e){const s=[t,e];return nt.applyInverseTransform(s,this.transform),s}}class Bf extends Li{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function Hc(c){const t=c.length;let e=0;for(;e<t&&c[e].trim()==="";)e++;return c.substring(e,e+5).toLowerCase()==="data:"}function If(c){return typeof c=="string"&&/\.pdf$/i.test(c)}function bE(c){return[c]=c.split(/[#?]/,1),c.substring(c.lastIndexOf("/")+1)}function vE(c,t="document.pdf"){if(typeof c!="string")return t;if(Hc(c))return vt('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const s=(h=>{try{return new URL(h)}catch{try{return new URL(decodeURIComponent(h))}catch{try{return new URL(h,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(h),"https://foo.bar")}catch{return null}}}}})(c);if(!s)return t;const a=h=>{try{let d=decodeURIComponent(h);return d.includes("/")?(d=d.split("/").at(-1),d.test(/^\.pdf$/i)?d:h):d}catch{return h}},o=/\.pdf$/i,l=s.pathname.split("/").at(-1);if(o.test(l))return a(l);if(s.searchParams.size>0){const h=Array.from(s.searchParams.values()).reverse();for(const f of h)if(o.test(f))return a(f);const d=Array.from(s.searchParams.keys()).reverse();for(const f of d)if(o.test(f))return a(f)}if(s.hash){const d=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(s.hash);if(d)return a(d[0])}return t}class Hb{started=Object.create(null);times=[];time(t){t in this.started&&vt(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||vt(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:s}of this.times)e=Math.max(s.length,e);for(const{name:s,start:a,end:o}of this.times)t.push(`${s.padEnd(e)} ${o-a}ms
`);return t.join("")}}function Qr(c,t){const e=t?URL.parse(c,t):URL.parse(c);return e?.protocol==="http:"||e?.protocol==="https:"}function Ln(c){c.preventDefault()}function ae(c){c.preventDefault(),c.stopPropagation()}function _E(c){console.log("Deprecated API usage: "+c)}class Jd{static#t;static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const s=parseInt(e[1],10);let a=parseInt(e[2],10);a=a>=1&&a<=12?a-1:0;let o=parseInt(e[3],10);o=o>=1&&o<=31?o:1;let l=parseInt(e[4],10);l=l>=0&&l<=23?l:0;let h=parseInt(e[5],10);h=h>=0&&h<=59?h:0;let d=parseInt(e[6],10);d=d>=0&&d<=59?d:0;const f=e[7]||"Z";let m=parseInt(e[8],10);m=m>=0&&m<=23?m:0;let y=parseInt(e[9],10)||0;return y=y>=0&&y<=59?y:0,f==="-"?(l+=m,h+=y):f==="+"&&(l-=m,h-=y),new Date(Date.UTC(s,a,o,l,h,d))}}function AE(c,{scale:t=1,rotation:e=0}){const{width:s,height:a}=c.attributes.style,o=[0,0,parseInt(s),parseInt(a)];return new go({viewBox:o,userUnit:1,scale:t,rotation:e})}function yo(c){if(c.startsWith("#")){const t=parseInt(c.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return c.startsWith("rgb(")?c.slice(4,-1).split(",").map(t=>parseInt(t)):c.startsWith("rgba(")?c.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(vt(`Not a valid color format: "${c}"`),[0,0,0])}function wE(c){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of c.keys()){t.style.color=e;const s=window.getComputedStyle(t).color;c.set(e,yo(s))}t.remove()}function ee(c){const{a:t,b:e,c:s,d:a,e:o,f:l}=c.getTransform();return[t,e,s,a,o,l]}function Xn(c){const{a:t,b:e,c:s,d:a,e:o,f:l}=c.getTransform().invertSelf();return[t,e,s,a,o,l]}function Oi(c,t,e=!1,s=!0){if(t instanceof go){const{pageWidth:a,pageHeight:o}=t.rawDims,{style:l}=c,h=Ae.isCSSRoundSupported,d=`var(--total-scale-factor) * ${a}px`,f=`var(--total-scale-factor) * ${o}px`,m=h?`round(down, ${d}, var(--scale-round-x))`:`calc(${d})`,y=h?`round(down, ${f}, var(--scale-round-y))`:`calc(${f})`;!e||t.rotation%180===0?(l.width=m,l.height=y):(l.width=y,l.height=m)}s&&c.setAttribute("data-main-rotation",t.rotation)}class Zn{constructor(){const{pixelRatio:t}=Zn;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,s,a,o=-1){let l=1/0,h=1/0,d=1/0;s=Zn.capPixels(s,o),s>0&&(l=Math.sqrt(s/(t*e))),a!==-1&&(h=a/t,d=a/e);const f=Math.min(l,h,d);return this.sx>f||this.sy>f?(this.sx=f,this.sy=f,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,s):s}return t}}const tf=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class SE{static get isDarkMode(){return _t(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class EE{static get commentForegroundColor(){const t=document.createElement("span");t.classList.add("comment","sidebar");const{style:e}=t;e.width=e.height="0",e.display="none",e.color="var(--comment-fg-color)",document.body.append(t);const{color:s}=window.getComputedStyle(t);return t.remove(),_t(this,"commentForegroundColor",yo(s))}}function xE(c,t,e,s){s=Math.min(Math.max(s??1,0),1);const a=255*(1-s);return c=Math.round(c*s+a),t=Math.round(t*s+a),e=Math.round(e*s+a),[c,t,e]}function jb(c,t){const e=c[0]/255,s=c[1]/255,a=c[2]/255,o=Math.max(e,s,a),l=Math.min(e,s,a),h=(o+l)/2;if(o===l)t[0]=t[1]=0;else{const d=o-l;switch(t[1]=h<.5?d/(o+l):d/(2-o-l),o){case e:t[0]=((s-a)/d+(s<a?6:0))*60;break;case s:t[0]=((a-e)/d+2)*60;break;case a:t[0]=((e-s)/d+4)*60;break}}t[2]=h}function ef(c,t){const e=c[0],s=c[1],a=c[2],o=(1-Math.abs(2*a-1))*s,l=o*(1-Math.abs(e/60%2-1)),h=a-o/2;switch(Math.floor(e/60)){case 0:t[0]=o+h,t[1]=l+h,t[2]=h;break;case 1:t[0]=l+h,t[1]=o+h,t[2]=h;break;case 2:t[0]=h,t[1]=o+h,t[2]=l+h;break;case 3:t[0]=h,t[1]=l+h,t[2]=o+h;break;case 4:t[0]=l+h,t[1]=h,t[2]=o+h;break;case 5:case 6:t[0]=o+h,t[1]=h,t[2]=l+h;break}}function qb(c){return c<=.03928?c/12.92:((c+.055)/1.055)**2.4}function $b(c,t,e){ef(c,e),e.map(qb);const s=.2126*e[0]+.7152*e[1]+.0722*e[2];ef(t,e),e.map(qb);const a=.2126*e[0]+.7152*e[1]+.0722*e[2];return s>a?(s+.05)/(a+.05):(a+.05)/(s+.05)}const Gb=new Map;function TE(c,t){const e=c[0]+c[1]*256+c[2]*65536+t[0]*16777216+t[1]*4294967296+t[2]*1099511627776;let s=Gb.get(e);if(s)return s;const a=new Float32Array(9),o=a.subarray(0,3),l=a.subarray(3,6);jb(c,l);const h=a.subarray(6,9);jb(t,h);const d=h[2]<.5,f=d?12:4.5;if(l[2]=d?Math.sqrt(l[2]):1-Math.sqrt(1-l[2]),$b(l,h,o)<f){let m,y;d?(m=l[2],y=1):(m=0,y=l[2]);const b=.005;for(;y-m>b;){const v=l[2]=(m+y)/2;d===$b(l,h,o)<f?m=v:y=v}l[2]=d?y:m}return ef(l,o),s=nt.makeHexColor(Math.round(o[0]*255),Math.round(o[1]*255),Math.round(o[2]*255)),Gb.set(e,s),s}function t_({html:c,dir:t,className:e},s){const a=document.createDocumentFragment();if(typeof c=="string"){const o=document.createElement("p");o.dir=t||"auto";const l=c.split(/(?:\r\n?|\n)/);for(let h=0,d=l.length;h<d;++h){const f=l[h];o.append(document.createTextNode(f)),h<d-1&&o.append(document.createElement("br"))}a.append(o)}else Jv.render({xfaHtml:c,div:a,intent:"richText"});a.firstElementChild.classList.add("richText",e),s.append(a)}function e_(c){const t=new Path2D;if(!c)return t;for(let e=0,s=c.length;e<s;)switch(c[e++]){case Pr.moveTo:t.moveTo(c[e++],c[e++]);break;case Pr.lineTo:t.lineTo(c[e++],c[e++]);break;case Pr.curveTo:t.bezierCurveTo(c[e++],c[e++],c[e++],c[e++],c[e++],c[e++]);break;case Pr.quadraticCurveTo:t.quadraticCurveTo(c[e++],c[e++],c[e++],c[e++]);break;case Pr.closePath:t.closePath();break;default:vt(`Unrecognized drawing path operator: ${c[e-1]}`);break}return t}class so{#t=null;#e=null;#s;#n=null;#r=null;#a=null;#i=null;#o=null;static#c=null;constructor(t){this.#s=t,so.#c||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#s._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",Ln,{signal:e}),t.addEventListener("pointerdown",so.#l,{signal:e}));const s=this.#n=document.createElement("div");s.className="buttons",t.append(s);const a=this.#s.toolbarPosition;if(a){const{style:o}=t,l=this.#s._uiManager.direction==="ltr"?1-a[0]:a[0];o.insetInlineEnd=`${100*l}%`,o.top=`calc(${100*a[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#t}static#l(t){t.stopPropagation()}#d(t){this.#s._focusEventsAllowed=!1,ae(t)}#h(t){this.#s._focusEventsAllowed=!0,ae(t)}#f(t){const e=this.#s._uiManager._signal;return!(e instanceof AbortSignal)||e.aborted?!1:(t.addEventListener("focusin",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#h.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",Ln,{signal:e}),!0)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#r?.shown(),this.#a?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#s,s=document.createElement("button");s.classList.add("basic","deleteButton"),s.tabIndex=0,s.setAttribute("data-l10n-id",so.#c[t]),this.#f(s)&&s.addEventListener("click",a=>{e.delete()},{signal:e._signal}),this.#n.append(s)}get#g(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#f(e),this.#n.append(e,this.#g),this.#r=t}addComment(t,e=null){if(this.#a)return;const s=t.renderForToolbar();if(!s)return;this.#f(s);const a=this.#i=this.#g;e?(this.#n.insertBefore(s,e),this.#n.insertBefore(a,e)):this.#n.append(s,a),this.#a=t,t.toolbar=this}addColorPicker(t){if(this.#e)return;this.#e=t;const e=t.renderButton();this.#f(e),this.#n.append(e,this.#g)}async addEditSignatureButton(t){const e=this.#o=await t.renderEditButton(this.#s);this.#f(e),this.#n.append(e,this.#g)}removeButton(t){t==="comment"&&(this.#a?.removeToolbarCommentButton(),this.#a=null,this.#i?.remove(),this.#i=null)}async addButton(t,e){switch(t){case"colorPicker":e&&this.addColorPicker(e);break;case"altText":e&&await this.addAltText(e);break;case"editSignature":e&&await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":e&&this.addComment(e);break}}async addButtonBefore(t,e,s){if(!e&&t==="comment")return;const a=this.#n.querySelector(s);a&&t==="comment"&&this.addComment(e,a)}updateEditSignatureButton(t){this.#o&&(this.#o.title=t)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class CE{#t=null;#e=null;#s;constructor(t){this.#s=t}#n(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar");const e=this.#s._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",Ln,{signal:e});const s=this.#t=document.createElement("div");return s.className="buttons",t.append(s),this.#s.hasCommentManager()&&this.#a("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#s.commentSelection("floating_button")}),this.#a("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#s.highlightSelection("floating_button")}),t}#r(t,e){let s=0,a=0;for(const o of t){const l=o.y+o.height;if(l<s)continue;const h=o.x+(e?o.width:0);if(l>s){a=h,s=l;continue}e?h>a&&(a=h):h<a&&(a=h)}return[e?1-a:a,s]}show(t,e,s){const[a,o]=this.#r(e,s),{style:l}=this.#e||=this.#n();t.append(this.#e),l.insetInlineEnd=`${100*a}%`,l.top=`calc(${100*o}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#a(t,e,s,a){const o=document.createElement("button");o.classList.add("basic",t),o.tabIndex=0,o.setAttribute("data-l10n-id",e);const l=document.createElement("span");o.append(l),l.className="visuallyHidden",l.setAttribute("data-l10n-id",s);const h=this.#s._signal;h instanceof AbortSignal&&!h.aborted&&(o.addEventListener("contextmenu",Ln,{signal:h}),o.addEventListener("click",a,{signal:h})),this.#t.append(o)}}function n_(c,t,e){for(const s of e)t.addEventListener(s,c[s].bind(c))}class zt{static#t=NaN;static#e=null;static#s=NaN;static#n=null;static initializeAndAddPointerId(t){(zt.#e||=new Set).add(t)}static setPointer(t,e){zt.#t||=e,zt.#n??=t}static setTimeStamp(t){zt.#s=t}static isSamePointerId(t){return zt.#t===t}static isSamePointerIdOrRemove(t){return zt.#t===t?!0:(zt.#e?.delete(t),!1)}static isSamePointerType(t){return zt.#n===t}static isInitializedAndDifferentPointerType(t){return zt.#n!==null&&!zt.isSamePointerType(t)}static isSameTimeStamp(t){return zt.#s===t}static isUsingMultiplePointers(){return zt.#e?.size>=1}static clearPointerType(){zt.#n=null}static clearPointerIds(){zt.#t=NaN,zt.#e=null}static clearTimeStamp(){zt.#s=NaN}}class RE{#t=0;get id(){return`${ao}${this.#t++}`}}class Pf{#t=Qv();#e=0;#s=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),a=new Image;a.src=t;const o=a.decode().then(()=>(s.drawImage(a,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return _t(this,"_isSVGFittingCanvas",o)}async#n(t,e){this.#s||=new Map;let s=this.#s.get(t);if(s===null)return null;if(s?.bitmap)return s.refCounter+=1,s;try{s||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let a;if(typeof e=="string"?(s.url=e,a=await mo(e,"blob")):e instanceof File?a=s.file=e:e instanceof Blob&&(a=e),a.type==="image/svg+xml"){const o=Pf._isSVGFittingCanvas,l=new FileReader,h=new Image,d=new Promise((f,m)=>{h.onload=()=>{s.bitmap=h,s.isSvg=!0,f()},l.onload=async()=>{const y=s.svgUrl=l.result;h.src=await o?`${y}#svgView(preserveAspectRatio(none))`:y},h.onerror=l.onerror=m});l.readAsDataURL(a),await d}else s.bitmap=await createImageBitmap(a);s.refCounter=1}catch(a){vt(a),s=null}return this.#s.set(t,s),s&&this.#s.set(s.id,s),s}async getFromFile(t){const{lastModified:e,name:s,size:a,type:o}=t;return this.#n(`${e}_${s}_${a}_${o}`,t)}async getFromUrl(t){return this.#n(t,t)}async getFromBlob(t,e){const s=await e;return this.#n(t,s)}async getFromId(t){this.#s||=new Map;const e=this.#s.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:s}=e;return delete e.blobPromise,this.getFromBlob(e.id,s)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#s||=new Map;let s=this.#s.get(t);if(s?.bitmap)return s.refCounter+=1,s;const a=new OffscreenCanvas(e.width,e.height);return a.getContext("2d").drawImage(e,0,0),s={bitmap:a.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#s.set(t,s),this.#s.set(s.id,s),s}getSvgUrl(t){const e=this.#s.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#s||=new Map;const e=this.#s.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:s}=e;if(!e.url&&!e.file){const a=new OffscreenCanvas(s.width,s.height);a.getContext("bitmaprenderer").transferFromImageBitmap(s),e.blobPromise=a.convertToBlob()}s.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class ME{#t=[];#e=!1;#s;#n=-1;constructor(t=128){this.#s=t}add({cmd:t,undo:e,post:s,mustExec:a,type:o=NaN,overwriteIfSameType:l=!1,keepUndo:h=!1}){if(a&&t(),this.#e)return;const d={cmd:t,undo:e,post:s,type:o};if(this.#n===-1){this.#t.length>0&&(this.#t.length=0),this.#n=0,this.#t.push(d);return}if(l&&this.#t[this.#n].type===o){h&&(d.undo=this.#t[this.#n].undo),this.#t[this.#n]=d;return}const f=this.#n+1;f===this.#s?this.#t.splice(0,1):(this.#n=f,f<this.#t.length&&this.#t.splice(f)),this.#t.push(d)}undo(){if(this.#n===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#n];t(),e?.(),this.#e=!1,this.#n-=1}redo(){if(this.#n<this.#t.length-1){this.#n+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#n];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#t.length-1}cleanType(t){if(this.#n!==-1){for(let e=this.#n;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#n-e),this.#n=e;return}this.#t.length=0,this.#n=-1}}destroy(){this.#t=null}}class bo{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=Ae.platform;for(const[s,a,o={}]of t)for(const l of s){const h=l.startsWith("mac+");e&&h?(this.callbacks.set(l.slice(4),{callback:a,options:o}),this.allKeys.add(l.split("+").at(-1))):!e&&!h&&(this.callbacks.set(l,{callback:a,options:o}),this.allKeys.add(l.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const s=this.callbacks.get(this.#t(e));if(!s)return;const{callback:a,options:{bubbles:o=!1,args:l=[],checker:h=null}}=s;h&&!h(t,e)||(a.bind(t,...l,e)(),o||ae(e))}}class Ff{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return wE(t),_t(this,"_colors",t)}convert(t){const e=yo(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[s,a]of this._colors)if(a.every((o,l)=>o===e[l]))return Ff._colorsMapping.get(s);return e}getHexCode(t){const e=this._colors.get(t);return e?nt.makeHexColor(...e):t}}class ti{#t=new AbortController;#e=null;#s=null;#n=new Map;#r=new Map;#a=null;#i=null;#o=null;#c=new ME;#l=null;#d=null;#h=null;#f=0;#g=new Set;#m=null;#u=null;#p=new Set;_editorUndoBar=null;#y=!1;#v=!1;#b=!1;#x=null;#S=null;#A=null;#C=null;#_=!1;#E=null;#D=new RE;#R=!1;#M=!1;#P=!1;#N=null;#k=null;#F=null;#B=null;#$=null;#T=At.NONE;#w=new Set;#L=null;#U=null;#H=null;#V=null;#X=null;#Y={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#j=[0,0];#I=null;#G=null;#Z=null;#J=null;#z=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=ti.prototype,e=l=>l.#G.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&l.hasSomethingToControl(),s=(l,{target:h})=>{if(h instanceof HTMLInputElement){const{type:d}=h;return d!=="text"&&d!=="number"}return!0},a=this.TRANSLATE_SMALL,o=this.TRANSLATE_BIG;return _t(this,"_keyboardManager",new bo([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(l,{target:h})=>!(h instanceof HTMLButtonElement)&&l.#G.contains(h)&&!l.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(l,{target:h})=>!(h instanceof HTMLButtonElement)&&l.#G.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-a,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-o,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[a,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[o,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-a],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-o],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,a],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,o],checker:e}]]))}constructor(t,e,s,a,o,l,h,d,f,m,y,b,v,w,A,x){const S=this._signal=this.#t.signal;this.#G=t,this.#Z=e,this.#J=s,this.#a=a,this.#l=o,this.#U=l,this.#X=d,this._eventBus=h,h._on("editingaction",this.onEditingAction.bind(this),{signal:S}),h._on("pagechanging",this.onPageChanging.bind(this),{signal:S}),h._on("scalechanging",this.onScaleChanging.bind(this),{signal:S}),h._on("rotationchanging",this.onRotationChanging.bind(this),{signal:S}),h._on("setpreference",this.onSetPreference.bind(this),{signal:S}),h._on("switchannotationeditorparams",T=>this.updateParams(T.type,T.value),{signal:S}),window.addEventListener("pointerdown",()=>{this.#M=!0},{capture:!0,signal:S}),window.addEventListener("pointerup",()=>{this.#M=!1},{capture:!0,signal:S}),this.#rt(),this.#dt(),this.#et(),this.#i=d.annotationStorage,this.#x=d.filterFactory,this.#H=f,this.#C=m||null,this.#y=y,this.#v=b,this.#b=v,this.#$=w||null,this.viewParameters={realScale:Fa.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=A||null,this._supportsPinchToZoom=x!==!1,o?.setSidebarUiManager(this)}destroy(){this.#z?.resolve(),this.#z=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#r.values())t.destroy();this.#r.clear(),this.#n.clear(),this.#p.clear(),this.#B?.clear(),this.#e=null,this.#w.clear(),this.#c.destroy(),this.#a?.destroy(),this.#l?.destroy(),this.#U?.destroy(),this.#E?.hide(),this.#E=null,this.#F?.destroy(),this.#F=null,this.#s=null,this.#S&&(clearTimeout(this.#S),this.#S=null),this.#I&&(clearTimeout(this.#I),this.#I=null),this._editorUndoBar?.destroy(),this.#X=null}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#$}get useNewAltTextFlow(){return this.#v}get useNewAltTextWhenAddingImage(){return this.#b}get hcmFilter(){return _t(this,"hcmFilter",this.#H?this.#x.addHCMFilter(this.#H.foreground,this.#H.background):"none")}get direction(){return _t(this,"direction",getComputedStyle(this.#G).direction)}get _highlightColors(){return _t(this,"_highlightColors",this.#C?new Map(this.#C.split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return _t(this,"highlightColors",null);const e=new Map,s=!!this.#H;for(const[a,o]of t){const l=a.endsWith("_HCM");if(s&&l){e.set(a.replace("_HCM",""),o);continue}!s&&!l&&e.set(a,o)}return _t(this,"highlightColors",e)}get highlightColorNames(){return _t(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#h=t}setMainHighlightColorPicker(t){this.#F=t}editAltText(t,e=!1){this.#a?.editAltText(this,t,e)}hasCommentManager(){return!!this.#l}editComment(t,e,s,a){this.#l?.showDialog(this,t,e,s,a)}selectComment(t,e){this.#r.get(t)?.getEditorByUID(e)?.toggleComment(!0,!0)}updateComment(t){this.#l?.updateComment(t.getData())}updatePopupColor(t){this.#l?.updatePopupColor(t)}removeComment(t){this.#l?.removeComments([t.uid])}toggleComment(t,e,s=void 0){this.#l?.toggleCommentPopup(t,e,s)}makeCommentColor(t,e){return t&&this.#l?.makeCommentColor(t,e)||null}getCommentDialogElement(){return this.#l?.dialogElement||null}async waitForEditorsRendered(t){if(this.#r.has(t-1))return;const{resolve:e,promise:s}=Promise.withResolvers(),a=o=>{o.pageNumber===t&&(this._eventBus._off("editorsrendered",a),e())};this._eventBus.on("editorsrendered",a),await s}getSignature(t){this.#U?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#U}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){t==="enableNewAltTextWhenAddingImage"&&(this.#b=e)}onPageChanging({pageNumber:t}){this.#f=t-1}focusMainContainer(){this.#G.focus()}findParent(t,e){for(const s of this.#r.values()){const{x:a,y:o,width:l,height:h}=s.div.getBoundingClientRect();if(t>=a&&t<=a+l&&e>=o&&e<=o+h)return s}return null}disableUserSelect(t=!1){this.#Z.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#p.add(t)}removeShouldRescale(t){this.#p.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*Fa.PDF_TO_CSS_UNITS;for(const e of this.#p)e.onScaleChanging();this.#h?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#Q({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#tt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const s of this.#r.values())if(s.hasTextLayer(t))return s;return null}highlightSelection(t="",e=!1){const s=document.getSelection();if(!s||s.isCollapsed)return;const{anchorNode:a,anchorOffset:o,focusNode:l,focusOffset:h}=s,d=s.toString(),m=this.#Q(s).closest(".textLayer"),y=this.getSelectionBoxes(m);if(!y)return;s.empty();const b=this.#tt(m),v=this.#T===At.NONE,w=()=>{const A=b?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:y,anchorNode:a,anchorOffset:o,focusNode:l,focusOffset:h,text:d});v&&this.showAllEditors("highlight",!0,!0),e&&A?.editComment()};if(v){this.switchToMode(At.HIGHLIGHT,w);return}w()}commentSelection(t=""){this.highlightSelection(t,!0)}#it(){const t=document.getSelection();if(!t||t.isCollapsed)return;const s=this.#Q(t).closest(".textLayer"),a=this.getSelectionBoxes(s);a&&(this.#E||=new CE(this),this.#E.show(s,a,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(t){if(!this.#i)return null;const e=`${ao}${t}`,s=this.#i.getRawValue(e);return s&&this.#i.remove(e),s}addToAnnotationStorage(t){!t.isEmpty()&&this.#i&&!this.#i.has(t.id)&&this.#i.setValue(t.id,t)}a11yAlert(t,e=null){const s=this.#J;s&&(s.setAttribute("data-l10n-id",t),e?s.setAttribute("data-l10n-args",JSON.stringify(e)):s.removeAttribute("data-l10n-args"))}#at(){const t=document.getSelection();if(!t||t.isCollapsed){this.#L&&(this.#E?.hide(),this.#L=null,this.#O({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#L)return;const a=this.#Q(t).closest(".textLayer");if(!a){this.#L&&(this.#E?.hide(),this.#L=null,this.#O({hasSelectedText:!1}));return}if(this.#E?.hide(),this.#L=e,this.#O({hasSelectedText:!0}),!(this.#T!==At.HIGHLIGHT&&this.#T!==At.NONE)&&(this.#T===At.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#_=this.isShiftKeyDown,!this.isShiftKeyDown)){const o=this.#T===At.HIGHLIGHT?this.#tt(a):null;if(o?.toggleDrawing(),this.#M){const l=new AbortController,h=this.combinedSignal(l),d=f=>{f.type==="pointerup"&&f.button!==0||(l.abort(),o?.toggleDrawing(!0),f.type==="pointerup"&&this.#K("main_toolbar"))};window.addEventListener("pointerup",d,{signal:h}),window.addEventListener("blur",d,{signal:h})}else o?.toggleDrawing(!0),this.#K("main_toolbar")}}#K(t=""){this.#T===At.HIGHLIGHT?this.highlightSelection(t):this.#y&&this.#it()}#rt(){document.addEventListener("selectionchange",this.#at.bind(this),{signal:this._signal})}#ot(){if(this.#A)return;this.#A=new AbortController;const t=this.combinedSignal(this.#A);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#lt(){this.#A?.abort(),this.#A=null}blur(){if(this.isShiftKeyDown=!1,this.#_&&(this.#_=!1,this.#K("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#w)if(e.div.contains(t)){this.#k=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#k)return;const[t,e]=this.#k;this.#k=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#et(){if(this.#N)return;this.#N=new AbortController;const t=this.combinedSignal(this.#N);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#ct(){this.#N?.abort(),this.#N=null}#ut(){if(this.#d)return;this.#d=new AbortController;const t=this.combinedSignal(this.#d);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#ht(){this.#d?.abort(),this.#d=null}#dt(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#et(),this.setEditingState(!0)}removeEditListeners(){this.#ct(),this.setEditingState(!1)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const s of this.#u)if(s.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const s of this.#u)if(s.isHandlingMimeForPasting(e.type)){s.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const s of this.#w){const a=s.serialize(!0);a&&e.push(a)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const o of e.items)for(const l of this.#u)if(l.isHandlingMimeForPasting(o.type)){l.paste(o,this.currentLayer);return}let s=e.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(o){vt(`paste: "${o.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const a=this.currentLayer;try{const o=[];for(const d of s){const f=await a.deserialize(d);if(!f)return;o.push(f)}const l=()=>{for(const d of o)this.#nt(d);this.#st(o)},h=()=>{for(const d of o)d.remove()};this.addCommands({cmd:l,undo:h,mustExec:!0})}catch(o){vt(`paste: "${o.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#T!==At.NONE&&!this.isEditorHandlingKeyboard&&ti._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#_&&(this.#_=!1,this.#K("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#O(t){Object.entries(t).some(([s,a])=>this.#Y[s]!==a)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#Y,t)}),this.#T===At.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#q([[kt.HIGHLIGHT_FREE,!0]]))}#q(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#ot(),this.#ut(),this.#O({isEditing:this.#T!==At.NONE,isEmpty:this.#W(),hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:this.#c.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#lt(),this.#ht(),this.#O({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#u){this.#u=t;for(const e of this.#u)this.#q(e.defaultPropertiesToUpdate)}}getId(){return this.#D.id}get currentLayer(){return this.#r.get(this.#f)}getLayer(t){return this.#r.get(t)}get currentPageIndex(){return this.#f}addLayer(t){this.#r.set(t.pageIndex,t),this.#R?t.enable():t.disable()}removeLayer(t){this.#r.delete(t.pageIndex)}async updateMode(t,e=null,s=!1,a=!1,o=!1,l=!1){if(this.#T!==t&&!(this.#z&&(await this.#z.promise,!this.#z))){if(this.#z=Promise.withResolvers(),this.#h?.commitOrRemove(),this.#T===At.POPUP&&this.#l?.hideSidebar(),this.#l?.destroyPopup(),this.#T=t,t===At.NONE){this.setEditingState(!1),this.#pt();for(const h of this.#n.values())h.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#z.resolve();return}for(const h of this.#n.values())h.addStandaloneCommentButton();t===At.SIGNATURE&&await this.#U?.loadSignatures(),s&&zt.clearPointerType(),this.setEditingState(!0),await this.#ft(),this.unselectAll();for(const h of this.#r.values())h.updateMode(t);if(t===At.POPUP){this.#s||=await this.#X.getAnnotationsByType(new Set(this.#u.map(f=>f._editorType)));const h=new Set,d=[];for(const f of this.#n.values()){const{annotationElementId:m,hasComment:y,deleted:b}=f;m&&h.add(m),y&&!b&&d.push(f.getData())}for(const f of this.#s){const{id:m,popupRef:y,contentsObj:b}=f;y&&b?.str&&!h.has(m)&&!this.#g.has(m)&&d.push(f)}this.#l?.showSidebar(d)}if(!e){a&&this.addNewEditorFromKeyboard(),this.#z.resolve();return}for(const h of this.#n.values())h.uid===e?(this.setSelected(h),l?h.editComment():o?h.enterInEditMode():h.focus()):h.unselect();this.#z.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#T&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#u){switch(t){case kt.CREATE:this.currentLayer.addNewEditor(e);return;case kt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#V||=new Map).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const s of this.#w)s.updateParams(t,e);else for(const s of this.#u)s.updateDefaultParams(t,e)}}showAllEditors(t,e,s=!1){for(const o of this.#n.values())o.editorType===t&&o.show(e);(this.#V?.get(kt.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#q([[kt.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#P!==t){this.#P=t;for(const e of this.#r.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#ft(){if(!this.#R){this.#R=!0;const t=[];for(const e of this.#r.values())t.push(e.enable());await Promise.all(t);for(const e of this.#n.values())e.enable()}}#pt(){if(this.unselectAll(),this.#R){this.#R=!1;for(const t of this.#r.values())t.disable();for(const t of this.#n.values())t.disable()}}*getEditors(t){for(const e of this.#n.values())e.pageIndex===t&&(yield e)}getEditor(t){return this.#n.get(t)}addEditor(t){this.#n.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#S&&clearTimeout(this.#S),this.#S=setTimeout(()=>{this.focusMainContainer(),this.#S=null},0)),this.#n.delete(t.id),t.annotationElementId&&this.#B?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#g.has(t.annotationElementId))&&this.#i?.remove(t.id)}addDeletedAnnotationElement(t){this.#g.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#g.has(t)}removeDeletedAnnotationElement(t){this.#g.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#nt(t){const e=this.#r.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#q(t.propertiesToUpdate))}get#mt(){let t=null;for(t of this.#w);return t}updateUI(t){this.#mt===t&&this.#q(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#q(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#w.has(t)){this.#w.delete(t),t.unselect(),this.#O({hasSelectedEditor:this.hasSelection});return}this.#w.add(t),t.select(),this.#q(t.propertiesToUpdate),this.#O({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.uid}),this.#h?.commitOrRemove();for(const e of this.#w)e!==t&&e.unselect();this.#w.clear(),this.#w.add(t),t.select(),this.#q(t.propertiesToUpdate),this.#O({hasSelectedEditor:!0})}isSelected(t){return this.#w.has(t)}get firstSelectedEditor(){return this.#w.values().next().value}unselect(t){t.unselect(),this.#w.delete(t),this.#O({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#w.size!==0}get isEnterHandled(){return this.#w.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#c.undo(),this.#O({hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#W()}),this._editorUndoBar?.hide()}redo(){this.#c.redo(),this.#O({hasSomethingToUndo:!0,hasSomethingToRedo:this.#c.hasSomethingToRedo(),isEmpty:this.#W()})}addCommands(t){this.#c.add(t),this.#O({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#W()})}cleanUndoStack(t){this.#c.cleanType(t)}#W(){if(this.#n.size===0)return!0;if(this.#n.size===1)for(const t of this.#n.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#w],s=()=>{this._editorUndoBar?.show(a,e.length===1?e[0].editorType:e.length);for(const o of e)o.remove()},a=()=>{for(const o of e)this.#nt(o)};this.addCommands({cmd:s,undo:a,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#st(t){for(const e of this.#w)e.unselect();this.#w.clear();for(const e of t)e.isEmpty()||(this.#w.add(e),e.select());this.#O({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#w)t.commit();this.#st(this.#n.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#T!==At.NONE))&&!this.#h?.commitOrRemove()&&this.hasSelection){for(const t of this.#w)t.unselect();this.#w.clear(),this.#O({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;this.#j[0]+=t,this.#j[1]+=e;const[a,o]=this.#j,l=[...this.#w],h=1e3;this.#I&&clearTimeout(this.#I),this.#I=setTimeout(()=>{this.#I=null,this.#j[0]=this.#j[1]=0,this.addCommands({cmd:()=>{for(const d of l)this.#n.has(d.id)&&(d.translateInPage(a,o),d.translationDone())},undo:()=>{for(const d of l)this.#n.has(d.id)&&(d.translateInPage(-a,-o),d.translationDone())},mustExec:!1})},h);for(const d of l)d.translateInPage(t,e),d.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#m=new Map;for(const t of this.#w)this.#m.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#m)return!1;this.disableUserSelect(!1);const t=this.#m;this.#m=null;let e=!1;for(const[{x:a,y:o,pageIndex:l},h]of t)h.newX=a,h.newY=o,h.newPageIndex=l,e||=a!==h.savedX||o!==h.savedY||l!==h.savedPageIndex;if(!e)return!1;const s=(a,o,l,h)=>{if(this.#n.has(a.id)){const d=this.#r.get(h);d?a._setParentAndPosition(d,o,l):(a.pageIndex=h,a.x=o,a.y=l)}};return this.addCommands({cmd:()=>{for(const[a,{newX:o,newY:l,newPageIndex:h}]of t)s(a,o,l,h)},undo:()=>{for(const[a,{savedX:o,savedY:l,savedPageIndex:h}]of t)s(a,o,l,h)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#m)for(const s of this.#m.keys())s.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#w.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#T}isEditingMode(){return this.#T!==At.NONE}get imageManager(){return _t(this,"imageManager",new Pf)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let f=0,m=e.rangeCount;f<m;f++)if(!t.contains(e.getRangeAt(f).commonAncestorContainer))return null;const{x:s,y:a,width:o,height:l}=t.getBoundingClientRect();let h;switch(t.getAttribute("data-main-rotation")){case"90":h=(f,m,y,b)=>({x:(m-a)/l,y:1-(f+y-s)/o,width:b/l,height:y/o});break;case"180":h=(f,m,y,b)=>({x:1-(f+y-s)/o,y:1-(m+b-a)/l,width:y/o,height:b/l});break;case"270":h=(f,m,y,b)=>({x:1-(m+b-a)/l,y:(f-s)/o,width:b/l,height:y/o});break;default:h=(f,m,y,b)=>({x:(f-s)/o,y:(m-a)/l,width:y/o,height:b/l});break}const d=[];for(let f=0,m=e.rangeCount;f<m;f++){const y=e.getRangeAt(f);if(!y.collapsed)for(const{x:b,y:v,width:w,height:A}of y.getClientRects())w===0||A===0||d.push(h(b,v,w,A))}return d.length===0?null:d}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#o||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#o?.delete(t)}renderAnnotationElement(t){const e=this.#o?.get(t.data.id);if(!e)return;const s=this.#i.getRawValue(e);s&&(this.#T===At.NONE&&!s.hasBeenModified||s.renderAnnotationElement(t))}setMissingCanvas(t,e,s){const a=this.#B?.get(t);a&&(a.setCanvas(e,s),this.#B.delete(t))}addMissingCanvas(t,e){(this.#B||=new Map).set(t,e)}}class Wn{#t=null;#e=!1;#s=null;#n=null;#r=null;#a=null;#i=!1;#o=null;#c=null;#l=null;#d=null;#h=!1;static#f=null;static _l10n=null;constructor(t){this.#c=t,this.#h=t._uiManager.useNewAltTextFlow,Wn.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){Wn._l10n??=t}async render(){const t=this.#s=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#n=document.createElement("span");t.append(e),this.#h?(t.classList.add("new"),t.setAttribute("data-l10n-id",Wn.#f.missing),e.setAttribute("data-l10n-id",Wn.#f["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=this.#c._uiManager._signal;t.addEventListener("contextmenu",Ln,{signal:s}),t.addEventListener("pointerdown",o=>o.stopPropagation(),{signal:s});const a=o=>{o.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#h&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#g}})};return t.addEventListener("click",a,{capture:!0,signal:s}),t.addEventListener("keydown",o=>{o.target===t&&o.key==="Enter"&&(this.#i=!0,a(o))},{signal:s}),await this.#m(),t}get#g(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#s&&(this.#s.focus({focusVisible:this.#i}),this.#i=!1)}isEmpty(){return this.#h?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#h?this.#t!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}async setGuessedText(t){this.#t===null&&(this.#l=t,this.#d=await Wn._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#m())}toggleAltTextBadge(t=!1){if(!this.#h||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){const e=this.#o=document.createElement("div");e.className="noAltTextBadge",this.#c.div.append(e)}this.#o.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#l===e&&(e=this.#d),{altText:e,decorative:this.#e,guessedText:this.#l,textWithDisclaimer:this.#d}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:s,textWithDisclaimer:a,cancel:o=!1}){s&&(this.#l=s,this.#d=a),!(this.#t===t&&this.#e===e)&&(o||(this.#t=t,this.#e=e),this.#m())}toggle(t=!1){this.#s&&(!t&&this.#a&&(clearTimeout(this.#a),this.#a=null),this.#s.disabled=!t)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#g}})}destroy(){this.#s?.remove(),this.#s=null,this.#n=null,this.#r=null,this.#o?.remove(),this.#o=null}async#m(){const t=this.#s;if(!t)return;if(this.#h){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",Wn.#f[this.#g]),this.#n?.setAttribute("data-l10n-id",Wn.#f[`${this.#g}-label`]),!this.#t){this.#r?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#r?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#r;if(!e){this.#r=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#c.id}`;const a=100,o=this.#c._uiManager._signal;o.addEventListener("abort",()=>{clearTimeout(this.#a),this.#a=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#a=setTimeout(()=>{this.#a=null,this.#r.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},a)},{signal:o}),t.addEventListener("mouseleave",()=>{this.#a&&(clearTimeout(this.#a),this.#a=null),this.#r?.classList.remove("show")},{signal:o})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#c.getElementForAltText()?.setAttribute("aria-describedby",e.id)}}class Gl{#t=null;#e=null;#s=!1;#n=null;#r=null;#a=null;#i=null;#o=null;#c=!1;#l=null;constructor(t){this.#n=t}renderForToolbar(){const t=this.#e=document.createElement("button");return t.className="comment",this.#d(t,!1)}renderForStandalone(){const t=this.#t=document.createElement("button");t.className="annotationCommentButton";const e=this.#n.commentButtonPosition;if(e){const{style:s}=t;s.insetInlineEnd=`calc(${100*(this.#n._uiManager.direction==="ltr"?1-e[0]:e[0])}% - var(--comment-button-dim))`,s.top=`calc(${100*e[1]}% - var(--comment-button-dim))`;const a=this.#n.commentButtonColor;a&&(s.backgroundColor=a)}return this.#d(t,!0)}focusButton(){setTimeout(()=>{(this.#t??this.#e)?.focus()},0)}onUpdatedColor(){if(!this.#t)return;const t=this.#n.commentButtonColor;t&&(this.#t.style.backgroundColor=t),this.#n._uiManager.updatePopupColor(this.#n)}get commentButtonWidth(){return(this.#t?.getBoundingClientRect().width??0)/this.#n.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#l)return this.#l;if(!this.#t)return null;const{x:t,y:e,height:s}=this.#t.getBoundingClientRect(),{x:a,y:o,width:l,height:h}=this.#n.parent.boundingClientRect;return[(t-a)/l,(e+s-o)/h]}set commentPopupPositionInLayer(t){this.#l=t}hasDefaultPopupPosition(){return this.#l===null}removeStandaloneCommentButton(){this.#t?.remove(),this.#t=null}removeToolbarCommentButton(){this.#e?.remove(),this.#e=null}setCommentButtonStates({selected:t,hasPopup:e}){this.#t&&(this.#t.classList.toggle("selected",t),this.#t.ariaExpanded=e)}#d(t,e){if(!this.#n._uiManager.hasCommentManager())return null;t.tabIndex="0",t.ariaHasPopup="dialog",e?(t.ariaControls="commentPopup",t.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(t.ariaControlsElements=[this.#n._uiManager.getCommentDialogElement()],t.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const s=this.#n._uiManager._signal;if(!(s instanceof AbortSignal)||s.aborted)return t;t.addEventListener("contextmenu",Ln,{signal:s}),e&&(t.addEventListener("focusin",o=>{this.#n._focusEventsAllowed=!1,ae(o)},{capture:!0,signal:s}),t.addEventListener("focusout",o=>{this.#n._focusEventsAllowed=!0,ae(o)},{capture:!0,signal:s})),t.addEventListener("pointerdown",o=>o.stopPropagation(),{signal:s});const a=o=>{o.preventDefault(),t===this.#e?this.edit():this.#n.toggleComment(!0)};return t.addEventListener("click",a,{capture:!0,signal:s}),t.addEventListener("keydown",o=>{o.target===t&&o.key==="Enter"&&(this.#s=!0,a(o))},{signal:s}),t.addEventListener("pointerenter",()=>{this.#n.toggleComment(!1,!0)},{signal:s}),t.addEventListener("pointerleave",()=>{this.#n.toggleComment(!1,!1)},{signal:s}),t}edit(t){const e=this.commentPopupPositionInLayer;let s,a;if(e)[s,a]=e;else{[s,a]=this.#n.commentButtonPosition;const{width:m,height:y,x:b,y:v}=this.#n;s=b+s*m,a=v+a*y}const o=this.#n.parent.boundingClientRect,{x:l,y:h,width:d,height:f}=o;this.#n._uiManager.editComment(this.#n,l+s*d,h+a*f,{...t,parentDimensions:o})}finish(){this.#e&&(this.#e.focus({focusVisible:this.#s}),this.#s=!1)}isDeleted(){return this.#c||this.#i===""}isEmpty(){return this.#i===null}hasBeenEdited(){return this.isDeleted()||this.#i!==this.#r}serialize(){return this.data}get data(){return{text:this.#i,richText:this.#a,date:this.#o,deleted:this.isDeleted()}}set data(t){if(t!==this.#i&&(this.#a=null),t===null){this.#i="",this.#c=!0;return}this.#i=t,this.#o=new Date,this.#c=!1}setInitialText(t,e=null){this.#r=t,this.data=t,this.#o=null,this.#a=e}shown(){}destroy(){this.#e?.remove(),this.#e=null,this.#t?.remove(),this.#t=null,this.#i="",this.#a=null,this.#o=null,this.#n=null,this.#s=!1,this.#c=!1}}class jc{#t;#e=!1;#s=null;#n;#r;#a;#i;#o=null;#c;#l=null;#d;#h=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:s=null,onPinchStart:a=null,onPinching:o=null,onPinchEnd:l=null,signal:h}){this.#t=t,this.#s=s,this.#n=e,this.#r=a,this.#a=o,this.#i=l,this.#d=new AbortController,this.#c=AbortSignal.any([h,this.#d.signal]),t.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#c})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Zn.pixelRatio}#f(t){if(this.#n?.())return;if(t.touches.length===1){if(this.#o)return;const a=this.#o=new AbortController,o=AbortSignal.any([this.#c,a.signal]),l=this.#t,h={capture:!0,signal:o,passive:!1},d=f=>{f.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};l.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(ae(f),d(f))},h),l.addEventListener("pointerup",d,h),l.addEventListener("pointercancel",d,h);return}if(!this.#h){this.#h=new AbortController;const a=AbortSignal.any([this.#c,this.#h.signal]),o=this.#t,l={signal:a,capture:!1,passive:!1};o.addEventListener("touchmove",this.#g.bind(this),l);const h=this.#m.bind(this);o.addEventListener("touchend",h,l),o.addEventListener("touchcancel",h,l),l.capture=!0,o.addEventListener("pointerdown",ae,l),o.addEventListener("pointermove",ae,l),o.addEventListener("pointercancel",ae,l),o.addEventListener("pointerup",ae,l),this.#r?.()}if(ae(t),t.touches.length!==2||this.#s?.()){this.#l=null;return}let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]),this.#l={touch0X:e.screenX,touch0Y:e.screenY,touch1X:s.screenX,touch1Y:s.screenY}}#g(t){if(!this.#l||t.touches.length!==2)return;ae(t);let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]);const{screenX:a,screenY:o}=e,{screenX:l,screenY:h}=s,d=this.#l,{touch0X:f,touch0Y:m,touch1X:y,touch1Y:b}=d,v=y-f,w=b-m,A=l-a,x=h-o,S=Math.hypot(A,x)||1,T=Math.hypot(v,w)||1;if(!this.#e&&Math.abs(T-S)<=jc.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(d.touch0X=a,d.touch0Y=o,d.touch1X=l,d.touch1Y=h,!this.#e){this.#e=!0;return}const C=[(a+l)/2,(o+h)/2];this.#a?.(C,T,S)}#m(t){t.touches.length>=2||(this.#h&&(this.#h.abort(),this.#h=null,this.#i?.()),this.#l&&(ae(t),this.#l=null,this.#e=!1))}destroy(){this.#d?.abort(),this.#d=null,this.#o?.abort(),this.#o=null}}class ct{#t=null;#e=null;#s=null;#n=null;#r=null;#a=!1;#i=null;#o="";#c=null;#l=null;#d=null;#h=null;#f=null;#g="";#m=!1;#u=null;#p=!1;#y=!1;#v=!1;#b=null;#x=0;#S=0;#A=null;#C=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#_=!1;#E=ct._zIndex++;static _borderLineWidth=-1;static _colorManager=new Ff;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=ct.prototype._resizeWithKeyboard,e=ti.TRANSLATE_SMALL,s=ti.TRANSLATE_BIG;return _t(this,"_resizerKeyboardManager",new bo([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,s]}],[["Escape","mac+Escape"],ct.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null,this.creationDate=t.creationDate||new Date,this.modificationDate=t.modificationDate||null,this.canAddComment=!0;const{rotation:e,rawDims:{pageWidth:s,pageHeight:a,pageX:o,pageY:l}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,a],this.pageTranslation=[o,l];const[h,d]=this.parentDimensions;this.x=t.x/h,this.y=t.y/d,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return _t(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new DE({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(ct._l10n??=t,ct._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),ct._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);ct._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){Kt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#_}set _isDraggable(t){this.#_=t,this.div?.classList.toggle("draggable",t)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#E}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):(this.#I(),this.#h?.remove(),this.#h=null),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#m?this.#m=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,s,a){const[o,l]=this.parentDimensions;[s,a]=this.screenToPageTranslation(s,a),this.x=(t+s)/o,this.y=(e+a)/l,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[s,a]=this.parentDimensions;this.setAt(t*s,e*a,this.width*s,this.height*a),this._onTranslated()}#D([t,e],s,a){[s,a]=this.screenToPageTranslation(s,a),this.x+=s/t,this.y+=a/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#D(this.parentDimensions,t,e)}translateInPage(t,e){this.#u||=[this.x,this.y,this.width,this.height],this.#D(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#u||=[this.x,this.y,this.width,this.height];const{div:s,parentDimensions:[a,o]}=this;if(this.x+=t/a,this.y+=e/o,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:y,y:b}=this.div.getBoundingClientRect();this.parent.findNewParent(this,y,b)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:l,y:h}=this;const[d,f]=this.getBaseTranslation();l+=d,h+=f;const{style:m}=s;m.left=`${(100*l).toFixed(2)}%`,m.top=`${(100*h).toFixed(2)}%`,this._onTranslating(l,h),s.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#u&&(this.#u[0]!==this.x||this.#u[1]!==this.y)}get _hasBeenResized(){return!!this.#u&&(this.#u[2]!==this.width||this.#u[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:s}=ct,a=s/t,o=s/e;switch(this.rotation){case 90:return[-a,o];case 180:return[a,o];case 270:return[a,-o];default:return[-a,-o]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[s,a]}=this;let{x:o,y:l,width:h,height:d}=this;if(h*=s,d*=a,o*=s,l*=a,this._mustFixPosition)switch(t){case 0:o=je(o,0,s-h),l=je(l,0,a-d);break;case 90:o=je(o,0,s-d),l=je(l,h,a);break;case 180:o=je(o,h,s),l=je(l,d,a);break;case 270:o=je(o,d,s),l=je(l,0,a-h);break}this.x=o/=s,this.y=l/=a;const[f,m]=this.getBaseTranslation();o+=f,l+=m,e.left=`${(100*o).toFixed(2)}%`,e.top=`${(100*l).toFixed(2)}%`,this.moveInDOM()}static#R(t,e,s){switch(s){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return ct.#R(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return ct.#R(t,e,360-this.parentRotation)}#M(t){switch(t){case 90:{const[e,s]=this.pageDimensions;return[0,-e/s,s/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,s]=this.pageDimensions;return[0,e/s,-s/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,s]}=this;return[e*t,s*t]}setDims(){const{div:{style:t},width:e,height:s}=this;t.width=`${(100*e).toFixed(2)}%`,t.height=`${(100*s).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#P(){if(this.#c)return;this.#c=document.createElement("div"),this.#c.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const s of t){const a=document.createElement("div");this.#c.append(a),a.classList.add("resizer",s),a.setAttribute("data-resizer-name",s),a.addEventListener("pointerdown",this.#N.bind(this,s),{signal:e}),a.addEventListener("contextmenu",Ln,{signal:e}),a.tabIndex=-1}this.div.prepend(this.#c)}#N(t,e){e.preventDefault();const{isMac:s}=Ae.platform;if(e.button!==0||e.ctrlKey&&s)return;this.#s?.toggle(!1);const a=this._isDraggable;this._isDraggable=!1,this.#l=[e.screenX,e.screenY];const o=new AbortController,l=this._uiManager.combinedSignal(o);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#B.bind(this,t),{passive:!0,capture:!0,signal:l}),window.addEventListener("touchmove",ae,{passive:!1,signal:l}),window.addEventListener("contextmenu",Ln,{signal:l}),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const h=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const f=()=>{o.abort(),this.parent.togglePointerEvents(!0),this.#s?.toggle(!0),this._isDraggable=a,this.parent.div.style.cursor=h,this.div.style.cursor=d,this.#F()};window.addEventListener("pointerup",f,{signal:l}),window.addEventListener("blur",f,{signal:l})}#k(t,e,s,a){this.width=s,this.height=a,this.x=t,this.y=e,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#F(){if(!this.#d)return;const{savedX:t,savedY:e,savedWidth:s,savedHeight:a}=this.#d;this.#d=null;const o=this.x,l=this.y,h=this.width,d=this.height;o===t&&l===e&&h===s&&d===a||this.addCommands({cmd:this.#k.bind(this,o,l,h,d),undo:this.#k.bind(this,t,e,s,a),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#B(t,e){const[s,a]=this.parentDimensions,o=this.x,l=this.y,h=this.width,d=this.height,f=ct.MIN_SIZE/s,m=ct.MIN_SIZE/a,y=this.#M(this.rotation),b=(B,$)=>[y[0]*B+y[2]*$,y[1]*B+y[3]*$],v=this.#M(360-this.rotation),w=(B,$)=>[v[0]*B+v[2]*$,v[1]*B+v[3]*$];let A,x,S=!1,T=!1;switch(t){case"topLeft":S=!0,A=(B,$)=>[0,0],x=(B,$)=>[B,$];break;case"topMiddle":A=(B,$)=>[B/2,0],x=(B,$)=>[B/2,$];break;case"topRight":S=!0,A=(B,$)=>[B,0],x=(B,$)=>[0,$];break;case"middleRight":T=!0,A=(B,$)=>[B,$/2],x=(B,$)=>[0,$/2];break;case"bottomRight":S=!0,A=(B,$)=>[B,$],x=(B,$)=>[0,0];break;case"bottomMiddle":A=(B,$)=>[B/2,$],x=(B,$)=>[B/2,0];break;case"bottomLeft":S=!0,A=(B,$)=>[0,$],x=(B,$)=>[B,0];break;case"middleLeft":T=!0,A=(B,$)=>[0,$/2],x=(B,$)=>[B,$/2];break}const C=A(h,d),N=x(h,d);let D=b(...N);const L=ct._round(o+D[0]),k=ct._round(l+D[1]);let V=1,K=1,J,W;if(e.fromKeyboard)({deltaX:J,deltaY:W}=e);else{const{screenX:B,screenY:$}=e,[tt,wt]=this.#l;[J,W]=this.screenToPageTranslation(B-tt,$-wt),this.#l[0]=B,this.#l[1]=$}if([J,W]=w(J/s,W/a),S){const B=Math.hypot(h,d);V=K=Math.max(Math.min(Math.hypot(N[0]-C[0]-J,N[1]-C[1]-W)/B,1/h,1/d),f/h,m/d)}else T?V=je(Math.abs(N[0]-C[0]-J),f,1)/h:K=je(Math.abs(N[1]-C[1]-W),m,1)/d;const pt=ct._round(h*V),Tt=ct._round(d*K);D=b(...x(pt,Tt));const gt=L-D[0],Nt=k-D[1];this.#u||=[this.x,this.y,this.width,this.height],this.width=pt,this.height=Tt,this.x=gt,this.y=Nt,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#s?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#y)return this._editToolbar;this._editToolbar=new so(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,s]of t)await this._editToolbar.addButton(e,s);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#s?.destroy()}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#s||(Wn.initialize(ct._l10n),this.#s=new Wn(this),this.#t&&(this.#s.data=this.#t,this.#t=null)),this.#s}get altTextData(){return this.#s?.data}set altTextData(t){this.#s&&(this.#s.data=t)}get guessedAltText(){return this.#s?.guessedText}async setGuessedAltText(t){await this.#s?.setGuessedText(t)}serializeAltText(t){return this.#s?.serialize(t)}hasAltText(){return!!this.#s&&!this.#s.isEmpty()}hasAltTextData(){return this.#s?.hasData()??!1}focusCommentButton(){this.#n?.focusButton()}addCommentButton(){return this.canAddComment?this.#n||=new Gl(this):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(this.#r){this._uiManager.isEditingMode()&&this.#r.classList.remove("hidden");return}this.hasComment&&(this.#r=this.#n.renderForStandalone(),this.div.append(this.#r))}}removeStandaloneCommentButton(){this.#n.removeStandaloneCommentButton(),this.#r=null}hideStandaloneCommentButton(){this.#r?.classList.add("hidden")}get comment(){const{data:{richText:t,text:e,date:s,deleted:a}}=this.#n;return{text:e,richText:t,date:s,deleted:a,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(t){this.#n||=new Gl(this),this.#n.data=t,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:t,popupRef:e,richText:s}){if(!e||(this.#n||=new Gl(this),this.#n.setInitialText(t,s),!this.annotationElementId))return;const a=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);a&&this.updateFromAnnotationLayer(a)}get hasEditedComment(){return this.#n?.hasBeenEdited()}get hasDeletedComment(){return this.#n?.isDeleted()}get hasComment(){return!!this.#n&&!this.#n.isEmpty()&&!this.#n.isDeleted()}async editComment(t){this.#n||=new Gl(this),this.#n.edit(t)}toggleComment(t,e=void 0){this.hasComment&&this._uiManager.toggleComment(this,t,e)}setSelectedCommentButton(t){this.#n.setSelectedButton(t)}addComment(t){if(this.hasEditedComment){const[,,,a]=t.rect,[o]=this.pageDimensions,[l]=this.pageTranslation,h=l+o+1,d=a-100,f=h+180;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[h,d,f,a]}}}updateFromAnnotationLayer({popup:{contents:t,deleted:e}}){this.#n.data=e?null:t}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#a?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#H();const[e,s]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*s/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/s).toFixed(2)}%`);const[a,o]=this.getInitialTranslation();return this.translate(a,o),n_(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#C||=new jc({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#$.bind(this),onPinching:this.#T.bind(this),onPinchEnd:this.#w.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),t}#$(){this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#s?.toggle(!1),this.parent.togglePointerEvents(!1)}#T(t,e,s){let o=.7*(s/e)+1-.7;if(o===1)return;const l=this.#M(this.rotation),h=(L,k)=>[l[0]*L+l[2]*k,l[1]*L+l[3]*k],[d,f]=this.parentDimensions,m=this.x,y=this.y,b=this.width,v=this.height,w=ct.MIN_SIZE/d,A=ct.MIN_SIZE/f;o=Math.max(Math.min(o,1/b,1/v),w/b,A/v);const x=ct._round(b*o),S=ct._round(v*o);if(x===b&&S===v)return;this.#u||=[m,y,b,v];const T=h(b/2,v/2),C=ct._round(m+T[0]),N=ct._round(y+T[1]),D=h(x/2,S/2);this.x=C-D[0],this.y=N-D[1],this.width=x,this.height=S,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#w(){this.#s?.toggle(!0),this.parent.togglePointerEvents(!0),this.#F()}pointerdown(t){const{isMac:e}=Ae.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#m=!0,this._isDraggable){this.#U(t);return}this.#L(t)}#L(t){const{isMac:e}=Ae.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#U(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let s=!1;const a=new AbortController,o=this._uiManager.combinedSignal(a),l={capture:!0,passive:!1,signal:o},h=f=>{a.abort(),this.#i=null,this.#m=!1,this._uiManager.endDragSession()||this.#L(f),s&&this._onStopDragging()};e&&(this.#x=t.clientX,this.#S=t.clientY,this.#i=t.pointerId,this.#o=t.pointerType,window.addEventListener("pointermove",f=>{s||(s=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:m,clientY:y,pointerId:b}=f;if(b!==this.#i){ae(f);return}const[v,w]=this.screenToPageTranslation(m-this.#x,y-this.#S);this.#x=m,this.#S=y,this._uiManager.dragSelectedEditors(v,w)},l),window.addEventListener("touchmove",ae,l),window.addEventListener("pointerdown",f=>{f.pointerType===this.#o&&(this.#C||f.isPrimary)&&h(f),ae(f)},l));const d=f=>{if(!this.#i||this.#i===f.pointerId){h(f);return}ae(f)};window.addEventListener("pointerup",d,{signal:o}),window.addEventListener("blur",d,{signal:o})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#b&&clearTimeout(this.#b),this.#b=setTimeout(()=>{this.#b=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,s){t.changeParent(this),this.x=e,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,s=this.rotation){const a=this.parentScale,[o,l]=this.pageDimensions,[h,d]=this.pageTranslation,f=t/a,m=e/a,y=this.x*o,b=this.y*l,v=this.width*o,w=this.height*l;switch(s){case 0:return[y+f+h,l-b-m-w+d,y+f+v+h,l-b-m+d];case 90:return[y+m+h,l-b+f+d,y+m+w+h,l-b+f+v+d];case 180:return[y-f-v+h,l-b+m+d,y-f+h,l-b+m+w+d];case 270:return[y-m-w+h,l-b-f-v+d,y-m+h,l-b-f+d];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[s,a,o,l]=t,h=o-s,d=l-a;switch(this.rotation){case 0:return[s,e-l,h,d];case 90:return[s,e-a,d,h];case 180:return[o,e-a,h,d];case 270:return[o,e-l,d,h];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&ct._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#n?.onUpdatedColor()}getData(){const{comment:{text:t,color:e,date:s,opacity:a,deleted:o,richText:l},uid:h,pageIndex:d,creationDate:f,modificationDate:m}=this;return{id:h,pageIndex:d,rect:this.getPDFRect(),richText:l,contentsObj:{str:t},creationDate:f,modificationDate:s||m,popupRef:!o,color:e,opacity:a}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#y=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#y=!1,!0):!1}isInEditMode(){return this.#y}shouldGetKeyboardEvents(){return this.#v}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:s,right:a}=this.getClientDimensions(),{innerHeight:o,innerWidth:l}=window;return e<l&&a>0&&t<o&&s>0}#H(){if(this.#f||!this.div)return;this.#f=new AbortController;const t=this._uiManager.combinedSignal(this.#f);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#H()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(t,e,s){const a=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:s,annotationElementId:t.annotationElementId,creationDate:t.creationDate,modificationDate:t.modificationDate});a.rotation=t.rotation,a.#t=t.accessibilityData,a._isCopy=t.isCopy||!1;const[o,l]=a.pageDimensions,[h,d,f,m]=a.getRectInCurrentCoords(t.rect,l);return a.x=h/o,a.y=d/l,a.width=f/o,a.height=m/l,a}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#f?.abort(),this.#f=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),this.#b&&(clearTimeout(this.#b),this.#b=null),this.#I(),this.removeEditToolbar(),this.#A){for(const t of this.#A.values())clearTimeout(t);this.#A=null}this.parent=null,this.#C?.destroy(),this.#C=null,this.#h?.remove(),this.#h=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#P(),this.#c.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[t,e]}=this,[s,a,o,l]=this.getPDFRect();return[ct._round(s+(o-s)*t),ct._round(a+(l-a)*(1-e))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#n.commentPopupPositionInLayer}set commentPopupPosition(t){this.#n.commentPopupPositionInLayer=t}hasDefaultPopupPosition(){return this.#n.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#n.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(t){this.#n?.setCommentButtonStates(t)}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#d={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#c.children;if(!this.#e){this.#e=Array.from(e);const l=this.#V.bind(this),h=this.#X.bind(this),d=this._uiManager._signal;for(const f of this.#e){const m=f.getAttribute("data-resizer-name");f.setAttribute("role","spinbutton"),f.addEventListener("keydown",l,{signal:d}),f.addEventListener("blur",h,{signal:d}),f.addEventListener("focus",this.#Y.bind(this,m),{signal:d}),f.setAttribute("data-l10n-id",ct._l10nResizer[m])}}const s=this.#e[0];let a=0;for(const l of e){if(l===s)break;a++}const o=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(o!==a){if(o<a)for(let h=0;h<a-o;h++)this.#c.append(this.#c.firstElementChild);else if(o>a)for(let h=0;h<o-a;h++)this.#c.firstElementChild.before(this.#c.lastElementChild);let l=0;for(const h of e){const f=this.#e[l++].getAttribute("data-resizer-name");h.setAttribute("data-l10n-id",ct._l10nResizer[f])}}this.#j(0),this.#v=!0,this.#c.firstElementChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#V(t){ct._resizerKeyboardManager.exec(this,t)}#X(t){this.#v&&t.relatedTarget?.parentNode!==this.#c&&this.#I()}#Y(t){this.#g=this.#v?t:""}#j(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#v&&this.#B(this.#g,{deltaX:t,deltaY:e,fromKeyboard:!0})}#I(){this.#v=!1,this.#j(-1),this.#F()}_stopResizingWithKeyboard(){this.#I(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#s?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#c?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#s?.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){t.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(t){this.#p=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#A||=new Map;const{action:s}=t;let a=this.#A.get(s);a&&clearTimeout(a),a=setTimeout(()=>{this._reportTelemetry(t),this.#A.delete(s),this.#A.size===0&&(this.#A=null)},ct._telemetryTimeout),this.#A.set(s,a);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#a=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#a=!0}updateFakeAnnotationElement(t){if(!this.#h&&!this.deleted){this.#h=t.addFakeAnnotation(this);return}if(this.deleted){this.#h.remove(),this.#h=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#h.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const s=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),s.before(e)}return e}resetAnnotationElement(t){const{firstElementChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class DE extends ct{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Xb=3285377520,Mn=4294901760,Vn=65535;class s_{constructor(t){this.h1=t?t&4294967295:Xb,this.h2=t?t&4294967295:Xb}update(t){let e,s;if(typeof t=="string"){e=new Uint8Array(t.length*2),s=0;for(let A=0,x=t.length;A<x;A++){const S=t.charCodeAt(A);S<=255?e[s++]=S:(e[s++]=S>>>8,e[s++]=S&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),s=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const a=s>>2,o=s-a*4,l=new Uint32Array(e.buffer,0,a);let h=0,d=0,f=this.h1,m=this.h2;const y=3432918353,b=461845907,v=y&Vn,w=b&Vn;for(let A=0;A<a;A++)A&1?(h=l[A],h=h*y&Mn|h*v&Vn,h=h<<15|h>>>17,h=h*b&Mn|h*w&Vn,f^=h,f=f<<13|f>>>19,f=f*5+3864292196):(d=l[A],d=d*y&Mn|d*v&Vn,d=d<<15|d>>>17,d=d*b&Mn|d*w&Vn,m^=d,m=m<<13|m>>>19,m=m*5+3864292196);switch(h=0,o){case 3:h^=e[a*4+2]<<16;case 2:h^=e[a*4+1]<<8;case 1:h^=e[a*4],h=h*y&Mn|h*v&Vn,h=h<<15|h>>>17,h=h*b&Mn|h*w&Vn,a&1?f^=h:m^=h}this.h1=f,this.h2=m}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&Mn|t*36045&Vn,e=e*4283543511&Mn|((e<<16|t>>>16)*2950163797&Mn)>>>16,t^=e>>>1,t=t*444984403&Mn|t*60499&Vn,e=e*3301882366&Mn|((e<<16|t>>>16)*3120437893&Mn)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const nf=Object.freeze({map:null,hash:"",transfer:void 0});class Uf{#t=!1;#e=null;#s=null;#n=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const s=this.#n.get(t);return s===void 0?e:Object.assign(e,s)}getRawValue(t){return this.#n.get(t)}remove(t){const e=this.#n.get(t);if(e!==void 0&&(e instanceof ct&&this.#s.delete(e.annotationElementId),this.#n.delete(t),this.#n.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const s of this.#n.values())if(s instanceof ct)return;this.onAnnotationEditor(null)}}setValue(t,e){const s=this.#n.get(t);let a=!1;if(s!==void 0)for(const[o,l]of Object.entries(e))s[o]!==l&&(a=!0,s[o]=l);else a=!0,this.#n.set(t,e);a&&this.#r(),e instanceof ct&&((this.#s||=new Map).set(e.annotationElementId,e),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type))}has(t){return this.#n.has(t)}get size(){return this.#n.size}#r(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new i_(this)}get serializable(){if(this.#n.size===0)return nf;const t=new Map,e=new s_,s=[],a=Object.create(null);let o=!1;for(const[l,h]of this.#n){const d=h instanceof ct?h.serialize(!1,a):h;d&&(t.set(l,d),e.update(`${l}:${JSON.stringify(d)}`),o||=!!d.bitmap)}if(o)for(const l of t.values())l.bitmap&&s.push(l.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:s}:nf}get editorStats(){let t=null;const e=new Map;let s=0,a=0;for(const o of this.#n.values()){if(!(o instanceof ct)){o.popup&&(o.popup.deleted?a+=1:s+=1);continue}o.isCommentDeleted?a+=1:o.hasEditedComment&&(s+=1);const l=o.telemetryFinalData;if(!l)continue;const{type:h}=l;e.has(h)||e.set(h,Object.getPrototypeOf(o).constructor),t||=Object.create(null);const d=t[h]||=new Map;for(const[f,m]of Object.entries(l)){if(f==="type")continue;let y=d.get(f);y||(y=new Map,d.set(f,y));const b=y.get(m)??0;y.set(m,b+1)}}if((a>0||s>0)&&(t||=Object.create(null),t.comments={deleted:a,edited:s}),!t)return null;for(const[o,l]of e)t[o]=l.computeTelemetryFinalData(t[o]);return t}resetModifiedIds(){this.#e=null}updateEditor(t,e){const s=this.#s?.get(t);return s?(s.updateFromAnnotationLayer(e),!0):!1}getEditor(t){return this.#s?.get(t)||null}get modifiedIds(){if(this.#e)return this.#e;const t=[];if(this.#s)for(const e of this.#s.values())e.serialize()&&t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#n.entries()}}class i_ extends Uf{#t;constructor(t){super();const{map:e,hash:s,transfer:a}=t.serializable,o=structuredClone(e,a?{transfer:a}:null);this.#t={map:o,hash:s,transfer:a}}get print(){Kt("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return _t(this,"modifiedIds",{ids:new Set,hash:""})}}class OE{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:s}){if(!(!t||this.#t.has(t.loadedName))){if(Bt(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:a,src:o,style:l}=t,h=new FontFace(a,o,l);this.addNativeFontFace(h);try{await h.load(),this.#t.add(a),s?.(t)}catch{vt(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(h)}return}Kt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const s=t.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(a){throw vt(`Failed to load font '${s.family}': '${a}'.`),t.disableFontFace=!0,a}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const a=this._queueLoadingCallback(s);this._prepareFontLoadEvent(t,a)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return _t(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return _t(this,"isSyncFontLoadingSupported",He||Ae.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(Bt(!a.done,"completeRequest() cannot be called twice."),a.done=!0;s.length>0&&s[0].done;){const o=s.shift();setTimeout(o.callback,0)}}const{loadingRequests:s}=this,a={done:!1,complete:e,callback:t};return s.push(a),a}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return _t(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function s(N,D){return N.charCodeAt(D)<<24|N.charCodeAt(D+1)<<16|N.charCodeAt(D+2)<<8|N.charCodeAt(D+3)&255}function a(N,D,L,k){const V=N.substring(0,D),K=N.substring(D+L);return V+k+K}let o,l;const h=this._document.createElement("canvas");h.width=1,h.height=1;const d=h.getContext("2d");let f=0;function m(N,D){if(++f>30){vt("Load test font never loaded."),D();return}if(d.font="30px "+N,d.fillText(".",0,20),d.getImageData(0,0,1,1).data[3]>0){D();return}setTimeout(m.bind(null,N,D))}const y=`lt${Date.now()}${this.loadTestFontId++}`;let b=this._loadTestFont;b=a(b,976,y.length,y);const w=16,A=1482184792;let x=s(b,w);for(o=0,l=y.length-3;o<l;o+=4)x=x-A+s(y,o)|0;o<y.length&&(x=x-A+s(y+"XXX",o)|0),b=a(b,w,4,hE(x));const S=`url(data:font/opentype;base64,${btoa(b)});`,T=`@font-face {font-family:"${y}";src:${S}}`;this.insertRule(T);const C=this._document.createElement("div");C.style.visibility="hidden",C.style.width=C.style.height="10px",C.style.position="absolute",C.style.top=C.style.left="0px";for(const N of[t.loadedName,y]){const D=this._document.createElement("span");D.textContent="Hi",D.style.fontFamily=N,C.append(D)}this._document.body.append(C),m(y,()=>{C.remove(),e.complete()})}}class NE{#t;constructor(t,e=null,s,a){this.compiledGlyphs=Object.create(null),this.#t=t,this._inspectFont=e,s&&Object.assign(this,s),a&&(this.charProcOperatorList=a)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${Zv(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const s=this.loadedName+"_path_"+e;let a;try{a=t.get(s)}catch(l){vt(`getPathGenerator - ignoring character: "${l}".`)}const o=e_(a?.path);return this.fontExtraProperties||t.delete(s),this.compiledGlyphs[e]=o}get black(){return this.#t.black}get bold(){return this.#t.bold}get disableFontFace(){return this.#t.disableFontFace??!1}set disableFontFace(t){_t(this,"disableFontFace",!!t)}get fontExtraProperties(){return this.#t.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#t.isInvalidPDFjsFont}get isType3Font(){return this.#t.isType3Font}get italic(){return this.#t.italic}get missingFile(){return this.#t.missingFile}get remeasure(){return this.#t.remeasure}get vertical(){return this.#t.vertical}get ascent(){return this.#t.ascent}get defaultWidth(){return this.#t.defaultWidth}get descent(){return this.#t.descent}get bbox(){return this.#t.bbox}set bbox(t){_t(this,"bbox",t)}get fontMatrix(){return this.#t.fontMatrix}get fallbackName(){return this.#t.fallbackName}get loadedName(){return this.#t.loadedName}get mimetype(){return this.#t.mimetype}get name(){return this.#t.name}get data(){return this.#t.data}clearData(){this.#t.clearData()}get cssFontInfo(){return this.#t.cssFontInfo}get systemFontInfo(){return this.#t.systemFontInfo}get defaultVMetrics(){return this.#t.defaultVMetrics}}class La{#t;#e;#s;static strings=["fontFamily","fontWeight","italicAngle"];static write(t){const e=new TextEncoder,s={};let a=0;for(const f of La.strings){const m=e.encode(t[f]);s[f]=m,a+=4+m.length}const o=new ArrayBuffer(a),l=new Uint8Array(o),h=new DataView(o);let d=0;for(const f of La.strings){const m=s[f],y=m.length;h.setUint32(d,y),l.set(m,d+4),d+=4+y}return Bt(d===o.byteLength,"CssFontInfo.write: Buffer overflow"),o}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#s=new TextDecoder}#n(t){Bt(t<La.strings.length,"Invalid string index");let e=0;for(let a=0;a<t;a++)e+=this.#e.getUint32(e)+4;const s=this.#e.getUint32(e);return this.#s.decode(new Uint8Array(this.#t,e+4,s))}get fontFamily(){return this.#n(0)}get fontWeight(){return this.#n(1)}get italicAngle(){return this.#n(2)}}class ka{#t;#e;#s;static strings=["css","loadedName","baseFontName","src"];static write(t){const e=new TextEncoder,s={};let a=0;for(const b of ka.strings){const v=e.encode(t[b]);s[b]=v,a+=4+v.length}a+=4;let o,l,h=1+a;t.style&&(o=e.encode(t.style.style),l=e.encode(t.style.weight),h+=4+o.length+4+l.length);const d=new ArrayBuffer(h),f=new Uint8Array(d),m=new DataView(d);let y=0;m.setUint8(y++,t.guessFallback?1:0),m.setUint32(y,0),y+=4,a=0;for(const b of ka.strings){const v=s[b],w=v.length;a+=4+w,m.setUint32(y,w),f.set(v,y+4),y+=4+w}return m.setUint32(y-a-4,a),t.style&&(m.setUint32(y,o.length),f.set(o,y+4),y+=4+o.length,m.setUint32(y,l.length),f.set(l,y+4),y+=4+l.length),Bt(y<=d.byteLength,"SubstitionInfo.write: Buffer overflow"),d.transferToFixedLength(y)}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#s=new TextDecoder}get guessFallback(){return this.#e.getUint8(0)!==0}#n(t){Bt(t<ka.strings.length,"Invalid string index");let e=5;for(let a=0;a<t;a++)e+=this.#e.getUint32(e)+4;const s=this.#e.getUint32(e);return this.#s.decode(new Uint8Array(this.#t,e+4,s))}get css(){return this.#n(0)}get loadedName(){return this.#n(1)}get baseFontName(){return this.#n(2)}get src(){return this.#n(3)}get style(){let t=1;t+=4+this.#e.getUint32(t);const e=this.#e.getUint32(t),s=this.#s.decode(new Uint8Array(this.#t,t+4,e));t+=4+e;const a=this.#e.getUint32(t),o=this.#s.decode(new Uint8Array(this.#t,t+4,a));return{style:s,weight:o}}}class Xt{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#t=Math.ceil(this.bools.length*2/8);static#e=this.#t+this.numbers.length*8;static#s=this.#e+1+8;static#n=this.#s+1+48;static#r=this.#n+1+6;#a;#i;#o;constructor({data:t,extra:e}){this.#a=t,this.#i=new TextDecoder,this.#o=new DataView(this.#a),e&&Object.assign(this,e)}#c(t){Bt(t<Xt.bools.length,"Invalid boolean index");const e=Math.floor(t/4),s=t*2%8,a=this.#o.getUint8(e)>>s&3;return a===0?void 0:a===2}get black(){return this.#c(0)}get bold(){return this.#c(1)}get disableFontFace(){return this.#c(2)}get fontExtraProperties(){return this.#c(3)}get isInvalidPDFjsFont(){return this.#c(4)}get isType3Font(){return this.#c(5)}get italic(){return this.#c(6)}get missingFile(){return this.#c(7)}get remeasure(){return this.#c(8)}get vertical(){return this.#c(9)}#l(t){return Bt(t<Xt.numbers.length,"Invalid number index"),this.#o.getFloat64(Xt.#t+t*8)}get ascent(){return this.#l(0)}get defaultWidth(){return this.#l(1)}get descent(){return this.#l(2)}get bbox(){let t=Xt.#e;if(this.#o.getUint8(t)===0)return;t+=1;const s=[];for(let a=0;a<4;a++)s.push(this.#o.getInt16(t,!0)),t+=2;return s}get fontMatrix(){let t=Xt.#s;if(this.#o.getUint8(t)===0)return;t+=1;const s=[];for(let a=0;a<6;a++)s.push(this.#o.getFloat64(t,!0)),t+=8;return s}get defaultVMetrics(){let t=Xt.#n;if(this.#o.getUint8(t)===0)return;t+=1;const s=[];for(let a=0;a<3;a++)s.push(this.#o.getInt16(t,!0)),t+=2;return s}#d(t){Bt(t<Xt.strings.length,"Invalid string index");let e=Xt.#r+4;for(let o=0;o<t;o++)e+=this.#o.getUint32(e)+4;const s=this.#o.getUint32(e),a=new Uint8Array(s);return a.set(new Uint8Array(this.#a,e+4,s)),this.#i.decode(a)}get fallbackName(){return this.#d(0)}get loadedName(){return this.#d(1)}get mimetype(){return this.#d(2)}get name(){return this.#d(3)}get data(){let t=Xt.#r;const e=this.#o.getUint32(t);t+=4+e;const s=this.#o.getUint32(t);t+=4+s;const a=this.#o.getUint32(t);t+=4+a;const o=this.#o.getUint32(t);if(o!==0)return new Uint8Array(this.#a,t+4,o)}clearData(){let t=Xt.#r;const e=this.#o.getUint32(t);t+=4+e;const s=this.#o.getUint32(t);t+=4+s;const a=this.#o.getUint32(t);t+=4+a;const o=this.#o.getUint32(t);new Uint8Array(this.#a,t+4,o).fill(0),this.#o.setUint32(t,0)}get cssFontInfo(){let t=Xt.#r;const e=this.#o.getUint32(t);t+=4+e;const s=this.#o.getUint32(t);t+=4+s;const a=this.#o.getUint32(t);if(a===0)return null;const o=new Uint8Array(a);return o.set(new Uint8Array(this.#a,t+4,a)),new La(o.buffer)}get systemFontInfo(){let t=Xt.#r;const e=this.#o.getUint32(t);t+=4+e;const s=this.#o.getUint32(t);if(s===0)return null;const a=new Uint8Array(s);return a.set(new Uint8Array(this.#a,t+4,s)),new ka(a.buffer)}static write(t){const e=t.systemFontInfo?ka.write(t.systemFontInfo):null,s=t.cssFontInfo?La.write(t.cssFontInfo):null,a=new TextEncoder,o={};let l=0;for(const A of Xt.strings)o[A]=a.encode(t[A]),l+=4+o[A].length;const h=Xt.#r+4+l+4+(e?e.byteLength:0)+4+(s?s.byteLength:0)+4+(t.data?t.data.length:0),d=new ArrayBuffer(h),f=new Uint8Array(d),m=new DataView(d);let y=0;const b=Xt.bools.length;let v=0,w=0;for(let A=0;A<b;A++){const x=t[Xt.bools[A]];v|=(x===void 0?0:x?2:1)<<w,w+=2,(w===8||A===b-1)&&(m.setUint8(y++,v),v=0,w=0)}Bt(y===Xt.#t,"FontInfo.write: Boolean properties offset mismatch");for(const A of Xt.numbers)m.setFloat64(y,t[A]),y+=8;if(Bt(y===Xt.#e,"FontInfo.write: Number properties offset mismatch"),t.bbox){m.setUint8(y++,4);for(const A of t.bbox)m.setInt16(y,A,!0),y+=2}else m.setUint8(y++,0),y+=8;if(Bt(y===Xt.#s,"FontInfo.write: BBox properties offset mismatch"),t.fontMatrix){m.setUint8(y++,6);for(const A of t.fontMatrix)m.setFloat64(y,A,!0),y+=8}else m.setUint8(y++,0),y+=48;if(Bt(y===Xt.#n,"FontInfo.write: FontMatrix properties offset mismatch"),t.defaultVMetrics){m.setUint8(y++,1);for(const A of t.defaultVMetrics)m.setInt16(y,A,!0),y+=2}else m.setUint8(y++,0),y+=6;Bt(y===Xt.#r,"FontInfo.write: DefaultVMetrics properties offset mismatch"),m.setUint32(Xt.#r,0),y+=4;for(const A of Xt.strings){const x=o[A],S=x.length;m.setUint32(y,S),f.set(x,y+4),y+=4+S}if(m.setUint32(Xt.#r,y-Xt.#r-4),!e)m.setUint32(y,0),y+=4;else{const A=e.byteLength;m.setUint32(y,A),Bt(y+4+A<=d.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),f.set(new Uint8Array(e),y+4),y+=4+A}if(!s)m.setUint32(y,0),y+=4;else{const A=s.byteLength;m.setUint32(y,A),Bt(y+4+A<=d.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),f.set(new Uint8Array(s),y+4),y+=4+A}return t.data===void 0?(m.setUint32(y,0),y+=4):(m.setUint32(y,t.data.length),f.set(t.data,y+4),y+=4+t.data.length),Bt(y<=d.byteLength,"FontInfo.write: Buffer overflow"),d.transferToFixedLength(y)}}class Ee{static#t=0;static#e=1;static#s=2;static#n=3;static#r=4;static#a=8;static#i=12;static#o=16;constructor(t){this.buffer=t,this.view=new DataView(t),this.data=new Uint8Array(t)}static write(t){let e,s=null,a=[],o=[],l=[],h=[],d=null,f=null;switch(t[0]){case"RadialAxial":e=t[1]==="axial"?1:2,s=t[2],l=t[3],e===1?a.push(...t[4],...t[5]):a.push(t[4][0],t[4][1],t[6],t[5][0],t[5][1],t[7]);break;case"Mesh":e=3,d=t[1],a=t[2],o=t[3],h=t[4]||[],s=t[6],f=t[7];break;default:throw new Error(`Unsupported pattern type: ${t[0]}`)}const m=Math.floor(a.length/2),y=Math.floor(o.length/3),b=l.length,v=h.length;let w=0;for(const D of h)w+=1,w=Math.ceil(w/4)*4,w+=4+D.coords.length*4,w+=4+D.colors.length*4,D.verticesPerRow!==void 0&&(w+=4);const A=20+m*8+y*3+b*8+(s?16:0)+(f?3:0)+w,x=new ArrayBuffer(A),S=new DataView(x),T=new Uint8Array(x);S.setUint8(Ee.#t,e),S.setUint8(Ee.#e,s?1:0),S.setUint8(Ee.#s,f?1:0),S.setUint8(Ee.#n,d),S.setUint32(Ee.#r,m,!0),S.setUint32(Ee.#a,y,!0),S.setUint32(Ee.#i,b,!0),S.setUint32(Ee.#o,v,!0);let C=20;new Float32Array(x,C,m*2).set(a),C+=m*8,T.set(o,C),C+=y*3;for(const[D,L]of l)S.setFloat32(C,D,!0),C+=4,S.setUint32(C,parseInt(L.slice(1),16),!0),C+=4;if(s)for(const D of s)S.setFloat32(C,D,!0),C+=4;f&&(T.set(f,C),C+=3);for(let D=0;D<h.length;D++){const L=h[D];S.setUint8(C,L.type),C+=1,C=Math.ceil(C/4)*4,S.setUint32(C,L.coords.length,!0),C+=4,new Int32Array(x,C,L.coords.length).set(L.coords),C+=L.coords.length*4,S.setUint32(C,L.colors.length,!0),C+=4,new Int32Array(x,C,L.colors.length).set(L.colors),C+=L.colors.length*4,L.verticesPerRow!==void 0&&(S.setUint32(C,L.verticesPerRow,!0),C+=4)}return x}getIR(){const t=this.view,e=this.data[Ee.#t],s=!!this.data[Ee.#e],a=!!this.data[Ee.#s],o=t.getUint32(Ee.#r,!0),l=t.getUint32(Ee.#a,!0),h=t.getUint32(Ee.#i,!0),d=t.getUint32(Ee.#o,!0);let f=20;const m=new Float32Array(this.buffer,f,o*2);f+=o*8;const y=new Uint8Array(this.buffer,f,l*3);f+=l*3;const b=[];for(let x=0;x<h;++x){const S=t.getFloat32(f,!0);f+=4;const T=t.getUint32(f,!0);f+=4,b.push([S,`#${T.toString(16).padStart(6,"0")}`])}let v=null;if(s){v=[];for(let x=0;x<4;++x)v.push(t.getFloat32(f,!0)),f+=4}let w=null;a&&(w=new Uint8Array(this.buffer,f,3),f+=3);const A=[];for(let x=0;x<d;++x){const S=t.getUint8(f);f+=1,f=Math.ceil(f/4)*4;const T=t.getUint32(f,!0);f+=4;const C=new Int32Array(this.buffer,f,T);f+=T*4;const N=t.getUint32(f,!0);f+=4;const D=new Int32Array(this.buffer,f,N);f+=N*4;const L={type:S,coords:C,colors:D};S===Qd.LATTICE&&(L.verticesPerRow=t.getUint32(f,!0),f+=4),A.push(L)}if(e===1)return["RadialAxial","axial",v,b,Array.from(m.slice(0,2)),Array.from(m.slice(2,4)),null,null];if(e===2)return["RadialAxial","radial",v,b,[m[0],m[1]],[m[3],m[4]],m[2],m[5]];if(e===3){const x=this.data[Ee.#n];let S=null;if(m.length>0){let T=m[0],C=m[0],N=m[1],D=m[1];for(let L=0;L<m.length;L+=2){const k=m[L],V=m[L+1];T=T>k?k:T,N=N>V?V:N,C=C<k?k:C,D=D<V?V:D}S=[T,N,C,D]}return["Mesh",x,m,y,A,S,v,w]}throw new Error(`Unsupported pattern kind: ${e}`)}}class LE{static write(t){let e,s;return Ae.isFloat16ArraySupported?(s=new ArrayBuffer(t.length*2),e=new Float16Array(s)):(s=new ArrayBuffer(t.length*4),e=new Float32Array(s)),e.set(t),s}#t;constructor(t){this.#t=t}get path(){return Ae.isFloat16ArraySupported?new Float16Array(this.#t):new Float32Array(this.#t)}}function kE(c){if(c instanceof URL)return c.href;if(typeof c=="string"){if(He)return c;const t=URL.parse(c,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function BE(c){if(He&&typeof Buffer<"u"&&c instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(c instanceof Uint8Array&&c.byteLength===c.buffer.byteLength)return c;if(typeof c=="string")return po(c);if(c instanceof ArrayBuffer||ArrayBuffer.isView(c)||typeof c=="object"&&!isNaN(c?.length))return new Uint8Array(c);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Xl(c){if(typeof c!="string")return null;if(c.endsWith("/"))return c;throw new Error(`Invalid factory url: "${c}" must include trailing slash.`)}const sf=c=>typeof c=="object"&&Number.isInteger(c?.num)&&c.num>=0&&Number.isInteger(c?.gen)&&c.gen>=0,IE=c=>typeof c=="object"&&typeof c?.name=="string",PE=gE.bind(null,sf,IE);class FE{#t=new Map;#e=Promise.resolve();postMessage(t,e){const s={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[a]of this.#t)a.call(this,s)})}addEventListener(t,e,s=null){let a=null;if(s?.signal instanceof AbortSignal){const{signal:o}=s;if(o.aborted){vt("LoopbackPort - cannot use an `aborted` signal.");return}const l=()=>this.removeEventListener(t,e);a=()=>o.removeEventListener("abort",l),o.addEventListener("abort",l)}this.#t.set(e,a)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}const Vl={DATA:1,ERROR:2},pe={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function Vb(){}function Ze(c){if(c instanceof Js||c instanceof Zd||c instanceof Ub||c instanceof Ac||c instanceof Td)return c;switch(c instanceof Error||typeof c=="object"&&c!==null||Kt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),c.name){case"AbortException":return new Js(c.message);case"InvalidPDFException":return new Zd(c.message);case"PasswordException":return new Ub(c.message,c.code);case"ResponseException":return new Ac(c.message,c.status,c.missing);case"UnknownErrorException":return new Td(c.message,c.details)}return new Td(c.message,c.toString())}class Zr{#t=new AbortController;constructor(t,e,s){this.sourceName=t,this.targetName=e,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#n(t);return}if(t.callback){const s=t.callbackId,a=this.callbackCapabilities[s];if(!a)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],t.callback===Vl.DATA)a.resolve(t.data);else if(t.callback===Vl.ERROR)a.reject(Ze(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const s=this.sourceName,a=t.sourceName,o=this.comObj;Promise.try(e,t.data).then(function(l){o.postMessage({sourceName:s,targetName:a,callback:Vl.DATA,callbackId:t.callbackId,data:l})},function(l){o.postMessage({sourceName:s,targetName:a,callback:Vl.ERROR,callbackId:t.callbackId,reason:Ze(l)})});return}if(t.streamId){this.#s(t);return}e(t.data)}on(t,e){const s=this.actionHandler;if(s[t])throw new Error(`There is already an actionName called "${t}"`);s[t]=e}send(t,e,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},s)}sendWithPromise(t,e,s){const a=this.callbackId++,o=Promise.withResolvers();this.callbackCapabilities[a]=o;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:a,data:e},s)}catch(l){o.reject(l)}return o.promise}sendWithStream(t,e,s,a){const o=this.streamId++,l=this.sourceName,h=this.targetName,d=this.comObj;return new ReadableStream({start:f=>{const m=Promise.withResolvers();return this.streamControllers[o]={controller:f,startCall:m,pullCall:null,cancelCall:null,isClosed:!1},d.postMessage({sourceName:l,targetName:h,action:t,streamId:o,data:e,desiredSize:f.desiredSize},a),m.promise},pull:f=>{const m=Promise.withResolvers();return this.streamControllers[o].pullCall=m,d.postMessage({sourceName:l,targetName:h,stream:pe.PULL,streamId:o,desiredSize:f.desiredSize}),m.promise},cancel:f=>{Bt(f instanceof Error,"cancel must have a valid reason");const m=Promise.withResolvers();return this.streamControllers[o].cancelCall=m,this.streamControllers[o].isClosed=!0,d.postMessage({sourceName:l,targetName:h,stream:pe.CANCEL,streamId:o,reason:Ze(f)}),m.promise}},s)}#s(t){const e=t.streamId,s=this.sourceName,a=t.sourceName,o=this.comObj,l=this,h=this.actionHandler[t.action],d={enqueue(f,m=1,y){if(this.isCancelled)return;const b=this.desiredSize;this.desiredSize-=m,b>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),o.postMessage({sourceName:s,targetName:a,stream:pe.ENQUEUE,streamId:e,chunk:f},y)},close(){this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:s,targetName:a,stream:pe.CLOSE,streamId:e}),delete l.streamSinks[e])},error(f){Bt(f instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,o.postMessage({sourceName:s,targetName:a,stream:pe.ERROR,streamId:e,reason:Ze(f)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[e]=d,Promise.try(h,t.data,d).then(function(){o.postMessage({sourceName:s,targetName:a,stream:pe.START_COMPLETE,streamId:e,success:!0})},function(f){o.postMessage({sourceName:s,targetName:a,stream:pe.START_COMPLETE,streamId:e,reason:Ze(f)})})}#n(t){const e=t.streamId,s=this.sourceName,a=t.sourceName,o=this.comObj,l=this.streamControllers[e],h=this.streamSinks[e];switch(t.stream){case pe.START_COMPLETE:t.success?l.startCall.resolve():l.startCall.reject(Ze(t.reason));break;case pe.PULL_COMPLETE:t.success?l.pullCall.resolve():l.pullCall.reject(Ze(t.reason));break;case pe.PULL:if(!h){o.postMessage({sourceName:s,targetName:a,stream:pe.PULL_COMPLETE,streamId:e,success:!0});break}h.desiredSize<=0&&t.desiredSize>0&&h.sinkCapability.resolve(),h.desiredSize=t.desiredSize,Promise.try(h.onPull||Vb).then(function(){o.postMessage({sourceName:s,targetName:a,stream:pe.PULL_COMPLETE,streamId:e,success:!0})},function(f){o.postMessage({sourceName:s,targetName:a,stream:pe.PULL_COMPLETE,streamId:e,reason:Ze(f)})});break;case pe.ENQUEUE:if(Bt(l,"enqueue should have stream controller"),l.isClosed)break;l.controller.enqueue(t.chunk);break;case pe.CLOSE:if(Bt(l,"close should have stream controller"),l.isClosed)break;l.isClosed=!0,l.controller.close(),this.#r(l,e);break;case pe.ERROR:Bt(l,"error should have stream controller"),l.controller.error(Ze(t.reason)),this.#r(l,e);break;case pe.CANCEL_COMPLETE:t.success?l.cancelCall.resolve():l.cancelCall.reject(Ze(t.reason)),this.#r(l,e);break;case pe.CANCEL:if(!h)break;const d=Ze(t.reason);Promise.try(h.onCancel||Vb,d).then(function(){o.postMessage({sourceName:s,targetName:a,stream:pe.CANCEL_COMPLETE,streamId:e,success:!0})},function(f){o.postMessage({sourceName:s,targetName:a,stream:pe.CANCEL_COMPLETE,streamId:e,reason:Ze(f)})}),h.sinkCapability.reject(d),h.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#r(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class a_{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(t,e);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,s){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||s<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=s}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){Kt("Abstract method `_createCanvas` called.")}}class UE extends a_{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const s=this._document.createElement("canvas");return s.width=t,s.height=e,s}}class r_{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){Kt("Abstract method `_fetch` called.")}}class Yb extends r_{async _fetch(t){const e=await mo(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):po(e)}}class o_{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,s,a,o){return"none"}destroy(t=!1){}}class zE extends o_{#t;#e;#s;#n;#r;#a;#i=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#n=t,this.#r=e}get#o(){return this.#e||=new Map}get#c(){return this.#a||=new Map}get#l(){if(!this.#s){const t=this.#r.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const s=this.#r.createElementNS(_s,"svg");s.setAttribute("width",0),s.setAttribute("height",0),this.#s=this.#r.createElementNS(_s,"defs"),t.append(s),s.append(this.#s),this.#r.body.append(t)}return this.#s}#d(t){if(t.length===1){const d=t[0],f=new Array(256);for(let y=0;y<256;y++)f[y]=d[y]/255;const m=f.join(",");return[m,m,m]}const[e,s,a]=t,o=new Array(256),l=new Array(256),h=new Array(256);for(let d=0;d<256;d++)o[d]=e[d]/255,l[d]=s[d]/255,h[d]=a[d]/255;return[o.join(","),l.join(","),h.join(",")]}#h(t){if(this.#t===void 0){this.#t="";const e=this.#r.URL;e!==this.#r.baseURI&&(Hc(e)?vt('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=Kv(e,""))}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#o.get(t);if(e)return e;const[s,a,o]=this.#d(t),l=t.length===1?s:`${s}${a}${o}`;if(e=this.#o.get(l),e)return this.#o.set(t,e),e;const h=`g_${this.#n}_transfer_map_${this.#i++}`,d=this.#h(h);this.#o.set(t,d),this.#o.set(l,d);const f=this.#m(h);return this.#p(s,a,o,f),d}addHCMFilter(t,e){const s=`${t}-${e}`,a="base";let o=this.#c.get(a);if(o?.key===s||(o?(o.filter?.remove(),o.key=s,o.url="none",o.filter=null):(o={key:s,url:"none",filter:null},this.#c.set(a,o)),!t||!e))return o.url;const l=this.#v(t);t=nt.makeHexColor(...l);const h=this.#v(e);if(e=nt.makeHexColor(...h),this.#l.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return o.url;const d=new Array(256);for(let v=0;v<=255;v++){const w=v/255;d[v]=w<=.03928?w/12.92:((w+.055)/1.055)**2.4}const f=d.join(","),m=`g_${this.#n}_hcm_filter`,y=o.filter=this.#m(m);this.#p(f,f,f,y),this.#g(y);const b=(v,w)=>{const A=l[v]/255,x=h[v]/255,S=new Array(w+1);for(let T=0;T<=w;T++)S[T]=A+T/w*(x-A);return S.join(",")};return this.#p(b(0,5),b(1,5),b(2,5),y),o.url=this.#h(m),o.url}addAlphaFilter(t){let e=this.#o.get(t);if(e)return e;const[s]=this.#d([t]),a=`alpha_${s}`;if(e=this.#o.get(a),e)return this.#o.set(t,e),e;const o=`g_${this.#n}_alpha_map_${this.#i++}`,l=this.#h(o);this.#o.set(t,l),this.#o.set(a,l);const h=this.#m(o);return this.#y(s,h),l}addLuminosityFilter(t){let e=this.#o.get(t||"luminosity");if(e)return e;let s,a;if(t?([s]=this.#d([t]),a=`luminosity_${s}`):a="luminosity",e=this.#o.get(a),e)return this.#o.set(t,e),e;const o=`g_${this.#n}_luminosity_map_${this.#i++}`,l=this.#h(o);this.#o.set(t,l),this.#o.set(a,l);const h=this.#m(o);return this.#f(h),t&&this.#y(s,h),l}addHighlightHCMFilter(t,e,s,a,o){const l=`${e}-${s}-${a}-${o}`;let h=this.#c.get(t);if(h?.key===l||(h?(h.filter?.remove(),h.key=l,h.url="none",h.filter=null):(h={key:l,url:"none",filter:null},this.#c.set(t,h)),!e||!s))return h.url;const[d,f]=[e,s].map(this.#v.bind(this));let m=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),y=Math.round(.2126*f[0]+.7152*f[1]+.0722*f[2]),[b,v]=[a,o].map(this.#v.bind(this));y<m&&([m,y,b,v]=[y,m,v,b]),this.#l.style.color="";const w=(S,T,C)=>{const N=new Array(256),D=(y-m)/C,L=S/255,k=(T-S)/(255*C);let V=0;for(let K=0;K<=C;K++){const J=Math.round(m+K*D),W=L+K*k;for(let pt=V;pt<=J;pt++)N[pt]=W;V=J+1}for(let K=V;K<256;K++)N[K]=N[V-1];return N.join(",")},A=`g_${this.#n}_hcm_${t}_filter`,x=h.filter=this.#m(A);return this.#g(x),this.#p(w(b[0],v[0],5),w(b[1],v[1],5),w(b[2],v[2],5),x),h.url=this.#h(A),h.url}destroy(t=!1){t&&this.#a?.size||(this.#s?.parentNode.parentNode.remove(),this.#s=null,this.#e?.clear(),this.#e=null,this.#a?.clear(),this.#a=null,this.#i=0)}#f(t){const e=this.#r.createElementNS(_s,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#g(t){const e=this.#r.createElementNS(_s,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#m(t){const e=this.#r.createElementNS(_s,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#l.append(e),e}#u(t,e,s){const a=this.#r.createElementNS(_s,e);a.setAttribute("type","discrete"),a.setAttribute("tableValues",s),t.append(a)}#p(t,e,s,a){const o=this.#r.createElementNS(_s,"feComponentTransfer");a.append(o),this.#u(o,"feFuncR",t),this.#u(o,"feFuncG",e),this.#u(o,"feFuncB",s)}#y(t,e){const s=this.#r.createElementNS(_s,"feComponentTransfer");e.append(s),this.#u(s,"feFuncA",t)}#v(t){return this.#l.style.color=t,yo(getComputedStyle(this.#l).getPropertyValue("color"))}}class l_{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){Kt("Abstract method `_fetch` called.")}}class Kb extends l_{async _fetch(t){const e=await mo(t,"arraybuffer");return new Uint8Array(e)}}class c_{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){Kt("Abstract method `_fetch` called.")}}class Wb extends c_{async _fetch(t){const e=await mo(t,"arraybuffer");return new Uint8Array(e)}}He&&vt("Please use the `legacy` build in Node.js environments.");async function zf(c){const e=await process.getBuiltinModule("fs").promises.readFile(c);return new Uint8Array(e)}class HE extends o_{}class jE extends a_{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class qE extends r_{async _fetch(t){return zf(t)}}class $E extends l_{async _fetch(t){return zf(t)}}class GE extends c_{async _fetch(t){return zf(t)}}const wa="__forcedDependency",{floor:Qb,ceil:Zb}=Math;function Yl(c,t,e,s,a,o){c[t*4+0]=Math.min(c[t*4+0],e),c[t*4+1]=Math.min(c[t*4+1],s),c[t*4+2]=Math.max(c[t*4+2],a),c[t*4+3]=Math.max(c[t*4+3],o)}const af=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class XE{#t;#e;constructor(t,e){this.#t=t,this.#e=e}get length(){return this.#t.length}isEmpty(t){return this.#t[t]===af}minX(t){return this.#e[t*4+0]/256}minY(t){return this.#e[t*4+1]/256}maxX(t){return(this.#e[t*4+2]+1)/256}maxY(t){return(this.#e[t*4+3]+1)/256}}const Kl=(c,t)=>{if(!c)return;let e=c.get(t);return e||(e={dependencies:new Set,isRenderingOperation:!1},c.set(t,e)),e};class VE{#t={__proto__:null};#e={__proto__:null,transform:[],moveText:[],sameLineText:[],[wa]:[]};#s=new Map;#n=[];#r=[];#a=[[1,0,0,1,0,0]];#i=[-1/0,-1/0,1/0,1/0];#o=new Float64Array([1/0,1/0,-1/0,-1/0]);#c=-1;#l=new Set;#d=new Map;#h=new Map;#f;#g;#m;#u;#p;constructor(t,e,s=!1){this.#f=t.width,this.#g=t.height,this.#y(e),s&&(this.#p=new Map)}growOperationsCount(t){t>=this.#u.length&&this.#y(t,this.#u)}#y(t,e){const s=new ArrayBuffer(t*4);this.#m=new Uint8ClampedArray(s),this.#u=new Uint32Array(s),e&&e.length>0?(this.#u.set(e),this.#u.fill(af,e.length)):this.#u.fill(af)}save(t){return this.#t={__proto__:this.#t},this.#e={__proto__:this.#e,transform:{__proto__:this.#e.transform},moveText:{__proto__:this.#e.moveText},sameLineText:{__proto__:this.#e.sameLineText},[wa]:{__proto__:this.#e[wa]}},this.#i={__proto__:this.#i},this.#n.push(t),this}restore(t){const e=Object.getPrototypeOf(this.#t);if(e===null)return this;this.#t=e,this.#e=Object.getPrototypeOf(this.#e),this.#i=Object.getPrototypeOf(this.#i);const s=this.#n.pop();return s!==void 0&&(Kl(this.#p,t)?.dependencies.add(s),this.#u[t]=this.#u[s]),this}recordOpenMarker(t){return this.#n.push(t),this}getOpenMarker(){return this.#n.length===0?null:this.#n.at(-1)}recordCloseMarker(t){const e=this.#n.pop();return e!==void 0&&(Kl(this.#p,t)?.dependencies.add(e),this.#u[t]=this.#u[e]),this}beginMarkedContent(t){return this.#r.push(t),this}endMarkedContent(t){const e=this.#r.pop();return e!==void 0&&(Kl(this.#p,t)?.dependencies.add(e),this.#u[t]=this.#u[e]),this}pushBaseTransform(t){return this.#a.push(nt.multiplyByDOMMatrix(this.#a.at(-1),t.getTransform())),this}popBaseTransform(){return this.#a.length>1&&this.#a.pop(),this}recordSimpleData(t,e){return this.#t[t]=e,this}recordIncrementalData(t,e){return this.#e[t].push(e),this}resetIncrementalData(t,e){return this.#e[t].length=0,this}recordNamedData(t,e){return this.#s.set(t,e),this}recordSimpleDataFromNamed(t,e,s){this.#t[t]=this.#s.get(e)??s}recordFutureForcedDependency(t,e){return this.recordIncrementalData(wa,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in this.#t&&this.recordFutureForcedDependency(e,this.#t[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of this.#l)this.recordFutureForcedDependency(wa,t);return this}resetBBox(t){return this.#c!==t&&(this.#c=t,this.#o[0]=1/0,this.#o[1]=1/0,this.#o[2]=-1/0,this.#o[3]=-1/0),this}recordClipBox(t,e,s,a,o,l){const h=nt.multiplyByDOMMatrix(this.#a.at(-1),e.getTransform()),d=[1/0,1/0,-1/0,-1/0];nt.axialAlignedBoundingBox([s,o,a,l],h,d);const f=nt.intersect(this.#i,d);return f?(this.#i[0]=f[0],this.#i[1]=f[1],this.#i[2]=f[2],this.#i[3]=f[3]):(this.#i[0]=this.#i[1]=1/0,this.#i[2]=this.#i[3]=-1/0),this}recordBBox(t,e,s,a,o,l){const h=this.#i;if(h[0]===1/0)return this;const d=nt.multiplyByDOMMatrix(this.#a.at(-1),e.getTransform());if(h[0]===-1/0)return nt.axialAlignedBoundingBox([s,o,a,l],d,this.#o),this;const f=[1/0,1/0,-1/0,-1/0];return nt.axialAlignedBoundingBox([s,o,a,l],d,f),this.#o[0]=Math.min(this.#o[0],Math.max(f[0],h[0])),this.#o[1]=Math.min(this.#o[1],Math.max(f[1],h[1])),this.#o[2]=Math.max(this.#o[2],Math.min(f[2],h[2])),this.#o[3]=Math.max(this.#o[3],Math.min(f[3],h[3])),this}recordCharacterBBox(t,e,s,a=1,o=0,l=0,h){const d=s.bbox;let f,m;if(d&&(f=d[2]!==d[0]&&d[3]!==d[1]&&this.#h.get(s),f!==!1&&(m=[0,0,0,0],nt.axialAlignedBoundingBox(d,s.fontMatrix,m),(a!==1||o!==0||l!==0)&&nt.scaleMinMax([a,0,0,-a,o,l],m),f)))return this.recordBBox(t,e,m[0],m[2],m[1],m[3]);if(!h)return this.recordFullPageBBox(t);const y=h();return d&&m&&f===void 0&&(f=m[0]<=o-y.actualBoundingBoxLeft&&m[2]>=o+y.actualBoundingBoxRight&&m[1]<=l-y.actualBoundingBoxAscent&&m[3]>=l+y.actualBoundingBoxDescent,this.#h.set(s,f),f)?this.recordBBox(t,e,m[0],m[2],m[1],m[3]):this.recordBBox(t,e,o-y.actualBoundingBoxLeft,o+y.actualBoundingBoxRight,l-y.actualBoundingBoxAscent,l+y.actualBoundingBoxDescent)}recordFullPageBBox(t){return this.#o[0]=Math.max(0,this.#i[0]),this.#o[1]=Math.max(0,this.#i[1]),this.#o[2]=Math.min(this.#f,this.#i[2]),this.#o[3]=Math.min(this.#g,this.#i[3]),this}getSimpleIndex(t){return this.#t[t]}recordDependencies(t,e){const s=this.#l,a=this.#t,o=this.#e;for(const l of e)l in this.#t?s.add(a[l]):l in o&&o[l].forEach(s.add,s);return this}recordNamedDependency(t,e){return this.#s.has(e)&&this.#l.add(this.#s.get(e)),this}recordOperation(t,e=!1){if(this.recordDependencies(t,[wa]),this.#p){const s=Kl(this.#p,t),{dependencies:a}=s;this.#l.forEach(a.add,a),this.#n.forEach(a.add,a),this.#r.forEach(a.add,a),a.delete(t),s.isRenderingOperation=!0}if(this.#c===t){const s=Qb(this.#o[0]*256/this.#f),a=Qb(this.#o[1]*256/this.#g),o=Zb(this.#o[2]*256/this.#f),l=Zb(this.#o[3]*256/this.#g);Yl(this.#m,t,s,a,o,l);for(const h of this.#l)h!==t&&Yl(this.#m,h,s,a,o,l);for(const h of this.#n)h!==t&&Yl(this.#m,h,s,a,o,l);for(const h of this.#r)h!==t&&Yl(this.#m,h,s,a,o,l);e||(this.#l.clear(),this.#c=-1)}return this}recordShowTextOperation(t,e=!1){const s=Array.from(this.#l);this.recordOperation(t,e),this.recordIncrementalData("sameLineText",t);for(const a of s)this.recordIncrementalData("sameLineText",a);return this}bboxToClipBoxDropOperation(t,e=!1){return this.#c===t&&(this.#c=-1,this.#i[0]=Math.max(this.#i[0],this.#o[0]),this.#i[1]=Math.max(this.#i[1],this.#o[1]),this.#i[2]=Math.min(this.#i[2],this.#o[2]),this.#i[3]=Math.min(this.#i[3],this.#o[3]),e||this.#l.clear()),this}_takePendingDependencies(){const t=this.#l;return this.#l=new Set,t}_extractOperation(t){const e=this.#d.get(t);return this.#d.delete(t),e}_pushPendingDependencies(t){for(const e of t)this.#l.add(e)}take(){return this.#h.clear(),new XE(this.#u,this.#m)}takeDebugMetadata(){return this.#p}}class wc{#t;#e;#s;#n=0;#r=0;constructor(t,e,s){if(t instanceof wc&&t.#s===!!s)return t;this.#t=t,this.#e=e,this.#s=!!s}growOperationsCount(){throw new Error("Unreachable")}save(t){return this.#r++,this.#t.save(this.#e),this}restore(t){return this.#r>0&&(this.#t.restore(this.#e),this.#r--),this}recordOpenMarker(t){return this.#n++,this}getOpenMarker(){return this.#n>0?this.#e:this.#t.getOpenMarker()}recordCloseMarker(t){return this.#n--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return this.#t.pushBaseTransform(t),this}popBaseTransform(){return this.#t.popBaseTransform(),this}recordSimpleData(t,e){return this.#t.recordSimpleData(t,this.#e),this}recordIncrementalData(t,e){return this.#t.recordIncrementalData(t,this.#e),this}resetIncrementalData(t,e){return this.#t.resetIncrementalData(t,this.#e),this}recordNamedData(t,e){return this}recordSimpleDataFromNamed(t,e,s){return this.#t.recordSimpleDataFromNamed(t,e,this.#e),this}recordFutureForcedDependency(t,e){return this.#t.recordFutureForcedDependency(t,this.#e),this}inheritSimpleDataAsFutureForcedDependencies(t){return this.#t.inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#t.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return this.#s||this.#t.resetBBox(this.#e),this}recordClipBox(t,e,s,a,o,l){return this.#s||this.#t.recordClipBox(this.#e,e,s,a,o,l),this}recordBBox(t,e,s,a,o,l){return this.#s||this.#t.recordBBox(this.#e,e,s,a,o,l),this}recordCharacterBBox(t,e,s,a,o,l,h){return this.#s||this.#t.recordCharacterBBox(this.#e,e,s,a,o,l,h),this}recordFullPageBBox(t){return this.#s||this.#t.recordFullPageBBox(this.#e),this}getSimpleIndex(t){return this.#t.getSimpleIndex(t)}recordDependencies(t,e){return this.#t.recordDependencies(this.#e,e),this}recordNamedDependency(t,e){return this.#t.recordNamedDependency(this.#e,e),this}recordOperation(t){return this.#t.recordOperation(this.#e,!0),this}recordShowTextOperation(t){return this.#t.recordShowTextOperation(this.#e,!0),this}bboxToClipBoxDropOperation(t){return this.#s||this.#t.bboxToClipBoxDropOperation(this.#e,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const Dn={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},Ie={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function rf(c,t){if(!t)return;const e=t[2]-t[0],s=t[3]-t[1],a=new Path2D;a.rect(t[0],t[1],e,s),c.clip(a)}class Hf{isModifyingCurrentTransform(){return!1}getPattern(){Kt("Abstract method `getPattern` called.")}}class YE extends Hf{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}isOriginBased(){return this._p0[0]===0&&this._p0[1]===0&&(!this.isRadial()||this._p1[0]===0&&this._p1[1]===0)}isRadial(){return this._type==="radial"}_createGradient(t,e=null){let s,a=this._p0,o=this._p1;if(e&&(a=a.slice(),o=o.slice(),nt.applyTransform(a,e),nt.applyTransform(o,e)),this._type==="axial")s=t.createLinearGradient(a[0],a[1],o[0],o[1]);else if(this._type==="radial"){let l=this._r0,h=this._r1;if(e){const d=new Float32Array(2);nt.singularValueDecompose2dScale(e,d),l*=d[0],h*=d[0]}s=t.createRadialGradient(a[0],a[1],l,o[0],o[1],h)}for(const l of this._colorStops)s.addColorStop(l[0],l[1]);return s}getPattern(t,e,s,a){let o;if(a===Ie.STROKE||a===Ie.FILL){if(this.isOriginBased()){let b=nt.transform(s,e.baseTransform);this.matrix&&(b=nt.transform(b,this.matrix));const v=.001,w=Math.hypot(b[0],b[1]),A=Math.hypot(b[2],b[3]),x=(b[0]*b[2]+b[1]*b[3])/(w*A);if(Math.abs(x)<v)if(this.isRadial()){if(Math.abs(w-A)<v)return this._createGradient(t,b)}else return this._createGradient(t,b)}const l=e.current.getClippedPathBoundingBox(a,ee(t))||[0,0,0,0],h=Math.ceil(l[2]-l[0])||1,d=Math.ceil(l[3]-l[1])||1,f=e.cachedCanvases.getCanvas("pattern",h,d),m=f.context;m.clearRect(0,0,m.canvas.width,m.canvas.height),m.beginPath(),m.rect(0,0,m.canvas.width,m.canvas.height),m.translate(-l[0],-l[1]),s=nt.transform(s,[1,0,0,1,l[0],l[1]]),m.transform(...e.baseTransform),this.matrix&&m.transform(...this.matrix),rf(m,this._bbox),m.fillStyle=this._createGradient(m),m.fill(),o=t.createPattern(f.canvas,"no-repeat");const y=new DOMMatrix(s);o.setTransform(y)}else rf(t,this._bbox),o=this._createGradient(t);return o}}function Md(c,t,e,s,a,o,l,h){const d=t.coords,f=t.colors,m=c.data,y=c.width*4;let b;d[e+1]>d[s+1]&&(b=e,e=s,s=b,b=o,o=l,l=b),d[s+1]>d[a+1]&&(b=s,s=a,a=b,b=l,l=h,h=b),d[e+1]>d[s+1]&&(b=e,e=s,s=b,b=o,o=l,l=b);const v=(d[e]+t.offsetX)*t.scaleX,w=(d[e+1]+t.offsetY)*t.scaleY,A=(d[s]+t.offsetX)*t.scaleX,x=(d[s+1]+t.offsetY)*t.scaleY,S=(d[a]+t.offsetX)*t.scaleX,T=(d[a+1]+t.offsetY)*t.scaleY;if(w>=T)return;const C=f[o],N=f[o+1],D=f[o+2],L=f[l],k=f[l+1],V=f[l+2],K=f[h],J=f[h+1],W=f[h+2],pt=Math.round(w),Tt=Math.round(T);let gt,Nt,B,$,tt,wt,Ct,M;for(let q=pt;q<=Tt;q++){if(q<x){const dt=q<w?0:(w-q)/(w-x);gt=v-(v-A)*dt,Nt=C-(C-L)*dt,B=N-(N-k)*dt,$=D-(D-V)*dt}else{let dt;q>T?dt=1:x===T?dt=0:dt=(x-q)/(x-T),gt=A-(A-S)*dt,Nt=L-(L-K)*dt,B=k-(k-J)*dt,$=V-(V-W)*dt}let Q;q<w?Q=0:q>T?Q=1:Q=(w-q)/(w-T),tt=v-(v-S)*Q,wt=C-(C-K)*Q,Ct=N-(N-J)*Q,M=D-(D-W)*Q;const et=Math.round(Math.min(gt,tt)),ht=Math.round(Math.max(gt,tt));let yt=y*q+et*4;for(let dt=et;dt<=ht;dt++)Q=(gt-dt)/(gt-tt),Q<0?Q=0:Q>1&&(Q=1),m[yt++]=Nt-(Nt-wt)*Q|0,m[yt++]=B-(B-Ct)*Q|0,m[yt++]=$-($-M)*Q|0,m[yt++]=255}}function KE(c,t,e){const s=t.coords,a=t.colors;let o,l;switch(t.type){case Qd.LATTICE:const h=t.verticesPerRow,d=Math.floor(s.length/h)-1,f=h-1;for(o=0;o<d;o++){let m=o*h;for(let y=0;y<f;y++,m++)Md(c,e,s[m],s[m+1],s[m+h],a[m],a[m+1],a[m+h]),Md(c,e,s[m+h+1],s[m+1],s[m+h],a[m+h+1],a[m+1],a[m+h])}break;case Qd.TRIANGLES:for(o=0,l=s.length;o<l;o+=3)Md(c,e,s[o],s[o+1],s[o+2],a[o],a[o+1],a[o+2]);break;default:throw new Error("illegal figure")}}class WE extends Hf{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,s){const h=Math.floor(this._bounds[0]),d=Math.floor(this._bounds[1]),f=Math.ceil(this._bounds[2])-h,m=Math.ceil(this._bounds[3])-d,y=Math.min(Math.ceil(Math.abs(f*t[0]*1.1)),3e3),b=Math.min(Math.ceil(Math.abs(m*t[1]*1.1)),3e3),v=f/y,w=m/b,A={coords:this._coords,colors:this._colors,offsetX:-h,offsetY:-d,scaleX:1/v,scaleY:1/w},x=y+4,S=b+4,T=s.getCanvas("mesh",x,S),C=T.context,N=C.createImageData(y,b);if(e){const L=N.data;for(let k=0,V=L.length;k<V;k+=4)L[k]=e[0],L[k+1]=e[1],L[k+2]=e[2],L[k+3]=255}for(const L of this._figures)KE(N,L,A);return C.putImageData(N,2,2),{canvas:T.canvas,offsetX:h-2*v,offsetY:d-2*w,scaleX:v,scaleY:w}}isModifyingCurrentTransform(){return!0}getPattern(t,e,s,a){rf(t,this._bbox);const o=new Float32Array(2);if(a===Ie.SHADING)nt.singularValueDecompose2dScale(ee(t),o);else if(this.matrix){nt.singularValueDecompose2dScale(this.matrix,o);const[h,d]=o;nt.singularValueDecompose2dScale(e.baseTransform,o),o[0]*=h,o[1]*=d}else nt.singularValueDecompose2dScale(e.baseTransform,o);const l=this._createMeshCanvas(o,a===Ie.SHADING?null:this._background,e.cachedCanvases);return a!==Ie.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(l.offsetX,l.offsetY),t.scale(l.scaleX,l.scaleY),t.createPattern(l.canvas,"no-repeat")}}class QE extends Hf{getPattern(){return"hotpink"}}function ZE(c){switch(c[0]){case"RadialAxial":return new YE(c);case"Mesh":return new WE(c);case"Dummy":return new QE}throw new Error(`Unknown IR type: ${c[0]}`)}const Jb={COLORED:1,UNCOLORED:2};class jf{static MAX_PATTERN_SIZE=3e3;constructor(t,e,s,a){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=s,this.baseTransform=a}createPatternCanvas(t,e){const{bbox:s,operatorList:a,paintType:o,tilingType:l,color:h,canvasGraphicsFactory:d}=this;let{xstep:f,ystep:m}=this;f=Math.abs(f),m=Math.abs(m),zc("TilingType: "+l);const y=s[0],b=s[1],v=s[2],w=s[3],A=v-y,x=w-b,S=new Float32Array(2);nt.singularValueDecompose2dScale(this.matrix,S);const[T,C]=S;nt.singularValueDecompose2dScale(this.baseTransform,S);const N=T*S[0],D=C*S[1];let L=A,k=x,V=!1,K=!1;const J=Math.ceil(f*N),W=Math.ceil(m*D),pt=Math.ceil(A*N),Tt=Math.ceil(x*D);J>=pt?L=f:V=!0,W>=Tt?k=m:K=!0;const gt=this.getSizeAndScale(L,this.ctx.canvas.width,N),Nt=this.getSizeAndScale(k,this.ctx.canvas.height,D),B=t.cachedCanvases.getCanvas("pattern",gt.size,Nt.size),$=B.context,tt=d.createCanvasGraphics($,e);if(tt.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(tt,o,h),$.translate(-gt.scale*y,-Nt.scale*b),tt.transform(0,gt.scale,0,0,Nt.scale,0,0),$.save(),tt.dependencyTracker?.save(),this.clipBbox(tt,y,b,v,w),tt.baseTransform=ee(tt.ctx),tt.executeOperatorList(a),tt.endDrawing(),tt.dependencyTracker?.restore(),$.restore(),V||K){const wt=B.canvas;V&&(L=f),K&&(k=m);const Ct=this.getSizeAndScale(L,this.ctx.canvas.width,N),M=this.getSizeAndScale(k,this.ctx.canvas.height,D),q=Ct.size,Q=M.size,et=t.cachedCanvases.getCanvas("pattern-workaround",q,Q),ht=et.context,yt=V?Math.floor(A/f):0,dt=K?Math.floor(x/m):0;for(let re=0;re<=yt;re++)for(let Vt=0;Vt<=dt;Vt++)ht.drawImage(wt,q*re,Q*Vt,q,Q,0,0,q,Q);return{canvas:et.canvas,scaleX:Ct.scale,scaleY:M.scale,offsetX:y,offsetY:b}}return{canvas:B.canvas,scaleX:gt.scale,scaleY:Nt.scale,offsetX:y,offsetY:b}}getSizeAndScale(t,e,s){const a=Math.max(jf.MAX_PATTERN_SIZE,e);let o=Math.ceil(t*s);return o>=a?o=a:s=o/t,{scale:s,size:o}}clipBbox(t,e,s,a,o){const l=a-e,h=o-s;t.ctx.rect(e,s,l,h),nt.axialAlignedBoundingBox([e,s,a,o],ee(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,s){const a=t.ctx,o=t.current;switch(e){case Jb.COLORED:const{fillStyle:l,strokeStyle:h}=this.ctx;a.fillStyle=o.fillColor=l,a.strokeStyle=o.strokeColor=h;break;case Jb.UNCOLORED:a.fillStyle=a.strokeStyle=s,o.fillColor=o.strokeColor=s;break;default:throw new uE(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,s,a,o){let l=s;a!==Ie.SHADING&&(l=nt.transform(l,e.baseTransform),this.matrix&&(l=nt.transform(l,this.matrix)));const h=this.createPatternCanvas(e,o);let d=new DOMMatrix(l);d=d.translate(h.offsetX,h.offsetY),d=d.scale(1/h.scaleX,1/h.scaleY);const f=t.createPattern(h.canvas,"repeat");return f.setTransform(d),f}}function JE({src:c,srcPos:t=0,dest:e,width:s,height:a,nonBlackColor:o=4294967295,inverseDecode:l=!1}){const h=Ae.isLittleEndian?4278190080:255,[d,f]=l?[o,h]:[h,o],m=s>>3,y=s&7,b=c.length;e=new Uint32Array(e.buffer);let v=0;for(let w=0;w<a;w++){for(const x=t+m;t<x;t++){const S=t<b?c[t]:255;e[v++]=S&128?f:d,e[v++]=S&64?f:d,e[v++]=S&32?f:d,e[v++]=S&16?f:d,e[v++]=S&8?f:d,e[v++]=S&4?f:d,e[v++]=S&2?f:d,e[v++]=S&1?f:d}if(y===0)continue;const A=t<b?c[t++]:255;for(let x=0;x<y;x++)e[v++]=A&1<<7-x?f:d}return{srcPos:t,destPos:v}}const t0=16,e0=100,tx=15,n0=10,Je=16,Dd=new DOMMatrix,bn=new Float32Array(2),Oa=new Float32Array([1/0,1/0,-1/0,-1/0]);function ex(c,t){if(c._removeMirroring)throw new Error("Context is already forwarding operations.");c.__originalSave=c.save,c.__originalRestore=c.restore,c.__originalRotate=c.rotate,c.__originalScale=c.scale,c.__originalTranslate=c.translate,c.__originalTransform=c.transform,c.__originalSetTransform=c.setTransform,c.__originalResetTransform=c.resetTransform,c.__originalClip=c.clip,c.__originalMoveTo=c.moveTo,c.__originalLineTo=c.lineTo,c.__originalBezierCurveTo=c.bezierCurveTo,c.__originalRect=c.rect,c.__originalClosePath=c.closePath,c.__originalBeginPath=c.beginPath,c._removeMirroring=()=>{c.save=c.__originalSave,c.restore=c.__originalRestore,c.rotate=c.__originalRotate,c.scale=c.__originalScale,c.translate=c.__originalTranslate,c.transform=c.__originalTransform,c.setTransform=c.__originalSetTransform,c.resetTransform=c.__originalResetTransform,c.clip=c.__originalClip,c.moveTo=c.__originalMoveTo,c.lineTo=c.__originalLineTo,c.bezierCurveTo=c.__originalBezierCurveTo,c.rect=c.__originalRect,c.closePath=c.__originalClosePath,c.beginPath=c.__originalBeginPath,delete c._removeMirroring},c.save=function(){t.save(),this.__originalSave()},c.restore=function(){t.restore(),this.__originalRestore()},c.translate=function(e,s){t.translate(e,s),this.__originalTranslate(e,s)},c.scale=function(e,s){t.scale(e,s),this.__originalScale(e,s)},c.transform=function(e,s,a,o,l,h){t.transform(e,s,a,o,l,h),this.__originalTransform(e,s,a,o,l,h)},c.setTransform=function(e,s,a,o,l,h){t.setTransform(e,s,a,o,l,h),this.__originalSetTransform(e,s,a,o,l,h)},c.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},c.rotate=function(e){t.rotate(e),this.__originalRotate(e)},c.clip=function(e){t.clip(e),this.__originalClip(e)},c.moveTo=function(e,s){t.moveTo(e,s),this.__originalMoveTo(e,s)},c.lineTo=function(e,s){t.lineTo(e,s),this.__originalLineTo(e,s)},c.bezierCurveTo=function(e,s,a,o,l,h){t.bezierCurveTo(e,s,a,o,l,h),this.__originalBezierCurveTo(e,s,a,o,l,h)},c.rect=function(e,s,a,o){t.rect(e,s,a,o),this.__originalRect(e,s,a,o)},c.closePath=function(){t.closePath(),this.__originalClosePath()},c.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class nx{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,s){let a;return this.cache[t]!==void 0?(a=this.cache[t],this.canvasFactory.reset(a,e,s)):(a=this.canvasFactory.create(e,s),this.cache[t]=a),a}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Wl(c,t,e,s,a,o,l,h,d,f){const[m,y,b,v,w,A]=ee(c);if(y===0&&b===0){const T=l*m+w,C=Math.round(T),N=h*v+A,D=Math.round(N),L=(l+d)*m+w,k=Math.abs(Math.round(L)-C)||1,V=(h+f)*v+A,K=Math.abs(Math.round(V)-D)||1;return c.setTransform(Math.sign(m),0,0,Math.sign(v),C,D),c.drawImage(t,e,s,a,o,0,0,k,K),c.setTransform(m,y,b,v,w,A),[k,K]}if(m===0&&v===0){const T=h*b+w,C=Math.round(T),N=l*y+A,D=Math.round(N),L=(h+f)*b+w,k=Math.abs(Math.round(L)-C)||1,V=(l+d)*y+A,K=Math.abs(Math.round(V)-D)||1;return c.setTransform(0,Math.sign(y),Math.sign(b),0,C,D),c.drawImage(t,e,s,a,o,0,0,K,k),c.setTransform(m,y,b,v,w,A),[K,k]}c.drawImage(t,e,s,a,o,l,h,d,f);const x=Math.hypot(m,y),S=Math.hypot(b,v);return[x*d,S*f]}class s0{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=Wd;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=ve.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e,s){s?.(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=Oa.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=Ie.FILL,e=null){const s=this.minMax.slice();if(t===Ie.STROKE){e||Kt("Stroke bounding box must include transform."),nt.singularValueDecompose2dScale(e,bn);const a=bn[0]*this.lineWidth/2,o=bn[1]*this.lineWidth/2;s[0]-=a,s[1]-=o,s[2]+=a,s[3]+=o}return s}updateClipFromPath(){const t=nt.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(Oa,0)}getClippedPathBoundingBox(t=Ie.FILL,e=null){return nt.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function i0(c,t){if(t instanceof ImageData){c.putImageData(t,0,0);return}const e=t.height,s=t.width,a=e%Je,o=(e-a)/Je,l=a===0?o:o+1,h=c.createImageData(s,Je);let d=0,f;const m=t.data,y=h.data;let b,v,w,A;if(t.kind===cc.GRAYSCALE_1BPP){const x=m.byteLength,S=new Uint32Array(y.buffer,0,y.byteLength>>2),T=S.length,C=s+7>>3,N=4294967295,D=Ae.isLittleEndian?4278190080:255;for(b=0;b<l;b++){for(w=b<o?Je:a,f=0,v=0;v<w;v++){const L=x-d;let k=0;const V=L>C?s:L*8-7,K=V&-8;let J=0,W=0;for(;k<K;k+=8)W=m[d++],S[f++]=W&128?N:D,S[f++]=W&64?N:D,S[f++]=W&32?N:D,S[f++]=W&16?N:D,S[f++]=W&8?N:D,S[f++]=W&4?N:D,S[f++]=W&2?N:D,S[f++]=W&1?N:D;for(;k<V;k++)J===0&&(W=m[d++],J=128),S[f++]=W&J?N:D,J>>=1}for(;f<T;)S[f++]=0;c.putImageData(h,0,b*Je)}}else if(t.kind===cc.RGBA_32BPP){for(v=0,A=s*Je*4,b=0;b<o;b++)y.set(m.subarray(d,d+A)),d+=A,c.putImageData(h,0,v),v+=Je;b<l&&(A=s*a*4,y.set(m.subarray(d,d+A)),c.putImageData(h,0,v))}else if(t.kind===cc.RGB_24BPP)for(w=Je,A=s*w,b=0;b<l;b++){for(b>=o&&(w=a,A=s*w),f=0,v=A;v--;)y[f++]=m[d++],y[f++]=m[d++],y[f++]=m[d++],y[f++]=255;c.putImageData(h,0,b*Je)}else throw new Error(`bad image kind: ${t.kind}`)}function a0(c,t){if(t.bitmap){c.drawImage(t.bitmap,0,0);return}const e=t.height,s=t.width,a=e%Je,o=(e-a)/Je,l=a===0?o:o+1,h=c.createImageData(s,Je);let d=0;const f=t.data,m=h.data;for(let y=0;y<l;y++){const b=y<o?Je:a;({srcPos:d}=JE({src:f,srcPos:d,dest:m,width:s,height:b,nonBlackColor:0})),c.putImageData(h,0,y*Je)}}function Fr(c,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of e)c[s]!==void 0&&(t[s]=c[s]);c.setLineDash!==void 0&&(t.setLineDash(c.getLineDash()),t.lineDashOffset=c.lineDashOffset)}function Ql(c){c.strokeStyle=c.fillStyle="#000000",c.fillRule="nonzero",c.globalAlpha=1,c.lineWidth=1,c.lineCap="butt",c.lineJoin="miter",c.miterLimit=10,c.globalCompositeOperation="source-over",c.font="10px sans-serif",c.setLineDash!==void 0&&(c.setLineDash([]),c.lineDashOffset=0);const{filter:t}=c;t!=="none"&&t!==""&&(c.filter="none")}function r0(c,t){if(t)return!0;nt.singularValueDecompose2dScale(c,bn);const e=Math.fround(Zn.pixelRatio*Fa.PDF_TO_CSS_UNITS);return bn[0]<=e&&bn[1]<=e}const sx=["butt","round","square"],ix=["miter","round","bevel"],ax={},o0={};class Ba{constructor(t,e,s,a,o,{optionalContentConfig:l,markedContentStack:h=null},d,f,m){this.ctx=t,this.current=new s0(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=s,this.canvasFactory=a,this.filterFactory=o,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=h||[],this.optionalContentConfig=l,this.cachedCanvases=new nx(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=d,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=f,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=m??null}getObject(t,e,s=null){return typeof e=="string"?(this.dependencyTracker?.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):s}beginDrawing({transform:t,viewport:e,transparency:s=!1,background:a=null}){const o=this.ctx.canvas.width,l=this.ctx.canvas.height,h=this.ctx.fillStyle;if(this.ctx.fillStyle=a||"#ffffff",this.ctx.fillRect(0,0,o,l),this.ctx.fillStyle=h,s){const d=this.cachedCanvases.getCanvas("transparent",o,l);this.compositeCtx=this.ctx,this.transparentCanvas=d.canvas,this.ctx=d.context,this.ctx.save(),this.ctx.transform(...ee(this.compositeCtx))}this.ctx.save(),Ql(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=ee(this.ctx)}executeOperatorList(t,e,s,a,o){const l=t.argsArray,h=t.fnArray;let d=e||0;const f=l.length;if(f===d)return d;const m=f-d>n0&&typeof s=="function",y=m?Date.now()+tx:0;let b=0;const v=this.commonObjs,w=this.objs;let A,x;for(;;){if(a!==void 0&&d===a.nextBreakPoint)return a.breakIt(d,s),d;if(!o||o(d))if(A=h[d],x=l[d]??null,A!==ro.dependency)x===null?this[A](d):this[A](d,...x);else for(const S of x){this.dependencyTracker?.recordNamedData(S,d);const T=S.startsWith("g_")?v:w;if(!T.has(S))return T.get(S,s),d}if(d++,d===f)return d;if(m&&++b>n0){if(Date.now()>y)return s(),d;b=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const s=t.width??t.displayWidth,a=t.height??t.displayHeight;let o=Math.max(Math.hypot(e[0],e[1]),1),l=Math.max(Math.hypot(e[2],e[3]),1),h=s,d=a,f="prescale1",m,y;for(;o>2&&h>1||l>2&&d>1;){let b=h,v=d;o>2&&h>1&&(b=h>=16384?Math.floor(h/2)-1||1:Math.ceil(h/2),o/=h/b),l>2&&d>1&&(v=d>=16384?Math.floor(d/2)-1||1:Math.ceil(d)/2,l/=d/v),m=this.cachedCanvases.getCanvas(f,b,v),y=m.context,y.clearRect(0,0,b,v),y.drawImage(t,0,0,h,d,0,0,b,v),t=m.canvas,h=b,d=v,f=f==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:h,paintHeight:d}}_createMaskCanvas(t,e){const s=this.ctx,{width:a,height:o}=e,l=this.current.fillColor,h=this.current.patternFill,d=ee(s);let f,m,y,b;if((e.bitmap||e.data)&&e.count>1){const J=e.bitmap||e.data.buffer;m=JSON.stringify(h?d:[d.slice(0,4),l]),f=this._cachedBitmapsMap.get(J),f||(f=new Map,this._cachedBitmapsMap.set(J,f));const W=f.get(m);if(W&&!h){const pt=Math.round(Math.min(d[0],d[2])+d[4]),Tt=Math.round(Math.min(d[1],d[3])+d[5]);return this.dependencyTracker?.recordDependencies(t,Dn.transformAndFill),{canvas:W,offsetX:pt,offsetY:Tt}}y=W}y||(b=this.cachedCanvases.getCanvas("maskCanvas",a,o),a0(b.context,e));let v=nt.transform(d,[1/a,0,0,-1/o,0,0]);v=nt.transform(v,[1,0,0,1,0,-o]);const w=Oa.slice();nt.axialAlignedBoundingBox([0,0,a,o],v,w);const[A,x,S,T]=w,C=Math.round(S-A)||1,N=Math.round(T-x)||1,D=this.cachedCanvases.getCanvas("fillCanvas",C,N),L=D.context,k=A,V=x;L.translate(-k,-V),L.transform(...v),y||(y=this._scaleImage(b.canvas,Xn(L)),y=y.img,f&&h&&f.set(m,y)),L.imageSmoothingEnabled=r0(ee(L),e.interpolate),Wl(L,y,0,0,y.width,y.height,0,0,a,o),L.globalCompositeOperation="source-in";const K=nt.transform(Xn(L),[1,0,0,1,-k,-V]);return L.fillStyle=h?l.getPattern(s,this,K,Ie.FILL,t):l,L.fillRect(0,0,a,o),f&&!h&&(this.cachedCanvases.delete("fillCanvas"),f.set(m,D.canvas)),this.dependencyTracker?.recordDependencies(t,Dn.transformAndFill),{canvas:D.canvas,offsetX:Math.round(k),offsetY:Math.round(V)}}setLineWidth(t,e){this.dependencyTracker?.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){this.dependencyTracker?.recordSimpleData("lineCap",t),this.ctx.lineCap=sx[e]}setLineJoin(t,e){this.dependencyTracker?.recordSimpleData("lineJoin",t),this.ctx.lineJoin=ix[e]}setMiterLimit(t,e){this.dependencyTracker?.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,s){this.dependencyTracker?.recordSimpleData("dash",t);const a=this.ctx;a.setLineDash!==void 0&&(a.setLineDash(e),a.lineDashOffset=s)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){for(const[s,a]of e)switch(s){case"LW":this.setLineWidth(t,a);break;case"LC":this.setLineCap(t,a);break;case"LJ":this.setLineJoin(t,a);break;case"ML":this.setMiterLimit(t,a);break;case"D":this.setDash(t,a[0],a[1]);break;case"RI":this.setRenderingIntent(t,a);break;case"FL":this.setFlatness(t,a);break;case"Font":this.setFont(t,a[0],a[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=a;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=a;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=a;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",t),this.current.activeSMask=a?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(a);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,s=this.ctx.canvas.height,a="smaskGroupAt"+this.groupLevel,o=this.cachedCanvases.getCanvas(a,e,s);this.suspendedCtx=this.ctx;const l=this.ctx=o.context;l.setTransform(this.suspendedCtx.getTransform()),Fr(this.suspendedCtx,l),ex(l,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Fr(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,s,a){const o=a[0],l=a[1],h=a[2]-o,d=a[3]-l;h===0||d===0||(this.genericComposeSMask(e.context,s,h,d,e.subtype,e.backdrop,e.transferMap,o,l,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(s.canvas,0,0),t.restore())}genericComposeSMask(t,e,s,a,o,l,h,d,f,m,y){let b=t.canvas,v=d-m,w=f-y;if(l)if(v<0||w<0||v+s>b.width||w+a>b.height){const x=this.cachedCanvases.getCanvas("maskExtension",s,a),S=x.context;S.drawImage(b,-v,-w),S.globalCompositeOperation="destination-atop",S.fillStyle=l,S.fillRect(0,0,s,a),S.globalCompositeOperation="source-over",b=x.canvas,v=w=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const x=new Path2D;x.rect(v,w,s,a),t.clip(x),t.globalCompositeOperation="destination-atop",t.fillStyle=l,t.fillRect(v,w,s,a),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),o==="Alpha"&&h?e.filter=this.filterFactory.addAlphaFilter(h):o==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(h));const A=new Path2D;A.rect(d,f,s,a),e.clip(A),e.globalCompositeOperation="destination-in",e.drawImage(b,v,w,s,a,d,f,s,a),e.restore()}save(t){this.inSMaskMode&&Fr(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.dependencyTracker?.save(t)}restore(t){if(this.dependencyTracker?.restore(t),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Fr(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,s,a,o,l,h){this.dependencyTracker?.recordIncrementalData("transform",t),this.ctx.transform(e,s,a,o,l,h),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,s,a){let[o]=s;if(!a){o||=s[0]=new Path2D,this[e](t,o);return}if(this.dependencyTracker!==null){const l=e===ro.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,a[0]-l,a[2]+l,a[1]-l,a[3]+l).recordDependencies(t,["transform"])}o instanceof Path2D||(o=s[0]=e_(o)),nt.axialAlignedBoundingBox(a,ee(this.ctx),this.current.minMax),this[e](t,o),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,s=!0){const a=this.ctx,o=this.current.strokeColor;if(a.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof o=="object"&&o?.getPattern){const l=o.isModifyingCurrentTransform()?a.getTransform():null;if(a.save(),a.strokeStyle=o.getPattern(a,this,Xn(a),Ie.STROKE,t),l){const h=new Path2D;h.addPath(e,a.getTransform().invertSelf().multiplySelf(l)),e=h}this.rescaleAndStroke(e,!1),a.restore()}else this.rescaleAndStroke(e,!0);this.dependencyTracker?.recordDependencies(t,Dn.stroke),s&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(Ie.STROKE,ee(this.ctx))),a.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,s=!0){const a=this.ctx,o=this.current.fillColor,l=this.current.patternFill;let h=!1;if(l){const f=o.isModifyingCurrentTransform()?a.getTransform():null;if(this.dependencyTracker?.save(t),a.save(),a.fillStyle=o.getPattern(a,this,Xn(a),Ie.FILL,t),f){const m=new Path2D;m.addPath(e,a.getTransform().invertSelf().multiplySelf(f)),e=m}h=!0}const d=this.current.getClippedPathBoundingBox();this.contentVisible&&d!==null&&(this.pendingEOFill?(a.fill(e,"evenodd"),this.pendingEOFill=!1):a.fill(e)),this.dependencyTracker?.recordDependencies(t,Dn.fill),h&&(a.restore(),this.dependencyTracker?.restore(t)),s&&this.consumePath(t,e,d)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){this.ctx.fill(e),this.dependencyTracker?.recordDependencies(t,Dn.rawFillPath).recordOperation(t)}clip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=ax}eoClip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=o0}beginText(t){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,s=this.ctx;if(this.dependencyTracker){const{dependencyTracker:a}=this;e!==void 0&&a.recordFutureForcedDependency("textClip",a.getOpenMarker()).recordFutureForcedDependency("textClip",t),a.recordCloseMarker(t)}if(e!==void 0){const a=new Path2D,o=s.getTransform().invertSelf();for(const{transform:l,x:h,y:d,fontSize:f,path:m}of e)m&&a.addPath(m,new DOMMatrix(l).preMultiplySelf(o).translate(h,d).scale(f,-f));s.clip(a)}delete this.pendingTextPaths}setCharSpacing(t,e){this.dependencyTracker?.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){this.dependencyTracker?.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){this.dependencyTracker?.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){this.dependencyTracker?.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,s){this.dependencyTracker?.recordSimpleData("font",t).recordSimpleDataFromNamed("fontObj",e,t);const a=this.commonObjs.get(e),o=this.current;if(!a)throw new Error(`Can't find font for ${e}`);if(o.fontMatrix=a.fontMatrix||Wd,(o.fontMatrix[0]===0||o.fontMatrix[3]===0)&&vt("Invalid font matrix for font "+e),s<0?(s=-s,o.fontDirection=-1):o.fontDirection=1,this.current.font=a,this.current.fontSize=s,a.isType3Font)return;const l=a.loadedName||"sans-serif",h=a.systemFontInfo?.css||`"${l}", ${a.fallbackName}`;let d="normal";a.black?d="900":a.bold&&(d="bold");const f=a.italic?"italic":"normal";let m=s;s<t0?m=t0:s>e0&&(m=e0),this.current.fontSizeScale=s/m,this.ctx.font=`${f} ${d} ${m}px ${h}`}setTextRenderingMode(t,e){this.dependencyTracker?.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){this.dependencyTracker?.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,s){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=s}setLeadingMoveText(t,e,s){this.setLeading(t,-s),this.moveText(t,e,s)}setTextMatrix(t,e){this.dependencyTracker?.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",t);const{current:s}=this;s.textMatrix=e,s.textMatrixScale=Math.hypot(e[0],e[1]),s.x=s.lineX=0,s.y=s.lineY=0}nextLine(t){this.moveText(t,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}#s(t,e,s){const a=new Path2D;return a.addPath(t,new DOMMatrix(s).invertSelf().multiplySelf(e)),a}paintChar(t,e,s,a,o,l){const h=this.ctx,d=this.current,f=d.font,m=d.textRenderingMode,y=d.fontSize/d.fontSizeScale,b=m&ve.FILL_STROKE_MASK,v=!!(m&ve.ADD_TO_PATH_FLAG),w=d.patternFill&&!f.missingFile,A=d.patternStroke&&!f.missingFile;let x;if((f.disableFontFace||v||w||A)&&!f.missingFile&&(x=f.getPathGenerator(this.commonObjs,e)),x&&(f.disableFontFace||w||A)){h.save(),h.translate(s,a),h.scale(y,-y),this.dependencyTracker?.recordCharacterBBox(t,h,f);let S;if(b===ve.FILL||b===ve.FILL_STROKE)if(o){S=h.getTransform(),h.setTransform(...o);const T=this.#s(x,S,o);h.fill(T)}else h.fill(x);if(b===ve.STROKE||b===ve.FILL_STROKE)if(l){S||=h.getTransform(),h.setTransform(...l);const{a:T,b:C,c:N,d:D}=S,L=nt.inverseTransform(l),k=nt.transform([T,C,N,D,0,0],L);nt.singularValueDecompose2dScale(k,bn),h.lineWidth*=Math.max(bn[0],bn[1])/y,h.stroke(this.#s(x,S,l))}else h.lineWidth/=y,h.stroke(x);h.restore()}else(b===ve.FILL||b===ve.FILL_STROKE)&&(h.fillText(e,s,a),this.dependencyTracker?.recordCharacterBBox(t,h,f,y,s,a,()=>h.measureText(e))),(b===ve.STROKE||b===ve.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(t,h,f,y,s,a,()=>h.measureText(e)).recordDependencies(t,Dn.stroke),h.strokeText(e,s,a));v&&((this.pendingTextPaths||=[]).push({transform:ee(h),x:s,y:a,fontSize:y,path:x}),this.dependencyTracker?.recordCharacterBBox(t,h,f,y,s,a))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let s=!1;for(let a=3;a<e.length;a+=4)if(e[a]>0&&e[a]<255){s=!0;break}return _t(this,"isFontSubpixelAAEnabled",s)}showText(t,e){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,Dn.showText).resetBBox(t),this.current.textRenderingMode&ve.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const s=this.current,a=s.font;if(a.isType3Font){this.showType3Text(t,e),this.dependencyTracker?.recordShowTextOperation(t);return}const o=s.fontSize;if(o===0){this.dependencyTracker?.recordOperation(t);return}const l=this.ctx,h=s.fontSizeScale,d=s.charSpacing,f=s.wordSpacing,m=s.fontDirection,y=s.textHScale*m,b=e.length,v=a.vertical,w=v?1:-1,A=a.defaultVMetrics,x=o*s.fontMatrix[0],S=s.textRenderingMode===ve.FILL&&!a.disableFontFace&&!s.patternFill;l.save(),s.textMatrix&&l.transform(...s.textMatrix),l.translate(s.x,s.y+s.textRise),m>0?l.scale(y,-1):l.scale(y,1);let T,C;const N=s.textRenderingMode&ve.FILL_STROKE_MASK,D=N===ve.FILL||N===ve.FILL_STROKE,L=N===ve.STROKE||N===ve.FILL_STROKE;if(D&&s.patternFill){l.save();const W=s.fillColor.getPattern(l,this,Xn(l),Ie.FILL,t);T=ee(l),l.restore(),l.fillStyle=W}if(L&&s.patternStroke){l.save();const W=s.strokeColor.getPattern(l,this,Xn(l),Ie.STROKE,t);C=ee(l),l.restore(),l.strokeStyle=W}let k=s.lineWidth;const V=s.textMatrixScale;if(V===0||k===0?L&&(k=this.getSinglePixelWidth()):k/=V,h!==1&&(l.scale(h,h),k/=h),l.lineWidth=k,a.isInvalidPDFjsFont){const W=[];let pt=0;for(const gt of e)W.push(gt.unicode),pt+=gt.width;const Tt=W.join("");if(l.fillText(Tt,0,0),this.dependencyTracker!==null){const gt=l.measureText(Tt);this.dependencyTracker.recordBBox(t,this.ctx,-gt.actualBoundingBoxLeft,gt.actualBoundingBoxRight,-gt.actualBoundingBoxAscent,gt.actualBoundingBoxDescent).recordShowTextOperation(t)}s.x+=pt*x*y,l.restore(),this.compose();return}let K=0,J;for(J=0;J<b;++J){const W=e[J];if(typeof W=="number"){K+=w*W*o/1e3;continue}let pt=!1;const Tt=(W.isSpace?f:0)+d,gt=W.fontChar,Nt=W.accent;let B,$,tt=W.width;if(v){const M=W.vmetric||A,q=-(W.vmetric?M[1]:tt*.5)*x,Q=M[2]*x;tt=M?-M[0]:tt,B=q/h,$=(K+Q)/h}else B=K/h,$=0;let wt;if(a.remeasure&&tt>0){wt=l.measureText(gt);const M=wt.width*1e3/o*h;if(tt<M&&this.isFontSubpixelAAEnabled){const q=tt/M;pt=!0,l.save(),l.scale(q,1),B/=q}else tt!==M&&(B+=(tt-M)/2e3*o/h)}if(this.contentVisible&&(W.isInFont||a.missingFile)){if(S&&!Nt)l.fillText(gt,B,$),this.dependencyTracker?.recordCharacterBBox(t,l,wt?{bbox:null}:a,o/h,B,$,()=>wt??l.measureText(gt));else if(this.paintChar(t,gt,B,$,T,C),Nt){const M=B+o*Nt.offset.x/h,q=$-o*Nt.offset.y/h;this.paintChar(t,Nt.fontChar,M,q,T,C)}}const Ct=v?tt*x-Tt*m:tt*x+Tt*m;K+=Ct,pt&&l.restore()}v?s.y-=K:s.x+=K*y,l.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(t)}showType3Text(t,e){const s=this.ctx,a=this.current,o=a.font,l=a.fontSize,h=a.fontDirection,d=o.vertical?1:-1,f=a.charSpacing,m=a.wordSpacing,y=a.textHScale*h,b=a.fontMatrix||Wd,v=e.length,w=a.textRenderingMode===ve.INVISIBLE;let A,x,S,T;if(w||l===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,s.save(),a.textMatrix&&s.transform(...a.textMatrix),s.translate(a.x,a.y+a.textRise),s.scale(y,h);const C=this.dependencyTracker;for(this.dependencyTracker=C?new wc(C,t):null,A=0;A<v;++A){if(x=e[A],typeof x=="number"){T=d*x*l/1e3,this.ctx.translate(T,0),a.x+=T*y;continue}const N=(x.isSpace?m:0)+f,D=o.charProcOperatorList[x.operatorListId];D?this.contentVisible&&(this.save(),s.scale(l,l),s.transform(...b),this.executeOperatorList(D),this.restore()):vt(`Type3 character "${x.operatorListId}" is not available.`);const L=[x.width,0];nt.applyTransform(L,b),S=L[0]*l+N,s.translate(S,0),a.x+=S*y}s.restore(),C&&(this.dependencyTracker=C)}setCharWidth(t,e,s){}setCharWidthAndBounds(t,e,s,a,o,l,h){const d=new Path2D;d.rect(a,o,l-a,h-o),this.ctx.clip(d),this.dependencyTracker?.recordBBox(t,this.ctx,a,l,o,h).recordClipBox(t,this.ctx,a,l,o,h),this.endPath(t)}getColorN_Pattern(t,e){let s;if(e[0]==="TilingPattern"){const a=this.baseTransform||ee(this.ctx),o={createCanvasGraphics:(l,h)=>new Ba(l,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new wc(this.dependencyTracker,h,!0):null)};s=new jf(e,this.ctx,o,a)}else s=this._getPattern(t,e[1],e[2]);return s}setStrokeColorN(t,...e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,s=null){let a;return this.cachedPatterns.has(e)?a=this.cachedPatterns.get(e):(a=ZE(this.getObject(t,e)),this.cachedPatterns.set(e,a)),s&&(a.matrix=s),a}shadingFill(t,e){if(!this.contentVisible)return;const s=this.ctx;this.save(t);const a=this._getPattern(t,e);s.fillStyle=a.getPattern(s,this,Xn(s),Ie.SHADING,t);const o=Xn(s);if(o){const{width:l,height:h}=s.canvas,d=Oa.slice();nt.axialAlignedBoundingBox([0,0,l,h],o,d);const[f,m,y,b]=d;this.ctx.fillRect(f,m,y-f,b-m)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,Dn.transform).recordDependencies(t,Dn.fill).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){Kt("Should not call beginInlineImage")}beginImageData(){Kt("Should not call beginImageData")}paintFormXObjectBegin(t,e,s){if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=ee(this.ctx),s)){nt.axialAlignedBoundingBox(s,this.baseTransform,this.current.minMax);const[a,o,l,h]=s,d=new Path2D;d.rect(a,o,l-a,h-o),this.ctx.clip(d),this.dependencyTracker?.recordClipBox(t,this.ctx,a,l,o,h),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const s=this.ctx;e.isolated||zc("TODO: Support non-isolated groups."),e.knockout&&vt("Knockout groups not supported.");const a=ee(s);if(e.matrix&&s.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let o=Oa.slice();nt.axialAlignedBoundingBox(e.bbox,ee(s),o);const l=[0,0,s.canvas.width,s.canvas.height];o=nt.intersect(o,l)||[0,0,0,0];const h=Math.floor(o[0]),d=Math.floor(o[1]),f=Math.max(Math.ceil(o[2])-h,1),m=Math.max(Math.ceil(o[3])-d,1);this.current.startNewPathAndClipBox([0,0,f,m]);let y="groupAt"+this.groupLevel;e.smask&&(y+="_smask_"+this.smaskCounter++%2);const b=this.cachedCanvases.getCanvas(y,f,m),v=b.context;v.translate(-h,-d),v.transform(...a);let w=new Path2D;const[A,x,S,T]=e.bbox;if(w.rect(A,x,S-A,T-x),e.matrix){const C=new Path2D;C.addPath(w,new DOMMatrix(e.matrix)),w=C}v.clip(w),e.smask&&this.smaskStack.push({canvas:b.canvas,context:v,offsetX:h,offsetY:d,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),(!e.smask||this.dependencyTracker)&&(s.setTransform(1,0,0,1,0,0),s.translate(h,d),s.save()),Fr(s,v),this.ctx=v,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(s),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(s),this.groupLevel++}endGroup(t,e){if(!this.contentVisible)return;this.groupLevel--;const s=this.ctx,a=this.groupStack.pop();if(this.ctx=a,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const o=ee(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...o);const l=Oa.slice();nt.axialAlignedBoundingBox([0,0,s.canvas.width,s.canvas.height],o,l),this.ctx.drawImage(s.canvas,0,0),this.ctx.restore(),this.compose(l)}}beginAnnotation(t,e,s,a,o,l){if(this.#t(),Ql(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),s){const h=s[2]-s[0],d=s[3]-s[1];if(l&&this.annotationCanvasMap){a=a.slice(),a[4]-=s[0],a[5]-=s[1],s=s.slice(),s[0]=s[1]=0,s[2]=h,s[3]=d,nt.singularValueDecompose2dScale(ee(this.ctx),bn);const{viewportScale:f}=this,m=Math.ceil(h*this.outputScaleX*f),y=Math.ceil(d*this.outputScaleY*f);this.annotationCanvas=this.canvasFactory.create(m,y);const{canvas:b,context:v}=this.annotationCanvas;this.annotationCanvasMap.set(e,b),this.annotationCanvas.savedCtx=this.ctx,this.ctx=v,this.ctx.save(),this.ctx.setTransform(bn[0],0,0,-bn[1],0,d*bn[1]),Ql(this.ctx)}else{Ql(this.ctx),this.endPath(t);const f=new Path2D;f.rect(s[0],s[1],h,d),this.ctx.clip(f)}}this.current=new s0(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...a),this.transform(t,...o)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){if(!this.contentVisible)return;const s=e.count;e=this.getObject(t,e.data,e),e.count=s;const a=this.ctx,o=this._createMaskCanvas(t,e),l=o.canvas;a.save(),a.setTransform(1,0,0,1,0,0),a.drawImage(l,o.offsetX,o.offsetY),this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,o.offsetX,o.offsetX+l.width,o.offsetY,o.offsetY+l.height).recordOperation(t),a.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,s,a=0,o=0,l,h){if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const d=this.ctx;d.save();const f=ee(d);d.transform(s,a,o,l,0,0);const m=this._createMaskCanvas(t,e);d.setTransform(1,0,0,1,m.offsetX-f[4],m.offsetY-f[5]),this.dependencyTracker?.resetBBox(t);for(let y=0,b=h.length;y<b;y+=2){const v=nt.transform(f,[s,a,o,l,h[y],h[y+1]]);d.drawImage(m.canvas,v[4],v[5]),this.dependencyTracker?.recordBBox(t,this.ctx,v[4],v[4]+m.canvas.width,v[5],v[5]+m.canvas.height)}d.restore(),this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageMaskXObjectGroup(t,e){if(!this.contentVisible)return;const s=this.ctx,a=this.current.fillColor,o=this.current.patternFill;this.dependencyTracker?.resetBBox(t).recordDependencies(t,Dn.transformAndFill);for(const l of e){const{data:h,width:d,height:f,transform:m}=l,y=this.cachedCanvases.getCanvas("maskCanvas",d,f),b=y.context;b.save();const v=this.getObject(t,h,l);a0(b,v),b.globalCompositeOperation="source-in",b.fillStyle=o?a.getPattern(b,this,Xn(s),Ie.FILL,t):a,b.fillRect(0,0,d,f),b.restore(),s.save(),s.transform(...m),s.scale(1,-1),Wl(s,y.canvas,0,0,d,f,0,-1,1,1),this.dependencyTracker?.recordBBox(t,s,0,d,0,f),s.restore()}this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const s=this.getObject(t,e);if(!s){vt("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t,s)}paintImageXObjectRepeat(t,e,s,a,o){if(!this.contentVisible)return;const l=this.getObject(t,e);if(!l){vt("Dependent image isn't ready yet");return}const h=l.width,d=l.height,f=[];for(let m=0,y=o.length;m<y;m+=2)f.push({transform:[s,0,0,a,o[m],o[m+1]],x:0,y:0,w:h,h:d});this.paintInlineImageXObjectGroup(t,l,f)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:s,height:a}=t,o=this.cachedCanvases.getCanvas("inlineImage",s,a),l=o.context;return l.filter=this.current.transferMaps,l.drawImage(e,0,0),l.filter="none",o.canvas}paintInlineImageXObject(t,e){if(!this.contentVisible)return;const s=e.width,a=e.height,o=this.ctx;this.save(t);const{filter:l}=o;l!=="none"&&l!==""&&(o.filter="none"),o.scale(1/s,-1/a);let h;if(e.bitmap)h=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)h=e;else{const m=this.cachedCanvases.getCanvas("inlineImage",s,a).context;i0(m,e),h=this.applyTransferMapsToCanvas(m)}const d=this._scaleImage(h,Xn(o));o.imageSmoothingEnabled=r0(ee(o),e.interpolate),this.dependencyTracker?.resetBBox(t).recordBBox(t,o,0,s,-a,0).recordDependencies(t,Dn.imageXObject).recordOperation(t),Wl(o,d.img,0,0,d.paintWidth,d.paintHeight,0,-a,s,a),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,s){if(!this.contentVisible)return;const a=this.ctx;let o;if(e.bitmap)o=e.bitmap;else{const l=e.width,h=e.height,f=this.cachedCanvases.getCanvas("inlineImage",l,h).context;i0(f,e),o=this.applyTransferMapsToCanvas(f)}this.dependencyTracker?.resetBBox(t);for(const l of s)a.save(),a.transform(...l.transform),a.scale(1,-1),Wl(a,o,l.x,l.y,l.w,l.h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,a,0,1,-1,0),a.restore();this.dependencyTracker?.recordOperation(t),this.compose()}paintSolidColorImageMask(t){this.contentVisible&&(this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,Dn.fill).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,s){}beginMarkedContent(t,e){this.dependencyTracker?.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,s){this.dependencyTracker?.beginMarkedContent(t),e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(s)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){this.dependencyTracker?.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,s){const a=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(s);const o=this.ctx;this.pendingClip?(a||(this.pendingClip===o0?o.clip(e,"evenodd"):o.clip(e)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):this.dependencyTracker?.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=ee(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),s=Math.hypot(t[0],t[2]),a=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(s,a)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:s,c:a,d:o}=this.ctx.getTransform();let l,h;if(s===0&&a===0){const d=Math.abs(e),f=Math.abs(o);if(d===f)if(t===0)l=h=1/d;else{const m=d*t;l=h=m<1?1/m:1}else if(t===0)l=1/d,h=1/f;else{const m=d*t,y=f*t;l=m<1?1/m:1,h=y<1?1/y:1}}else{const d=Math.abs(e*o-s*a),f=Math.hypot(e,s),m=Math.hypot(a,o);if(t===0)l=m/d,h=f/d;else{const y=t*d;l=m>y?m/y:1,h=f>y?f/y:1}}this._cachedScaleForStroking[0]=l,this._cachedScaleForStroking[1]=h}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:s,current:{lineWidth:a}}=this,[o,l]=this.getScaleForStroking();if(o===l){s.lineWidth=(a||1)*o,s.stroke(t);return}const h=s.getLineDash();e&&s.save(),s.scale(o,l),Dd.a=1/o,Dd.d=1/l;const d=new Path2D;if(d.addPath(t,Dd),h.length>0){const f=Math.max(o,l);s.setLineDash(h.map(m=>m/f)),s.lineDashOffset/=f}s.lineWidth=a||1,s.stroke(d),e&&s.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const c in ro)Ba.prototype[c]!==void 0&&(Ba.prototype[ro[c]]=Ba.prototype[c]);class Ia{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class rx{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}[Symbol.iterator](){return this.#t.entries()}}const Ca=Symbol("INTERNAL");class ox{#t=!1;#e=!1;#s=!1;#n=!0;constructor(t,{name:e,intent:s,usage:a,rbGroups:o}){this.#t=!!(t&gn.DISPLAY),this.#e=!!(t&gn.PRINT),this.name=e,this.intent=s,this.usage=a,this.rbGroups=o}get visible(){if(this.#s)return this.#n;if(!this.#n)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,s=!1){t!==Ca&&Kt("Internal method `_setVisible` called."),this.#s=s,this.#n=e}}class lx{#t=null;#e=new Map;#s=null;#n=null;constructor(t,e=gn.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#n=t.order;for(const s of t.groups)this.#e.set(s.id,new ox(e,s));if(t.baseState==="OFF")for(const s of this.#e.values())s._setVisible(Ca,!1);for(const s of t.on)this.#e.get(s)._setVisible(Ca,!0);for(const s of t.off)this.#e.get(s)._setVisible(Ca,!1);this.#s=this.getHash()}}#r(t){const e=t.length;if(e<2)return!0;const s=t[0];for(let a=1;a<e;a++){const o=t[a];let l;if(Array.isArray(o))l=this.#r(o);else if(this.#e.has(o))l=this.#e.get(o).visible;else return vt(`Optional content group not found: ${o}`),!0;switch(s){case"And":if(!l)return!1;break;case"Or":if(l)return!0;break;case"Not":return!l;default:return!0}}return s==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return zc("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:(vt(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#r(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return vt(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return vt(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return vt(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return vt(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return vt(`Unknown optional content policy ${t.policy}.`),!0}return vt(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,s=!0){const a=this.#e.get(t);if(!a){vt(`Optional content group not found: ${t}`);return}if(s&&e&&a.rbGroups.length)for(const o of a.rbGroups)for(const l of o)l!==t&&this.#e.get(l)?._setVisible(Ca,!1,!0);a._setVisible(Ca,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let s;for(const a of t){switch(a){case"ON":case"OFF":case"Toggle":s=a;continue}const o=this.#e.get(a);if(o)switch(s){case"ON":this.setVisibility(a,!0,e);break;case"OFF":this.setVisibility(a,!1,e);break;case"Toggle":this.setVisibility(a,!o.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#s===null||this.getHash()===this.#s}getOrder(){return this.#e.size?this.#n?this.#n.slice():[...this.#e.keys()]:null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new s_;for(const[e,s]of this.#e)t.update(`${e}:${s.visible}`);return this.#t=t.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class cx{constructor(t,{disableRange:e=!1,disableStream:s=!1}){Bt(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:a,initialData:o,progressiveDone:l,contentDispositionFilename:h}=t;if(this._queuedChunks=[],this._progressiveDone=l,this._contentDispositionFilename=h,o?.length>0){const d=o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!s,this._isRangeSupported=!e,this._contentLength=a,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((d,f)=>{this._onReceiveData({begin:d,chunk:f})}),t.addProgressListener((d,f)=>{this._onProgress({loaded:d,total:f})}),t.addProgressiveReadListener(d=>{this._onReceiveData({chunk:d})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const s=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const a=this._rangeReaders.some(function(o){return o._begin!==t?!1:(o._enqueue(s),!0)});Bt(a,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(t){t.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:t.loaded}):this._fullRequestReader?.onProgress?.({loaded:t.loaded,total:t.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){Bt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new ux(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new hx(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeReaders.slice(0))e.cancel(t);this._pdfDataRangeTransport.abort()}}class ux{constructor(t,e,s=!1,a=null){this._stream=t,this._done=s||!1,this._filename=If(a)?a:null,this._queuedChunks=e||[],this._loaded=0;for(const o of this._queuedChunks)this._loaded+=o.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class hx{constructor(t,e,s){this._stream=t,this._begin=e,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function dx(c){let t=!0,e=s("filename\\*","i").exec(c);if(e){e=e[1];let m=h(e);return m=unescape(m),m=d(m),m=f(m),o(m)}if(e=l(c),e){const m=f(e);return o(m)}if(e=s("filename","i").exec(c),e){e=e[1];let m=h(e);return m=f(m),o(m)}function s(m,y){return new RegExp("(?:^|;)\\s*"+m+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',y)}function a(m,y){if(m){if(!/^[\x00-\xFF]+$/.test(y))return y;try{const b=new TextDecoder(m,{fatal:!0}),v=po(y);y=b.decode(v),t=!1}catch{}}return y}function o(m){return t&&/[\x80-\xff]/.test(m)&&(m=a("utf-8",m),t&&(m=a("iso-8859-1",m))),m}function l(m){const y=[];let b;const v=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(b=v.exec(m))!==null;){let[,A,x,S]=b;if(A=parseInt(A,10),A in y){if(A===0)break;continue}y[A]=[x,S]}const w=[];for(let A=0;A<y.length&&A in y;++A){let[x,S]=y[A];S=h(S),x&&(S=unescape(S),A===0&&(S=d(S))),w.push(S)}return w.join("")}function h(m){if(m.startsWith('"')){const y=m.slice(1).split('\\"');for(let b=0;b<y.length;++b){const v=y[b].indexOf('"');v!==-1&&(y[b]=y[b].slice(0,v),y.length=b+1),y[b]=y[b].replaceAll(/\\(.)/g,"$1")}m=y.join('"')}return m}function d(m){const y=m.indexOf("'");if(y===-1)return m;const b=m.slice(0,y),w=m.slice(y+1).replace(/^[^']*'/,"");return a(b,w)}function f(m){return!m.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(m)?m:m.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(y,b,v,w){if(v==="q"||v==="Q")return w=w.replaceAll("_"," "),w=w.replaceAll(/=([0-9a-fA-F]{2})/g,function(A,x){return String.fromCharCode(parseInt(x,16))}),a(b,w);try{w=atob(w)}catch{}return a(b,w)})}return""}function u_(c,t){const e=new Headers;if(!c||!t||typeof t!="object")return e;for(const s in t){const a=t[s];a!==void 0&&e.append(s,a)}return e}function qc(c){return URL.parse(c)?.origin??null}function h_({responseHeaders:c,isHttp:t,rangeChunkSize:e,disableRange:s}){const a={allowRangeRequests:!1,suggestedLength:void 0},o=parseInt(c.get("Content-Length"),10);return!Number.isInteger(o)||(a.suggestedLength=o,o<=2*e)||s||!t||c.get("Accept-Ranges")!=="bytes"||(c.get("Content-Encoding")||"identity")!=="identity"||(a.allowRangeRequests=!0),a}function d_(c){const t=c.get("Content-Disposition");if(t){let e=dx(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(If(e))return e}return null}function vo(c,t){return new Ac(`Unexpected server response (${c}) while retrieving PDF "${t}".`,c,c===404||c===0&&t.startsWith("file:"))}function f_(c){return c===200||c===206}function p_(c,t,e){return{method:"GET",headers:c,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function m_(c){return c instanceof Uint8Array?c.buffer:c instanceof ArrayBuffer?c:(vt(`getArrayBuffer - unexpected data format: ${c}`),new Uint8Array(c).buffer)}class fx{_responseOrigin=null;constructor(t){this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=u_(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Bt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new px(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new mx(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class px{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const s=new Headers(t.headers),a=e.url;fetch(a,p_(s,this._withCredentials,this._abortController)).then(o=>{if(t._responseOrigin=qc(o.url),!f_(o.status))throw vo(o.status,a);this._reader=o.body.getReader(),this._headersCapability.resolve();const l=o.headers,{allowRangeRequests:h,suggestedLength:d}=h_({responseHeaders:l,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=h,this._contentLength=d||this._contentLength,this._filename=d_(l),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Js("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:m_(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class mx{constructor(t,e,s){this._stream=t,this._reader=null,this._loaded=0;const a=t.source;this._withCredentials=a.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!a.disableStream,this._abortController=new AbortController;const o=new Headers(t.headers);o.append("Range",`bytes=${e}-${s-1}`);const l=a.url;fetch(l,p_(o,this._withCredentials,this._abortController)).then(h=>{const d=qc(h.url);if(d!==t._responseOrigin)throw new Error(`Expected range response-origin "${d}" to match "${t._responseOrigin}".`);if(!f_(h.status))throw vo(h.status,l);this._readCapability.resolve(),this._reader=h.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded}),{value:m_(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const Od=200,Nd=206;function gx(c){const t=c.response;return typeof t!="string"?t:po(t).buffer}class yx{_responseOrigin=null;constructor({url:t,httpHeaders:e,withCredentials:s}){this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=u_(this.isHttp,e),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,s=this.currXhrId++,a=this.pendingRequests[s]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[o,l]of this.headers)e.setRequestHeader(o,l);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),a.expectedStatus=Nd):a.expectedStatus=Od,e.responseType="arraybuffer",Bt(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,s),e.onprogress=this.onProgress.bind(this,s),a.onHeadersReceived=t.onHeadersReceived,a.onDone=t.onDone,a.onError=t.onError,a.onProgress=t.onProgress,e.send(null),s}onProgress(t,e){const s=this.pendingRequests[t];s&&s.onProgress?.(e)}onStateChange(t,e){const s=this.pendingRequests[t];if(!s)return;const a=s.xhr;if(a.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),a.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],a.status===0&&this.isHttp){s.onError(a.status);return}const o=a.status||Od;if(!(o===Od&&s.expectedStatus===Nd)&&o!==s.expectedStatus){s.onError(a.status);return}const h=gx(a);if(o===Nd){const d=a.getResponseHeader("Content-Range"),f=/bytes (\d+)-(\d+)\/(\d+)/.exec(d);f?s.onDone({begin:parseInt(f[1],10),chunk:h}):(vt('Missing or invalid "Content-Range" header.'),s.onError(0))}else h?s.onDone({begin:0,chunk:h}):s.onError(a.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class bx{constructor(t){this._source=t,this._manager=new yx(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return Bt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new vx(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const s=new _x(this._manager,t,e);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class vx{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=qc(e.responseURL);const s=e.getAllResponseHeaders(),a=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(h=>{const[d,...f]=h.split(": ");return[d,f.join(": ")]}):[]),{allowRangeRequests:o,suggestedLength:l}=h_({responseHeaders:a,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});o&&(this._isRangeSupported=!0),this._contentLength=l||this._contentLength,this._filename=d_(a),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=vo(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class _x{constructor(t,e,s){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const t=qc(this._manager.getRequestXhr(this._requestId)?.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??=vo(t,this._url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){this.isStreamingSupported||this.onProgress?.({loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const Ax=/^[a-z][a-z0-9\-+.]+:/i;function wx(c){if(Ax.test(c))return new URL(c);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(c))}class Sx{constructor(t){this.source=t,this.url=wx(t.url),Bt(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Bt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Ex(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new xx(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){this._fullRequestReader?.cancel(t);for(const e of this._rangeRequestReaders.slice(0))e.cancel(t)}}class Ex{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(a=>{this._contentLength=a.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},a=>{a.code==="ENOENT"&&(a=vo(0,this._url.href)),this._storedError=a,this._headersCapability.reject(a)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Js("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class xx{constructor(t,e,s){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const a=t.source;this._isStreamingSupported=!a.disableStream;const o=process.getBuiltinModule("fs");this._setReadableStream(o.createReadStream(this._url,{start:e,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Ur=Symbol("INITIAL_DATA");class g_{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:Ur}}get(t,e=null){if(e){const a=this.#e(t);return a.promise.then(()=>e(a.data)),null}const s=this.#t[t];if(!s||s.data===Ur)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return s.data}has(t){const e=this.#t[t];return!!e&&e.data!==Ur}delete(t){const e=this.#t[t];return!e||e.data===Ur?!1:(delete this.#t[t],!0)}resolve(t,e=null){const s=this.#e(t);s.data=e,s.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==Ur&&(yield[t,e])}}}const Tx=1e5,l0=30;class yn{#t=Promise.withResolvers();#e=null;#s=!1;#n=!!globalThis.FontInspector?.enabled;#r=null;#a=null;#i=0;#o=0;#c=null;#l=null;#d=0;#h=0;#f=Object.create(null);#g=[];#m=null;#u=[];#p=new WeakMap;#y=null;static#v=new Map;static#b=new Map;static#x=new WeakMap;static#S=null;static#A=new Set;constructor({textContentSource:t,container:e,viewport:s}){if(t instanceof ReadableStream)this.#m=t;else if(typeof t=="object")this.#m=new ReadableStream({start(d){d.enqueue(t),d.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#l=e,this.#h=s.scale*Zn.pixelRatio,this.#d=s.rotation,this.#a={div:null,properties:null,ctx:null};const{pageWidth:a,pageHeight:o,pageX:l,pageY:h}=s.rawDims;this.#y=[1,0,0,-1,-l,h+o],this.#o=a,this.#i=o,yn.#M(),e.style.setProperty("--min-font-size",yn.#S),Oi(e,s),this.#t.promise.finally(()=>{yn.#A.delete(this),this.#a=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=Ae.platform;return _t(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#c.read().then(({value:e,done:s})=>{if(s){this.#t.resolve();return}this.#r??=e.lang,Object.assign(this.#f,e.styles),this.#C(e.items),t()},this.#t.reject)};return this.#c=this.#m.getReader(),yn.#A.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const s=t.scale*Zn.pixelRatio,a=t.rotation;if(a!==this.#d&&(e?.(),this.#d=a,Oi(this.#l,{rotation:a})),s!==this.#h){e?.(),this.#h=s;const o={div:null,properties:null,ctx:yn.#D(this.#r)};for(const l of this.#u)o.properties=this.#p.get(l),o.div=l,this.#E(o)}}cancel(){const t=new Js("TextLayer task cancelled.");this.#c?.cancel(t).catch(()=>{}),this.#c=null,this.#t.reject(t)}get textDivs(){return this.#u}get textContentItemsStr(){return this.#g}#C(t){if(this.#s)return;this.#a.ctx??=yn.#D(this.#r);const e=this.#u,s=this.#g;for(const a of t){if(e.length>Tx){vt("Ignoring additional textDivs for performance reasons."),this.#s=!0;return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),a.id&&this.#e.setAttribute("id",`${a.id}`),o.append(this.#e)}else a.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}s.push(a.str),this.#_(a)}}#_(t){const e=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#u.push(e);const a=nt.transform(this.#y,t.transform);let o=Math.atan2(a[1],a[0]);const l=this.#f[t.fontName];l.vertical&&(o+=Math.PI/2);let h=this.#n&&l.fontSubstitution||l.fontFamily;h=yn.fontFamilyMap.get(h)||h;const d=Math.hypot(a[2],a[3]),f=d*yn.#P(h,l,this.#r);let m,y;o===0?(m=a[4],y=a[5]-f):(m=a[4]+f*Math.sin(o),y=a[5]-f*Math.cos(o));const b=e.style;b.left=`${(100*m/this.#o).toFixed(2)}%`,b.top=`${(100*y/this.#i).toFixed(2)}%`,b.setProperty("--font-height",`${d.toFixed(2)}px`),b.fontFamily=h,s.fontSize=d,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#n&&(e.dataset.fontName=l.fontSubstitutionLoadedName||t.fontName),o!==0&&(s.angle=o*(180/Math.PI));let v=!1;if(t.str.length>1)v=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const w=Math.abs(t.transform[0]),A=Math.abs(t.transform[3]);w!==A&&Math.max(w,A)/Math.min(w,A)>1.5&&(v=!0)}if(v&&(s.canvasWidth=l.vertical?t.height:t.width),this.#p.set(e,s),this.#a.div=e,this.#a.properties=s,this.#E(this.#a),s.hasText&&this.#e.append(e),s.hasEOL){const w=document.createElement("br");w.setAttribute("role","presentation"),this.#e.append(w)}}#E(t){const{div:e,properties:s,ctx:a}=t,{style:o}=e;if(s.canvasWidth!==0&&s.hasText){const{fontFamily:l}=o,{canvasWidth:h,fontSize:d}=s;yn.#R(a,d*this.#h,l);const{width:f}=a.measureText(e.textContent);f>0&&o.setProperty("--scale-x",h*this.#h/f)}s.angle!==0&&o.setProperty("--rotate",`${s.angle}deg`)}static cleanup(){if(!(this.#A.size>0)){this.#v.clear();for(const{canvas:t}of this.#b.values())t.remove();this.#b.clear()}}static#D(t=null){let e=this.#b.get(t||="");if(!e){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=t,document.body.append(s),e=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#b.set(t,e),this.#x.set(e,{size:0,family:""})}return e}static#R(t,e,s){const a=this.#x.get(t);e===a.size&&s===a.family||(t.font=`${e}px ${s}`,a.size=e,a.family=s)}static#M(){if(this.#S!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#S=t.getBoundingClientRect().height,t.remove()}static#P(t,e,s){const a=this.#v.get(t);if(a)return a;const o=this.#D(s);o.canvas.width=o.canvas.height=l0,this.#R(o,l0,t);const l=o.measureText(""),h=l.fontBoundingBoxAscent,d=Math.abs(l.fontBoundingBoxDescent);o.canvas.width=o.canvas.height=0;let f=.8;return h?f=h/(h+d):(Ae.platform.isFirefox&&vt("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?f=e.ascent:e.descent&&(f=1+e.descent)),this.#v.set(t,f),f}}const Cx=100;function y_(c={}){typeof c=="string"||c instanceof URL?c={url:c}:(c instanceof ArrayBuffer||ArrayBuffer.isView(c))&&(c={data:c});const t=new qf,{docId:e}=t,s=c.url?kE(c.url):null,a=c.data?BE(c.data):null,o=c.httpHeaders||null,l=c.withCredentials===!0,h=c.password??null,d=c.range instanceof b_?c.range:null,f=Number.isInteger(c.rangeChunkSize)&&c.rangeChunkSize>0?c.rangeChunkSize:2**16;let m=c.worker instanceof lo?c.worker:null;const y=c.verbosity,b=typeof c.docBaseUrl=="string"&&!Hc(c.docBaseUrl)?c.docBaseUrl:null,v=Xl(c.cMapUrl),w=c.cMapPacked!==!1,A=c.CMapReaderFactory||(He?qE:Yb),x=Xl(c.iccUrl),S=Xl(c.standardFontDataUrl),T=c.StandardFontDataFactory||(He?$E:Kb),C=Xl(c.wasmUrl),N=c.WasmFactory||(He?GE:Wb),D=c.stopAtErrors!==!0,L=Number.isInteger(c.maxImageSize)&&c.maxImageSize>-1?c.maxImageSize:-1,k=c.isEvalSupported!==!1,V=typeof c.isOffscreenCanvasSupported=="boolean"?c.isOffscreenCanvasSupported:!He,K=typeof c.isImageDecoderSupported=="boolean"?c.isImageDecoderSupported:!He&&(Ae.platform.isFirefox||!globalThis.chrome),J=Number.isInteger(c.canvasMaxAreaInBytes)?c.canvasMaxAreaInBytes:-1,W=typeof c.disableFontFace=="boolean"?c.disableFontFace:He,pt=c.fontExtraProperties===!0,Tt=c.enableXfa===!0,gt=c.ownerDocument||globalThis.document,Nt=c.disableRange===!0,B=c.disableStream===!0,$=c.disableAutoFetch===!0,tt=c.pdfBug===!0,wt=c.CanvasFactory||(He?jE:UE),Ct=c.FilterFactory||(He?HE:zE),M=c.enableHWA===!0,q=c.useWasm!==!1,Q=d?d.length:c.length??NaN,et=typeof c.useSystemFonts=="boolean"?c.useSystemFonts:!He&&!W,ht=typeof c.useWorkerFetch=="boolean"?c.useWorkerFetch:!!(A===Yb&&T===Kb&&N===Wb&&v&&S&&C&&Qr(v,document.baseURI)&&Qr(S,document.baseURI)&&Qr(C,document.baseURI)),yt=null;oE(y);const dt={canvasFactory:new wt({ownerDocument:gt,enableHWA:M}),filterFactory:new Ct({docId:e,ownerDocument:gt}),cMapReaderFactory:ht?null:new A({baseUrl:v,isCompressed:w}),standardFontDataFactory:ht?null:new T({baseUrl:S}),wasmFactory:ht?null:new N({baseUrl:C})};m||(m=lo.create({verbosity:y,port:Ia.workerPort}),t._worker=m);const re={docId:e,apiVersion:"5.4.530",data:a,password:h,disableAutoFetch:$,rangeChunkSize:f,length:Q,docBaseUrl:b,enableXfa:Tt,evaluatorOptions:{maxImageSize:L,disableFontFace:W,ignoreErrors:D,isEvalSupported:k,isOffscreenCanvasSupported:V,isImageDecoderSupported:K,canvasMaxAreaInBytes:J,fontExtraProperties:pt,useSystemFonts:et,useWasm:q,useWorkerFetch:ht,cMapUrl:v,iccUrl:x,standardFontDataUrl:S,wasmUrl:C}},Vt={ownerDocument:gt,pdfBug:tt,styleElement:yt,loadingParams:{disableAutoFetch:$,enableXfa:Tt}};return m.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(m.destroyed)throw new Error("Worker was destroyed");const ei=m.messageHandler.sendWithPromise("GetDocRequest",re,a?[a.buffer]:null);let Ss;if(d)Ss=new cx(d,{disableRange:Nt,disableStream:B});else if(!a){if(!s)throw new Error("getDocument - no `url` parameter provided.");const ni=Qr(s)?fx:He?Sx:bx;Ss=new ni({url:s,length:Q,httpHeaders:o,withCredentials:l,rangeChunkSize:f,disableRange:Nt,disableStream:B})}return ei.then(ni=>{if(t.destroyed)throw new Error("Loading aborted");if(m.destroyed)throw new Error("Worker was destroyed");const Ha=new Zr(e,ni,m.port),Jn=new Dx(Ha,t,Ss,Vt,dt,M);t._transport=Jn,Ha.send("Ready",null)})}).catch(t._capability.reject),t}class qf{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${qf.#t++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class b_{#t=Promise.withResolvers();#e=[];#s=[];#n=[];#r=[];constructor(t,e,s=!1,a=null){this.length=t,this.initialData=e,this.progressiveDone=s,this.contentDispositionFilename=a}addRangeListener(t){this.#r.push(t)}addProgressListener(t){this.#n.push(t)}addProgressiveReadListener(t){this.#s.push(t)}addProgressiveDoneListener(t){this.#e.push(t)}onDataRange(t,e){for(const s of this.#r)s(t,e)}onDataProgress(t,e){this.#t.promise.then(()=>{for(const s of this.#n)s(t,e)})}onDataProgressiveRead(t){this.#t.promise.then(()=>{for(const e of this.#s)e(t)})}onDataProgressiveDone(){this.#t.promise.then(()=>{for(const t of this.#e)t()})}transportReady(){this.#t.resolve()}requestDataRange(t,e){Kt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class Rx{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return _t(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(t){return this._transport.extractPages(t)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class Mx{#t=!1;constructor(t,e,s,a=!1){this._pageIndex=t,this._pageInfo=e,this._transport=s,this._stats=a?new Hb:null,this._pdfBug=a,this.commonObjs=s.commonObjs,this.objs=new g_,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:s=0,offsetY:a=0,dontFlip:o=!1}={}){return new go({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:a,dontFlip:o})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return _t(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:s,intent:a="display",annotationMode:o=Qs.ENABLE,transform:l=null,background:h=null,optionalContentConfigPromise:d=null,annotationCanvasMap:f=null,pageColors:m=null,printAnnotationStorage:y=null,isEditing:b=!1,recordOperations:v=!1,operationsFilter:w=null}){this._stats?.time("Overall");const A=this._transport.getRenderingIntent(a,o,y,b),{renderingIntent:x,cacheKey:S}=A;this.#t=!1,d||=this._transport.getOptionalContentConfig(x);let T=this._intentStates.get(S);T||(T=Object.create(null),this._intentStates.set(S,T)),T.streamReaderCancelTimeout&&(clearTimeout(T.streamReaderCancelTimeout),T.streamReaderCancelTimeout=null);const C=!!(x&gn.PRINT);T.displayReadyCapability||(T.displayReadyCapability=Promise.withResolvers(),T.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(A));const N=!!(this._pdfBug&&globalThis.StepperManager?.enabled),D=!this.recordedBBoxes&&(v||N),L=K=>{if(T.renderTasks.delete(k),D){const J=k.gfx?.dependencyTracker.take();J&&(k.stepper&&k.stepper.setOperatorBBoxes(J,k.gfx.dependencyTracker.takeDebugMetadata()),v&&(this.recordedBBoxes=J))}C&&(this.#t=!0),this.#e(),K?(k.capability.reject(K),this._abortOperatorList({intentState:T,reason:K instanceof Error?K:new Error(K)})):k.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},k=new Na({callback:L,params:{canvas:e,canvasContext:t,dependencyTracker:D?new VE(e,T.operatorList.length,N):null,viewport:s,transform:l,background:h},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:f,operatorList:T.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!C,pdfBug:this._pdfBug,pageColors:m,enableHWA:this._transport.enableHWA,operationsFilter:w});(T.renderTasks||=new Set).add(k);const V=k.task;return Promise.all([T.displayReadyCapability.promise,d]).then(([K,J])=>{if(this.destroyed){L();return}if(this._stats?.time("Rendering"),!(J.renderingIntent&x))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");k.initializeGraphics({transparency:K,optionalContentConfig:J}),k.operatorListChanged()}).catch(L),V}getOperatorList({intent:t="display",annotationMode:e=Qs.ENABLE,printAnnotationStorage:s=null,isEditing:a=!1}={}){function o(){h.operatorList.lastChunk&&(h.opListReadCapability.resolve(h.operatorList),h.renderTasks.delete(d))}const l=this._transport.getRenderingIntent(t,e,s,a,!0);let h=this._intentStates.get(l.cacheKey);h||(h=Object.create(null),this._intentStates.set(l.cacheKey,h));let d;return h.opListReadCapability||(d=Object.create(null),d.operatorListChanged=o,h.opListReadCapability=Promise.withResolvers(),(h.renderTasks||=new Set).add(d),h.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(l)),h.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(a){return a.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>oo.textContent(s));const e=this.streamTextContent(t);return new Promise(function(s,a){function o(){l.read().then(function({value:d,done:f}){if(f){s(h);return}h.lang??=d.lang,Object.assign(h.styles,d.styles),h.items.push(...d.items),o()},a)}const l=e.getReader(),h={items:[],styles:Object.create(null),lang:null};o()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const s of e.renderTasks)t.push(s.completed),s.cancel();return this.objs.clear(),this.#t=!1,Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#e();return t&&e&&(this._stats&&=new Hb),e}#e(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(t,e){const s=this._intentStates.get(e);s&&(this._stats?.timeEnd("Page Request"),s.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let s=0,a=t.length;s<a;s++)e.operatorList.fnArray.push(t.fnArray[s]),e.operatorList.argsArray.push(t.argsArray[s]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const s of e.renderTasks)s.operatorListChanged();t.lastChunk&&this.#e()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:s,modifiedIds:a}){const{map:o,transfer:l}=s,d=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:o,modifiedIds:a},l).getReader(),f=this._intentStates.get(e);f.streamReader=d;const m=()=>{d.read().then(({value:y,done:b})=>{if(b){f.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(y,f),m())},y=>{if(f.streamReader=null,!this._transport.destroyed){if(f.operatorList){f.operatorList.lastChunk=!0;for(const b of f.renderTasks)b.operatorListChanged();this.#e()}if(f.displayReadyCapability)f.displayReadyCapability.reject(y);else if(f.opListReadCapability)f.opListReadCapability.reject(y);else throw y}})};m()}_abortOperatorList({intentState:t,reason:e,force:s=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!s){if(t.renderTasks.size>0)return;if(e instanceof Bf){let a=Cx;e.extraDelay>0&&e.extraDelay<1e3&&(a+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},a);return}}if(t.streamReader.cancel(new Js(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[a,o]of this._intentStates)if(o===t){this._intentStates.delete(a);break}this.cleanup()}}}get stats(){return this._stats}}var Zs,Fn,ws,Ti,Ec,Ci,Ri,qe,uc,v_,__,Jr,Pa,hc;const te=class te{constructor({name:t=null,port:e=null,verbosity:s=lE()}={}){qn(this,qe);qn(this,Zs,Promise.withResolvers());qn(this,Fn,null);qn(this,ws,null);qn(this,Ti,null);if(this.name=t,this.destroyed=!1,this.verbosity=s,e){if(Jt(te,Ri).has(e))throw new Error("Cannot use more than one PDFWorker per port.");Jt(te,Ri).set(e,this),$n(this,qe,v_).call(this,e)}else $n(this,qe,__).call(this)}get promise(){return Jt(this,Zs).promise}get port(){return Jt(this,ws)}get messageHandler(){return Jt(this,Fn)}destroy(){this.destroyed=!0,Jt(this,Ti)?.terminate(),Qe(this,Ti,null),Jt(te,Ri).delete(Jt(this,ws)),Qe(this,ws,null),Jt(this,Fn)?.destroy(),Qe(this,Fn,null)}static create(t){const e=Jt(this,Ri).get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new te(t)}static get workerSrc(){if(Ia.workerSrc)return Ia.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return _t(this,"_setupFakeWorkerGlobal",(async()=>Jt(this,Pa,hc)?Jt(this,Pa,hc):(await import(this.workerSrc)).WorkerMessageHandler)())}};Zs=new WeakMap,Fn=new WeakMap,ws=new WeakMap,Ti=new WeakMap,Ec=new WeakMap,Ci=new WeakMap,Ri=new WeakMap,qe=new WeakSet,uc=function(){Jt(this,Zs).resolve(),Jt(this,Fn).send("configure",{verbosity:this.verbosity})},v_=function(t){Qe(this,ws,t),Qe(this,Fn,new Zr("main","worker",t)),Jt(this,Fn).on("ready",()=>{}),$n(this,qe,uc).call(this)},__=function(){if(Jt(te,Ci)||Jt(te,Pa,hc)){$n(this,qe,Jr).call(this);return}let{workerSrc:t}=te;try{te._isSameOrigin(window.location,t)||(t=te._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),s=new Zr("main","worker",e),a=()=>{o.abort(),s.destroy(),e.terminate(),this.destroyed?Jt(this,Zs).reject(new Error("Worker was destroyed")):$n(this,qe,Jr).call(this)},o=new AbortController;e.addEventListener("error",()=>{Jt(this,Ti)||a()},{signal:o.signal}),s.on("test",h=>{if(o.abort(),this.destroyed||!h){a();return}Qe(this,Fn,s),Qe(this,ws,e),Qe(this,Ti,e),$n(this,qe,uc).call(this)}),s.on("ready",h=>{if(o.abort(),this.destroyed){a();return}try{l()}catch{$n(this,qe,Jr).call(this)}});const l=()=>{const h=new Uint8Array;s.send("test",h,[h.buffer])};l();return}catch{zc("The worker has been disabled.")}$n(this,qe,Jr).call(this)},Jr=function(){Jt(te,Ci)||(vt("Setting up fake worker."),Qe(te,Ci,!0)),te._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){Jt(this,Zs).reject(new Error("Worker was destroyed"));return}const e=new FE;Qe(this,ws,e);const s=`fake${Qy(te,Ec)._++}`,a=new Zr(s+"_worker",s,e);t.setup(a,e),Qe(this,Fn,new Zr(s,s+"_worker",e)),$n(this,qe,uc).call(this)}).catch(t=>{Jt(this,Zs).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},Pa=new WeakSet,hc=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},qn(te,Pa),qn(te,Ec,0),qn(te,Ci,!1),qn(te,Ri,new WeakMap),He&&(Qe(te,Ci,!0),Ia.workerSrc||="./pdf.worker.mjs"),te._isSameOrigin=(t,e)=>{const s=URL.parse(t);if(!s?.origin||s.origin==="null")return!1;const a=new URL(e,s);return s.origin===a.origin},te._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},te.fromPort=t=>{if(_E("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return te.create(t)};let lo=te;class Dx{#t=new Map;#e=new Map;#s=new Map;#n=new Map;#r=null;constructor(t,e,s,a,o,l){this.messageHandler=t,this.loadingTask=e,this.commonObjs=new g_,this.fontLoader=new OE({ownerDocument:a.ownerDocument,styleElement:a.styleElement}),this.loadingParams=a.loadingParams,this._params=a,this.canvasFactory=o.canvasFactory,this.filterFactory=o.filterFactory,this.cMapReaderFactory=o.cMapReaderFactory,this.standardFontDataFactory=o.standardFontDataFactory,this.wasmFactory=o.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=l,this.setupMessageHandler()}#a(t,e=null){const s=this.#t.get(t);if(s)return s;const a=this.messageHandler.sendWithPromise(t,e);return this.#t.set(t,a),a}get annotationStorage(){return _t(this,"annotationStorage",new Uf)}getRenderingIntent(t,e=Qs.ENABLE,s=null,a=!1,o=!1){let l=gn.DISPLAY,h=nf;switch(t){case"any":l=gn.ANY;break;case"display":break;case"print":l=gn.PRINT;break;default:vt(`getRenderingIntent - invalid intent: ${t}`)}const d=l&gn.PRINT&&s instanceof i_?s:this.annotationStorage;switch(e){case Qs.DISABLE:l+=gn.ANNOTATIONS_DISABLE;break;case Qs.ENABLE:break;case Qs.ENABLE_FORMS:l+=gn.ANNOTATIONS_FORMS;break;case Qs.ENABLE_STORAGE:l+=gn.ANNOTATIONS_STORAGE,h=d.serializable;break;default:vt(`getRenderingIntent - invalid annotationMode: ${e}`)}a&&(l+=gn.IS_EDITING),o&&(l+=gn.OPLIST);const{ids:f,hash:m}=d.modifiedIds,y=[l,h.hash,m];return{renderingIntent:l,cacheKey:y.join("_"),annotationStorageSerializable:h,modifiedIds:f}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#r?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const s of this.#e.values())t.push(s._destroy());this.#e.clear(),this.#s.clear(),this.#n.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),yn.cleanup(),this._networkStream?.cancelAllRequests(new Js("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(s,a)=>{Bt(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=o=>{this._lastProgress={loaded:o.loaded,total:o.total}},a.onPull=()=>{this._fullReader.read().then(function({value:o,done:l}){if(l){a.close();return}Bt(o instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),a.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{a.error(o)})},a.onCancel=o=>{this._fullReader.cancel(o),a.ready.catch(l=>{if(!this.destroyed)throw l})}}),t.on("ReaderHeadersReady",async s=>{await this._fullReader.headersReady;const{isStreamingSupported:a,isRangeSupported:o,contentLength:l}=this._fullReader;return(!a||!o)&&(this._lastProgress&&e.onProgress?.(this._lastProgress),this._fullReader.onProgress=h=>{e.onProgress?.({loaded:h.loaded,total:h.total})}),{isStreamingSupported:a,isRangeSupported:o,contentLength:l}}),t.on("GetRangeReader",(s,a)=>{Bt(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const o=this._networkStream.getRangeReader(s.begin,s.end);if(!o){a.close();return}a.onPull=()=>{o.read().then(function({value:l,done:h}){if(h){a.close();return}Bt(l instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),a.enqueue(new Uint8Array(l),1,[l])}).catch(l=>{a.error(l)})},a.onCancel=l=>{o.cancel(l),a.ready.catch(h=>{if(!this.destroyed)throw h})}}),t.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,e._capability.resolve(new Rx(s,this))}),t.on("DocException",s=>{e._capability.reject(Ze(s))}),t.on("PasswordRequest",s=>{this.#r=Promise.withResolvers();try{if(!e.onPassword)throw Ze(s);const a=o=>{o instanceof Error?this.#r.reject(o):this.#r.resolve({password:o})};e.onPassword(a,s.code)}catch(a){this.#r.reject(a)}return this.#r.promise}),t.on("DataLoaded",s=>{e.onProgress?.({loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),t.on("StartRenderPage",s=>{if(this.destroyed)return;this.#e.get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),t.on("commonobj",([s,a,o])=>{if(this.destroyed||this.commonObjs.has(s))return null;switch(a){case"Font":if("error"in o){const y=o.error;vt(`Error during font loading: ${y}`),this.commonObjs.resolve(s,y);break}const l=new Xt(o),h=this._params.pdfBug&&globalThis.FontInspector?.enabled?(y,b)=>globalThis.FontInspector.fontAdded(y,b):null,d=new NE(l,h,o.extra,o.charProcOperatorList);this.fontLoader.bind(d).catch(()=>t.sendWithPromise("FontFallback",{id:s})).finally(()=>{!d.fontExtraProperties&&d.data&&d.clearData(),this.commonObjs.resolve(s,d)});break;case"CopyLocalImage":const{imageRef:f}=o;Bt(f,"The imageRef must be defined.");for(const y of this.#e.values())for(const[,b]of y.objs)if(b?.ref===f)return b.dataLen?(this.commonObjs.resolve(s,structuredClone(b)),b.dataLen):null;break;case"FontPath":this.commonObjs.resolve(s,new LE(o));break;case"Image":this.commonObjs.resolve(s,o);break;case"Pattern":const m=new Ee(o);this.commonObjs.resolve(s,m.getIR());break;default:throw new Error(`Got unknown common object type ${a}`)}return null}),t.on("obj",([s,a,o,l])=>{if(this.destroyed)return;const h=this.#e.get(a);if(!h.objs.has(s)){if(h._intentStates.size===0){l?.bitmap?.close();return}switch(o){case"Image":case"Pattern":h.objs.resolve(s,l);break;default:throw new Error(`Got unknown object type ${o}`)}}}),t.on("DocProgress",s=>{this.destroyed||e.onProgress?.({loaded:s.loaded,total:s.total})}),t.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const a=this[s.type];if(!a)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return a.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&vt("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this._fullReader?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}extractPages(t){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:t})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,s=this.#s.get(e);if(s)return s;const a=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(o=>{if(this.destroyed)throw new Error("Transport destroyed");o.refStr&&this.#n.set(o.refStr,t);const l=new Mx(e,o,this,this._params.pdfBug);return this.#e.set(e,l),l});return this.#s.set(e,a),a}getPageIndex(t){return sf(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return this.#a("GetFieldObjects")}hasJSActions(){return this.#a("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return this.#a("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#a("GetOptionalContentConfig").then(e=>new lx(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#t.get(t);if(e)return e;const s=this.messageHandler.sendWithPromise(t,null).then(a=>({info:a[0],metadata:a[1]?new rx(a[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null,hasStructTree:a[2]}));return this.#t.set(t,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#e.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),yn.cleanup()}}cachedPageNumber(t){if(!sf(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return this.#n.get(e)??null}}class Ox{#t=null;onContinue=null;onError=null;constructor(t){this.#t=t}get promise(){return this.#t.capability.promise}cancel(t=0){this.#t.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this.#t.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this.#t;return t.form||t.canvas&&e?.size>0}}class Na{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:s,commonObjs:a,annotationCanvasMap:o,operatorList:l,pageIndex:h,canvasFactory:d,filterFactory:f,useRequestAnimationFrame:m=!1,pdfBug:y=!1,pageColors:b=null,enableHWA:v=!1,operationsFilter:w=null}){this.callback=t,this.params=e,this.objs=s,this.commonObjs=a,this.annotationCanvasMap=o,this.operatorListIdx=null,this.operatorList=l,this._pageIndex=h,this.canvasFactory=d,this.filterFactory=f,this._pdfBug=y,this.pageColors=b,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=m===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Ox(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=v,this._dependencyTracker=e.dependencyTracker,this._operationsFilter=w}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(Na.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Na.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:s,transform:a,background:o,dependencyTracker:l}=this.params,h=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Ba(h,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,l),this.gfx.beginDrawing({transform:a,viewport:s,transparency:t,background:o}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),Na.#e.delete(this._canvas),t||=new Bf(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Na.#e.delete(this._canvas),this.callback())))}}const A_="5.4.530",Nx="50cc4adac";class On{#t=null;#e=null;#s;#n=null;#r=!1;#a=!1;#i=null;#o;#c=null;#l=null;static#d=null;static get _keyboardManager(){return _t(this,"_keyboardManager",new bo([[["Escape","mac+Escape"],On.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],On.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],On.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],On.prototype._moveToPrevious],[["Home","mac+Home"],On.prototype._moveToBeginning],[["End","mac+End"],On.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#a=!1,this.#i=t):this.#a=!0,this.#l=t?._uiManager||e,this.#o=this.#l._eventBus,this.#s=t?.color?.toUpperCase()||this.#l?.highlightColors.values().next().value||"#FFFF98",On.#d||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#i&&(t.ariaControls=`${this.#i.id}_colorpicker_dropdown`);const e=this.#l._signal;t.addEventListener("click",this.#m.bind(this),{signal:e}),t.addEventListener("keydown",this.#g.bind(this),{signal:e});const s=this.#e=document.createElement("span");return s.className="swatch",s.ariaHidden="true",s.style.backgroundColor=this.#s,t.append(s),t}renderMainDropdown(){const t=this.#n=this.#h();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#h(){const t=document.createElement("div"),e=this.#l._signal;t.addEventListener("contextmenu",Ln,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#i&&(t.id=`${this.#i.id}_colorpicker_dropdown`);for(const[s,a]of this.#l.highlightColors){const o=document.createElement("button");o.tabIndex="0",o.role="option",o.setAttribute("data-color",a),o.title=s,o.setAttribute("data-l10n-id",On.#d[s]);const l=document.createElement("span");o.append(l),l.className="swatch",l.style.backgroundColor=a,o.ariaSelected=a===this.#s,o.addEventListener("click",this.#f.bind(this,a),{signal:e}),t.append(o)}return t.addEventListener("keydown",this.#g.bind(this),{signal:e}),t}#f(t,e){e.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:kt.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#m(t);return}const e=t.target.getAttribute("data-color");e&&this.#f(e,t)}_moveToNext(t){if(!this.#p){this.#m(t);return}if(t.target===this.#t){this.#n.firstElementChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#n?.firstElementChild||t.target===this.#t){this.#p&&this._hideDropdownFromKeyboard();return}this.#p||this.#m(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#p){this.#m(t);return}this.#n.firstElementChild?.focus()}_moveToEnd(t){if(!this.#p){this.#m(t);return}this.#n.lastElementChild?.focus()}#g(t){On._keyboardManager.exec(this,t)}#m(t){if(this.#p){this.hideDropdown();return}if(this.#r=t.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#u.bind(this),{signal:this.#l.combinedSignal(this.#c)})),this.#t.ariaExpanded="true",this.#n){this.#n.classList.remove("hidden");return}const e=this.#n=this.#h();this.#t.append(e)}#u(t){this.#n?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#n?.classList.add("hidden"),this.#t.ariaExpanded="false",this.#c?.abort(),this.#c=null}get#p(){return this.#n&&!this.#n.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#a){if(!this.#p){this.#i?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#r})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#n)return;const e=this.#l.highlightColors.values();for(const s of this.#n.children)s.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#n?.remove(),this.#n=null}}class co{#t=null;#e=null;#s=null;static#n=null;constructor(t){this.#e=t,this.#s=t._uiManager,co.#n||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#t)return this.#t;const{editorType:t,colorType:e,color:s}=this.#e,a=this.#t=document.createElement("input");return a.type="color",a.value=s||"#000000",a.className="basicColorPicker",a.tabIndex=0,a.setAttribute("data-l10n-id",co.#n[t]),a.addEventListener("input",()=>{this.#s.updateParams(e,a.value)},{signal:this.#s._signal}),a}update(t){this.#t&&(this.#t.value=t)}destroy(){this.#t?.remove(),this.#t=null}hideDropdown(){}}function c0(c){return Math.floor(Math.max(0,Math.min(1,c))*255).toString(16).padStart(2,"0")}function zr(c){return Math.max(0,Math.min(255,255*c))}class u0{static CMYK_G([t,e,s,a]){return["G",1-Math.min(1,.3*t+.59*s+.11*e+a)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=zr(t),[t,t,t]}static G_HTML([t]){const e=c0(t);return`#${e}${e}${e}`}static RGB_G([t,e,s]){return["G",.3*t+.59*e+.11*s]}static RGB_rgb(t){return t.map(zr)}static RGB_HTML(t){return`#${t.map(c0).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,s,a]){return["RGB",1-Math.min(1,t+a),1-Math.min(1,s+a),1-Math.min(1,e+a)]}static CMYK_rgb([t,e,s,a]){return[zr(1-Math.min(1,t+a)),zr(1-Math.min(1,s+a)),zr(1-Math.min(1,e+a))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,s]){const a=1-t,o=1-e,l=1-s,h=Math.min(a,o,l);return["CMYK",a,o,l,h]}}class Lx{create(t,e,s=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const a=this._createSVG("svg:svg");return a.setAttribute("version","1.1"),s||(a.setAttribute("width",`${t}px`),a.setAttribute("height",`${e}px`)),a.setAttribute("preserveAspectRatio","none"),a.setAttribute("viewBox",`0 0 ${t} ${e}`),a}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){Kt("Abstract method `_createSVG` called.")}}class Sc extends Lx{_createSVG(t){return document.createElementNS(_s,t)}}const kx=9,Ni=new WeakSet,Bx=new Date().getTimezoneOffset()*60*1e3;class Ld{static create(t){switch(t.data.annotationType){case me.LINK:return new $f(t);case me.TEXT:return new Px(t);case me.WIDGET:switch(t.data.fieldType){case"Tx":return new Fx(t);case"Btn":return t.data.radioButton?new w_(t):t.data.checkBox?new zx(t):new Hx(t);case"Ch":return new jx(t);case"Sig":return new Ux(t)}return new ki(t);case me.POPUP:return new of(t);case me.FREETEXT:return new S_(t);case me.LINE:return new $x(t);case me.SQUARE:return new Gx(t);case me.CIRCLE:return new Xx(t);case me.POLYLINE:return new E_(t);case me.CARET:return new Yx(t);case me.INK:return new Gf(t);case me.POLYGON:return new Vx(t);case me.HIGHLIGHT:return new x_(t);case me.UNDERLINE:return new Kx(t);case me.SQUIGGLY:return new Wx(t);case me.STRIKEOUT:return new Qx(t);case me.STAMP:return new T_(t);case me.FILEATTACHMENT:return new Zx(t);default:return new ne(t)}}}class ne{#t=null;#e=!1;#s=null;constructor(t,{isRenderable:e=!1,ignoreBorder:s=!1,createQuadrilaterals:a=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,this.hasOwnCommentButton=!1,e&&(this.contentElement=this.container=this._createContainer(s)),a&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return ne._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:t}=this,e=this.annotationStorage?.getEditor(t.id);return e?e.getData():t}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const t=this.annotationStorage?.getEditor(this.data.id);if(t)return t.commentButtonPositionInPage;const{quadPoints:e,inkLists:s,rect:a}=this.data;let o=-1/0,l=-1/0;if(e?.length>=8){for(let h=0;h<e.length;h+=8)e[h+1]>l?(l=e[h+1],o=e[h+2]):e[h+1]===l&&(o=Math.max(o,e[h+2]));return[o,l]}if(s?.length>=1){for(const h of s)for(let d=0,f=h.length;d<f;d+=2)h[d+1]>l?(l=h[d+1],o=h[d]):h[d+1]===l&&(o=Math.max(o,h[d]));if(o!==1/0)return[o,l]}return a?[a[2],a[3]]:null}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:s,pageHeight:a,pageX:o,pageY:l}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-o)/s,t[1]=100*(t[1]-l)/a,t}get commentText(){const{data:t}=this;return this.annotationStorage.getRawValue(`${ao}${t.id}`)?.popup?.contents||t.contentsObj?.str||""}set commentText(t){const{data:e}=this,s={deleted:!t,contents:t||""};this.annotationStorage.updateEditor(e.id,{popup:s})||this.annotationStorage.setValue(`${ao}${e.id}`,{id:e.id,annotationType:e.annotationType,pageIndex:this.parent.page._pageIndex,popup:s,popupRef:e.popupRef,modificationDate:new Date}),t||this.removePopup()}removePopup(){(this.#s?.popup||this.popup)?.remove(),this.#s=this.popup=null}updateEdited(t){if(!this.container)return;t.rect&&(this.#t||={rect:this.data.rect.slice(0)});const{rect:e,popup:s}=t;e&&this.#n(e);let a=this.#s?.popup||this.popup;!a&&s?.text&&(this._createPopup(s),a=this.#s.popup),a&&(a.updateEdited(t),s?.deleted&&(a.remove(),this.#s=null,this.popup=null))}resetEdited(){this.#t&&(this.#n(this.#t.rect),this.#s?.popup.resetEdited(),this.#t=null)}#n(t){const{container:{style:e},data:{rect:s,rotation:a},parent:{viewport:{rawDims:{pageWidth:o,pageHeight:l,pageX:h,pageY:d}}}}=this;s?.splice(0,4,...t),e.left=`${100*(t[0]-h)/o}%`,e.top=`${100*(l-t[3]+d)/l}%`,a===0?(e.width=`${100*(t[2]-t[0])/o}%`,e.height=`${100*(t[3]-t[1])/l}%`):this.setRotation(a)}_createContainer(t){const{data:e,parent:{page:s,viewport:a}}=this,o=document.createElement("section");o.setAttribute("data-annotation-id",e.id),!(this instanceof ki)&&!(this instanceof $f)&&(o.tabIndex=0);const{style:l}=o;if(l.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(o.title=e.alternativeText),e.noRotate&&o.classList.add("norotate"),!e.rect||this instanceof of){const{rotation:A}=e;return!e.hasOwnCanvas&&A!==0&&this.setRotation(A,o),o}const{width:h,height:d}=this;if(!t&&e.borderStyle.width>0){l.borderWidth=`${e.borderStyle.width}px`;const A=e.borderStyle.horizontalCornerRadius,x=e.borderStyle.verticalCornerRadius;if(A>0||x>0){const T=`calc(${A}px * var(--total-scale-factor)) / calc(${x}px * var(--total-scale-factor))`;l.borderRadius=T}else if(this instanceof w_){const T=`calc(${h}px * var(--total-scale-factor)) / calc(${d}px * var(--total-scale-factor))`;l.borderRadius=T}switch(e.borderStyle.style){case Ta.SOLID:l.borderStyle="solid";break;case Ta.DASHED:l.borderStyle="dashed";break;case Ta.BEVELED:vt("Unimplemented border style: beveled");break;case Ta.INSET:vt("Unimplemented border style: inset");break;case Ta.UNDERLINE:l.borderBottomStyle="solid";break}const S=e.borderColor||null;S?(this.#e=!0,l.borderColor=nt.makeHexColor(S[0]|0,S[1]|0,S[2]|0)):l.borderWidth=0}const f=nt.normalizeRect([e.rect[0],s.view[3]-e.rect[1]+s.view[1],e.rect[2],s.view[3]-e.rect[3]+s.view[1]]),{pageWidth:m,pageHeight:y,pageX:b,pageY:v}=a.rawDims;l.left=`${100*(f[0]-b)/m}%`,l.top=`${100*(f[1]-v)/y}%`;const{rotation:w}=e;return e.hasOwnCanvas||w===0?(l.width=`${100*h/m}%`,l.height=`${100*d/y}%`):this.setRotation(w,o),o}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:a}=this.parent.viewport.rawDims;let{width:o,height:l}=this;t%180!==0&&([o,l]=[l,o]),e.style.width=`${100*o/s}%`,e.style.height=`${100*l/a}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,s,a)=>{const o=a.detail[e],l=o[0],h=o.slice(1);a.target.style[s]=u0[`${l}_HTML`](h),this.annotationStorage.setValue(this.data.id,{[s]:u0[`${l}_rgb`](h)})};return _t(this,"_commonActions",{display:e=>{const{display:s}=e.detail,a=s%2===1;this.container.style.visibility=a?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:a,noPrint:s===1||s===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:s}=e.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const s=e.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(t,e){const s=this._commonActions;for(const a of Object.keys(e.detail))(t[a]||s[a])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const s=this._commonActions;for(const[a,o]of Object.entries(e)){const l=s[a];if(l){const h={detail:{[a]:o},target:t};l(h),delete e[a]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,s,a,o]=this.data.rect.map(A=>Math.fround(A));if(t.length===8){const[A,x,S,T]=t.subarray(2,6);if(a===A&&o===x&&e===S&&s===T)return}const{style:l}=this.container;let h;if(this.#e){const{borderColor:A,borderWidth:x}=l;l.borderWidth=0,h=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${A}" stroke-width="${x}">`],this.container.classList.add("hasBorder")}const d=a-e,f=o-s,{svgFactory:m}=this,y=m.createElement("svg");y.classList.add("quadrilateralsContainer"),y.setAttribute("width",0),y.setAttribute("height",0),y.role="none";const b=m.createElement("defs");y.append(b);const v=m.createElement("clipPath"),w=`clippath_${this.data.id}`;v.setAttribute("id",w),v.setAttribute("clipPathUnits","objectBoundingBox"),b.append(v);for(let A=2,x=t.length;A<x;A+=8){const S=t[A],T=t[A+1],C=t[A+2],N=t[A+3],D=m.createElement("rect"),L=(C-e)/d,k=(o-T)/f,V=(S-C)/d,K=(T-N)/f;D.setAttribute("x",L),D.setAttribute("y",k),D.setAttribute("width",V),D.setAttribute("height",K),v.append(D),h?.push(`<rect vector-effect="non-scaling-stroke" x="${L}" y="${k}" width="${V}" height="${K}"/>`)}this.#e&&(h.push("</g></svg>')"),l.backgroundImage=h.join("")),this.container.append(y),this.container.style.clipPath=`url(#${w})`}_createPopup(t=null){const{data:e}=this;let s,a;t?(s={str:t.text},a=t.date):(s=e.contentsObj,a=e.modificationDate),this.#s=new of({data:{color:e.color,titleObj:e.titleObj,modificationDate:a,contentsObj:s,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]})}get hasPopupElement(){return!!(this.#s||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#s}render(){Kt("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const s=[];if(this._fieldObjects){const a=this._fieldObjects[t];if(a)for(const{page:o,id:l,exportValues:h}of a){if(o===-1||l===e)continue;const d=typeof h=="string"?h:null,f=document.querySelector(`[data-element-id="${l}"]`);if(f&&!Ni.has(f)){vt(`_getElementsByName - element not allowed: ${l}`);continue}s.push({id:l,exportValue:d,domElement:f})}return s}for(const a of document.getElementsByName(t)){const{exportValue:o}=a,l=a.getAttribute("data-element-id");l!==e&&Ni.has(a)&&s.push({id:l,exportValue:o,domElement:a})}return s}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class Ix extends ne{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.editor=t.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:t}=this;t.hasComment&&this._createPopup(t.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(t){this.editor.comment=t,t||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}class $f extends ne{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let a=!1;return t.url?(e.addLinkAttributes(s,t.url,t.newWindow),a=!0):t.action?(this._bindNamedAction(s,t.action,t.overlaidText),a=!0):t.attachment?(this.#e(s,t.attachment,t.overlaidText,t.attachmentDest),a=!0):t.setOCGState?(this.#s(s,t.setOCGState,t.overlaidText),a=!0):t.dest?(this._bindLink(s,t.dest,t.overlaidText),a=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),a=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),a=!0):this.isTooltipOnly&&!a&&(this._bindLink(s,""),a=!0)),this.container.classList.add("linkAnnotation"),a&&(this.contentElement=s,this.container.append(s)),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,s=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t(),s&&(t.title=s)}_bindNamedAction(t,e,s=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),s&&(t.title=s),this.#t()}#e(t,e,s="",a=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:s&&(t.title=s),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,a),!1),this.#t()}#s(t,e,s=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),s&&(t.title=s),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const a of Object.keys(e.actions)){const o=s.get(a);o&&(t[o]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:a}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){vt('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{s?.();const{fields:a,refs:o,include:l}=e,h=[];if(a.length!==0||o.length!==0){const m=new Set(o);for(const y of a){const b=this._fieldObjects[y]||[];for(const{id:v}of b)m.add(v)}for(const y of Object.values(this._fieldObjects))for(const b of y)m.has(b.id)===l&&h.push(b)}else for(const m of Object.values(this._fieldObjects))h.push(...m);const d=this.annotationStorage,f=[];for(const m of h){const{id:y}=m;switch(f.push(y),m.type){case"text":{const v=m.defaultValue||"";d.setValue(y,{value:v});break}case"checkbox":case"radiobutton":{const v=m.defaultValue===m.exportValues;d.setValue(y,{value:v});break}case"combobox":case"listbox":{const v=m.defaultValue||"";d.setValue(y,{value:v});break}default:continue}const b=document.querySelector(`[data-element-id="${y}"]`);if(b){if(!Ni.has(b)){vt(`_bindResetFormAction - element not allowed: ${y}`);continue}}else continue;b.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:f,name:"ResetForm"}}),!1}}}class Px extends ne{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(t),this.container}}class ki extends ne{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return Ae.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,s,a,o){s.includes("mouse")?t.addEventListener(s,l=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:a,value:o(l),shift:l.shiftKey,modifier:this._getKeyModifier(l)}})}):t.addEventListener(s,l=>{if(s==="blur"){if(!e.focused||!l.relatedTarget)return;e.focused=!1}else if(s==="focus"){if(e.focused)return;e.focused=!0}o&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:a,value:o(l)}})})}_setEventListeners(t,e,s,a){for(const[o,l]of s)(l==="Action"||this.data.actions?.[l])&&((l==="Focus"||l==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,o,l,a),l==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):l==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":nt.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,a=this.data.defaultAppearanceData.fontSize||kx,o=t.style;let l;const h=2,d=f=>Math.round(10*f)/10;if(this.data.multiLine){const f=Math.abs(this.data.rect[3]-this.data.rect[1]-h),m=Math.round(f/(xd*a))||1,y=f/m;l=Math.min(a,d(y/xd))}else{const f=Math.abs(this.data.rect[3]-this.data.rect[1]-h);l=Math.min(a,d(f/xd))}o.fontSize=`calc(${l}px * var(--total-scale-factor))`,o.color=nt.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(o.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class Fx extends ki{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,s,a){const o=this.annotationStorage;for(const l of this._getElementsByName(t.name,t.id))l.domElement&&(l.domElement[e]=s),o.setValue(l.id,{[a]:s})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const a=t.getValue(e,{value:this.data.fieldValue});let o=a.value||"";const l=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let h=a.formattedValue||this.data.textContent?.join(`
`)||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const d={userValue:o,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=h??o,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",h??o),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Ni.add(s),this.contentElement=s,s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=0;const{datetimeFormat:f,datetimeType:m,timeStep:y}=this.data,b=!!m&&this.enableScripting;f&&(s.title=f),this._setRequired(s,this.data.required),l&&(s.maxLength=l),s.addEventListener("input",w=>{t.setValue(e,{value:w.target.value}),this.setPropertyOnSiblings(s,"value",w.target.value,"value"),d.formattedValue=null}),s.addEventListener("resetform",w=>{const A=this.data.defaultFieldValue??"";s.value=d.userValue=A,d.formattedValue=null});let v=w=>{const{formattedValue:A}=d;A!=null&&(w.target.value=A),w.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",A=>{if(d.focused)return;const{target:x}=A;if(b&&(x.type=m,y&&(x.step=y)),d.userValue){const S=d.userValue;if(b)if(m==="time"){const T=new Date(S),C=[T.getHours(),T.getMinutes(),T.getSeconds()];x.value=C.map(N=>N.toString().padStart(2,"0")).join(":")}else x.value=new Date(S-Bx).toISOString().split(m==="date"?"T":".",1)[0];else x.value=S}d.lastCommittedValue=x.value,d.commitKey=1,this.data.actions?.Focus||(d.focused=!0)}),s.addEventListener("updatefromsandbox",A=>{this.showElementAndHideCanvas(A.target);const x={value(S){d.userValue=S.detail.value??"",b||t.setValue(e,{value:d.userValue.toString()}),S.target.value=d.userValue},formattedValue(S){const{formattedValue:T}=S.detail;d.formattedValue=T,T!=null&&S.target!==document.activeElement&&(S.target.value=T);const C={formattedValue:T};b&&(C.value=T),t.setValue(e,C)},selRange(S){S.target.setSelectionRange(...S.detail.selRange)},charLimit:S=>{const{charLimit:T}=S.detail,{target:C}=S;if(T===0){C.removeAttribute("maxLength");return}C.setAttribute("maxLength",T);let N=d.userValue;!N||N.length<=T||(N=N.slice(0,T),C.value=d.userValue=N,t.setValue(e,{value:N}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:N,willCommit:!0,commitKey:1,selStart:C.selectionStart,selEnd:C.selectionEnd}}))}};this._dispatchEventFromSandbox(x,A)}),s.addEventListener("keydown",A=>{d.commitKey=1;let x=-1;if(A.key==="Escape"?x=0:A.key==="Enter"&&!this.data.multiLine?x=2:A.key==="Tab"&&(d.commitKey=3),x===-1)return;const{value:S}=A.target;d.lastCommittedValue!==S&&(d.lastCommittedValue=S,d.userValue=S,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:S,willCommit:!0,commitKey:x,selStart:A.target.selectionStart,selEnd:A.target.selectionEnd}}))});const w=v;v=null,s.addEventListener("blur",A=>{if(!d.focused||!A.relatedTarget)return;this.data.actions?.Blur||(d.focused=!1);const{target:x}=A;let{value:S}=x;if(b){if(S&&m==="time"){const T=S.split(":").map(C=>parseInt(C,10));S=new Date(2e3,0,1,T[0],T[1],T[2]||0).valueOf(),x.step=""}else S.includes("T")||(S=`${S}T00:00`),S=new Date(S).valueOf();x.type="text"}d.userValue=S,d.lastCommittedValue!==S&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:S,willCommit:!0,commitKey:d.commitKey,selStart:A.target.selectionStart,selEnd:A.target.selectionEnd}}),w(A)}),this.data.actions?.Keystroke&&s.addEventListener("beforeinput",A=>{d.lastCommittedValue=null;const{data:x,target:S}=A,{value:T,selectionStart:C,selectionEnd:N}=S;let D=C,L=N;switch(A.inputType){case"deleteWordBackward":{const k=T.substring(0,C).match(/\w*[^\w]*$/);k&&(D-=k[0].length);break}case"deleteWordForward":{const k=T.substring(C).match(/^[^\w]*\w*/);k&&(L+=k[0].length);break}case"deleteContentBackward":C===N&&(D-=1);break;case"deleteContentForward":C===N&&(L+=1);break}A.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:T,change:x||"",willCommit:!1,selStart:D,selEnd:L}})}),this._setEventListeners(s,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],A=>A.target.value)}if(v&&s.addEventListener("blur",v),this.data.comb){const A=(this.data.rect[2]-this.data.rect[0])/l;s.classList.add("comb"),s.style.letterSpacing=`calc(${A}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Ux extends ki{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class zx extends ki{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,s=e.id;let a=t.getValue(s,{value:e.exportValue===e.fieldValue}).value;typeof a=="string"&&(a=a!=="Off",t.setValue(s,{value:a})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const o=document.createElement("input");return Ni.add(o),o.setAttribute("data-element-id",s),o.disabled=e.readOnly,this._setRequired(o,this.data.required),o.type="checkbox",o.name=e.fieldName,a&&o.setAttribute("checked",!0),o.setAttribute("exportValue",e.exportValue),o.tabIndex=0,o.addEventListener("change",l=>{const{name:h,checked:d}=l.target;for(const f of this._getElementsByName(h,s)){const m=d&&f.exportValue===e.exportValue;f.domElement&&(f.domElement.checked=m),t.setValue(f.id,{value:m})}t.setValue(s,{value:d})}),o.addEventListener("resetform",l=>{const h=e.defaultFieldValue||"Off";l.target.checked=h===e.exportValue}),this.enableScripting&&this.hasJSActions&&(o.addEventListener("updatefromsandbox",l=>{const h={value(d){d.target.checked=d.detail.value!=="Off",t.setValue(s,{value:d.target.checked})}};this._dispatchEventFromSandbox(h,l)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],l=>l.target.checked)),this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}}class w_ extends ki{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,s=e.id;let a=t.getValue(s,{value:e.fieldValue===e.buttonValue}).value;if(typeof a=="string"&&(a=a!==e.buttonValue,t.setValue(s,{value:a})),a)for(const l of this._getElementsByName(e.fieldName,s))t.setValue(l.id,{value:!1});const o=document.createElement("input");if(Ni.add(o),o.setAttribute("data-element-id",s),o.disabled=e.readOnly,this._setRequired(o,this.data.required),o.type="radio",o.name=e.fieldName,a&&o.setAttribute("checked",!0),o.tabIndex=0,o.addEventListener("change",l=>{const{name:h,checked:d}=l.target;for(const f of this._getElementsByName(h,s))t.setValue(f.id,{value:!1});t.setValue(s,{value:d})}),o.addEventListener("resetform",l=>{const h=e.defaultFieldValue;l.target.checked=h!=null&&h===e.buttonValue}),this.enableScripting&&this.hasJSActions){const l=e.buttonValue;o.addEventListener("updatefromsandbox",h=>{const d={value:f=>{const m=l===f.detail.value;for(const y of this._getElementsByName(f.target.name)){const b=m&&y.id===s;y.domElement&&(y.domElement.checked=b),t.setValue(y.id,{value:b})}}};this._dispatchEventFromSandbox(d,h)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],h=>h.target.checked)}return this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}}class Hx extends $f{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),t}}class jx extends ki{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,s=t.getValue(e,{value:this.data.fieldValue}),a=document.createElement("select");Ni.add(a),a.setAttribute("data-element-id",e),a.disabled=this.data.readOnly,this._setRequired(a,this.data.required),a.name=this.data.fieldName,a.tabIndex=0;let o=this.data.combo&&this.data.options.length>0;this.data.combo||(a.size=this.data.options.length,this.data.multiSelect&&(a.multiple=!0)),a.addEventListener("resetform",m=>{const y=this.data.defaultFieldValue;for(const b of a.options)b.selected=b.value===y});for(const m of this.data.options){const y=document.createElement("option");y.textContent=m.displayValue,y.value=m.exportValue,s.value.includes(m.exportValue)&&(y.setAttribute("selected",!0),o=!1),a.append(y)}let l=null;if(o){const m=document.createElement("option");m.value=" ",m.setAttribute("hidden",!0),m.setAttribute("selected",!0),a.prepend(m),l=()=>{m.remove(),a.removeEventListener("input",l),l=null},a.addEventListener("input",l)}const h=m=>{const y=m?"value":"textContent",{options:b,multiple:v}=a;return v?Array.prototype.filter.call(b,w=>w.selected).map(w=>w[y]):b.selectedIndex===-1?null:b[b.selectedIndex][y]};let d=h(!1);const f=m=>{const y=m.target.options;return Array.prototype.map.call(y,b=>({displayValue:b.textContent,exportValue:b.value}))};return this.enableScripting&&this.hasJSActions?(a.addEventListener("updatefromsandbox",m=>{const y={value(b){l?.();const v=b.detail.value,w=new Set(Array.isArray(v)?v:[v]);for(const A of a.options)A.selected=w.has(A.value);t.setValue(e,{value:h(!0)}),d=h(!1)},multipleSelection(b){a.multiple=!0},remove(b){const v=a.options,w=b.detail.remove;v[w].selected=!1,a.remove(w),v.length>0&&Array.prototype.findIndex.call(v,x=>x.selected)===-1&&(v[0].selected=!0),t.setValue(e,{value:h(!0),items:f(b)}),d=h(!1)},clear(b){for(;a.length!==0;)a.remove(0);t.setValue(e,{value:null,items:[]}),d=h(!1)},insert(b){const{index:v,displayValue:w,exportValue:A}=b.detail.insert,x=a.children[v],S=document.createElement("option");S.textContent=w,S.value=A,x?x.before(S):a.append(S),t.setValue(e,{value:h(!0),items:f(b)}),d=h(!1)},items(b){const{items:v}=b.detail;for(;a.length!==0;)a.remove(0);for(const w of v){const{displayValue:A,exportValue:x}=w,S=document.createElement("option");S.textContent=A,S.value=x,a.append(S)}a.options.length>0&&(a.options[0].selected=!0),t.setValue(e,{value:h(!0),items:f(b)}),d=h(!1)},indices(b){const v=new Set(b.detail.indices);for(const w of b.target.options)w.selected=v.has(w.index);t.setValue(e,{value:h(!0)}),d=h(!1)},editable(b){b.target.disabled=!b.detail.editable}};this._dispatchEventFromSandbox(y,m)}),a.addEventListener("input",m=>{const y=h(!0),b=h(!1);t.setValue(e,{value:y}),m.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:d,change:b,changeEx:y,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(a,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],m=>m.target.value)):a.addEventListener("input",function(m){t.setValue(e,{value:h(!0)})}),this.data.combo&&this._setTextStyle(a),this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class of extends ne{constructor(t){const{data:e,elements:s,parent:a}=t,o=!!a._commentManager;if(super(t,{isRenderable:!o&&ne._hasPopupData(e)}),this.elements=s,o&&ne._hasPopupData(e)){const l=this.popup=this.#t();for(const h of s)h.popup=l}else this.popup=null}#t(){return new qx({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=this.#t(),s=[];for(const a of this.elements)a.popup=e,a.container.ariaHasPopup="dialog",s.push(a.data.id),a.addHighlightArea();return this.container.setAttribute("aria-controls",s.map(a=>`${Da}${a}`).join(",")),this.container}}class qx{#t=null;#e=this.#$.bind(this);#s=this.#U.bind(this);#n=this.#L.bind(this);#r=this.#w.bind(this);#a=null;#i=null;#o=null;#c=null;#l=null;#d=null;#h=null;#f=!1;#g=null;#m=null;#u=null;#p=null;#y=null;#v=null;#b=null;#x=null;#S=null;#A=null;#C=!1;#_=null;#E=null;constructor({container:t,color:e,elements:s,titleObj:a,modificationDate:o,contentsObj:l,richText:h,parent:d,rect:f,parentRect:m,open:y,commentManager:b=null}){this.#i=t,this.#S=a,this.#o=l,this.#x=h,this.#d=d,this.#a=e,this.#b=f,this.#h=m,this.#l=s,this.#t=b,this.#_=s[0],this.#c=Jd.toDateObject(o),this.trigger=s.flatMap(v=>v.getElementsToTriggerPopup()),b||(this.#D(),this.#i.hidden=!0,y&&this.#w())}#D(){if(this.#m)return;this.#m=new AbortController;const{signal:t}=this.#m;for(const e of this.trigger)e.addEventListener("click",this.#r,{signal:t}),e.addEventListener("pointerenter",this.#n,{signal:t}),e.addEventListener("pointerleave",this.#s,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#l)e.container?.addEventListener("keydown",this.#e,{signal:t})}#R(){const t=this.#l.find(e=>e.hasCommentButton);t&&(this.#y=t._normalizePoint(t.commentButtonPosition))}renderCommentButton(){if(this.#p){this.#p.parentNode||this.#_.container.after(this.#p);return}if(this.#y||this.#R(),!this.#y)return;const{signal:t}=this.#m=new AbortController,e=this.#_.hasOwnCommentButton,s=()=>{this.#t.toggleCommentPopup(this,!0,void 0,!e)},a=()=>{this.#t.toggleCommentPopup(this,!1,!0,!e)},o=()=>{this.#t.toggleCommentPopup(this,!1,!1)};if(e){this.#p=this.#_.container;for(const l of this.trigger)l.ariaHasPopup="dialog",l.ariaControls="commentPopup",l.addEventListener("keydown",this.#e,{signal:t}),l.addEventListener("click",s,{signal:t}),l.addEventListener("pointerenter",a,{signal:t}),l.addEventListener("pointerleave",o,{signal:t}),l.classList.add("popupTriggerArea")}else{const l=this.#p=document.createElement("button");l.className="annotationCommentButton";const h=this.#_.container;l.style.zIndex=h.style.zIndex+1,l.tabIndex=0,l.ariaHasPopup="dialog",l.ariaControls="commentPopup",l.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#P(),this.#M(),l.addEventListener("keydown",this.#e,{signal:t}),l.addEventListener("click",s,{signal:t}),l.addEventListener("pointerenter",a,{signal:t}),l.addEventListener("pointerleave",o,{signal:t}),h.after(l)}}#M(){if(this.#_.extraPopupElement&&!this.#_.editor)return;this.#p||this.renderCommentButton();const[t,e]=this.#y,{style:s}=this.#p;s.left=`calc(${t}%)`,s.top=`calc(${e}% - var(--comment-button-dim))`}#P(){this.#_.extraPopupElement||(this.#p||this.renderCommentButton(),this.#p.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:t,opacity:e}=this.#_.commentData;return t?this.#d._commentManager.makeCommentColor(t,e):null}focusCommentButton(){setTimeout(()=>{this.#p?.focus()},0)}getData(){const{richText:t,color:e,opacity:s,creationDate:a,modificationDate:o}=this.#_.commentData;return{contentsObj:{str:this.comment},richText:t,color:e,opacity:s,creationDate:a,modificationDate:o}}get elementBeforePopup(){return this.#p}get comment(){return this.#E||=this.#_.commentText,this.#E}set comment(t){t!==this.comment&&(this.#_.commentText=this.#E=t)}focus(){this.#_.container?.focus()}get parentBoundingClientRect(){return this.#_.layer.getBoundingClientRect()}setCommentButtonStates({selected:t,hasPopup:e}){this.#p&&(this.#p.classList.toggle("selected",t),this.#p.ariaExpanded=e)}setSelectedCommentButton(t){this.#p.classList.toggle("selected",t)}get commentPopupPosition(){if(this.#v)return this.#v;const{x:t,y:e,height:s}=this.#p.getBoundingClientRect(),{x:a,y:o,width:l,height:h}=this.#_.layer.getBoundingClientRect();return[(t-a)/l,(e+s-o)/h]}set commentPopupPosition(t){this.#v=t}hasDefaultPopupPosition(){return this.#v===null}get commentButtonPosition(){return this.#y}get commentButtonWidth(){return this.#p.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(t){const[e,s]=this.#v||this.commentButtonPosition.map(f=>f/100),a=this.parentBoundingClientRect,{x:o,y:l,width:h,height:d}=a;this.#t.showDialog(null,this,o+e*h,l+s*d,{...t,parentDimensions:a})}render(){if(this.#g)return;const t=this.#g=document.createElement("div");if(t.className="popup",this.#a){const s=t.style.outlineColor=nt.makeHexColor(...this.#a);t.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#S?.str){const s=document.createElement("span");s.className="title",e.append(s),{dir:s.dir,str:s.textContent}=this.#S}if(t.append(e),this.#c){const s=document.createElement("time");s.className="popupDate",s.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),s.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#c.valueOf()})),s.dateTime=this.#c.toISOString(),e.append(s)}t_({html:this.#N||this.#o.str,dir:this.#o?.dir,className:"popupContent"},t),this.#i.append(t)}get#N(){const t=this.#x,e=this.#o;return t?.str&&(!e?.str||e.str===t.str)&&this.#x.html||null}get#k(){return this.#N?.attributes?.style?.fontSize||0}get#F(){return this.#N?.attributes?.style?.color||null}#B(t){const e=[],s={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},a={style:{color:this.#F,fontSize:this.#k?`calc(${this.#k}px * var(--total-scale-factor))`:""}};for(const o of t.split(`
`))e.push({name:"span",value:o,attributes:a});return s}#$(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#f)&&this.#w()}updateEdited({rect:t,popup:e,deleted:s}){if(this.#t){s?(this.remove(),this.#E=null):e&&(e.deleted?this.remove():(this.#P(),this.#E=e.text)),t&&(this.#y=null,this.#R(),this.#M());return}if(s||e?.deleted){this.remove();return}this.#D(),this.#A||={contentsObj:this.#o,richText:this.#x},t&&(this.#u=null),e&&e.text&&(this.#x=this.#B(e.text),this.#c=Jd.toDateObject(e.date),this.#o=null),this.#g?.remove(),this.#g=null}resetEdited(){this.#A&&({contentsObj:this.#o,richText:this.#x}=this.#A,this.#A=null,this.#g?.remove(),this.#g=null,this.#u=null)}remove(){if(this.#m?.abort(),this.#m=null,this.#g?.remove(),this.#g=null,this.#C=!1,this.#f=!1,this.#p?.remove(),this.#p=null,this.trigger)for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#T(){if(this.#u!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:s,pageX:a,pageY:o}}}=this.#d;let l=!!this.#h,h=l?this.#h:this.#b;for(const w of this.#l)if(!h||nt.intersect(w.data.rect,h)!==null){h=w.data.rect,l=!0;break}const d=nt.normalizeRect([h[0],t[3]-h[1]+t[1],h[2],t[3]-h[3]+t[1]]),m=l?h[2]-h[0]+5:0,y=d[0]+m,b=d[1];this.#u=[100*(y-a)/e,100*(b-o)/s];const{style:v}=this.#i;v.left=`${this.#u[0]}%`,v.top=`${this.#u[1]}%`}#w(){if(this.#t){this.#t.toggleCommentPopup(this,!1);return}this.#f=!this.#f,this.#f?(this.#L(),this.#i.addEventListener("click",this.#r),this.#i.addEventListener("keydown",this.#e)):(this.#U(),this.#i.removeEventListener("click",this.#r),this.#i.removeEventListener("keydown",this.#e))}#L(){this.#g||this.render(),this.isVisible?this.#f&&this.#i.classList.add("focused"):(this.#T(),this.#i.hidden=!1,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)+1e3)}#U(){this.#i.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#i.hidden=!0,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)-1e3)}forceHide(){this.#C=this.isVisible,this.#C&&(this.#i.hidden=!0)}maybeShow(){this.#t||(this.#D(),this.#C&&(this.#g||this.#L(),this.#C=!1,this.#i.hidden=!1))}get isVisible(){return this.#t?!1:this.#i.hidden===!1}}class S_ extends ne{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=At.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=this.contentElement=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const s=document.createElement("span");s.textContent=e,t.append(s)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class $x extends ne{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:s}=this,a=this.svgFactory.create(e,s,!0),o=this.#t=this.svgFactory.createElement("svg:line");return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),a.append(o),this.container.append(a),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Gx extends ne{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:s}=this,a=this.svgFactory.create(e,s,!0),o=t.borderStyle.width,l=this.#t=this.svgFactory.createElement("svg:rect");return l.setAttribute("x",o/2),l.setAttribute("y",o/2),l.setAttribute("width",e-o),l.setAttribute("height",s-o),l.setAttribute("stroke-width",o||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),a.append(l),this.container.append(a),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Xx extends ne{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:s}=this,a=this.svgFactory.create(e,s,!0),o=t.borderStyle.width,l=this.#t=this.svgFactory.createElement("svg:ellipse");return l.setAttribute("cx",e/2),l.setAttribute("cy",s/2),l.setAttribute("rx",e/2-o/2),l.setAttribute("ry",s/2-o/2),l.setAttribute("stroke-width",o||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),a.append(l),this.container.append(a),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class E_ extends ne{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:s,popupRef:a},width:o,height:l}=this;if(!e)return this.container;const h=this.svgFactory.create(o,l,!0);let d=[];for(let m=0,y=e.length;m<y;m+=2){const b=e[m]-t[0],v=t[3]-e[m+1];d.push(`${b},${v}`)}d=d.join(" ");const f=this.#t=this.svgFactory.createElement(this.svgElementName);return f.setAttribute("points",d),f.setAttribute("stroke-width",s.width||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),h.append(f),this.container.append(h),!a&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Vx extends E_{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Yx extends ne{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}class Gf extends ne{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?At.HIGHLIGHT:At.INK}#s(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:s,borderStyle:a,popupRef:o}}=this,{transform:l,width:h,height:d}=this.#s(e,t),f=this.svgFactory.create(h,d,!0),m=this.#t=this.svgFactory.createElement("svg:g");f.append(m),m.setAttribute("stroke-width",a.width||1),m.setAttribute("stroke-linecap","round"),m.setAttribute("stroke-linejoin","round"),m.setAttribute("stroke-miterlimit",10),m.setAttribute("stroke","transparent"),m.setAttribute("fill","transparent"),m.setAttribute("transform",l);for(let y=0,b=s.length;y<b;y++){const v=this.svgFactory.createElement(this.svgElementName);this.#e.push(v),v.setAttribute("points",s[y].join(",")),m.append(v)}return!o&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(f),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:s,rect:a}=t,o=this.#t;if(e>=0&&o.setAttribute("stroke-width",e||1),s)for(let l=0,h=this.#e.length;l<h;l++)this.#e[l].setAttribute("points",s[l].join(","));if(a){const{transform:l,width:h,height:d}=this.#s(this.data.rotation,a);o.parentElement.setAttribute("viewBox",`0 0 ${h} ${d}`),o.setAttribute("transform",l)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class x_ extends ne{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=At.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const s=document.createElement("mark");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class Kx extends ne{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),t){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class Wx extends ne{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),t){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class Qx extends ne{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),t){const s=document.createElement("s");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class T_ extends ne{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=At.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class Zx extends ne{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let s;e.hasAppearance||e.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),s.addEventListener("dblclick",this.#e.bind(this)),this.#t=s;const{isMac:a}=Ae.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(a?o.metaKey:o.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class Xf{#t=null;#e=null;#s=null;#n=new Map;#r=null;#a=null;#i=[];#o=!1;constructor({div:t,accessibilityManager:e,annotationCanvasMap:s,annotationEditorUIManager:a,page:o,viewport:l,structTreeLayer:h,commentManager:d,linkService:f,annotationStorage:m}){this.div=t,this.#t=e,this.#e=s,this.#r=h||null,this.#a=f||null,this.#s=m||new Uf,this.page=o,this.viewport=l,this.zIndex=0,this._annotationEditorUIManager=a,this._commentManager=d||null}hasEditableAnnotations(){return this.#n.size>0}async render(t){const{annotations:e}=t,s=this.div;Oi(s,this.viewport);const a=new Map,o=[],l={data:null,layer:s,linkService:this.#a,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new Sc,annotationStorage:this.#s,enableComment:t.enableComment===!0,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const h of e){if(h.noHTML)continue;const d=h.annotationType===me.POPUP;if(d){const y=a.get(h.id);if(!y)continue;if(!this._commentManager){o.push(h);continue}l.elements=y}else if(h.rect[2]===h.rect[0]||h.rect[3]===h.rect[1])continue;l.data=h;const f=Ld.create(l);if(!f.isRenderable)continue;if(!d&&(this.#i.push(f),h.popupRef)){const y=a.get(h.popupRef);y?y.push(f):a.set(h.popupRef,[f])}const m=f.render();h.hidden&&(m.style.visibility="hidden"),f._isEditable&&(this.#n.set(f.data.id,f),this._annotationEditorUIManager?.renderAnnotationElement(f))}await this.#c();for(const h of o){const d=l.elements=a.get(h.id);l.data=h;const f=Ld.create(l);if(!f.isRenderable)continue;const m=f.render();f.contentElement.id=`${Da}${h.id}`,h.hidden&&(m.style.visibility="hidden"),d.at(-1).container.after(m)}this.#l()}async#c(){if(this.#i.length===0)return;this.div.replaceChildren();const t=[];if(!this.#o){this.#o=!0;for(const{contentElement:s,data:{id:a}}of this.#i){const o=s.id=`${Da}${a}`;t.push(this.#r?.getAriaAttributes(o).then(l=>{if(l)for(const[h,d]of l)s.setAttribute(h,d)}))}}this.#i.sort(({data:{rect:[s,a,o,l]}},{data:{rect:[h,d,f,m]}})=>{if(s===o&&a===l)return 1;if(h===f&&d===m)return-1;const y=l,b=a,v=(a+l)/2,w=m,A=d,x=(d+m)/2;if(v>=w&&x<=b)return-1;if(x>=y&&v<=A)return 1;const S=(s+o)/2,T=(h+f)/2;return S-T});const e=document.createDocumentFragment();for(const s of this.#i)e.append(s.container),this._commentManager?(s.extraPopupElement?.popup||s.popup)?.renderCommentButton():s.extraPopupElement&&e.append(s.extraPopupElement.render());if(this.div.append(e),await Promise.all(t),this.#t)for(const s of this.#i)this.#t.addPointerInTextLayer(s.contentElement,!1)}async addLinkAnnotations(t){const e={data:null,layer:this.div,linkService:this.#a,svgFactory:new Sc,parent:this};for(const s of t){s.borderStyle||=Xf._defaultBorderStyle,e.data=s;const a=Ld.create(e);a.isRenderable&&(a.render(),a.contentElement.id=`${Da}${s.id}`,this.#i.push(a))}await this.#c()}update({viewport:t}){const e=this.div;this.viewport=t,Oi(e,{rotation:t.rotation}),this.#l(),e.hidden=!1}#l(){if(!this.#e)return;const t=this.div;for(const[e,s]of this.#e){const a=t.querySelector(`[data-annotation-id="${e}"]`);if(!a)continue;s.className="annotationContent";const{firstChild:o}=a;o?o.nodeName==="CANVAS"?o.replaceWith(s):o.classList.contains("annotationContent")?o.after(s):o.before(s):a.append(s);const l=this.#n.get(e);l&&(l._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,a.id,s),l._hasNoCanvas=!1):l.canvas=s)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#n.values())}getEditableAnnotation(t){return this.#n.get(t)}addFakeAnnotation(t){const{div:e}=this,{id:s,rotation:a}=t,o=new Ix({data:{id:s,rect:t.getPDFRect(),rotation:a},editor:t,layer:e,parent:this,enableComment:!!this._commentManager,linkService:this.#a,annotationStorage:this.#s});return o.render(),o.contentElement.id=`${Da}${s}`,o.createOrUpdatePopup(),this.#i.push(o),o}removeAnnotation(t){const e=this.#i.findIndex(a=>a.data.id===t);if(e<0)return;const[s]=this.#i.splice(e,1);this.#t?.removePointerInTextLayer(s.contentElement)}updateFakeAnnotations(t){if(t.length!==0){for(const e of t)e.updateFakeAnnotationElement(this);this.#c()}}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}static get _defaultBorderStyle(){return _t(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Ta.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const Zl=/\r\n?|\n/g;class xe extends ct{#t="";#e=`${this.id}-editor`;#s=null;#n;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=xe.prototype,e=o=>o.isEmpty(),s=ti.TRANSLATE_SMALL,a=ti.TRANSLATE_BIG;return _t(this,"_keyboardManager",new bo([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-a,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[a,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-a],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,a],checker:e}]]))}static _type="freetext";static _editorType=At.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.color=t.color||xe._defaultColor||ct._defaultLineColor,this.#n=t.fontSize||xe._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static initialize(t,e){ct.initialize(t,e);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case kt.FREETEXT_SIZE:xe._defaultFontSize=e;break;case kt.FREETEXT_COLOR:xe._defaultColor=e;break}}updateParams(t,e){switch(t){case kt.FREETEXT_SIZE:this.#r(e);break;case kt.FREETEXT_COLOR:this.#a(e);break}}static get defaultPropertiesToUpdate(){return[[kt.FREETEXT_SIZE,xe._defaultFontSize],[kt.FREETEXT_COLOR,xe._defaultColor||ct._defaultLineColor]]}get propertiesToUpdate(){return[[kt.FREETEXT_SIZE,this.#n],[kt.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new co(this),[["colorPicker",this._colorPicker]]}get colorType(){return kt.FREETEXT_COLOR}#r(t){const e=a=>{this.editorDiv.style.fontSize=`calc(${a}px * var(--total-scale-factor))`,this.translate(0,-(a-this.#n)*this.parentScale),this.#n=a,this.#o()},s=this.#n;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:kt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#a(t){const e=a=>{this.color=a,this.onUpdatedColor()},s=this.color;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:kt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-xe._internalPadding*t,-(xe._internalPadding+this.#n)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#s=new AbortController;const t=this._uiManager.combinedSignal(this.#s);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#e),this._isDraggable=!0,this.#s?.abort(),this.#s=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#i(){const t=[];this.editorDiv.normalize();let e=null;for(const s of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&s.nodeName==="BR"||(t.push(xe.#c(s)),e=s);return t.join(`
`)}#o(){const[t,e]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:a,div:o}=this,l=o.style.display,h=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",a.div.append(this.div),s=o.getBoundingClientRect(),o.remove(),o.style.display=l,o.classList.toggle("hidden",h)}this.rotation%180===this.parentRotation%180?(this.width=s.width/t,this.height=s.height/e):(this.width=s.height/t,this.height=s.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#t,e=this.#t=this.#i().trimEnd();if(t===e)return;const s=a=>{if(this.#t=a,!a){this.remove();return}this.#l(),this._uiManager.rebuild(this),this.#o()};this.addCommands({cmd:()=>{s(e)},undo:()=>{s(t)},mustExec:!1}),this.#o()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){xe._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#e),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${this.#n}px * var(--total-scale-factor))`,s.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[a,o]=this.parentDimensions;if(this.annotationElementId){const{position:l}=this._initialData;let[h,d]=this.getInitialTranslation();[h,d]=this.pageTranslationToScreen(h,d);const[f,m]=this.pageDimensions,[y,b]=this.pageTranslation;let v,w;switch(this.rotation){case 0:v=t+(l[0]-y)/f,w=e+this.height-(l[1]-b)/m;break;case 90:v=t+(l[0]-y)/f,w=e-(l[1]-b)/m,[h,d]=[d,-h];break;case 180:v=t-this.width+(l[0]-y)/f,w=e-(l[1]-b)/m,[h,d]=[-h,-d];break;case 270:v=t+(l[0]-y-this.height*m)/f,w=e+(l[1]-b-this.width*f)/m,[h,d]=[-d,h];break}this.setAt(v*a,w*o,h,d)}else this._moveAfterPaste(t,e);this.#l(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Zl,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:s}=e;if(s.length===1&&s[0]==="text/plain")return;t.preventDefault();const a=xe.#h(e.getData("text")||"").replaceAll(Zl,`
`);if(!a)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const l=o.getRangeAt(0);if(!a.includes(`
`)){l.insertNode(document.createTextNode(a)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:h,startOffset:d}=l,f=[],m=[];if(h.nodeType===Node.TEXT_NODE){const v=h.parentElement;if(m.push(h.nodeValue.slice(d).replaceAll(Zl,"")),v!==this.editorDiv){let w=f;for(const A of this.editorDiv.childNodes){if(A===v){w=m;continue}w.push(xe.#c(A))}}f.push(h.nodeValue.slice(0,d).replaceAll(Zl,""))}else if(h===this.editorDiv){let v=f,w=0;for(const A of this.editorDiv.childNodes)w++===d&&(v=m),v.push(xe.#c(A))}this.#t=`${f.join(`
`)}${a}${m.join(`
`)}`,this.#l();const y=new Range;let b=Math.sumPrecise(f.map(v=>v.length));for(const{firstChild:v}of this.editorDiv.childNodes)if(v.nodeType===Node.TEXT_NODE){const w=v.nodeValue.length;if(b<=w){y.setStart(v,b),y.setEnd(v,b);break}b-=w}o.removeAllRanges(),o.addRange(y)}#l(){if(this.editorDiv.replaceChildren(),!!this.#t)for(const t of this.#t.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#d(){return this.#t.replaceAll(""," ")}static#h(t){return t.replaceAll(" ","")}get contentDiv(){return this.editorDiv}getPDFRect(){const t=xe._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,e,s){let a=null;if(t instanceof S_){const{data:{defaultAppearanceData:{fontSize:l,fontColor:h},rect:d,rotation:f,id:m,popupRef:y,richText:b,contentsObj:v,creationDate:w,modificationDate:A},textContent:x,textPosition:S,parent:{page:{pageNumber:T}}}=t;if(!x||x.length===0)return null;a=t={annotationType:At.FREETEXT,color:Array.from(h),fontSize:l,value:x.join(`
`),position:S,pageIndex:T-1,rect:d.slice(0),rotation:f,annotationElementId:m,id:m,deleted:!1,popupRef:y,comment:v?.str||null,richText:b,creationDate:w,modificationDate:A}}const o=await super.deserialize(t,e,s);return o.#n=t.fontSize,o.color=nt.makeHexColor(...t.color),o.#t=xe.#h(t.value),o._initialData=a,t.comment&&o.setCommentData(t),o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=ct._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),s=Object.assign(super.serialize(t),{color:e,fontSize:this.#n,value:this.#d()});return this.addComment(s),t?(s.isCopy=!0,s):this.annotationElementId&&!this.#f(s)?null:(s.id=this.annotationElementId,s)}#f(t){const{value:e,fontSize:s,color:a,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==s||t.color.some((l,h)=>l!==a[h])||t.pageIndex!==o}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(!e)return null;const{style:s}=e;s.fontSize=`calc(${this.#n}px * var(--total-scale-factor))`,s.color=this.color,e.replaceChildren();for(const a of this.#t.split(`
`)){const o=document.createElement("div");o.append(a?document.createTextNode(a):document.createElement("br")),e.append(o)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#t}}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class st{static PRECISION=1e-4;toSVGPath(){Kt("Abstract method `toSVGPath` must be implemented.")}get box(){Kt("Abstract getter `box` must be implemented.")}serialize(t,e){Kt("Abstract method `serialize` must be implemented.")}static _rescale(t,e,s,a,o,l){l||=new Float32Array(t.length);for(let h=0,d=t.length;h<d;h+=2)l[h]=e+t[h]*a,l[h+1]=s+t[h+1]*o;return l}static _rescaleAndSwap(t,e,s,a,o,l){l||=new Float32Array(t.length);for(let h=0,d=t.length;h<d;h+=2)l[h]=e+t[h+1]*a,l[h+1]=s+t[h]*o;return l}static _translate(t,e,s,a){a||=new Float32Array(t.length);for(let o=0,l=t.length;o<l;o+=2)a[o]=e+t[o],a[o+1]=s+t[o+1];return a}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,s,a,o){switch(o){case 90:return[1-e/s,t/a];case 180:return[1-t/s,1-e/a];case 270:return[e/s,1-t/a];default:return[t/s,e/a]}}static _normalizePagePoint(t,e,s){switch(s){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,s,a,o,l){return[(t+5*s)/6,(e+5*a)/6,(5*s+o)/6,(5*a+l)/6,(s+o)/2,(a+l)/2]}}class xi{#t;#e=[];#s;#n;#r=[];#a=new Float32Array(18);#i;#o;#c;#l;#d;#h;#f=[];static#g=8;static#m=2;static#u=xi.#g+xi.#m;constructor({x:t,y:e},s,a,o,l,h=0){this.#t=s,this.#h=o*a,this.#n=l,this.#a.set([NaN,NaN,NaN,NaN,t,e],6),this.#s=h,this.#l=xi.#g*a,this.#c=xi.#u*a,this.#d=a,this.#f.push(t,e)}isEmpty(){return isNaN(this.#a[8])}#p(){const t=this.#a.subarray(4,6),e=this.#a.subarray(16,18),[s,a,o,l]=this.#t;return[(this.#i+(t[0]-e[0])/2-s)/o,(this.#o+(t[1]-e[1])/2-a)/l,(this.#i+(e[0]-t[0])/2-s)/o,(this.#o+(e[1]-t[1])/2-a)/l]}add({x:t,y:e}){this.#i=t,this.#o=e;const[s,a,o,l]=this.#t;let[h,d,f,m]=this.#a.subarray(8,12);const y=t-f,b=e-m,v=Math.hypot(y,b);if(v<this.#c)return!1;const w=v-this.#l,A=w/v,x=A*y,S=A*b;let T=h,C=d;h=f,d=m,f+=x,m+=S,this.#f?.push(t,e);const N=-S/w,D=x/w,L=N*this.#h,k=D*this.#h;return this.#a.set(this.#a.subarray(2,8),0),this.#a.set([f+L,m+k],4),this.#a.set(this.#a.subarray(14,18),12),this.#a.set([f-L,m-k],16),isNaN(this.#a[6])?(this.#r.length===0&&(this.#a.set([h+L,d+k],2),this.#r.push(NaN,NaN,NaN,NaN,(h+L-s)/o,(d+k-a)/l),this.#a.set([h-L,d-k],14),this.#e.push(NaN,NaN,NaN,NaN,(h-L-s)/o,(d-k-a)/l)),this.#a.set([T,C,h,d,f,m],6),!this.isEmpty()):(this.#a.set([T,C,h,d,f,m],6),Math.abs(Math.atan2(C-d,T-h)-Math.atan2(S,x))<Math.PI/2?([h,d,f,m]=this.#a.subarray(2,6),this.#r.push(NaN,NaN,NaN,NaN,((h+f)/2-s)/o,((d+m)/2-a)/l),[h,d,T,C]=this.#a.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((T+h)/2-s)/o,((C+d)/2-a)/l),!0):([T,C,h,d,f,m]=this.#a.subarray(0,6),this.#r.push(((T+5*h)/6-s)/o,((C+5*d)/6-a)/l,((5*h+f)/6-s)/o,((5*d+m)/6-a)/l,((h+f)/2-s)/o,((d+m)/2-a)/l),[f,m,h,d,T,C]=this.#a.subarray(12,18),this.#e.push(((T+5*h)/6-s)/o,((C+5*d)/6-a)/l,((5*h+f)/6-s)/o,((5*d+m)/6-a)/l,((h+f)/2-s)/o,((d+m)/2-a)/l),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#r,e=this.#e;if(isNaN(this.#a[6])&&!this.isEmpty())return this.#y();const s=[];s.push(`M${t[4]} ${t[5]}`);for(let a=6;a<t.length;a+=6)isNaN(t[a])?s.push(`L${t[a+4]} ${t[a+5]}`):s.push(`C${t[a]} ${t[a+1]} ${t[a+2]} ${t[a+3]} ${t[a+4]} ${t[a+5]}`);this.#b(s);for(let a=e.length-6;a>=6;a-=6)isNaN(e[a])?s.push(`L${e[a+4]} ${e[a+5]}`):s.push(`C${e[a]} ${e[a+1]} ${e[a+2]} ${e[a+3]} ${e[a+4]} ${e[a+5]}`);return this.#v(s),s.join(" ")}#y(){const[t,e,s,a]=this.#t,[o,l,h,d]=this.#p();return`M${(this.#a[2]-t)/s} ${(this.#a[3]-e)/a} L${(this.#a[4]-t)/s} ${(this.#a[5]-e)/a} L${o} ${l} L${h} ${d} L${(this.#a[16]-t)/s} ${(this.#a[17]-e)/a} L${(this.#a[14]-t)/s} ${(this.#a[15]-e)/a} Z`}#v(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#b(t){const[e,s,a,o]=this.#t,l=this.#a.subarray(4,6),h=this.#a.subarray(16,18),[d,f,m,y]=this.#p();t.push(`L${(l[0]-e)/a} ${(l[1]-s)/o} L${d} ${f} L${m} ${y} L${(h[0]-e)/a} ${(h[1]-s)/o}`)}newFreeDrawOutline(t,e,s,a,o,l){return new C_(t,e,s,a,o,l)}getOutlines(){const t=this.#r,e=this.#e,s=this.#a,[a,o,l,h]=this.#t,d=new Float32Array((this.#f?.length??0)+2);for(let y=0,b=d.length-2;y<b;y+=2)d[y]=(this.#f[y]-a)/l,d[y+1]=(this.#f[y+1]-o)/h;if(d[d.length-2]=(this.#i-a)/l,d[d.length-1]=(this.#o-o)/h,isNaN(s[6])&&!this.isEmpty())return this.#x(d);const f=new Float32Array(this.#r.length+24+this.#e.length);let m=t.length;for(let y=0;y<m;y+=2){if(isNaN(t[y])){f[y]=f[y+1]=NaN;continue}f[y]=t[y],f[y+1]=t[y+1]}m=this.#A(f,m);for(let y=e.length-6;y>=6;y-=6)for(let b=0;b<6;b+=2){if(isNaN(e[y+b])){f[m]=f[m+1]=NaN,m+=2;continue}f[m]=e[y+b],f[m+1]=e[y+b+1],m+=2}return this.#S(f,m),this.newFreeDrawOutline(f,d,this.#t,this.#d,this.#s,this.#n)}#x(t){const e=this.#a,[s,a,o,l]=this.#t,[h,d,f,m]=this.#p(),y=new Float32Array(36);return y.set([NaN,NaN,NaN,NaN,(e[2]-s)/o,(e[3]-a)/l,NaN,NaN,NaN,NaN,(e[4]-s)/o,(e[5]-a)/l,NaN,NaN,NaN,NaN,h,d,NaN,NaN,NaN,NaN,f,m,NaN,NaN,NaN,NaN,(e[16]-s)/o,(e[17]-a)/l,NaN,NaN,NaN,NaN,(e[14]-s)/o,(e[15]-a)/l],0),this.newFreeDrawOutline(y,t,this.#t,this.#d,this.#s,this.#n)}#S(t,e){const s=this.#e;return t.set([NaN,NaN,NaN,NaN,s[4],s[5]],e),e+=6}#A(t,e){const s=this.#a.subarray(4,6),a=this.#a.subarray(16,18),[o,l,h,d]=this.#t,[f,m,y,b]=this.#p();return t.set([NaN,NaN,NaN,NaN,(s[0]-o)/h,(s[1]-l)/d,NaN,NaN,NaN,NaN,f,m,NaN,NaN,NaN,NaN,y,b,NaN,NaN,NaN,NaN,(a[0]-o)/h,(a[1]-l)/d],e),e+=24}}class C_ extends st{#t;#e=new Float32Array(4);#s;#n;#r;#a;#i;constructor(t,e,s,a,o,l){super(),this.#i=t,this.#r=e,this.#t=s,this.#a=a,this.#s=o,this.#n=l,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#o(l);const[h,d,f,m]=this.#e;for(let y=0,b=t.length;y<b;y+=2)t[y]=(t[y]-h)/f,t[y+1]=(t[y+1]-d)/m;for(let y=0,b=e.length;y<b;y+=2)e[y]=(e[y]-h)/f,e[y+1]=(e[y+1]-d)/m}toSVGPath(){const t=[`M${this.#i[4]} ${this.#i[5]}`];for(let e=6,s=this.#i.length;e<s;e+=6){if(isNaN(this.#i[e])){t.push(`L${this.#i[e+4]} ${this.#i[e+5]}`);continue}t.push(`C${this.#i[e]} ${this.#i[e+1]} ${this.#i[e+2]} ${this.#i[e+3]} ${this.#i[e+4]} ${this.#i[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,s,a],o){const l=s-t,h=a-e;let d,f;switch(o){case 0:d=st._rescale(this.#i,t,a,l,-h),f=st._rescale(this.#r,t,a,l,-h);break;case 90:d=st._rescaleAndSwap(this.#i,t,e,l,h),f=st._rescaleAndSwap(this.#r,t,e,l,h);break;case 180:d=st._rescale(this.#i,s,e,-l,h),f=st._rescale(this.#r,s,e,-l,h);break;case 270:d=st._rescaleAndSwap(this.#i,s,a,-l,-h),f=st._rescaleAndSwap(this.#r,s,a,-l,-h);break}return{outline:Array.from(d),points:[Array.from(f)]}}#o(t){const e=this.#i;let s=e[4],a=e[5];const o=[s,a,s,a];let l=s,h=a,d=s,f=a;const m=t?Math.max:Math.min,y=new Float32Array(4);for(let v=6,w=e.length;v<w;v+=6){const A=e[v+4],x=e[v+5];isNaN(e[v])?(nt.pointBoundingBox(A,x,o),h>x?(l=A,h=x):h===x&&(l=m(l,A)),f<x?(d=A,f=x):f===x&&(d=m(d,A))):(y[0]=y[1]=1/0,y[2]=y[3]=-1/0,nt.bezierBoundingBox(s,a,...e.slice(v,v+6),y),nt.rectBoundingBox(y[0],y[1],y[2],y[3],o),h>y[1]?(l=y[0],h=y[1]):h===y[1]&&(l=m(l,y[0])),f<y[3]?(d=y[2],f=y[3]):f===y[3]&&(d=m(d,y[2]))),s=A,a=x}const b=this.#e;b[0]=o[0]-this.#s,b[1]=o[1]-this.#s,b[2]=o[2]-o[0]+2*this.#s,b[3]=o[3]-o[1]+2*this.#s,this.firstPoint=[l,h],this.lastPoint=[d,f]}get box(){return this.#e}newOutliner(t,e,s,a,o,l=0){return new xi(t,e,s,a,o,l)}getNewOutline(t,e){const[s,a,o,l]=this.#e,[h,d,f,m]=this.#t,y=o*f,b=l*m,v=s*f+h,w=a*m+d,A=this.newOutliner({x:this.#r[0]*y+v,y:this.#r[1]*b+w},this.#t,this.#a,t,this.#n,e??this.#s);for(let x=2;x<this.#r.length;x+=2)A.add({x:this.#r[x]*y+v,y:this.#r[x+1]*b+w});return A.getOutlines()}}class lf{#t;#e;#s;#n=[];#r=[];constructor(t,e=0,s=0,a=!0){const o=[1/0,1/0,-1/0,-1/0],l=10**-4;for(const{x:A,y:x,width:S,height:T}of t){const C=Math.floor((A-e)/l)*l,N=Math.ceil((A+S+e)/l)*l,D=Math.floor((x-e)/l)*l,L=Math.ceil((x+T+e)/l)*l,k=[C,D,L,!0],V=[N,D,L,!1];this.#n.push(k,V),nt.rectBoundingBox(C,D,N,L,o)}const h=o[2]-o[0]+2*s,d=o[3]-o[1]+2*s,f=o[0]-s,m=o[1]-s;let y=a?-1/0:1/0,b=1/0;const v=this.#n.at(a?-1:-2),w=[v[0],v[2]];for(const A of this.#n){const[x,S,T,C]=A;!C&&a?S<b?(b=S,y=x):S===b&&(y=Math.max(y,x)):C&&!a&&(S<b?(b=S,y=x):S===b&&(y=Math.min(y,x))),A[0]=(x-f)/h,A[1]=(S-m)/d,A[2]=(T-m)/d}this.#t=new Float32Array([f,m,h,d]),this.#e=[y,b],this.#s=w}getOutlines(){this.#n.sort((e,s)=>e[0]-s[0]||e[1]-s[1]||e[2]-s[2]);const t=[];for(const e of this.#n)e[3]?(t.push(...this.#l(e)),this.#o(e)):(this.#c(e),t.push(...this.#l(e)));return this.#a(t)}#a(t){const e=[],s=new Set;for(const l of t){const[h,d,f]=l;e.push([h,d,l],[h,f,l])}e.sort((l,h)=>l[1]-h[1]||l[0]-h[0]);for(let l=0,h=e.length;l<h;l+=2){const d=e[l][2],f=e[l+1][2];d.push(f),f.push(d),s.add(d),s.add(f)}const a=[];let o;for(;s.size>0;){const l=s.values().next().value;let[h,d,f,m,y]=l;s.delete(l);let b=h,v=d;for(o=[h,f],a.push(o);;){let w;if(s.has(m))w=m;else if(s.has(y))w=y;else break;s.delete(w),[h,d,f,m,y]=w,b!==h&&(o.push(b,v,h,v===d?d:f),b=h),v=v===d?f:d}o.push(b,v)}return new Jx(a,this.#t,this.#e,this.#s)}#i(t){const e=this.#r;let s=0,a=e.length-1;for(;s<=a;){const o=s+a>>1,l=e[o][0];if(l===t)return o;l<t?s=o+1:a=o-1}return a+1}#o([,t,e]){const s=this.#i(t);this.#r.splice(s,0,[t,e])}#c([,t,e]){const s=this.#i(t);for(let a=s;a<this.#r.length;a++){const[o,l]=this.#r[a];if(o!==t)break;if(o===t&&l===e){this.#r.splice(a,1);return}}for(let a=s-1;a>=0;a--){const[o,l]=this.#r[a];if(o!==t)break;if(o===t&&l===e){this.#r.splice(a,1);return}}}#l(t){const[e,s,a]=t,o=[[e,s,a]],l=this.#i(a);for(let h=0;h<l;h++){const[d,f]=this.#r[h];for(let m=0,y=o.length;m<y;m++){const[,b,v]=o[m];if(!(f<=b||v<=d)){if(b>=d){if(v>f)o[m][1]=f;else{if(y===1)return[];o.splice(m,1),m--,y--}continue}o[m][2]=d,v>f&&o.push([e,f,v])}}}return o}}class Jx extends st{#t;#e;constructor(t,e,s,a){super(),this.#e=t,this.#t=e,this.firstPoint=s,this.lastPoint=a}toSVGPath(){const t=[];for(const e of this.#e){let[s,a]=e;t.push(`M${s} ${a}`);for(let o=2;o<e.length;o+=2){const l=e[o],h=e[o+1];l===s?(t.push(`V${h}`),a=h):h===a&&(t.push(`H${l}`),s=l)}t.push("Z")}return t.join(" ")}serialize([t,e,s,a],o){const l=[],h=s-t,d=a-e;for(const f of this.#e){const m=new Array(f.length);for(let y=0;y<f.length;y+=2)m[y]=t+f[y]*h,m[y+1]=a-f[y+1]*d;l.push(m)}return l}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class cf extends xi{newFreeDrawOutline(t,e,s,a,o,l){return new tT(t,e,s,a,o,l)}}class tT extends C_{newOutliner(t,e,s,a,o,l=0){return new cf(t,e,s,a,o,l)}}class ce extends ct{#t=null;#e=0;#s;#n=null;#r=null;#a=null;#i=null;#o=0;#c=null;#l=null;#d=null;#h=!1;#f=null;#g=null;#m=null;#u="";#p;#y="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=At.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=ce.prototype;return _t(this,"_keyboardManager",new bo([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||ce._defaultColor,this.#p=t.thickness||ce._defaultThickness,this.opacity=t.opacity||ce._defaultOpacity,this.#s=t.boxes||null,this.#y=t.methodOfCreation||"",this.#u=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#h=!0,this.#b(t),this.#_()):this.#s&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#i=t.focusNode,this.#o=t.focusOffset,this.#v(),this.#_(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#h?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#p,methodOfCreation:this.#y}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#v(){const t=new lf(this.#s,.001);this.#l=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;const e=new lf(this.#s,.0025,.001,this._uiManager.direction==="ltr");this.#a=e.getOutlines();const{firstPoint:s}=this.#l;this.#f=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height];const{lastPoint:a}=this.#a;this.#g=[(a[0]-this.x)/this.width,(a[1]-this.y)/this.height]}#b({highlightOutlines:t,highlightId:e,clipPathId:s}){this.#l=t;const a=1.5;if(this.#a=t.getNewOutline(this.#p/2+a,.0025),e>=0)this.#d=e,this.#n=s,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#m=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#a.box,path:{d:this.#a.toSVGPath()}},!0);else if(this.parent){const y=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#d,{bbox:ce.#E(this.#l.box,(y-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#m,{bbox:ce.#E(this.#a.box,y),path:{d:this.#a.toSVGPath()}})}const[o,l,h,d]=t.box;switch(this.rotation){case 0:this.x=o,this.y=l,this.width=h,this.height=d;break;case 90:{const[y,b]=this.parentDimensions;this.x=l,this.y=1-o,this.width=h*b/y,this.height=d*y/b;break}case 180:this.x=1-o,this.y=1-l,this.width=h,this.height=d;break;case 270:{const[y,b]=this.parentDimensions;this.x=1-l,this.y=o,this.width=h*b/y,this.height=d*y/b;break}}const{firstPoint:f}=t;this.#f=[(f[0]-o)/h,(f[1]-l)/d];const{lastPoint:m}=this.#a;this.#g=[(m[0]-o)/h,(m[1]-l)/d]}static initialize(t,e){ct.initialize(t,e),ce._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case kt.HIGHLIGHT_COLOR:ce._defaultColor=e;break;case kt.HIGHLIGHT_THICKNESS:ce._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#g}get commentButtonPosition(){return this.#f}updateParams(t,e){switch(t){case kt.HIGHLIGHT_COLOR:this.#x(e);break;case kt.HIGHLIGHT_THICKNESS:this.#S(e);break}}static get defaultPropertiesToUpdate(){return[[kt.HIGHLIGHT_COLOR,ce._defaultColor],[kt.HIGHLIGHT_THICKNESS,ce._defaultThickness]]}get propertiesToUpdate(){return[[kt.HIGHLIGHT_COLOR,this.color||ce._defaultColor],[kt.HIGHLIGHT_THICKNESS,this.#p||ce._defaultThickness],[kt.HIGHLIGHT_FREE,this.#h]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#d,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#r?.updateColor(this.color),super.onUpdatedColor()}#x(t){const e=(o,l)=>{this.color=o,this.opacity=l,this.onUpdatedColor()},s=this.color,a=this.opacity;this.addCommands({cmd:e.bind(this,t,ce._defaultOpacity),undo:e.bind(this,s,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:kt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#S(t){const e=this.#p,s=a=>{this.#p=a,this.#A(a)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:kt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#r=new On({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#M())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#M())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#C(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#_(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#C():t&&(this.#_(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#A(t){this.#h&&(this.#b({highlightOutlines:this.#l.getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims())}#C(){this.#d===null||!this.parent||(this.parent.drawLayer.remove(this.#d),this.#d=null,this.parent.drawLayer.remove(this.#m),this.#m=null)}#_(t=this.parent){this.#d===null&&({id:this.#d,clipPathId:this.#n}=t.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#h},path:{d:this.#l.toSVGPath()}},!1,!0),this.#m=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#h},bbox:this.#a.box,path:{d:this.#a.toSVGPath()}},this.#h),this.#c&&(this.#c.style.clipPath=this.#n))}static#E([t,e,s,a],o){switch(o){case 90:return[1-e-a,t,a,s];case 180:return[1-t-s,1-e-a,s,a];case 270:return[e,1-t-s,a,s]}return[t,e,s,a]}rotate(t){const{drawLayer:e}=this.parent;let s;this.#h?(t=(t-this.rotation+360)%360,s=ce.#E(this.#l.box,t)):s=ce.#E([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#d,{bbox:s,root:{"data-main-rotation":t}}),e.updateProperties(this.#m,{bbox:ce.#E(this.#a.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#u&&(t.setAttribute("aria-label",this.#u),t.setAttribute("role","mark")),this.#h?t.classList.add("free"):this.div.addEventListener("keydown",this.#D.bind(this),{signal:this._uiManager._signal});const e=this.#c=document.createElement("div");return t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#n,this.setDims(),n_(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{hovered:!1}})}#D(t){ce._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#R(!0);break;case 1:case 3:this.#R(!1);break}}#R(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#i,this.#o)}select(){super.select(),this.#m&&this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#m&&(this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{selected:!1}}),this.#h||this.#R(!1))}get _mustFixPosition(){return!this.#h}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#d,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#m,{rootClass:{hidden:!t}}))}#M(){return this.#h?this.rotation:0}#P(){if(this.#h)return null;const[t,e]=this.pageDimensions,[s,a]=this.pageTranslation,o=this.#s,l=new Float32Array(o.length*8);let h=0;for(const{x:d,y:f,width:m,height:y}of o){const b=d*t+s,v=(1-f)*e+a;l[h]=l[h+4]=b,l[h+1]=l[h+3]=v,l[h+2]=l[h+6]=b+m*t,l[h+5]=l[h+7]=v-y*e,h+=8}return l}#N(t){return this.#l.serialize(t,this.#M())}static startHighlighting(t,e,{target:s,x:a,y:o}){const{x:l,y:h,width:d,height:f}=s.getBoundingClientRect(),m=new AbortController,y=t.combinedSignal(m),b=v=>{m.abort(),this.#F(t,v)};window.addEventListener("blur",b,{signal:y}),window.addEventListener("pointerup",b,{signal:y}),window.addEventListener("pointerdown",ae,{capture:!0,passive:!1,signal:y}),window.addEventListener("contextmenu",Ln,{signal:y}),s.addEventListener("pointermove",this.#k.bind(this,t),{signal:y}),this._freeHighlight=new cf({x:a,y:o},[l,h,d,f],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#k(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#F(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,s){let a=null;if(t instanceof x_){const{data:{quadPoints:w,rect:A,rotation:x,id:S,color:T,opacity:C,popupRef:N,richText:D,contentsObj:L,creationDate:k,modificationDate:V},parent:{page:{pageNumber:K}}}=t;a=t={annotationType:At.HIGHLIGHT,color:Array.from(T),opacity:C,quadPoints:w,boxes:null,pageIndex:K-1,rect:A.slice(0),rotation:x,annotationElementId:S,id:S,deleted:!1,popupRef:N,richText:D,comment:L?.str||null,creationDate:k,modificationDate:V}}else if(t instanceof Gf){const{data:{inkLists:w,rect:A,rotation:x,id:S,color:T,borderStyle:{rawWidth:C},popupRef:N,richText:D,contentsObj:L,creationDate:k,modificationDate:V},parent:{page:{pageNumber:K}}}=t;a=t={annotationType:At.HIGHLIGHT,color:Array.from(T),thickness:C,inkLists:w,boxes:null,pageIndex:K-1,rect:A.slice(0),rotation:x,annotationElementId:S,id:S,deleted:!1,popupRef:N,richText:D,comment:L?.str||null,creationDate:k,modificationDate:V}}const{color:o,quadPoints:l,inkLists:h,opacity:d}=t,f=await super.deserialize(t,e,s);f.color=nt.makeHexColor(...o),f.opacity=d||1,h&&(f.#p=t.thickness),f._initialData=a,t.comment&&f.setCommentData(t);const[m,y]=f.pageDimensions,[b,v]=f.pageTranslation;if(l){const w=f.#s=[];for(let A=0;A<l.length;A+=8)w.push({x:(l[A]-b)/m,y:1-(l[A+1]-v)/y,width:(l[A+2]-l[A])/m,height:(l[A+1]-l[A+5])/y});f.#v(),f.#_(),f.rotate(f.rotation)}else if(h){f.#h=!0;const w=h[0],A={x:w[0]-b,y:y-(w[1]-v)},x=new cf(A,[0,0,m,y],1,f.#p/2,!0,.001);for(let C=0,N=w.length;C<N;C+=2)A.x=w[C]-b,A.y=y-(w[C+1]-v),x.add(A);const{id:S,clipPathId:T}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:f.color,"fill-opacity":f._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:x.toSVGPath()}},!0,!0);f.#b({highlightOutlines:x.getOutlines(),highlightId:S,clipPathId:T}),f.#_(),f.rotate(f.parentRotation)}return f}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=ct._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),s=super.serialize(t);return Object.assign(s,{color:e,opacity:this.opacity,thickness:this.#p,quadPoints:this.#P(),outlines:this.#N(s.rect)}),this.addComment(s),this.annotationElementId&&!this.#B(s)?null:(s.id=this.annotationElementId,s)}#B(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((s,a)=>s!==e[a])}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class R_{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,s]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,s)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){Kt("Not implemented")}}class Ut extends ct{#t=null;#e;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#s=null;static#n=null;static#r=null;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(this.#a(t),this.#c())}#a({drawOutlines:t,drawId:e,drawingOptions:s}){this.#t=t,this._drawingOptions||=s,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#i(t,this.parent),this.#h(t.box)}#i(t,e){const{id:s}=e.drawLayer.draw(Ut._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s}static _mergeSVGProperties(t,e){const s=new Set(Object.keys(t));for(const[a,o]of Object.entries(e))s.has(a)?Object.assign(t[a],o):t[a]=o;return t}static getDefaultDrawingOptions(t){Kt("Not implemented")}static get typesMap(){Kt("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,e),this._currentParent&&(Ut.#s.updateProperty(s,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[s,a]of this.typesMap)t.push([s,e[a]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[s,a]of this.constructor.typesMap)t.push([s,e[a]]);return t}_updateProperty(t,e,s){const a=this._drawingOptions,o=a[e],l=h=>{a.updateProperty(e,h);const d=this.#t.updateProperty(e,h);d&&this.#h(d),this.parent?.drawLayer.updateProperties(this._drawId,a.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:l.bind(this,s),undo:l.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,Ut._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#d()),{bbox:this.#f()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,Ut._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#d()),{bbox:this.#f()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#f()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,Ut._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#d(),this.parentDimensions),{bbox:this.#f()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#o(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#c(),this.#h(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#o()):t&&(this._uiManager.addShouldRescale(this),this.#c(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#o(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#c(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#i(this.#t,t)}}#l([t,e,s,a]){const{parentDimensions:[o,l],rotation:h}=this;switch(h){case 90:return[e,1-t,s*(l/o),a*(o/l)];case 180:return[1-t,1-e,s,a];case 270:return[1-e,t,s*(l/o),a*(o/l)];default:return[t,e,s,a]}}#d(){const{x:t,y:e,width:s,height:a,parentDimensions:[o,l],rotation:h}=this;switch(h){case 90:return[1-e,t,s*(o/l),a*(l/o)];case 180:return[1-t,1-e,s,a];case 270:return[e,1-t,s*(o/l),a*(l/o)];default:return[t,e,s,a]}}#h(t){[this.x,this.y,this.width,this.height]=this.#l(t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#f(){const{x:t,y:e,width:s,height:a,rotation:o,parentRotation:l,parentDimensions:[h,d]}=this;switch((o*4+l)/90){case 1:return[1-e-a,t,a,s];case 2:return[1-t-s,1-e-a,s,a];case 3:return[e,1-t-s,a,s];case 4:return[t,e-s*(h/d),a*(d/h),s*(h/d)];case 5:return[1-e,t,s*(h/d),a*(d/h)];case 6:return[1-t-a*(d/h),1-e,a*(d/h),s*(h/d)];case 7:return[e-s*(h/d),1-t-a*(d/h),s*(h/d),a*(d/h)];case 8:return[t-s,e-a,s,a];case 9:return[1-e,t-s,a,s];case 10:return[1-t,1-e,s,a];case 11:return[e-a,1-t,a,s];case 12:return[t-a*(d/h),e,a*(d/h),s*(h/d)];case 13:return[1-e-s*(h/d),t-a*(d/h),s*(h/d),a*(d/h)];case 14:return[1-t,1-e-s*(h/d),a*(d/h),s*(h/d)];case 15:return[e,1-t,s*(h/d),a*(d/h)];default:return[t,e,s,a]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Ut._mergeSVGProperties({bbox:this.#f()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#h(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const s=super.render();s.classList.add("draw");const a=document.createElement("div");return s.append(a),a.setAttribute("aria-hidden","true"),a.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),s}static createDrawerInstance(t,e,s,a,o){Kt("Not implemented")}static startDrawing(t,e,s,a){const{target:o,offsetX:l,offsetY:h,pointerId:d,pointerType:f}=a;if(zt.isInitializedAndDifferentPointerType(f))return;const{viewport:{rotation:m}}=t,{width:y,height:b}=o.getBoundingClientRect(),v=Ut.#n=new AbortController,w=t.combinedSignal(v);if(zt.setPointer(f,d),window.addEventListener("pointerup",A=>{zt.isSamePointerIdOrRemove(A.pointerId)&&this._endDraw(A)},{signal:w}),window.addEventListener("pointercancel",A=>{zt.isSamePointerIdOrRemove(A.pointerId)&&this._currentParent.endDrawingSession()},{signal:w}),window.addEventListener("pointerdown",A=>{zt.isSamePointerType(A.pointerType)&&(zt.initializeAndAddPointerId(A.pointerId),Ut.#s.isCancellable()&&(Ut.#s.removeLastElement(),Ut.#s.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:w}),window.addEventListener("contextmenu",Ln,{signal:w}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:w}),o.addEventListener("touchmove",A=>{zt.isSameTimeStamp(A.timeStamp)&&ae(A)},{signal:w}),t.toggleDrawing(),e._editorUndoBar?.hide(),Ut.#s){t.drawLayer.updateProperties(this._currentDrawId,Ut.#s.startNew(l,h,y,b,m));return}e.updateUIForDefaultProperties(this),Ut.#s=this.createDrawerInstance(l,h,y,b,m),Ut.#r=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(Ut.#r.toSVGProperties(),Ut.#s.defaultSVGProperties),!0,!1)}static _drawMove(t){if(zt.isSameTimeStamp(t.timeStamp),!Ut.#s)return;const{offsetX:e,offsetY:s,pointerId:a}=t;if(zt.isSamePointerId(a)){if(zt.isUsingMultiplePointers()){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,Ut.#s.add(e,s)),zt.setTimeStamp(t.timeStamp),ae(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,Ut.#s=null,Ut.#r=null,zt.clearTimeStamp()),Ut.#n&&(Ut.#n.abort(),Ut.#n=null,zt.clearPointerIds())}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,Ut.#s.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const s=Ut.#s,a=this._currentDrawId,o=s.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(a,s.setLastElement(o))},undo:()=>{e.drawLayer.updateProperties(a,s.removeLastElement())},mustExec:!1,type:kt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(kt.DRAW_STEP),!Ut.#s.isEmpty()){const{pageDimensions:[s,a],scale:o}=e,l=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:Ut.#s.getOutlines(s*o,a*o,o,this._INNER_MARGIN),drawingOptions:Ut.#r,mustBeCommitted:!t});return this._cleanup(!0),l}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,s,a,o,l){Kt("Not implemented")}static async deserialize(t,e,s){const{rawDims:{pageWidth:a,pageHeight:o,pageX:l,pageY:h}}=e.viewport,d=this.deserializeDraw(l,h,a,o,this._INNER_MARGIN,t),f=await super.deserialize(t,e,s);return f.createDrawingOptions(t),f.#a({drawOutlines:d}),f.#c(),f.onScaleChanging(),f.rotate(),f}serializeDraw(t){const[e,s]=this.pageTranslation,[a,o]=this.pageDimensions;return this.#t.serialize([e,s,a,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class eT{#t=new Float64Array(6);#e;#s;#n;#r;#a;#i="";#o=0;#c=new _o;#l;#d;constructor(t,e,s,a,o,l){this.#l=s,this.#d=a,this.#n=o,this.#r=l,[t,e]=this.#h(t,e);const h=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#a=[t,e],this.#s=[{line:h,points:this.#a}],this.#t.set(h,0)}updateProperty(t,e){t==="stroke-width"&&(this.#r=e)}#h(t,e){return st._normalizePoint(t,e,this.#l,this.#d,this.#n)}isEmpty(){return!this.#s||this.#s.length===0}isCancellable(){return this.#a.length<=10}add(t,e){[t,e]=this.#h(t,e);const[s,a,o,l]=this.#t.subarray(2,6),h=t-o,d=e-l;return Math.hypot(this.#l*h,this.#d*d)<=2?null:(this.#a.push(t,e),isNaN(s)?(this.#t.set([o,l,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([s,a,o,l,t,e],0),this.#e.push(...st.createBezierPoints(s,a,o,l,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const s=this.add(t,e);return s||(this.#a.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,s,a,o){this.#l=s,this.#d=a,this.#n=o,[t,e]=this.#h(t,e);const l=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#a=[t,e];const h=this.#s.at(-1);return h&&(h.line=new Float32Array(h.line),h.points=new Float32Array(h.points)),this.#s.push({line:l,points:this.#a}),this.#t.set(l,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#s.at(-1)}setLastElement(t){return this.#s?(this.#s.push(t),this.#e=t.line,this.#a=t.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(t)}removeLastElement(){if(!this.#s)return this.#c.removeLastElement();this.#s.pop(),this.#i="";for(let t=0,e=this.#s.length;t<e;t++){const{line:s,points:a}=this.#s[t];this.#e=s,this.#a=a,this.#o=0,this.toSVGPath()}return{path:{d:this.#i}}}toSVGPath(){const t=st.svgRound(this.#e[4]),e=st.svgRound(this.#e[5]);if(this.#a.length===2)return this.#i=`${this.#i} M ${t} ${e} Z`,this.#i;if(this.#a.length<=6){const a=this.#i.lastIndexOf("M");this.#i=`${this.#i.slice(0,a)} M ${t} ${e}`,this.#o=6}if(this.#a.length===4){const a=st.svgRound(this.#e[10]),o=st.svgRound(this.#e[11]);return this.#i=`${this.#i} L ${a} ${o}`,this.#o=12,this.#i}const s=[];this.#o===0&&(s.push(`M ${t} ${e}`),this.#o=6);for(let a=this.#o,o=this.#e.length;a<o;a+=6){const[l,h,d,f,m,y]=this.#e.slice(a,a+6).map(st.svgRound);s.push(`C${l} ${h} ${d} ${f} ${m} ${y}`)}return this.#i+=s.join(" "),this.#o=this.#e.length,this.#i}getOutlines(t,e,s,a){const o=this.#s.at(-1);return o.line=new Float32Array(o.line),o.points=new Float32Array(o.points),this.#c.build(this.#s,t,e,s,this.#n,this.#r,a),this.#t=null,this.#e=null,this.#s=null,this.#i=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class _o extends st{#t;#e=0;#s;#n;#r;#a;#i;#o;#c;build(t,e,s,a,o,l,h){this.#r=e,this.#a=s,this.#i=a,this.#o=o,this.#c=l,this.#s=h??0,this.#n=t,this.#h()}get thickness(){return this.#c}setLastElement(t){return this.#n.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#n.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#n){if(t.push(`M${st.svgRound(e[4])} ${st.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${st.svgRound(e[10])} ${st.svgRound(e[11])}`);continue}for(let s=6,a=e.length;s<a;s+=6){const[o,l,h,d,f,m]=e.subarray(s,s+6).map(st.svgRound);t.push(`C${o} ${l} ${h} ${d} ${f} ${m}`)}}return t.join("")}serialize([t,e,s,a],o){const l=[],h=[],[d,f,m,y]=this.#d();let b,v,w,A,x,S,T,C,N;switch(this.#o){case 0:N=st._rescale,b=t,v=e+a,w=s,A=-a,x=t+d*s,S=e+(1-f-y)*a,T=t+(d+m)*s,C=e+(1-f)*a;break;case 90:N=st._rescaleAndSwap,b=t,v=e,w=s,A=a,x=t+f*s,S=e+d*a,T=t+(f+y)*s,C=e+(d+m)*a;break;case 180:N=st._rescale,b=t+s,v=e,w=-s,A=a,x=t+(1-d-m)*s,S=e+f*a,T=t+(1-d)*s,C=e+(f+y)*a;break;case 270:N=st._rescaleAndSwap,b=t+s,v=e+a,w=-s,A=-a,x=t+(1-f-y)*s,S=e+(1-d-m)*a,T=t+(1-f)*s,C=e+(1-d)*a;break}for(const{line:D,points:L}of this.#n)l.push(N(D,b,v,w,A,o?new Array(D.length):null)),h.push(N(L,b,v,w,A,o?new Array(L.length):null));return{lines:l,points:h,rect:[x,S,T,C]}}static deserialize(t,e,s,a,o,{paths:{lines:l,points:h},rotation:d,thickness:f}){const m=[];let y,b,v,w,A;switch(d){case 0:A=st._rescale,y=-t/s,b=e/a+1,v=1/s,w=-1/a;break;case 90:A=st._rescaleAndSwap,y=-e/a,b=-t/s,v=1/a,w=1/s;break;case 180:A=st._rescale,y=t/s+1,b=-e/a,v=-1/s,w=1/a;break;case 270:A=st._rescaleAndSwap,y=e/a+1,b=t/s+1,v=-1/a,w=-1/s;break}if(!l){l=[];for(const S of h){const T=S.length;if(T===2){l.push(new Float32Array([NaN,NaN,NaN,NaN,S[0],S[1]]));continue}if(T===4){l.push(new Float32Array([NaN,NaN,NaN,NaN,S[0],S[1],NaN,NaN,NaN,NaN,S[2],S[3]]));continue}const C=new Float32Array(3*(T-2));l.push(C);let[N,D,L,k]=S.subarray(0,4);C.set([NaN,NaN,NaN,NaN,N,D],0);for(let V=4;V<T;V+=2){const K=S[V],J=S[V+1];C.set(st.createBezierPoints(N,D,L,k,K,J),(V-2)*3),[N,D,L,k]=[L,k,K,J]}}}for(let S=0,T=l.length;S<T;S++)m.push({line:A(l[S].map(C=>C??NaN),y,b,v,w),points:A(h[S].map(C=>C??NaN),y,b,v,w)});const x=new this.prototype.constructor;return x.build(m,s,a,1,d,f,o),x}#l(t=this.#c){const e=this.#s+t/2*this.#i;return this.#o%180===0?[e/this.#r,e/this.#a]:[e/this.#a,e/this.#r]}#d(){const[t,e,s,a]=this.#t,[o,l]=this.#l(0);return[t+o,e+l,s-2*o,a-2*l]}#h(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:a}of this.#n){if(a.length<=12){for(let h=4,d=a.length;h<d;h+=6)nt.pointBoundingBox(a[h],a[h+1],t);continue}let o=a[4],l=a[5];for(let h=6,d=a.length;h<d;h+=6){const[f,m,y,b,v,w]=a.subarray(h,h+6);nt.bezierBoundingBox(o,l,f,m,y,b,v,w,t),o=v,l=w}}const[e,s]=this.#l();t[0]=je(t[0]-e,0,1),t[1]=je(t[1]-s,0,1),t[2]=je(t[2]+e,0,1),t[3]=je(t[3]+s,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#f(e):null}#f(t){const[e,s]=this.#l();this.#c=t;const[a,o]=this.#l(),[l,h]=[a-e,o-s],d=this.#t;return d[0]-=l,d[1]-=h,d[2]+=2*l,d[3]+=2*h,d}updateParentDimensions([t,e],s){const[a,o]=this.#l();this.#r=t,this.#a=e,this.#i=s;const[l,h]=this.#l(),d=l-a,f=h-o,m=this.#t;return m[0]-=d,m[1]-=f,m[2]+=2*d,m[3]+=2*f,m}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(st.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${st.svgRound(t)} ${st.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let s=0,a=0,o=0,l=0,h=0,d=0;switch(this.#e){case 90:a=e/t,o=-t/e,h=t;break;case 180:s=-1,l=-1,h=t,d=e;break;case 270:a=-e/t,o=t/e,d=e;break;default:return""}return`matrix(${s} ${a} ${o} ${l} ${st.svgRound(h)} ${st.svgRound(d)})`}getPathResizingSVGProperties([t,e,s,a]){const[o,l]=this.#l(),[h,d,f,m]=this.#t;if(Math.abs(f-o)<=st.PRECISION||Math.abs(m-l)<=st.PRECISION){const A=t+s/2-(h+f/2),x=e+a/2-(d+m/2);return{path:{"transform-origin":`${st.svgRound(t)} ${st.svgRound(e)}`,transform:`${this.rotationTransform} translate(${A} ${x})`}}}const y=(s-2*o)/(f-2*o),b=(a-2*l)/(m-2*l),v=f/s,w=m/a;return{path:{"transform-origin":`${st.svgRound(h)} ${st.svgRound(d)}`,transform:`${this.rotationTransform} scale(${v} ${w}) translate(${st.svgRound(o)} ${st.svgRound(l)}) scale(${y} ${b}) translate(${st.svgRound(-o)} ${st.svgRound(-l)})`}}}getPathResizedSVGProperties([t,e,s,a]){const[o,l]=this.#l(),h=this.#t,[d,f,m,y]=h;if(h[0]=t,h[1]=e,h[2]=s,h[3]=a,Math.abs(m-o)<=st.PRECISION||Math.abs(y-l)<=st.PRECISION){const x=t+s/2-(d+m/2),S=e+a/2-(f+y/2);for(const{line:T,points:C}of this.#n)st._translate(T,x,S,T),st._translate(C,x,S,C);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${st.svgRound(t)} ${st.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const b=(s-2*o)/(m-2*o),v=(a-2*l)/(y-2*l),w=-b*(d+o)+t+o,A=-v*(f+l)+e+l;if(b!==1||v!==1||w!==0||A!==0)for(const{line:x,points:S}of this.#n)st._rescale(x,w,A,b,v,x),st._rescale(S,w,A,b,v,S);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${st.svgRound(t)} ${st.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],s){const[a,o]=s,l=this.#t,h=t-l[0],d=e-l[1];if(this.#r===a&&this.#a===o)for(const{line:f,points:m}of this.#n)st._translate(f,h,d,f),st._translate(m,h,d,m);else{const f=this.#r/a,m=this.#a/o;this.#r=a,this.#a=o;for(const{line:y,points:b}of this.#n)st._rescale(y,h,d,f,m,y),st._rescale(b,h,d,f,m,b);l[2]*=f,l[3]*=m}return l[0]=t,l[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${st.svgRound(t)} ${st.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${st.svgRound(t[0])} ${st.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class $c extends R_{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:ct._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new $c(this._viewParameters);return t.updateAll(this),t}}class Vf extends Ut{static _type="ink";static _editorType=At.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){ct.initialize(t,e),this._defaultDrawingOptions=new $c(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return _t(this,"typesMap",new Map([[kt.INK_THICKNESS,"stroke-width"],[kt.INK_COLOR,"stroke"],[kt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,s,a,o){return new eT(t,e,s,a,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,s,a,o,l){return _o.deserialize(t,e,s,a,o,l)}static async deserialize(t,e,s){let a=null;if(t instanceof Gf){const{data:{inkLists:l,rect:h,rotation:d,id:f,color:m,opacity:y,borderStyle:{rawWidth:b},popupRef:v,richText:w,contentsObj:A,creationDate:x,modificationDate:S},parent:{page:{pageNumber:T}}}=t;a=t={annotationType:At.INK,color:Array.from(m),thickness:b,opacity:y,paths:{points:l},boxes:null,pageIndex:T-1,rect:h.slice(0),rotation:d,annotationElementId:f,id:f,deleted:!1,popupRef:v,richText:w,comment:A?.str||null,creationDate:x,modificationDate:S}}const o=await super.deserialize(t,e,s);return o._initialData=a,t.comment&&o.setCommentData(t),o}get toolbarButtons(){return this._colorPicker||=new co(this),[["colorPicker",this._colorPicker]]}get colorType(){return kt.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:s}=this;e.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:s}){this._drawingOptions=Vf.getDefaultDrawingOptions({stroke:nt.makeHexColor(...t),"stroke-width":e,"stroke-opacity":s})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:s}=this.serializeDraw(t),{_drawingOptions:{stroke:a,"stroke-opacity":o,"stroke-width":l}}=this,h=Object.assign(super.serialize(t),{color:ct._colorManager.convert(a),opacity:o,thickness:l,paths:{lines:e,points:s}});return this.addComment(h),t?(h.isCopy=!0,h):this.annotationElementId&&!this.#t(h)?null:(h.id=this.annotationElementId,h)}#t(t){const{color:e,thickness:s,opacity:a,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((l,h)=>l!==e[h])||t.thickness!==s||t.opacity!==a||t.pageIndex!==o}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:e,rect:s}=this.serializeDraw(!1);return t.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:e,popup:this.comment}),null}}class uf extends _o{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const Jl=8,Hr=3;class Ra{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(t,e,s,a){return s-=t,a-=e,s===0?a>0?0:4:s===1?a+6:2-a}static#s=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#n(t,e,s,a,o,l,h){const d=this.#e(s,a,o,l);for(let f=0;f<8;f++){const m=(-f+d-h+16)%8,y=this.#s[2*m],b=this.#s[2*m+1];if(t[(s+y)*e+(a+b)]!==0)return m}return-1}static#r(t,e,s,a,o,l,h){const d=this.#e(s,a,o,l);for(let f=0;f<8;f++){const m=(f+d+h+16)%8,y=this.#s[2*m],b=this.#s[2*m+1];if(t[(s+y)*e+(a+b)]!==0)return m}return-1}static#a(t,e,s,a){const o=t.length,l=new Int32Array(o);for(let m=0;m<o;m++)l[m]=t[m]<=a?1:0;for(let m=1;m<s-1;m++)l[m*e]=l[m*e+e-1]=0;for(let m=0;m<e;m++)l[m]=l[e*s-1-m]=0;let h=1,d;const f=[];for(let m=1;m<s-1;m++){d=1;for(let y=1;y<e-1;y++){const b=m*e+y,v=l[b];if(v===0)continue;let w=m,A=y;if(v===1&&l[b-1]===0)h+=1,A-=1;else if(v>=1&&l[b+1]===0)h+=1,A+=1,v>1&&(d=v);else{v!==1&&(d=Math.abs(v));continue}const x=[y,m],S=A===y+1,T={isHole:S,points:x,id:h,parent:0};f.push(T);let C;for(const W of f)if(W.id===d){C=W;break}C?C.isHole?T.parent=S?C.parent:d:T.parent=S?d:C.parent:T.parent=S?d:0;const N=this.#n(l,e,m,y,w,A,0);if(N===-1){l[b]=-h,l[b]!==1&&(d=Math.abs(l[b]));continue}let D=this.#s[2*N],L=this.#s[2*N+1];const k=m+D,V=y+L;w=k,A=V;let K=m,J=y;for(;;){const W=this.#r(l,e,K,J,w,A,1);D=this.#s[2*W],L=this.#s[2*W+1];const pt=K+D,Tt=J+L;x.push(Tt,pt);const gt=K*e+J;if(l[gt+1]===0?l[gt]=-h:l[gt]===1&&(l[gt]=h),pt===m&&Tt===y&&K===k&&J===V){l[b]!==1&&(d=Math.abs(l[b]));break}else w=K,A=J,K=pt,J=Tt}}}return f}static#i(t,e,s,a){if(s-e<=4){for(let k=e;k<s-2;k+=2)a.push(t[k],t[k+1]);return}const o=t[e],l=t[e+1],h=t[s-4]-o,d=t[s-3]-l,f=Math.hypot(h,d),m=h/f,y=d/f,b=m*l-y*o,v=d/h,w=1/f,A=Math.atan(v),x=Math.cos(A),S=Math.sin(A),T=w*(Math.abs(x)+Math.abs(S)),C=w*(1-T+T**2),N=Math.max(Math.atan(Math.abs(S+x)*C),Math.atan(Math.abs(S-x)*C));let D=0,L=e;for(let k=e+2;k<s-2;k+=2){const V=Math.abs(b-m*t[k+1]+y*t[k]);V>D&&(L=k,D=V)}D>(f*N)**2?(this.#i(t,e,L+2,a),this.#i(t,L,s,a)):a.push(o,l)}static#o(t){const e=[],s=t.length;return this.#i(t,0,s,e),e.push(t[s-2],t[s-1]),e.length<=4?null:e}static#c(t,e,s,a,o,l){const h=new Float32Array(l**2),d=-2*a**2,f=l>>1;for(let A=0;A<l;A++){const x=(A-f)**2;for(let S=0;S<l;S++)h[A*l+S]=Math.exp((x+(S-f)**2)/d)}const m=new Float32Array(256),y=-2*o**2;for(let A=0;A<256;A++)m[A]=Math.exp(A**2/y);const b=t.length,v=new Uint8Array(b),w=new Uint32Array(256);for(let A=0;A<s;A++)for(let x=0;x<e;x++){const S=A*e+x,T=t[S];let C=0,N=0;for(let L=0;L<l;L++){const k=A+L-f;if(!(k<0||k>=s))for(let V=0;V<l;V++){const K=x+V-f;if(K<0||K>=e)continue;const J=t[k*e+K],W=h[L*l+V]*m[Math.abs(J-T)];C+=J*W,N+=W}}const D=v[S]=Math.round(C/N);w[D]++}return[v,w]}static#l(t){const e=new Uint32Array(256);for(const s of t)e[s]++;return e}static#d(t){const e=t.length,s=new Uint8ClampedArray(e>>2);let a=-1/0,o=1/0;for(let h=0,d=s.length;h<d;h++){const f=s[h]=t[h<<2];a=Math.max(a,f),o=Math.min(o,f)}const l=255/(a-o);for(let h=0,d=s.length;h<d;h++)s[h]=(s[h]-o)*l;return s}static#h(t){let e,s=-1/0,a=-1/0;const o=t.findIndex(d=>d!==0);let l=o,h=o;for(e=o;e<256;e++){const d=t[e];d>s&&(e-l>a&&(a=e-l,h=e-1),s=d,l=e)}for(e=h-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#f(t){const e=t,{width:s,height:a}=t,{maxDim:o}=this.#t;let l=s,h=a;if(s>o||a>o){let b=s,v=a,w=Math.log2(Math.max(s,a)/o);const A=Math.floor(w);w=w===A?A-1:A;for(let S=0;S<w;S++){l=Math.ceil(b/2),h=Math.ceil(v/2);const T=new OffscreenCanvas(l,h);T.getContext("2d").drawImage(t,0,0,b,v,0,0,l,h),b=l,v=h,t!==e&&t.close(),t=T.transferToImageBitmap()}const x=Math.min(o/l,o/h);l=Math.round(l*x),h=Math.round(h*x)}const f=new OffscreenCanvas(l,h).getContext("2d",{willReadFrequently:!0});f.fillStyle="white",f.fillRect(0,0,l,h),f.filter="grayscale(1)",f.drawImage(t,0,0,t.width,t.height,0,0,l,h);const m=f.getImageData(0,0,l,h).data;return[this.#d(m),l,h]}static extractContoursFromText(t,{fontFamily:e,fontStyle:s,fontWeight:a},o,l,h,d){let f=new OffscreenCanvas(1,1),m=f.getContext("2d",{alpha:!1});const y=200,b=m.font=`${s} ${a} ${y}px ${e}`,{actualBoundingBoxLeft:v,actualBoundingBoxRight:w,actualBoundingBoxAscent:A,actualBoundingBoxDescent:x,fontBoundingBoxAscent:S,fontBoundingBoxDescent:T,width:C}=m.measureText(t),N=1.5,D=Math.ceil(Math.max(Math.abs(v)+Math.abs(w)||0,C)*N),L=Math.ceil(Math.max(Math.abs(A)+Math.abs(x)||y,Math.abs(S)+Math.abs(T)||y)*N);f=new OffscreenCanvas(D,L),m=f.getContext("2d",{alpha:!0,willReadFrequently:!0}),m.font=b,m.filter="grayscale(1)",m.fillStyle="white",m.fillRect(0,0,D,L),m.fillStyle="black",m.fillText(t,D*(N-1)/2,L*(3-N)/2);const k=this.#d(m.getImageData(0,0,D,L).data),V=this.#l(k),K=this.#h(V),J=this.#a(k,D,L,K);return this.processDrawnLines({lines:{curves:J,width:D,height:L},pageWidth:o,pageHeight:l,rotation:h,innerMargin:d,mustSmooth:!0,areContours:!0})}static process(t,e,s,a,o){const[l,h,d]=this.#f(t),[f,m]=this.#c(l,h,d,Math.hypot(h,d)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),y=this.#h(m),b=this.#a(f,h,d,y);return this.processDrawnLines({lines:{curves:b,width:h,height:d},pageWidth:e,pageHeight:s,rotation:a,innerMargin:o,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:a,innerMargin:o,mustSmooth:l,areContours:h}){a%180!==0&&([e,s]=[s,e]);const{curves:d,width:f,height:m}=t,y=t.thickness??0,b=[],v=Math.min(e/f,s/m),w=v/e,A=v/s,x=[];for(const{points:T}of d){const C=l?this.#o(T):T;if(!C)continue;x.push(C);const N=C.length,D=new Float32Array(N),L=new Float32Array(3*(N===2?2:N-2));if(b.push({line:L,points:D}),N===2){D[0]=C[0]*w,D[1]=C[1]*A,L.set([NaN,NaN,NaN,NaN,D[0],D[1]],0);continue}let[k,V,K,J]=C;k*=w,V*=A,K*=w,J*=A,D.set([k,V,K,J],0),L.set([NaN,NaN,NaN,NaN,k,V],0);for(let W=4;W<N;W+=2){const pt=D[W]=C[W]*w,Tt=D[W+1]=C[W+1]*A;L.set(st.createBezierPoints(k,V,K,J,pt,Tt),(W-2)*3),[k,V,K,J]=[K,J,pt,Tt]}}if(b.length===0)return null;const S=h?new uf:new _o;return S.build(b,e,s,1,a,h?0:y,o),{outline:S,newCurves:x,areContours:h,thickness:y,width:f,height:m}}static async compressSignature({outlines:t,areContours:e,thickness:s,width:a,height:o}){let l=1/0,h=-1/0,d=0;for(const C of t){d+=C.length;for(let N=2,D=C.length;N<D;N++){const L=C[N]-C[N-2];l=Math.min(l,L),h=Math.max(h,L)}}let f;l>=-128&&h<=127?f=Int8Array:l>=-32768&&h<=32767?f=Int16Array:f=Int32Array;const m=t.length,y=Jl+Hr*m,b=new Uint32Array(y);let v=0;b[v++]=y*Uint32Array.BYTES_PER_ELEMENT+(d-2*m)*f.BYTES_PER_ELEMENT,b[v++]=0,b[v++]=a,b[v++]=o,b[v++]=e?0:1,b[v++]=Math.max(0,Math.floor(s??0)),b[v++]=m,b[v++]=f.BYTES_PER_ELEMENT;for(const C of t)b[v++]=C.length-2,b[v++]=C[0],b[v++]=C[1];const w=new CompressionStream("deflate-raw"),A=w.writable.getWriter();await A.ready,A.write(b);const x=f.prototype.constructor;for(const C of t){const N=new x(C.length-2);for(let D=2,L=C.length;D<L;D++)N[D-2]=C[D]-C[D-2];A.write(N)}A.close();const S=await new Response(w.readable).arrayBuffer(),T=new Uint8Array(S);return Zv(T)}static async decompressSignature(t){try{const e=yE(t),{readable:s,writable:a}=new DecompressionStream("deflate-raw"),o=a.getWriter();await o.ready,o.write(e).then(async()=>{await o.ready,await o.close()}).catch(()=>{});let l=null,h=0;for await(const C of s)l||=new Uint8Array(new Uint32Array(C.buffer,0,4)[0]),l.set(C,h),h+=C.length;const d=new Uint32Array(l.buffer,0,l.length>>2),f=d[1];if(f!==0)throw new Error(`Invalid version: ${f}`);const m=d[2],y=d[3],b=d[4]===0,v=d[5],w=d[6],A=d[7],x=[],S=(Jl+Hr*w)*Uint32Array.BYTES_PER_ELEMENT;let T;switch(A){case Int8Array.BYTES_PER_ELEMENT:T=new Int8Array(l.buffer,S);break;case Int16Array.BYTES_PER_ELEMENT:T=new Int16Array(l.buffer,S);break;case Int32Array.BYTES_PER_ELEMENT:T=new Int32Array(l.buffer,S);break}h=0;for(let C=0;C<w;C++){const N=d[Hr*C+Jl],D=new Float32Array(N+2);x.push(D);for(let L=0;L<Hr-1;L++)D[L]=d[Hr*C+Jl+L+1];for(let L=0;L<N;L++)D[L+2]=D[L]+T[h++]}return{areContours:b,thickness:v,outlines:x,width:m,height:y}}catch(e){return vt(`decompressSignature: ${e}`),null}}}class Yf extends R_{constructor(){super(),super.updateProperties({fill:ct._defaultLineColor,"stroke-width":0})}clone(){const t=new Yf;return t.updateAll(this),t}}class Kf extends $c{constructor(t){super(t),super.updateProperties({stroke:ct._defaultLineColor,"stroke-width":1})}clone(){const t=new Kf(this._viewParameters);return t.updateAll(this),t}}class Yn extends Ut{#t=!1;#e=null;#s=null;#n=null;static _type="signature";static _editorType=At.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#s=t.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){ct.initialize(t,e),this._defaultDrawingOptions=new Yf,this._defaultDrawnSignatureOptions=new Kf(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return _t(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:s}=this;if(s&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(this.#s){const{lines:a,mustSmooth:o,areContours:l,description:h,uuid:d,heightInPage:f}=this.#s,{rawDims:{pageWidth:m,pageHeight:y},rotation:b}=this.parent.viewport,v=Ra.processDrawnLines({lines:a,pageWidth:m,pageHeight:y,rotation:b,innerMargin:Yn._INNER_MARGIN,mustSmooth:o,areContours:l});this.addSignature(v,f,h,d)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#e||""}));return s&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#n=t,this.addEditToolbar()}getUuid(){return this.#n}get description(){return this.#e}set description(t){this.#e=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:s,width:a,height:o}=this.#s,l=Math.max(a,o),h=Ra.processDrawnLines({lines:{curves:t.map(d=>({points:d})),thickness:s,width:a,height:o},pageWidth:l,pageHeight:l,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:h.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,s,a){const{x:o,y:l}=this,{outline:h}=this.#s=t;this.#t=h instanceof uf,this.description=s;let d;this.#t?d=Yn.getDefaultDrawingOptions():(d=Yn._defaultDrawnSignatureOptions.clone(),d.updateProperties({"stroke-width":h.thickness})),this._addOutlines({drawOutlines:h,drawingOptions:d});const[,f]=this.pageDimensions;let m=e/f;m=m>=1?.5:m,this.width*=m/this.height,this.width>=1&&(m*=.9/this.width,this.width=.9),this.height=m,this.setDims(),this.x=o,this.y=l,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(a),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!a,hasDescription:!!s}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:s},rotation:a}=this.parent.viewport;return Ra.process(t,e,s,a,Yn._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:s,pageHeight:a},rotation:o}=this.parent.viewport;return Ra.extractContoursFromText(t,e,s,a,o,Yn._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:s},rotation:a}=this.parent.viewport;return Ra.processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:a,innerMargin:Yn._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=Yn.getDefaultDrawingOptions():(this._drawingOptions=Yn._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:s}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":a}}=this,o=Object.assign(super.serialize(t),{isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:a});return this.addComment(o),t?(o.paths={lines:e,points:s},o.uuid=this.#n,o.isCopy=!0):o.lines=e,this.#e&&(o.accessibilityData={type:"Figure",alt:this.#e}),o}static deserializeDraw(t,e,s,a,o,l){return l.areContours?uf.deserialize(t,e,s,a,o,l):_o.deserialize(t,e,s,a,o,l)}static async deserialize(t,e,s){const a=await super.deserialize(t,e,s);return a.#t=t.areContours,a.description=t.accessibilityData?.alt||"",a.#n=t.uuid,a}}class nT extends ct{#t=null;#e=null;#s=null;#n=null;#r=null;#a="";#i=null;#o=!1;#c=null;#l=!1;#d=!1;static _type="stamp";static _editorType=At.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#n=t.bitmapUrl,this.#r=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){ct.initialize(t,e)}static isHandlingMimeForPasting(t){return tf.includes(t)}static paste(t,e){e.pasteEditor({mode:At.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#h(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#l=t.isSvg),t.file&&(this.#a=t.file.name),this.#m()}#f(){if(this.#s=null,this._uiManager.enableWaiting(!1),!!this.#i){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:a,width:o,height:l}=t||this.copyCanvas(null,null,!0).imageData,h=await s.guess({name:"altText",request:{data:a,width:o,height:l,channels:a.length/(o*l)}});if(!h)throw new Error("No response from the AI service.");if(h.error)throw new Error("Error from the AI service.");if(h.cancel)return null;if(!h.output)throw new Error("No valid response from the AI service.");const d=h.output;return await this.setGuessedAltText(d),e&&!this.hasAltTextData()&&(this.altTextData={alt:d,decorative:!1}),d}#g(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(s=>this.#h(s,!0)).finally(()=>this.#f());return}if(this.#n){const s=this.#n;this.#n=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromUrl(s).then(a=>this.#h(a)).finally(()=>this.#f());return}if(this.#r){const s=this.#r;this.#r=null,this._uiManager.enableWaiting(!0),this.#s=this._uiManager.imageManager.getFromFile(s).then(a=>this.#h(a)).finally(()=>this.#f());return}const t=document.createElement("input");t.type="file",t.accept=tf.join(",");const e=this._uiManager._signal;this.#s=new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const a=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#h(a)}s()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),s()},{signal:e})}).finally(()=>this.#f()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#i?.remove(),this.#i=null,this.#c&&(clearTimeout(this.#c),this.#c=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#g();return}super.rebuild(),this.div!==null&&(this.#e&&this.#i===null&&this.#g(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#s||this.#t||this.#n||this.#r||this.#e||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#t?this.#m():this.#g()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:s,bitmap:a}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),s&&this._uiManager.imageManager.isValidId(s)&&(this.#e=s,a&&(this.#t=a),this.#o=!1,this.#m())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#c!==null&&clearTimeout(this.#c);const t=200;this.#c=setTimeout(()=>{this.#c=null,this.#p()},t)}#m(){const{div:t}=this;let{width:e,height:s}=this.#t;const[a,o]=this.pageDimensions,l=.75;if(this.width)e=this.width*a,s=this.height*o;else if(e>l*a||s>l*o){const d=Math.min(l*a/e,l*o/s);e*=d,s*=d}this._uiManager.enableWaiting(!1);const h=this.#i=document.createElement("canvas");h.setAttribute("role","img"),this.addContainer(h),this.width=e/a,this.height=s/o,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#p(),this.#d||(this.parent.addUndoableEditor(this),this.#d=!0),this._reportTelemetry({action:"inserted_image"}),this.#a&&this.div.setAttribute("aria-description",this.#a),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,s=!1){t||(t=224);const{width:a,height:o}=this.#t,l=new Zn;let h=this.#t,d=a,f=o,m=null;if(e){if(a>e||o>e){const L=Math.min(e/a,e/o);d=Math.floor(a*L),f=Math.floor(o*L)}m=document.createElement("canvas");const b=m.width=Math.ceil(d*l.sx),v=m.height=Math.ceil(f*l.sy);this.#l||(h=this.#u(b,v));const w=m.getContext("2d");w.filter=this._uiManager.hcmFilter;let A="white",x="#cfcfd8";this._uiManager.hcmFilter!=="none"?x="black":SE.isDarkMode&&(A="#8f8f9d",x="#42414d");const S=15,T=S*l.sx,C=S*l.sy,N=new OffscreenCanvas(T*2,C*2),D=N.getContext("2d");D.fillStyle=A,D.fillRect(0,0,T*2,C*2),D.fillStyle=x,D.fillRect(0,0,T,C),D.fillRect(T,C,T,C),w.fillStyle=w.createPattern(N,"repeat"),w.fillRect(0,0,b,v),w.drawImage(h,0,0,h.width,h.height,0,0,b,v)}let y=null;if(s){let b,v;if(l.symmetric&&h.width<t&&h.height<t)b=h.width,v=h.height;else if(h=this.#t,a>t||o>t){const x=Math.min(t/a,t/o);b=Math.floor(a*x),v=Math.floor(o*x),this.#l||(h=this.#u(b,v))}const A=new OffscreenCanvas(b,v).getContext("2d",{willReadFrequently:!0});A.drawImage(h,0,0,h.width,h.height,0,0,b,v),y={width:b,height:v,data:A.getImageData(0,0,b,v).data}}return{canvas:m,width:d,height:f,imageData:y}}#u(t,e){const{width:s,height:a}=this.#t;let o=s,l=a,h=this.#t;for(;o>2*t||l>2*e;){const d=o,f=l;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),l>2*e&&(l=l>=16384?Math.floor(l/2)-1:Math.ceil(l/2));const m=new OffscreenCanvas(o,l);m.getContext("2d").drawImage(h,0,0,d,f,0,0,o,l),h=m.transferToImageBitmap()}return h}#p(){const[t,e]=this.parentDimensions,{width:s,height:a}=this,o=new Zn,l=Math.ceil(s*t*o.sx),h=Math.ceil(a*e*o.sy),d=this.#i;if(!d||d.width===l&&d.height===h)return;d.width=l,d.height=h;const f=this.#l?this.#t:this.#u(l,h),m=d.getContext("2d");m.filter=this._uiManager.hcmFilter,m.drawImage(f,0,0,f.width,f.height,0,0,l,h)}#y(t){if(t){if(this.#l){const a=this._uiManager.imageManager.getSvgUrl(this.#e);if(a)return a}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#l){const[e,s]=this.pageDimensions,a=Math.round(this.width*e*Fa.PDF_TO_CSS_UNITS),o=Math.round(this.height*s*Fa.PDF_TO_CSS_UNITS),l=new OffscreenCanvas(a,o);return l.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,a,o),l.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,s){let a=null,o=!1;if(t instanceof T_){const{data:{rect:A,rotation:x,id:S,structParent:T,popupRef:C,richText:N,contentsObj:D,creationDate:L,modificationDate:k},container:V,parent:{page:{pageNumber:K}},canvas:J}=t;let W,pt;J?(delete t.canvas,{id:W,bitmap:pt}=s.imageManager.getFromCanvas(V.id,J),J.remove()):(o=!0,t._hasNoCanvas=!0);const Tt=(await e._structTree.getAriaAttributes(`${Da}${S}`))?.get("aria-label")||"";a=t={annotationType:At.STAMP,bitmapId:W,bitmap:pt,pageIndex:K-1,rect:A.slice(0),rotation:x,annotationElementId:S,id:S,deleted:!1,accessibilityData:{decorative:!1,altText:Tt},isSvg:!1,structParent:T,popupRef:C,richText:N,comment:D?.str||null,creationDate:L,modificationDate:k}}const l=await super.deserialize(t,e,s),{rect:h,bitmap:d,bitmapUrl:f,bitmapId:m,isSvg:y,accessibilityData:b}=t;o?(s.addMissingCanvas(t.id,l),l.#o=!0):m&&s.imageManager.isValidId(m)?(l.#e=m,d&&(l.#t=d)):l.#n=f,l.#l=y;const[v,w]=l.pageDimensions;return l.width=(h[2]-h[0])/v,l.height=(h[3]-h[1])/w,b&&(l.altTextData=b),l._initialData=a,t.comment&&l.setCommentData(t),l.#d=!!a,l}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Object.assign(super.serialize(t),{bitmapId:this.#e,isSvg:this.#l});if(this.addComment(s),t)return s.bitmapUrl=this.#y(!0),s.accessibilityData=this.serializeAltText(!0),s.isCopy=!0,s;const{decorative:a,altText:o}=this.serializeAltText(!1);if(!a&&o&&(s.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const h=this.#v(s);return h.isSame?null:(h.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1,s.id=this.annotationElementId,delete s.bitmapId,s)}if(e===null)return s;e.stamps||=new Map;const l=this.#l?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:l,serialized:s}),s.bitmap=this.#y(!1);else if(this.#l){const h=e.stamps.get(this.#e);l>h.area&&(h.area=l,h.serialized.bitmap.close(),h.serialized.bitmap=this.#y(!1))}return s}#v(t){const{pageIndex:e,accessibilityData:{altText:s}}=this._initialData,a=t.pageIndex===e,o=(t.accessibilityData?.alt||"")===s;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&a&&o,isSameAltText:o}}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class As{#t;#e=!1;#s=null;#n=null;#r=null;#a=new Map;#i=!1;#o=!1;#c=!1;#l=null;#d=null;#h=null;#f=null;#g=null;#m=-1;#u;static _initialized=!1;static#p=new Map([xe,Vf,nT,ce,Yn].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:s,structTreeLayer:a,accessibilityManager:o,annotationLayer:l,drawLayer:h,textLayer:d,viewport:f,l10n:m}){const y=[...As.#p.values()];if(!As._initialized){As._initialized=!0;for(const b of y)b.initialize(m,t)}t.registerEditorTypes(y),this.#u=t,this.pageIndex=e,this.div=s,this.#t=o,this.#s=l,this.viewport=f,this.#h=d,this.drawLayer=h,this._structTree=a,this.#u.addLayer(this)}get isEmpty(){return this.#a.size===0}get isInvisible(){return this.isEmpty&&this.#u.getMode()===At.NONE}updateToolbar(t){this.#u.updateToolbar(t)}updateMode(t=this.#u.getMode()){switch(this.#A(),t){case At.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case At.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case At.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;if(e.toggle("nonEditing",!1),t===At.POPUP)e.toggle("commentEditing",!0);else{e.toggle("commentEditing",!1);for(const s of As.#p.values())e.toggle(`${s._type}Editing`,t===s._editorType)}this.div.hidden=!1}hasTextLayer(t){return t===this.#h?.div}setEditingState(t){this.#u.setEditingState(t)}addCommands(t){this.#u.addCommands(t)}cleanUndoStack(t){this.#u.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#s?.togglePointerEvents(t)}get#y(){return this.#a.size!==0?this.#a.values():this.#u.getEditors(this.pageIndex)}async enable(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#g?.abort(),this.#g=null;const t=new Set;for(const s of this.#y)s.enableEditing(),s.show(!0),s.annotationElementId&&(this.#u.removeChangedExistingAnnotation(s),t.add(s.annotationElementId));const e=this.#s;if(e)for(const s of e.getEditableAnnotations()){if(s.hide(),this.#u.isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;const a=await this.deserialize(s);a&&(this.addOrRebuild(a),a.enableEditing())}this.#c=!1,this.#u._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#h&&!this.#g){this.#g=new AbortController;const a=this.#u.combinedSignal(this.#g);this.#h.div.addEventListener("pointerdown",o=>{const{clientX:h,clientY:d,timeStamp:f}=o,m=this.#m;if(f-m>500){this.#m=f;return}this.#m=-1;const{classList:y}=this.div;y.toggle("getElements",!0);const b=document.elementsFromPoint(h,d);if(y.toggle("getElements",!1),!this.div.contains(b[0]))return;let v;const w=new RegExp(`^${ao}[0-9]+$`);for(const x of b)if(w.test(x.id)){v=x.id;break}if(!v)return;const A=this.#a.get(v);A?.annotationElementId===null&&(o.stopPropagation(),o.preventDefault(),A.dblclick(o))},{signal:a,capture:!0})}const t=this.#s,e=[];if(t){const a=new Map,o=new Map;for(const h of this.#y){if(h.disableEditing(),!h.annotationElementId){e.push(h);continue}if(h.serialize()!==null){a.set(h.annotationElementId,h);continue}else o.set(h.annotationElementId,h);this.getEditableAnnotation(h.annotationElementId)?.show(),h.remove()}const l=t.getEditableAnnotations();for(const h of l){const{id:d}=h.data;if(this.#u.isDeletedAnnotationElement(d)){h.updateEdited({deleted:!0});continue}let f=o.get(d);if(f){f.resetAnnotationElement(h),f.show(!1),h.show();continue}f=a.get(d),f&&(this.#u.addChangedExistingAnnotation(f),f.renderAnnotationElement(h)&&f.show(!1)),h.show()}}this.#A(),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const a of As.#p.values())s.remove(`${a._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),t?.updateFakeAnnotations(e),this.#o=!1}getEditableAnnotation(t){return this.#s?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#u.getActive()!==t&&this.#u.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#h?.div&&!this.#f){this.#f=new AbortController;const t=this.#u.combinedSignal(this.#f);this.#h.div.addEventListener("pointerdown",this.#v.bind(this),{signal:t}),this.#h.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#h?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#h.div.classList.remove("highlighting"))}#v(t){this.#u.unselectAll();const{target:e}=t;if(e===this.#h.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#h.div.contains(e)){const{isMac:s}=Ae.platform;if(t.button!==0||t.ctrlKey&&s)return;this.#u.showAllEditors("highlight",!0,!0),this.#h.div.classList.add("free"),this.toggleDrawing(),ce.startHighlighting(this,this.#u.direction==="ltr",{target:this.#h.div,x:t.x,y:t.y}),this.#h.div.addEventListener("pointerup",()=>{this.#h.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#u._signal}),t.preventDefault()}}enableClick(){if(this.#n)return;this.#n=new AbortController;const t=this.#u.combinedSignal(this.#n);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#n?.abort(),this.#n=null}attach(t){this.#a.set(t.id,t);const{annotationElementId:e}=t;e&&this.#u.isDeletedAnnotationElement(e)&&this.#u.removeDeletedAnnotationElement(t)}detach(t){this.#a.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#o&&t.annotationElementId&&this.#u.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#u.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#u.addDeletedAnnotationElement(t),ct.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#u.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#c),this.#u.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#r&&(t._focusEventsAllowed=!1,this.#r=setTimeout(()=>{this.#r=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#u._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),s=()=>{t.remove()};this.addCommands({cmd:e,undo:s,mustExec:!1})}getEditorByUID(t){for(const e of this.#a.values())if(e.uid===t)return e;return null}getNextId(){return this.#u.getId()}get#b(){return As.#p.get(this.#u.getMode())}combinedSignal(t){return this.#u.combinedSignal(t)}#x(t){const e=this.#b;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#b?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#u.updateMode(t.mode);const{offsetX:s,offsetY:a}=this.#S(),o=this.getNextId(),l=this.#x({parent:this,id:o,x:s,y:a,uiManager:this.#u,isCentered:!0,...e});l&&this.add(l)}async deserialize(t){return await As.#p.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#u)||null}createAndAddNewEditor(t,e,s={}){const a=this.getNextId(),o=this.#x({parent:this,id:a,x:t.offsetX,y:t.offsetY,uiManager:this.#u,isCentered:e,...s});return o&&this.add(o),o}get boundingClientRect(){return this.div.getBoundingClientRect()}#S(){const{x:t,y:e,width:s,height:a}=this.boundingClientRect,o=Math.max(0,t),l=Math.max(0,e),h=Math.min(window.innerWidth,t+s),d=Math.min(window.innerHeight,e+a),f=(o+h)/2-t,m=(l+d)/2-e,[y,b]=this.viewport.rotation%180===0?[f,m]:[m,f];return{offsetX:y,offsetY:b}}addNewEditor(t={}){this.createAndAddNewEditor(this.#S(),!0,t)}setSelected(t){this.#u.setSelected(t)}toggleSelected(t){this.#u.toggleSelected(t)}unselect(t){this.#u.unselect(t)}pointerup(t){const{isMac:e}=Ae.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!this.#i||(this.#i=!1,this.#b?.isDrawer&&this.#b.supportMultipleDrawings))return;if(!this.#e){this.#e=!0;return}const s=this.#u.getMode();if(s===At.STAMP||s===At.SIGNATURE){this.#u.unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){if(this.#u.getMode()===At.HIGHLIGHT&&this.enableTextSelection(),this.#i){this.#i=!1;return}const{isMac:e}=Ae.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#i=!0,this.#b?.isDrawer){this.startDrawingSession(t);return}const s=this.#u.getActive();this.#e=!s||s.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#l){this.#b.startDrawing(this,this.#u,!1,t);return}this.#u.setCurrentDrawingSession(this),this.#l=new AbortController;const e=this.#u.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(this.#d=null,this.commitOrRemove())},{signal:e}),this.#b.startDrawing(this,this.#u,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#d=e);return}this.#d&&setTimeout(()=>{this.#d?.focus(),this.#d=null},0)}endDrawingSession(t=!1){return this.#l?(this.#u.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#d=null,this.#b.endDrawing(t)):null}findNewParent(t,e,s){const a=this.#u.findParent(e,s);return a===null||a===this?!1:(a.changeParent(t),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#b.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#u.getActive()?.parent===this&&(this.#u.commitOrRemove(),this.#u.setActiveEditor(null)),this.#r&&(clearTimeout(this.#r),this.#r=null);for(const t of this.#a.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#a.clear(),this.#u.removeLayer(this)}#A(){for(const t of this.#a.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,Oi(this.div,t);for(const e of this.#u.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#u.commitOrRemove(),this.#A();const e=this.viewport.rotation,s=t.rotation;if(this.viewport=t,Oi(this.div,{rotation:s}),e!==s)for(const a of this.#a.values())a.rotate(s)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#u.viewParameters.realScale}}class Le{#t=null;#e=new Map;#s=new Map;static#n=0;constructor({pageIndex:t}){this.pageIndex=t}setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#e.size>0)for(const e of this.#e.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return _t(this,"_svgFactory",new Sc)}static#r(t,[e,s,a,o]){const{style:l}=t;l.top=`${100*s}%`,l.left=`${100*e}%`,l.width=`${100*a}%`,l.height=`${100*o}%`}#a(){const t=Le._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#i(t,e){const s=Le._svgFactory.createElement("clipPath");t.append(s);const a=`clip_${e}`;s.setAttribute("id",a),s.setAttribute("clipPathUnits","objectBoundingBox");const o=Le._svgFactory.createElement("use");return s.append(o),o.setAttribute("href",`#${e}`),o.classList.add("clip"),a}#o(t,e){for(const[s,a]of Object.entries(e))a===null?t.removeAttribute(s):t.setAttribute(s,a)}draw(t,e=!1,s=!1){const a=Le.#n++,o=this.#a(),l=Le._svgFactory.createElement("defs");o.append(l);const h=Le._svgFactory.createElement("path");l.append(h);const d=`path_p${this.pageIndex}_${a}`;h.setAttribute("id",d),h.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#s.set(a,h);const f=s?this.#i(l,d):null,m=Le._svgFactory.createElement("use");return o.append(m),m.setAttribute("href",`#${d}`),this.updateProperties(o,t),this.#e.set(a,o),{id:a,clipPathId:`url(#${f})`}}drawOutline(t,e){const s=Le.#n++,a=this.#a(),o=Le._svgFactory.createElement("defs");a.append(o);const l=Le._svgFactory.createElement("path");o.append(l);const h=`path_p${this.pageIndex}_${s}`;l.setAttribute("id",h),l.setAttribute("vector-effect","non-scaling-stroke");let d;if(e){const y=Le._svgFactory.createElement("mask");o.append(y),d=`mask_p${this.pageIndex}_${s}`,y.setAttribute("id",d),y.setAttribute("maskUnits","objectBoundingBox");const b=Le._svgFactory.createElement("rect");y.append(b),b.setAttribute("width","1"),b.setAttribute("height","1"),b.setAttribute("fill","white");const v=Le._svgFactory.createElement("use");y.append(v),v.setAttribute("href",`#${h}`),v.setAttribute("stroke","none"),v.setAttribute("fill","black"),v.setAttribute("fill-rule","nonzero"),v.classList.add("mask")}const f=Le._svgFactory.createElement("use");a.append(f),f.setAttribute("href",`#${h}`),d&&f.setAttribute("mask",`url(#${d})`);const m=f.cloneNode();return a.append(m),f.classList.add("mainOutline"),m.classList.add("secondaryOutline"),this.updateProperties(a,t),this.#e.set(s,a),s}finalizeDraw(t,e){this.#s.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:s,bbox:a,rootClass:o,path:l}=e,h=typeof t=="number"?this.#e.get(t):t;if(h){if(s&&this.#o(h,s),a&&Le.#r(h,a),o){const{classList:d}=h;for(const[f,m]of Object.entries(o))d.toggle(f,m)}if(l){const f=h.firstElementChild.firstElementChild;this.#o(f,l)}}}updateParent(t,e){if(e===this)return;const s=this.#e.get(t);s&&(e.#t.append(s),this.#e.delete(t),e.#e.set(t,s))}remove(t){this.#s.delete(t),this.#t!==null&&(this.#e.get(t).remove(),this.#e.delete(t))}destroy(){this.#t=null;for(const t of this.#e.values())t.remove();this.#e.clear(),this.#s.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:lf};globalThis.pdfjsLib={AbortException:Js,AnnotationEditorLayer:As,AnnotationEditorParamsType:kt,AnnotationEditorType:At,AnnotationEditorUIManager:ti,AnnotationLayer:Xf,AnnotationMode:Qs,AnnotationType:me,applyOpacity:xE,build:Nx,ColorPicker:On,createValidAbsoluteUrl:Yv,CSSConstants:EE,DOMSVGFactory:Sc,DrawLayer:Le,FeatureTest:Ae,fetchData:mo,findContrastColor:TE,getDocument:y_,getFilenameFromUrl:bE,getPdfFilenameFromUrl:vE,getRGB:yo,getUuid:Qv,getXfaPageViewport:AE,GlobalWorkerOptions:Ia,ImageKind:cc,InvalidPDFException:Zd,isDataScheme:Hc,isPdfFile:If,isValidExplicitDest:PE,MathClamp:je,noContextMenu:Ln,normalizeUnicode:mE,OPS:ro,OutputScale:Zn,PasswordResponses:rE,PDFDataRangeTransport:b_,PDFDateString:Jd,PDFWorker:lo,PermissionFlag:aE,PixelsPerInch:Fa,RenderingCancelledException:Bf,renderRichText:t_,ResponseException:Ac,setLayerDimensions:Oi,shadow:_t,SignatureExtractor:Ra,stopEvent:ae,SupportedImageMimeTypes:tf,TextLayer:yn,TouchManager:jc,updateUrlHash:Kv,Util:nt,VerbosityLevel:Fc,version:A_,XfaLayer:Jv};function sT(c){return c.lineStart!==void 0?c.lineEnd!==void 0&&c.lineEnd!==c.lineStart?`Page ${c.page}, Lines ${c.lineStart}-${c.lineEnd}`:`Page ${c.page}, Line ${c.lineStart}`:c.charStart!==void 0?`Page ${c.page}, Position ${c.charStart}`:`Page ${c.page}`}Ia.workerSrc=`//cdnjs.cloudflare.com/ajax/libs/pdf.js/${A_}/pdf.worker.min.js`;async function iT(c){return new Promise((t,e)=>{const s=new FileReader;s.onload=a=>{const o=a.target?.result;t(o)},s.onerror=()=>e(new Error("Failed to read text file")),s.readAsText(c)})}async function aT(c){try{const t=await c.arrayBuffer(),s=await y_({data:t}).promise,a=[];for(let o=1;o<=s.numPages;o++){const d=(await(await s.getPage(o)).getTextContent()).items.map(f=>f.str).join(" ");a.push(`
--- Page ${o} ---
${d}`)}return{text:a.join(`
`),pageCount:s.numPages}}catch(t){throw console.error("PDF parsing error:",t),new Error("Failed to parse PDF file")}}async function rT(c){const t=c.name.toLowerCase().endsWith(".pdf"),e=t?"pdf":"txt";let s,a;if(t){const o=await aT(c);s=o.text,a=o.pageCount}else s=await iT(c);return{id:Cc(),title:c.name.replace(/\.(pdf|txt)$/i,""),sourceType:e,uploadedAt:new Date,rawText:s,pageCount:a}}function oT(c){const t=[];let e=1,s=0;const a=c.split(`
`);for(let o=0;o<a.length;o++){const l=a[o],h=l.match(/^(?:---\s*)?Page\s+(\d+)/i);if(h){e=parseInt(h[1],10),s+=l.length+1;continue}const d=l.match(/^\s*(\d+)\s+(Q\.|A\.)/);let f,m=l.trim();d&&(f=parseInt(d[1],10),m=l.substring(d.index+d[0].length).trim()),m.length>0&&t.push({pageNumber:e,lineNumber:f,text:m,charOffset:s}),s+=l.length+1}return t}function lT(c){const t=oT(c.rawText),e=[];let s={role:null,lines:[]};for(const a of t){const o=a.text.match(/^Q\.\s*/),l=a.text.match(/^A\.\s*/);o?(s.role&&s.lines.length>0&&e.push(kd(c.id,s)),s={role:"QUESTION",lines:[{...a,text:a.text.substring(o[0].length).trim()}],startLine:a.lineNumber}):l?(s.role&&s.lines.length>0&&e.push(kd(c.id,s)),s={role:"ANSWER",lines:[{...a,text:a.text.substring(l[0].length).trim()}],startLine:a.lineNumber}):s.role&&s.lines.push(a)}return s.role&&s.lines.length>0&&e.push(kd(c.id,s)),e}function kd(c,t){const e=t.lines[0],s=t.lines[t.lines.length-1],a=e.pageNumber,o=e.lineNumber,l=s.lineNumber,h=t.lines.map(m=>m.text).join(" ").trim(),d=sT({page:a,lineStart:o,lineEnd:l!==o?l:void 0,charStart:o===void 0?e.charOffset:void 0}),f=t.role==="QUESTION"?"Attorney":"Witness";return{id:Cc(),documentId:c,pageNumber:a,lineStart:o,lineEnd:l,speaker:f,role:t.role,text:h,citation:d,timestamp:new Date}}function cT(){const[c,t]=en.useState(!1),[e,s]=en.useState({stage:"idle",progress:0,message:""}),[a,o]=en.useState(null),[l,h]=en.useState(null),d=y=>{t(!0);try{C1(y.openaiApiKey)}catch(b){alert(`Failed to initialize OpenAI: ${b.message}`);return}if(y.chromaTenant&&y.chromaDatabase&&y.chromaApiKey)try{z1({tenant:y.chromaTenant,database:y.chromaDatabase,apiKey:y.chromaApiKey})}catch(b){console.warn("Failed to initialize Chroma:",b.message)}},f=async y=>{o(null),s({stage:"parsing",progress:10,message:"Parsing transcript file..."});try{const b=await rT(y);h(b),cS(b),s({stage:"parsing",progress:30,message:"Extracting Q&A utterances..."});const v=lT(b);uS(v);const w=v.filter(x=>x.role==="ANSWER").length;s({stage:"extracting",progress:40,message:`Extracting claims from ${w} witness responses... This may take a few minutes.`});const A=await I1(v,x=>{const S=40+x.current/x.total*20;s({stage:"extracting",progress:S,message:`Extracting claims... (${x.current}/${x.total})`})});hS(A),s({stage:"embedding",progress:60,message:"Generating embeddings for semantic search..."});try{const x=A.map(D=>D.normalizedText),S=await O1(x),T=A.map((D,L)=>({claim:D,embedding:S[L]}));try{await H1(T)}catch(D){console.warn("Chroma storage failed, will use local similarity:",D)}s({stage:"analyzing",progress:70,message:"Detecting contradictions... This may take several minutes."});const C=await $1(A,8,.7,D=>{const L=70+D.current/D.total*25;s({stage:"analyzing",progress:L,message:`Analyzing... (${D.current}/${D.total} claims, ${D.contradictionsFound} contradictions found)`})});dS(C),s({stage:"analyzing",progress:95,message:"Generating report..."});const N=Q1(b,A,C);o(N),s({stage:"complete",progress:100,message:`Analysis complete! Found ${A.length} claims and ${C.length} contradictions.`})}catch(x){console.error("Embedding/analysis error:",x),s({stage:"error",progress:0,message:"Analysis failed",error:x.message||"An error occurred during analysis"})}}catch(b){console.error("Processing error:",b),s({stage:"error",progress:0,message:"Processing failed",error:b.message||"An error occurred during processing"})}},m=()=>{o(null),h(null),s({stage:"idle",progress:0,message:""})};return H.jsxs("div",{className:"min-h-screen bg-gray-100",children:[H.jsx("header",{className:"bg-white shadow-sm border-b",children:H.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[H.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Legal Deposition Analysis Tool"}),H.jsx("p",{className:"text-gray-600 mt-1",children:"Automated contradiction detection and claim extraction from deposition transcripts"})]})}),H.jsxs("main",{className:"max-w-7xl mx-auto px-4 py-8",children:[!c&&H.jsx(fS,{onConfigured:d}),c&&!a&&e.stage==="idle"&&H.jsx(pS,{onFileSelected:f,disabled:e.stage!=="idle"}),c&&H.jsx(mS,{status:e}),c&&a&&H.jsxs(H.Fragment,{children:[H.jsx(iE,{report:a}),H.jsx("div",{className:"mt-6 text-center",children:H.jsx("button",{onClick:m,className:"bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 text-lg font-semibold",children:"Analyze Another Transcript"})})]}),c&&!l&&e.stage==="idle"&&H.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 mt-6",children:[H.jsx("h3",{className:"text-xl font-bold mb-4",children:"How It Works"}),H.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-gray-700",children:[H.jsx("li",{children:"Upload a deposition transcript (PDF or TXT format)"}),H.jsx("li",{children:"The system extracts all Q&A pairs and identifies witness statements"}),H.jsx("li",{children:"AI analyzes each statement to extract atomic claims"}),H.jsx("li",{children:"Claims are embedded and searched for semantic similarity"}),H.jsx("li",{children:"Potential contradictions are detected and classified"}),H.jsx("li",{children:"A comprehensive report is generated with citations"})]}),H.jsx("div",{className:"mt-6 bg-blue-50 border border-blue-200 rounded p-4",children:H.jsxs("p",{className:"text-sm text-blue-800",children:[H.jsx("strong",{children:"Note:"})," Processing time depends on transcript length. A 100-page deposition typically takes 3-5 minutes. The tool uses OpenAI API which may incur costs based on usage."]})})]})]}),H.jsx("footer",{className:"bg-white border-t mt-16",children:H.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6 text-center text-sm text-gray-600",children:[H.jsx("p",{children:"Legal Deposition Analysis Tool | Built with OpenAI GPT-4 and Chroma Cloud"}),H.jsx("p",{className:"mt-2",children:"For professional use only. All analysis should be reviewed by qualified legal professionals."})]})})]})}oS.createRoot(document.getElementById("root")).render(H.jsx(en.StrictMode,{children:H.jsx(cT,{})}));
